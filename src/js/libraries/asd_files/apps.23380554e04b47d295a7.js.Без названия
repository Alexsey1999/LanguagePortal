!function(e){function t(t){for(var n,a,s=t[0],c=t[1],l=t[2],_=0,d=[];_<s.length;_++)a=s[_],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&d.push(o[a][0]),o[a]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);for(p&&p(t);d.length;)d.shift()();return i.push.apply(i,l||[]),r()}function r(){for(var e,t=0;t<i.length;t++){for(var r=i[t],n=!0,s=1;s<r.length;s++){var c=r[s];0!==o[c]&&(n=!1)}n&&(i.splice(t--,1),e=a(a.s=r[0]))}return e}var n={},o={"web/apps":0},i=[];function a(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.e=function(){return Promise.resolve()},a.m=e,a.c=n,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/js/cmodules/";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var p=c;i.push([137,"evbus","common","palette","vendors","71af34534be10395f7f6bb3e2039fd2e","6d060d537289a948aac46495929784fe","23f13708e764b3c21f858fbe45ced5b3"]),r()}({"/MKj":function(e,t,r){"use strict";r.r(t),r.d(t,"Provider",(function(){return f})),r.d(t,"connectAdvanced",(function(){return R})),r.d(t,"ReactReduxContext",(function(){return l})),r.d(t,"connect",(function(){return ne})),r.d(t,"batch",(function(){return _e.unstable_batchedUpdates})),r.d(t,"useDispatch",(function(){return ae})),r.d(t,"useSelector",(function(){return le})),r.d(t,"useStore",(function(){return ie})),r.d(t,"shallowEqual",(function(){return k}));var n=r("JX7q"),o=r("dI71"),i=r("q1tI"),a=r.n(i),s=r("17x9"),c=r.n(s),l=a.a.createContext(null);var p=function(e){e()},_={notify:function(){}};function d(){var e=p,t=[],r=[];return{clear:function(){r=null,t=null},notify:function(){var n=t=r;e((function(){for(var e=0;e<n.length;e++)n[e]()}))},get:function(){return r},subscribe:function(e){var n=!0;return r===t&&(r=t.slice()),r.push(e),function(){n&&null!==t&&(n=!1,r===t&&(r=t.slice()),r.splice(r.indexOf(e),1))}}}}var u=function(){function e(e,t){this.store=e,this.parentSub=t,this.unsubscribe=null,this.listeners=_,this.handleChangeWrapper=this.handleChangeWrapper.bind(this)}var t=e.prototype;return t.addNestedSub=function(e){return this.trySubscribe(),this.listeners.subscribe(e)},t.notifyNestedSubs=function(){this.listeners.notify()},t.handleChangeWrapper=function(){this.onStateChange&&this.onStateChange()},t.isSubscribed=function(){return Boolean(this.unsubscribe)},t.trySubscribe=function(){this.unsubscribe||(this.unsubscribe=this.parentSub?this.parentSub.addNestedSub(this.handleChangeWrapper):this.store.subscribe(this.handleChangeWrapper),this.listeners=d())},t.tryUnsubscribe=function(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null,this.listeners.clear(),this.listeners=_)},e}(),h=function(e){function t(t){var r;r=e.call(this,t)||this;var o=t.store;r.notifySubscribers=r.notifySubscribers.bind(Object(n.default)(r));var i=new u(o);return i.onStateChange=r.notifySubscribers,r.state={store:o,subscription:i},r.previousState=o.getState(),r}Object(o.default)(t,e);var r=t.prototype;return r.componentDidMount=function(){this._isMounted=!0,this.state.subscription.trySubscribe(),this.previousState!==this.props.store.getState()&&this.state.subscription.notifyNestedSubs()},r.componentWillUnmount=function(){this.unsubscribe&&this.unsubscribe(),this.state.subscription.tryUnsubscribe(),this._isMounted=!1},r.componentDidUpdate=function(e){if(this.props.store!==e.store){this.state.subscription.tryUnsubscribe();var t=new u(this.props.store);t.onStateChange=this.notifySubscribers,this.setState({store:this.props.store,subscription:t})}},r.notifySubscribers=function(){this.state.subscription.notifyNestedSubs()},r.render=function(){var e=this.props.context||l;return a.a.createElement(e.Provider,{value:this.state},this.props.children)},t}(i.Component);h.propTypes={store:c.a.shape({subscribe:c.a.func.isRequired,dispatch:c.a.func.isRequired,getState:c.a.func.isRequired}),context:c.a.object,children:c.a.any};var f=h,m=r("wx14"),b=r("zLVn"),E=r("2mql"),g=r.n(E),v=r("QLaP"),O=r.n(v),w=r("TOwV"),y=[],A=[null,null];function S(e,t){var r=e[1];return[t.payload,r+1]}var C=function(){return[null,0]},P="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?i.useLayoutEffect:i.useEffect;function R(e,t){void 0===t&&(t={});var r=t,n=r.getDisplayName,o=void 0===n?function(e){return"ConnectAdvanced("+e+")"}:n,s=r.methodName,c=void 0===s?"connectAdvanced":s,p=r.renderCountProp,_=void 0===p?void 0:p,d=r.shouldHandleStateChanges,h=void 0===d||d,f=r.storeKey,E=void 0===f?"store":f,v=r.withRef,R=void 0!==v&&v,T=r.forwardRef,D=void 0!==T&&T,k=r.context,I=void 0===k?l:k,M=Object(b.default)(r,["getDisplayName","methodName","renderCountProp","shouldHandleStateChanges","storeKey","withRef","forwardRef","context"]);O()(void 0===_,"renderCountProp is removed. render counting is built into the latest React Dev Tools profiling extension"),O()(!R,"withRef is removed. To access the wrapped instance, use a ref on the connected component");O()("store"===E,"storeKey has been removed and does not do anything. To use a custom Redux store for specific components, create a custom React context with React.createContext(), and pass the context object to React Redux's Provider and specific components like: <Provider context={MyContext}><ConnectedComponent context={MyContext} /></Provider>. You may also pass a {context : MyContext} option to connect");var L=I;return function(t){var r=t.displayName||t.name||"Component",n=o(r),s=Object(m.default)({},M,{getDisplayName:o,methodName:c,renderCountProp:_,shouldHandleStateChanges:h,storeKey:E,displayName:n,wrappedComponentName:r,WrappedComponent:t}),l=M.pure;var p=l?i.useMemo:function(e){return e()};function d(r){var o=Object(i.useMemo)((function(){var e=r.forwardedRef,t=Object(b.default)(r,["forwardedRef"]);return[r.context,e,t]}),[r]),c=o[0],l=o[1],_=o[2],d=Object(i.useMemo)((function(){return c&&c.Consumer&&Object(w.isContextConsumer)(a.a.createElement(c.Consumer,null))?c:L}),[c,L]),f=Object(i.useContext)(d),E=Boolean(r.store),g=Boolean(f)&&Boolean(f.store);O()(E||g,'Could not find "store" in the context of "'+n+'". Either wrap the root component in a <Provider>, or pass a custom React context provider to <Provider> and the corresponding React context consumer to '+n+" in connect options.");var v=r.store||f.store,R=Object(i.useMemo)((function(){return function(t){return e(t.dispatch,s)}(v)}),[v]),T=Object(i.useMemo)((function(){if(!h)return A;var e=new u(v,E?null:f.subscription),t=e.notifyNestedSubs.bind(e);return[e,t]}),[v,E,f]),D=T[0],k=T[1],I=Object(i.useMemo)((function(){return E?f:Object(m.default)({},f,{subscription:D})}),[E,f,D]),M=Object(i.useReducer)(S,y,C),x=M[0][0],N=M[1];if(x&&x.error)throw x.error;var B=Object(i.useRef)(),j=Object(i.useRef)(_),U=Object(i.useRef)(),W=Object(i.useRef)(!1),H=p((function(){return U.current&&_===j.current?U.current:R(v.getState(),_)}),[v,x,_]);P((function(){j.current=_,B.current=H,W.current=!1,U.current&&(U.current=null,k())})),P((function(){if(h){var e=!1,t=null,r=function(){if(!e){var r,n,o=v.getState();try{r=R(o,j.current)}catch(e){n=e,t=e}n||(t=null),r===B.current?W.current||k():(B.current=r,U.current=r,W.current=!0,N({type:"STORE_UPDATED",payload:{latestStoreState:o,error:n}}))}};D.onStateChange=r,D.trySubscribe(),r();return function(){if(e=!0,D.tryUnsubscribe(),t)throw t}}}),[v,D,R]);var K=Object(i.useMemo)((function(){return a.a.createElement(t,Object(m.default)({},H,{ref:l}))}),[l,t,H]);return Object(i.useMemo)((function(){return h?a.a.createElement(d.Provider,{value:I},K):K}),[d,K,I])}var f=l?a.a.memo(d):d;if(f.WrappedComponent=t,f.displayName=n,D){var v=a.a.forwardRef((function(e,t){return a.a.createElement(f,Object(m.default)({},e,{forwardedRef:t}))}));return v.displayName=n,v.WrappedComponent=t,g()(v,t)}return g()(f,t)}}var T=Object.prototype.hasOwnProperty;function D(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}function k(e,t){if(D(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var o=0;o<r.length;o++)if(!T.call(t,r[o])||!D(e[r[o]],t[r[o]]))return!1;return!0}var I=r("ANjH");function M(e){return function(t,r){var n=e(t,r);function o(){return n}return o.dependsOnOwnProps=!1,o}}function L(e){return null!==e.dependsOnOwnProps&&void 0!==e.dependsOnOwnProps?Boolean(e.dependsOnOwnProps):1!==e.length}function x(e,t){return function(t,r){r.displayName;var n=function(e,t){return n.dependsOnOwnProps?n.mapToProps(e,t):n.mapToProps(e)};return n.dependsOnOwnProps=!0,n.mapToProps=function(t,r){n.mapToProps=e,n.dependsOnOwnProps=L(e);var o=n(t,r);return"function"==typeof o&&(n.mapToProps=o,n.dependsOnOwnProps=L(o),o=n(t,r)),o},n}}var N=[function(e){return"function"==typeof e?x(e):void 0},function(e){return e?void 0:M((function(e){return{dispatch:e}}))},function(e){return e&&"object"==typeof e?M((function(t){return Object(I.bindActionCreators)(e,t)})):void 0}];var B=[function(e){return"function"==typeof e?x(e):void 0},function(e){return e?void 0:M((function(){return{}}))}];function j(e,t,r){return Object(m.default)({},r,e,t)}var U=[function(e){return"function"==typeof e?function(e){return function(t,r){r.displayName;var n,o=r.pure,i=r.areMergedPropsEqual,a=!1;return function(t,r,s){var c=e(t,r,s);return a?o&&i(c,n)||(n=c):(a=!0,n=c),n}}}(e):void 0},function(e){return e?void 0:function(){return j}}];function W(e,t,r,n){return function(o,i){return r(e(o,i),t(n,i),i)}}function H(e,t,r,n,o){var i,a,s,c,l,p=o.areStatesEqual,_=o.areOwnPropsEqual,d=o.areStatePropsEqual,u=!1;function h(o,u){var h,f,m=!_(u,a),b=!p(o,i);return i=o,a=u,m&&b?(s=e(i,a),t.dependsOnOwnProps&&(c=t(n,a)),l=r(s,c,a)):m?(e.dependsOnOwnProps&&(s=e(i,a)),t.dependsOnOwnProps&&(c=t(n,a)),l=r(s,c,a)):b?(h=e(i,a),f=!d(h,s),s=h,f&&(l=r(s,c,a)),l):l}return function(o,p){return u?h(o,p):(s=e(i=o,a=p),c=t(n,a),l=r(s,c,a),u=!0,l)}}function K(e,t){var r=t.initMapStateToProps,n=t.initMapDispatchToProps,o=t.initMergeProps,i=Object(b.default)(t,["initMapStateToProps","initMapDispatchToProps","initMergeProps"]),a=r(e,i),s=n(e,i),c=o(e,i);return(i.pure?H:W)(a,s,c,e,i)}function F(e,t,r){for(var n=t.length-1;n>=0;n--){var o=t[n](e);if(o)return o}return function(t,n){throw new Error("Invalid value of type "+typeof e+" for "+r+" argument when connecting component "+n.wrappedComponentName+".")}}function V(e,t){return e===t}var G,q,Y,z,X,$,J,Z,Q,ee,te,re,ne=(Y=(q=void 0===G?{}:G).connectHOC,z=void 0===Y?R:Y,X=q.mapStateToPropsFactories,$=void 0===X?B:X,J=q.mapDispatchToPropsFactories,Z=void 0===J?N:J,Q=q.mergePropsFactories,ee=void 0===Q?U:Q,te=q.selectorFactory,re=void 0===te?K:te,function(e,t,r,n){void 0===n&&(n={});var o=n,i=o.pure,a=void 0===i||i,s=o.areStatesEqual,c=void 0===s?V:s,l=o.areOwnPropsEqual,p=void 0===l?k:l,_=o.areStatePropsEqual,d=void 0===_?k:_,u=o.areMergedPropsEqual,h=void 0===u?k:u,f=Object(b.default)(o,["pure","areStatesEqual","areOwnPropsEqual","areStatePropsEqual","areMergedPropsEqual"]),E=F(e,$,"mapStateToProps"),g=F(t,Z,"mapDispatchToProps"),v=F(r,ee,"mergeProps");return z(re,Object(m.default)({methodName:"connect",getDisplayName:function(e){return"Connect("+e+")"},shouldHandleStateChanges:Boolean(e),initMapStateToProps:E,initMapDispatchToProps:g,initMergeProps:v,pure:a,areStatesEqual:c,areOwnPropsEqual:p,areStatePropsEqual:d,areMergedPropsEqual:h},f))});function oe(){var e=Object(i.useContext)(l);return O()(e,"could not find react-redux context value; please ensure the component is wrapped in a <Provider>"),e}function ie(){return oe().store}function ae(){return ie().dispatch}var se="undefined"!=typeof window?i.useLayoutEffect:i.useEffect,ce=function(e,t){return e===t};function le(e,t){void 0===t&&(t=ce),O()(e,"You must pass a selector to useSelectors");var r,n=oe(),o=n.store,a=n.subscription,s=Object(i.useReducer)((function(e){return e+1}),0)[1],c=Object(i.useMemo)((function(){return new u(o,a)}),[o,a]),l=Object(i.useRef)(),p=Object(i.useRef)(),_=Object(i.useRef)();try{r=e!==p.current||l.current?e(o.getState()):_.current}catch(e){var d="An error occured while selecting the store state: "+e.message+".";throw l.current&&(d+="\nThe error may be correlated with this previous error:\n"+l.current.stack+"\n\nOriginal stack trace:"),new Error(d)}return se((function(){p.current=e,_.current=r,l.current=void 0})),se((function(){function e(){try{var e=p.current(o.getState());if(t(e,_.current))return;_.current=e}catch(e){l.current=e}s({})}return c.onStateChange=e,c.trySubscribe(),e(),function(){return c.tryUnsubscribe()}}),[o,c]),r}var pe,_e=r("i8i4");pe=_e.unstable_batchedUpdates,p=pe},"/TnQ":function(e,t,r){"use strict";var n=r("ANjH").compose;t.__esModule=!0,t.composeWithDevTools=function(){if(0!==arguments.length)return"object"==typeof arguments[0]?n:n.apply(null,arguments)},t.devToolsEnhancer=function(){return function(e){return e}}},"0fW4":function(e,t,r){"use strict";r.r(t);var n=r("q1tI"),o=r.n(n),i=r("/MKj"),a=r("ANjH"),s=r("dImZ"),c=r.n(s),l=r("/TnQ"),p=r("sINF"),_=r("xYVc"),d=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n};function u(e){var t=e.present.background,r=t.currentBackgroundType,n=t.currentPhotoUrl,o=t.currentBackgroundId,i="";if(r===_.default.BACKGROUND_MODES.PHOTO)i=n||"";else{var a=e.present.data.backgrounds,s=a.gradients,c=a.emojies;i=d(s,c).filter((function(e){return e.id===o}))[0].url}return i}function h(e){var t=e.present.data,r=t.addons,n=t.artboardHeight,o=n;return r&&r.photoHeight&&(o=r.photoHeight),n/2-o/2}var f,m="SET_SETTING_COLOR_CORRECTION",b="SET_SETTING_FILTER_AMOUNT",E="SET_SETTING_BLUR_SIZE",g="SET_SETTING_BLUR_POSITION",v="SET_LAYER_FONT_SIZE",O=function(){return(O=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},w={isDataLoaded:!1,isShowDropBox:!1,isSaveLoading:!1,currentMode:_.default.TABS.STICKERS,currentStickerPackIndex:0,stickerHeaderScrollPosition:0},y=function(e,t){switch(void 0===e&&(e=w),t.type){case"SET_DATA_LOADED":return O(O({},e),{isDataLoaded:!0});case"SET_SHOW_DROP_BOX":return O(O({},e),{isShowDropBox:t.value});case"SET_SAVE_LOADING":return O(O({},e),{isSaveLoading:t.value});case"SET_CURRENT_TAB":return O(O({},e),{currentMode:t.value});case"SET_CURRENT_STICKER_PACK_INDEX":return O(O({},e),{currentStickerPackIndex:t.value});case"SET_HEADER_SCROLL_POSITION":return O(O({},e),{stickerHeaderScrollPosition:t.value});default:return e}},A=function(){return(A=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},S={color:_.default.COLORS[0],brushWidth:.5,brushOpacity:1,fontSize:.5,fontStyle:_.default.FONTS[0],filter:{name:_.default.PHOTO_FILTERS[0],value:.5},colorCorrection:{exposure:0,contrast:0,saturation:0,warmth:0,vignette:0,sharpness:0,grain:0},blur:{isEnabled:!1,form:_.default.BLUR_TYPES.ROUND,size:50,position:[.5,.5]},isAutoCorrection:!1,cropAspect:_.default.CROP_ASPECT_FREE,isCropped:!1,flipX:!1,flipY:!1,rotation:0},C=function(e,t){var r;switch(void 0===e&&(e=S),t.type){case"SET_SETTING_COLOR":return A(A({},e),{color:t.color});case"SET_SETTING_BRUSH_WIDTH":return A(A({},e),{brushWidth:t.brushWidth});case"SET_SETTING_BRUSH_OPACITY":return A(A({},e),{brushOpacity:t.brushOpacity});case"SET_SETTING_FONT_SIZE":return A(A({},e),{fontSize:t.fontSize});case"SET_SETTING_FONT_FAMILY":return A(A({},e),{fontStyle:t.fontStyle});case m:return A(A({},e),{colorCorrection:A(A({},e.colorCorrection),(r={},r[t.filter]=t.value,r))});case"SET_SETTING_FILTER":return A(A({},e),{filter:A(A({},e.filter),{name:t.name})});case b:return A(A({},e),{filter:A(A({},e.filter),{value:t.value})});case"SET_SETTING_BLUR_ENABLE":return A(A({},e),{blur:A(A({},e.blur),{isEnabled:t.isEnabled})});case"SET_SETTING_BLUR_FORM":return A(A({},e),{blur:A(A({},e.blur),{form:t.form})});case E:return A(A({},e),{blur:A(A({},e.blur),{size:t.size})});case g:return A(A({},e),{blur:A(A({},e.blur),{position:t.position})});case"SET_SETTING_AUTO_CORRECTION":return A(A({},e),{isAutoCorrection:t.isAutoCorrection});case"SET_SETTING_CROP_ASPECT":return A(A({},e),{cropAspect:t.aspect});case"SET_SETTING_CROPPED":return A(A({},e),{isCropped:t.isCropped});case"SET_SETTING_FLIP_X":return A(A({},e),{flipX:t.value});case"SET_SETTING_FLIP_Y":return A(A({},e),{flipY:t.value});case"SET_SETTING_ROTATE":return A(A({},e),{rotation:t.value});default:return e}},P=function(){return(P=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},R=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},T={currentIndex:null,items:[{canvas:document.createElement("canvas"),type:_.default.LAYER_TYPES.BACKGROUND,width:1,height:1,isBackground:!0,locked:!0,x:0,y:0,rotate:0,canDelete:!1,scale:1,avgColor:{r:128,g:128,b:128}}]},D=function(e,t){switch(void 0===e&&(e=T),t.type){case"SET_CURRENT_LAYER":return P(P({},e),{currentIndex:t.index});case"ADD_LAYER_STICKER":case"ADD_LAYER_TEXT":case"ADD_LAYER_IMAGE":return P(P({},e),{items:R(e.items,[t.payload])});case"SET_LAYER_POSITION":case"SET_LAYER_SCALE":case"SET_LAYER_COLOR":case v:case"SET_LAYER_FONT_STYLE":case"SET_LAYER_TEXT":case"TOGGLE_TEXT_EDITOR":return P(P({},e),{items:e.items.map((function(r,n){return e.currentIndex===n?P(P({},r),t.payload):r}))});case"START_LAYER_SCALE":return P({},e);case"UPDATE_BACKGROUND_LAYER":return P(P({},e),{items:e.items.map((function(e,r){return 0===r?P(P({},e),t.payload):e}))});case"DELETE_LAYER":return P(P({},e),{currentIndex:null,items:e.items.filter((function(e,r){return r!==t.index}))});case"UPDATE_LAYERS_AFTER_CROP":return P(P({},e),{items:t.items});default:return e}},k=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},I=function(e,t){switch(void 0===e&&(e=[]),t.type){case"ADD_VECTOR":return k(e,[t.payload]);case"UPDATE_DRAWING":return t.payload;default:return e}},M=function(){return(M=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},L={currentBackgroundType:_.default.BACKGROUND_MODES.BACKGROUND,currentPhotoUrl:null,currentBackgroundId:1},x=function(e,t){switch(void 0===e&&(e=L),t.type){case"SET_CURRENT_BACKGROUND_TYPE":return M(M({},e),{currentBackgroundType:t.value});case"SET_CURRENT_PHOTO_URL":return M(M({},e),{currentPhotoUrl:t.value});case"SET_CURRENT_BACKGROUND_ID":return M(M({},e),{currentBackgroundId:t.value});default:return e}},N=function(){return(N=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},B=function(e,t){switch(void 0===e&&(e={}),t.type){case"SET_DATA":return N(N({},e),t.payload);default:return e}},j=!1;var U=c()(Object(a.combineReducers)({ui:y,settings:C,layers:D,drawings:I,background:x,data:B}),{limit:100,syncFilter:!0,filter:Object(s.combineFilters)(Object(s.includeAction)([m,E,g,"SET_SETTING_BLUR_ENABLE","SET_SETTING_BLUR_FORM","SET_SETTING_AUTO_CORRECTION","SET_SETTING_FILTER",b,"ADD_LAYER_STICKER","ADD_LAYER_TEXT","DELETE_LAYER","ADD_VECTOR","SET_CURRENT_BACKGROUND_TYPE","SET_CURRENT_PHOTO_URL","SET_CURRENT_BACKGROUND_ID","SET_LAYER_COLOR",v,"SET_LAYER_FONT_STYLE","TOGGLE_TEXT_EDITOR","SET_SHOW_DROP_BOX","START_LAYER_SCALE"]),(function(e){return"TOGGLE_TEXT_EDITOR"===e.type?e.payload.isEdit:"SET_SHOW_DROP_BOX"===e.type?e.value:![m,b,E,g,v].includes(e.type)||(e.type!==f?(j=!1,f=e.type,!0):!j&&(j=!0,setTimeout((function(){j=!1}),500),!0))}))}),W=r("ufMw"),H=r("nAFc"),K=r("jE6c"),F=function(e){return{type:"SET_CURRENT_LAYER",index:e}},V=function(e,t,r){return void 0===r&&(r=!0),function(n,o){var i=o().present.layers.items;n({type:e,payload:t}),r&&n(F(i.length))}},G=function(e,t){return function(r,n){var o,i=n().present,a=i.data,s=i.settings,c=h(n()),l=a.artboardWidth/2,p=a.artboardHeight/2-c,d=Object(H.decodeHTMLEntities)(a.placeholders[Object(K.irand)(0,a.placeholders.length-1)]),u=0,f=!1,m=s.fontStyle,b=s.color,E=s.fontSize,g=1;t&&(l=void 0!==t.x?t.x:l,p=void 0!==t.y?t.y:p,d=void 0!==t.text?t.text:d,u=void 0!==t.rotate?t.rotate:u,f=void 0!==t.isEdit?t.isEdit:f,m=void 0!==t.style?t.style:m,b=void 0!==t.color?t.color:b,E=void 0!==t.fontSize?t.fontSize:E,o=t.initialFontSize,g=void 0!==t.scale?t.scale:g),Object(W.sendStat)(W.EVENTS.ADD_TEXT),e&&r(J(_.default.TABS.TEXT)),r(V("ADD_LAYER_TEXT",{type:_.default.LAYER_TYPES.TEXT,text:d,x:l,y:p,rotate:u,isEdit:f,fontSize:E,initialFontSize:o,fontStyle:m,color:b,scale:g,canDelete:!0},e))}},q=function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,i=n.items;null!==o&&i[o]&&t({type:"TOGGLE_TEXT_EDITOR",payload:{isEdit:e}})}},Y=function(e){return{type:"UPDATE_BACKGROUND_LAYER",payload:e}},z=function(){return function(e,t){var r=t().present.layers,n=r.currentIndex,o=r.items;if(null!==n){var i=o[n];i&&(i.type===_.default.LAYER_TYPES.STICKER?Object(W.sendStat)(W.EVENTS.DELETE_STICKER):i.type===_.default.LAYER_TYPES.TEXT&&Object(W.sendStat)(W.EVENTS.DELETE_TEXT),e($(!1)),e({type:"DELETE_LAYER",index:n}))}}},X=function(){return function(e,t){var r=t().present.layers,n=r.currentIndex,o=r.items;if(null!==n){var i=o[n];i&&i.type===_.default.LAYER_TYPES.TEXT&&(o[n].text.trim()?e(q(!1)):e(z()))}}},$=function(e){return{type:"SET_SHOW_DROP_BOX",value:e}},J=function(e){return function(t,r){var n=r().present.layers,o=n.items,i=n.currentIndex;null!==i&&(o[i].type===_.default.LAYER_TYPES.TEXT&&t(X()),[_.default.TABS.PAINT,_.default.TABS.FILTERS,_.default.TABS.COLOR,_.default.TABS.CROP].includes(e)&&t(F(null))),t({type:"SET_CURRENT_TAB",value:e})}},Z=function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,i=n.items;o&&!i[o]||t(function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,i=n.items;null!==o&&i[o]&&t({type:"SET_LAYER_COLOR",payload:{color:e}})}}(e)),t({type:"SET_SETTING_COLOR",color:e})}},Q=function(e){return{type:"SET_SETTING_CROP_ASPECT",aspect:e}},ee=function(e){return{type:"SET_CURRENT_BACKGROUND_TYPE",value:e}},te=function(e){return{type:"SET_CURRENT_PHOTO_URL",value:e}},re=function(e){return{type:"SET_DATA",payload:e}},ne=function(e){return function(t){Object(i.batch)((function(){var r;e.hasOwnProperty("url")&&t(te(e.url)),e.hasOwnProperty("data")&&t(re(e.data)),e.hasOwnProperty("isCropped")&&t({type:"SET_SETTING_CROPPED",isCropped:e.isCropped}),e.hasOwnProperty("flipX")&&t((r=e.flipX,Object(W.sendStat)(W.EVENTS.FLIP_X),{type:"SET_SETTING_FLIP_X",value:r})),e.hasOwnProperty("flipY")&&t(function(e){return Object(W.sendStat)(W.EVENTS.FLIP_Y),{type:"SET_SETTING_FLIP_Y",value:e}}(e.flipY)),e.hasOwnProperty("rotate")&&t(function(e){return{type:"SET_SETTING_ROTATE",value:e}}(e.rotate)),e.hasOwnProperty("layers")&&t({type:"UPDATE_LAYERS_AFTER_CROP",items:e.layers}),e.hasOwnProperty("drawings")&&t(function(e){return{type:"UPDATE_DRAWING",payload:e}}(e.drawings))}))}},oe=r("i8i4");function ie(e){return new Promise((function(t,r){var n=new Image;n.crossOrigin="Anonymous",n.onerror=function(){r(new Error("Failed to load image's URL: "+e))},n.onload=function(){t(n)},n.src=e}))}function ae(e,t){if(!t)return{x:0,y:0,xOrigin:0,yOrigin:0,width:0,height:0};var r=t.getBoundingClientRect(),n=r.left,o=r.top,i=r.width,a=r.height;return{x:e.clientX-n,y:e.clientY-o,xOrigin:n,yOrigin:o,width:i,height:a}}function se(e,t){var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return r?"rgba("+parseInt(r[1],16)+", "+parseInt(r[2],16)+", "+parseInt(r[3],16)+", "+t+")":"rgba(0, 0, 0, 1)"}function ce(){return new Promise((function(e,t){var r=document.createElement("input");r.setAttribute("style","width: 0; height: 0; position: absolute; top: -1000px; left: -1000px; visibility: hidden"),r.value="",r.type="file",r.accept="image/*",r.onchange=function(r){var n=r.target;if(!n)return t();if(!n.files)return t();var o=n.files[0],i=URL.createObjectURL(o);ie(i).then((function(){(function(e){return new Promise((function(t){var r=new FileReader;r.onload=function(e){if(e.target){var r=e.target,n=new DataView(r.result);if(65496!=n.getUint16(0,!1))return t(-2);for(var o=n.byteLength,i=2;i<o;){if(n.getUint16(i+2,!1)<=8)return t(-1);var a=n.getUint16(i,!1);if(i+=2,65505==a){if(1165519206!=n.getUint32(i+=2,!1))return t(-1);var s=18761==n.getUint16(i+=6,!1);i+=n.getUint32(i+4,s);var c=n.getUint16(i,s);i+=2;for(var l=0;l<c;l++)if(274==n.getUint16(i+12*l,s))return t(n.getUint16(i+12*l+8,s))}else{if(65280!=(65280&a))break;i+=n.getUint16(i,!1)}}return t(-1)}},r.readAsArrayBuffer(e)}))})(o).then((function(r){-1===r||-2===r||1===r?e(i):function(e,t){return new Promise((function(r,n){var o=new Image;o.onload=function(){var e=o.width,i=o.height,a=document.createElement("canvas"),s=a.getContext("2d");if(!s)return n();switch(4<t&&t<9?(a.width=i,a.height=e):(a.width=e,a.height=i),t){case 2:s.transform(-1,0,0,1,e,0);break;case 3:s.transform(-1,0,0,-1,e,i);break;case 4:s.transform(1,0,0,-1,0,i);break;case 5:s.transform(0,1,1,0,0,0);break;case 6:s.transform(0,1,-1,0,i,0);break;case 7:s.transform(0,-1,-1,0,i,e);break;case 8:s.transform(0,-1,1,0,0,e)}s.drawImage(o,0,0),r(a.toDataURL())},o.src=e}))}(i,r).then((function(t){e(t)})).catch((function(){t()}))})).catch((function(){t()}))})).catch((function(){t()}))},r.onclick=function(){document.body.onfocus=function(){r.remove()}},document.body.appendChild(r),r.click()}))}function le(e,t,r,n,o,i,a){var s=0,c=0;switch(e){case"left_top":s=n+i,c=o+a;break;case"left_center":s=n+i,c=r/2+a;break;case"left_bottom":s=n+i,c=r-o+a;break;case"center_top":s=t/2+i,c=o+a;break;case"center":s=t/2+i,c=r/2+a;break;case"center_bottom":s=t/2+i,c=r-o+a;break;case"right_top":s=t-n+i,c=o+a;break;case"right_center":s=t-n+i,c=r/2+a;break;case"right_bottom":s=t-n+i,c=r-o+a}return{x:s,y:c}}function pe(e,t,r){var n=e.getContext("2d");n&&(n.clearRect(0,0,e.width,e.height),n.fillStyle="rgb(30, 30, 30)",n.fillRect(0,0,e.width,e.height),n.save(),n.filter="blur(135px)",n.drawImage(t,0,0,e.width,e.height),n.restore(),"none"!==n.filter&&(n.fillStyle="rgb("+r.r+", "+r.g+", "+r.b+")",n.fillRect(0,0,e.width,e.height)))}var _e,de=r("ZxpX"),ue=(_e=function(e,t){return(_e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}_e(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),he=function(e){function t(t){var r=e.call(this,t)||this;return r.renderDrawings=function(){var e=r.props.drawings,t=r.canvas.current;if(t){var n=t.getContext("2d");if(n){var o=r.props.data.originalHeight/r.props.height;n.clearRect(0,0,t.width,t.height),n.lineCap="round",n.lineJoin="round",e.forEach((function(e){n.lineWidth=e.width*_.default.BRUSH_WIDTH_COEFFICIENT*o,n.strokeStyle=se(e.color,e.opacity),n.beginPath(),n.moveTo(e.path[0][0]*o,e.path[0][1]*o),e.path.forEach((function(e){n.lineTo(e[0]*o,e[1]*o)})),n.stroke()}))}}},r.drawStart=function(e){if(r.props.ui.currentMode===_.default.TABS.PAINT){window.addEventListener("mousemove",r.drawProcess),window.addEventListener("mouseup",r.drawFinish);var t=ae(e.nativeEvent,r.canvas.current),n=t.x,o=t.y;r.currentDrawing=[[n,o]];var i=r.props.settings;r.props.addDrawing({color:i.color,width:i.brushWidth,opacity:i.brushOpacity,path:r.currentDrawing}),r.renderDrawings()}},r.drawProcess=function(e){var t=ae(e,r.canvas.current),n=t.x,o=t.y;r.currentDrawing.push([n,o]),r.renderDrawings()},r.drawFinish=function(){window.removeEventListener("mousemove",r.drawProcess),window.removeEventListener("mouseup",r.drawFinish),r.currentDrawing=[]},r.canvas=n.createRef(),r.currentDrawing=[],r}return ue(t,e),t.prototype.render=function(){var e=this.props,t=e.data,r=e.width,o=e.height,i=e.ui,a=Object(de.classNames)("EditorCanvas__canvas","EditorCanvas__canvas--draw",{"EditorCanvas__canvas--disabled":i.currentMode!==_.default.TABS.PAINT});return n.createElement("canvas",{ref:this.canvas,className:a,onMouseDown:this.drawStart,width:t.originalWidth,height:t.originalHeight,style:{width:r,height:o}})},t.prototype.componentDidMount=function(){this.renderDrawings()},t.prototype.componentDidUpdate=function(){this.renderDrawings()},t}(n.PureComponent),fe={addDrawing:function(e){return Object(W.sendStat)(W.EVENTS.ADD_GRAFFITI),{type:"ADD_VECTOR",payload:e}},addLayerText:G},me=Object(i.connect)((function(e){return{ui:e.present.ui,settings:e.present.settings,drawings:e.present.drawings,data:e.present.data}}),fe)(he),be=new(function(){function e(){this.images={}}return e.prototype.get=function(e){var t=this;return new Promise((function(r,n){var o=t.images[e];o?r(o):ie(e).then((function(n){t.setImage(e,n),r(n)})).catch(n)}))},e.prototype.setImage=function(e,t){this.images[e]=t},e}()),Ee="WebGL context not found",ge="Create texture failed",ve="Shader compile failed",Oe="Create program failed",we="Incomplete framebuffer",ye="Filter not found",Ae=function(e,t,r){var n=e.createShader(r);if(!n)throw new Error(ve);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error(""+e.getShaderInfoLog(n));this.shader=n},Se=function(){function e(e,t,r){if(!e)throw new Error(Ee);var n=e.createTexture();if(!n)throw new Error(ge);this.texture=n,e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t&&r&&this.updateSize(e,t,r),e.bindTexture(e.TEXTURE_2D,null)}return e.prototype.attachImage=function(e,t){e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.bindTexture(e.TEXTURE_2D,null)},e.prototype.updateSize=function(e,t,r){e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,r,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindTexture(e.TEXTURE_2D,null)},e.prototype.use=function(e,t){e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this.texture)},e.unuse=function(e,t){e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,null)},e.prototype.destroy=function(e){e.deleteTexture(this.texture)},e}(),Ce=r("t7n3"),Pe=function(){function e(e,t,r){if(!e)throw new Error(Ee);var n=new Ae(e,t,e.VERTEX_SHADER).shader,o=new Ae(e,r,e.FRAGMENT_SHADER).shader;this.gl=e,this.program=this.createProgram(n,o),this.framebuffer=e.createFramebuffer()}return e.prototype.createProgram=function(e,t){var r=this.gl.createProgram();if(!r)throw new Error(Oe);if(this.gl.attachShader(r,e),this.gl.attachShader(r,t),this.gl.linkProgram(r),!this.gl.getProgramParameter(r,this.gl.LINK_STATUS))throw new Error(""+this.gl.getProgramInfoLog(r));return r},e.prototype.destroy=function(){this.gl.deleteProgram(this.program)},e.prototype.attribute=function(e,t){var r=this.gl.getAttribLocation(this.program,e),n=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(t),this.gl.STATIC_DRAW),this.gl.enableVertexAttribArray(r),this.gl.vertexAttribPointer(r,2,this.gl.FLOAT,!1,0,0)},e.prototype.uniforms=function(e){for(var t in this.gl.useProgram(this.program),e)if(e.hasOwnProperty(t)){var r=this.gl.getUniformLocation(this.program,t),n=e[t];if(Array.isArray(n))switch(n.length){case 1:this.gl.uniform1fv(r,new Float32Array(n));break;case 2:this.gl.uniform2fv(r,new Float32Array(n));break;case 3:this.gl.uniform3fv(r,new Float32Array(n));break;case 4:this.gl.uniform4fv(r,new Float32Array(n))}else Object(Ce.isNumber)(n)&&this.gl.uniform1f(r,n)}},e.prototype.textures=function(e,t){var r=this;this.gl.useProgram(this.program),e.forEach((function(e,n){t?(e.use(r.gl,n),r.gl.uniform1i(r.gl.getUniformLocation(r.program,"u_image"+n),n)):Se.unuse(r.gl,n)}))},e.prototype.draw=function(e,t){this.gl.useProgram(this.program),t&&(t.updateSize(this.gl,e.width,e.height),this.bindTexture(t.texture)),this.gl.canvas.width=e.width,this.gl.canvas.height=e.height,this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight);var r=e.width,n=e.height;this.attribute("a_position",[0,0,r,0,0,n,0,n,r,0,r,n]),this.attribute("a_texCoord",[0,0,1,0,0,1,0,1,1,0,1,1]),this.uniforms(Object.assign(e.uniforms,{u_resolution:[e.width,e.height]})),e.textures&&this.textures(e.textures,!0),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,6),e.textures&&this.textures(e.textures,!1),t&&this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)},e.prototype.bindTexture=function(e,t){if(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.framebuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,e,0),t){var r=this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER);if(r!==this.gl.FRAMEBUFFER_COMPLETE){var n="";switch(r){case this.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:n="The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete.";break;case this.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:n="There is no attachment.";break;case this.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:n="Height and width of the attachment are not the same.";break;case this.gl.FRAMEBUFFER_UNSUPPORTED:n="The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer."}throw new Error(we+". "+n)}}},e}(),Re="attribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform vec2 u_resolution;\n\nvarying vec2 v_texCoord;\n\nvoid main() {\n\t// convert the rectangle from pixels to 0.0 to 1.0\n\tvec2 zeroToOne = a_position / u_resolution;\n\n\t// convert from 0->1 to 0->2\n\tvec2 zeroToTwo = zeroToOne * 2.0;\n\n\t// convert from 0->2 to -1->+1 (clipspace)\n\tvec2 clipSpace = zeroToTwo - 1.0;\n\n\tgl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n\n\t// pass the texCoord to the fragment shader\n\t// The GPU will interpolate this value between points.\n\tv_texCoord = a_texCoord;\n}\n",Te=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},De={regular:"/images/filters/maps/regular.png",nox:"/images/filters/maps/nox.png",vesper:"/images/filters/maps/vesper.png",latona:"/images/filters/maps/latona.png",liber:"/images/filters/maps/liber.png",luna:"/images/filters/maps/luna.png",minerva:"/images/filters/maps/minerva.png",mitra:"/images/filters/maps/mitra.png",pro:"/images/filters/maps/pro.png",terra:"/images/filters/maps/terra.png",veles:"/images/filters/maps/veles.png",vesta:"/images/filters/maps/vesta.png",zaria:"/images/filters/maps/zaria.png",sepia:"/images/filters/maps/sepia.png",genius:"/images/filters/maps/genius.png",horus:"/images/filters/maps/horus.png",fortuna:"/images/filters/maps/fortuna.png"},ke=["/images/filters/maps/contrast_negative.png","/images/filters/maps/contrast_positive.png","/images/filters/maps/exposure_negative.png","/images/filters/maps/exposure_positive.png","/images/filters/maps/warm_negative_lut.png","/images/filters/maps/warm_positive_lut.png"];var Ie=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},Me={preserveDrawingBuffer:!0,premultipliedAlpha:!1},Le=document.createElement("canvas"),xe=Le.getContext("webgl",Me)||Le.getContext("experimental-webgl",Me),Ne={},Be=function(){function e(){this.baseColorCorrectionProgram=new Pe(xe,Re,"precision mediump float;\n\nvarying vec2 v_texCoord;\n\nuniform sampler2D u_image0; // image\nuniform sampler2D u_image1; // contrast_negative.png\nuniform sampler2D u_image2; // contrast_positive.png\nuniform sampler2D u_image3; // exposure_negative.png\nuniform sampler2D u_image4; // exposure_positive.png\nuniform sampler2D u_image5; // warm_negative_lut.png\nuniform sampler2D u_image6; // warm_positive_lit.png\nuniform sampler2D u_image7; // color table\n\nuniform float u_exposure;\nuniform float u_contrast;\nuniform float u_saturation;\nuniform float u_warmth;\nuniform float u_amount;\n\nvec3 ContrastSaturationBrightness(vec3 color, float brt, float sat, float con) {\n\tconst float AvgLumR = 0.5;\n\tconst float AvgLumG = 0.5;\n\tconst float AvgLumB = 0.5;\n\n\tconst vec3 LumCoeff = vec3(0.2125, 0.7154, 0.0721);\n\n\tvec3 AvgLumin = vec3(AvgLumR, AvgLumG, AvgLumB);\n\tvec3 brtColor = color * brt;\n\tvec3 intensity = vec3(dot(brtColor, LumCoeff));\n\tvec3 satColor = mix(intensity, brtColor, sat);\n\tvec3 conColor = mix(AvgLumin, satColor, con);\n\n\treturn conColor;\n}\n\nfloat BF_SoftLight(float base, float blend) {\n\treturn 2.0 * base * blend + base * base * (1.0 - 2.0 * blend);\n}\n\nvec3 BF_SoftLight(vec3 base, vec3 blend) {\n\treturn vec3(BF_SoftLight(base.r, blend.r), BF_SoftLight(base.g, blend.g), BF_SoftLight(base.b, blend.b));\n}\n\nvec3 Exposure(vec3 view, float intensity) {\n\tvec3 exposure1;\n\texposure1.r = texture2D(u_image3, vec2(view.r, 0.5)).r;\n\texposure1.g = texture2D(u_image3, vec2(view.g, 0.5)).g;\n\texposure1.b = texture2D(u_image3, vec2(view.b, 0.5)).b;\n\n\tvec3 exposure2;\n\texposure2.r = texture2D(u_image4, vec2(view.r, 0.5)).r;\n\texposure2.g = texture2D(u_image4, vec2(view.g, 0.5)).g;\n\texposure2.b = texture2D(u_image4, vec2(view.b, 0.5)).b;\n\n\tvec3 result;\n\tif (intensity >= 0.0) {\n\t\tresult = mix(view, exposure2, intensity);\n\t} else {\n\t\tresult = mix(view, exposure1, -intensity);\n\t}\n\n\treturn result;\n}\n\nvec3 Contrast(vec3 view, float intensity) {\n\tvec3 contrast1;\n\tcontrast1.r = texture2D(u_image1, vec2(view.r, 0.5)).r;\n\tcontrast1.g = texture2D(u_image1, vec2(view.g, 0.5)).g;\n\tcontrast1.b = texture2D(u_image1, vec2(view.b, 0.5)).b;\n\n\tvec3 contrast2;\n\tcontrast2.r = texture2D(u_image2, vec2(view.r, 0.5)).r;\n\tcontrast2.g = texture2D(u_image2, vec2(view.g, 0.5)).g;\n\tcontrast2.b = texture2D(u_image2, vec2(view.b, 0.5)).b;\n\n\tvec3 result;\n\tif (intensity >= 0.0) {\n\t\tresult = mix(view, contrast2, intensity);\n\t} else {\n\t\tresult = mix(view, contrast1, -intensity);\n\t}\n\n\treturn result;\n}\n\nvec3 ColorTemp(vec3 view, float intensity) {\n\tfloat blueColor = view.b * 63.0;\n\n\tvec2 quad1;\n\tquad1.y = floor(floor(blueColor) / 8.0);\n\tquad1.x = floor(blueColor) - (quad1.y * 8.0);\n\n\tvec2 quad2;\n\tquad2.y = floor(ceil(blueColor) / 8.0);\n\tquad2.x = ceil(blueColor) - (quad2.y * 8.0);\n\n\tvec2 texPos1;\n\ttexPos1.x = (quad1.x * 0.125) + 0.5 / 960.0 + ((0.125 - 1.0 / 960.0) * view.r);\n\ttexPos1.y = (quad1.y * 0.125) + 0.5 / 960.0 + ((0.125 - 1.0 / 960.0) * view.g);\n\n\tvec2 texPos2;\n\ttexPos2.x = (quad2.x * 0.125) + 0.5 / 960.0 + ((0.125 - 1.0 / 960.0) * view.r);\n\ttexPos2.y = (quad2.y * 0.125) + 0.5 / 960.0 + ((0.125 - 1.0 / 960.0) * view.g);\n\n\tvec3 coldColor1 = texture2D(u_image5, texPos1).rgb;\n\tvec3 coldColor2 = texture2D(u_image5, texPos2).rgb;\n\tvec3 coldColor = mix(coldColor1, coldColor2, fract(blueColor));\n\n\tvec3 warmColor1 = texture2D(u_image6, texPos1).rgb;\n\tvec3 warmColor2 = texture2D(u_image6, texPos2).rgb;\n\tvec3 warmColor = mix(warmColor1, warmColor2, fract(blueColor));\n\n\tvec3 result;\n\n\tif (intensity >= 0.0) {\n\t\tresult = mix(view, warmColor, intensity);\n\t} else {\n\t\tresult = mix(view, coldColor, -intensity);\n\t}\n\n\treturn result;\n}\n\nvec3 Saturation(vec3 view, float intensity) {\n\treturn ContrastSaturationBrightness(view, 1.0, intensity, 1.0);\n}\n\nvec3 Lut(vec3 view, sampler2D tex, float intensity) {\n\tfloat blueColor = view.b * 63.0;\n\n\tvec2 quad1;\n\tquad1.y = floor(floor(blueColor) / 8.0);\n\tquad1.x = floor(blueColor) - (quad1.y * 8.0);\n\n\tvec2 quad2;\n\tquad2.y = floor(ceil(blueColor) / 8.0);\n\tquad2.x = ceil(blueColor) - (quad2.y * 8.0);\n\n\tvec2 texPos1;\n\ttexPos1.x = (quad1.x * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * view.r);\n\ttexPos1.y = (quad1.y * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * view.g);\n\n\tvec2 texPos2;\n\ttexPos2.x = (quad2.x * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * view.r);\n\ttexPos2.y = (quad2.y * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * view.g);\n\n\tvec3 newColor1 = texture2D(tex, texPos1).rgb;\n\tvec3 newColor2 = texture2D(tex, texPos2).rgb;\n\n\tvec3 newColor = mix(newColor1, newColor2, fract(blueColor));\n\tvec3 color = mix(view, newColor, intensity);\n\n\treturn color;\n}\n\n// [-1.0; 1.0]\nvec3 pExposure(vec3 view, float intensity) {\n\tintensity = clamp(intensity, -1.0, 1.0);\n\treturn Exposure(view, intensity);\n}\n\n// [-1.0; 1.0]\nvec3 pContrast(vec3 view, float intensity) {\n\tintensity = clamp(intensity, -1.0, 1.0);\n\treturn Contrast(view, intensity);\n}\n\n// [-1.0; 1.0]\nvec3 pColorTemp(vec3 view, float intensity) {\n\tintensity = clamp(intensity, -1.0, 1.0);\n\treturn ColorTemp(view, intensity);\n}\n\n// [-1.0; 1.0]\nvec3 pSaturation(vec3 view, float intensity) {\n\tvec2 range = vec2(0.0, 1.6);\n\tintensity = clamp(intensity, -1.0, 1.0);\n\tintensity = (intensity >= 0.0) ? 1.0 + (range.y - 1.0) * intensity : range.x + (1.0 - range.x) * (intensity + 1.0);\n\treturn Saturation(view, intensity);\n}\n\n// [0.0; 1.0]\nvec3 pLut(vec3 view,sampler2D tex, float intensity) {\n\tvec2 range = vec2(0.0, 1.0);\n\tintensity = clamp(intensity, 0.0, 1.0);\n\treturn Lut(view, tex, intensity);\n}\n\nvoid main() {\n\t// Хак для того, чтобы перевернуть текстуру\n\tvec2 texelCoord = v_texCoord;\n\ttexelCoord.y = 1. - texelCoord.y;\n\n\tvec4 texture = texture2D(u_image0, texelCoord);\n\n\ttexture.rgb = pColorTemp(texture.rgb, u_warmth);\n\ttexture.rgb = pLut(texture.rgb, u_image7, u_amount);\n\ttexture.rgb = pExposure(texture.rgb, u_exposure);\n\ttexture.rgb = pContrast(texture.rgb, u_contrast);\n\ttexture.rgb = pSaturation(texture.rgb, u_saturation);\n\n\tgl_FragColor = texture;\n}\n"),this.postProcessProgram=new Pe(xe,Re,"precision mediump float;\n\nvarying vec2 v_texCoord;\n\nuniform sampler2D u_image0;\n\nuniform float u_vignette;\nuniform float u_sharpness;\nuniform float u_grain;\n\nuniform vec2 u_sourceSize;\n\nvec4 rnm(in vec2 tc) {\n\tfloat timer = 0.4;\n\tfloat noise = sin(dot(tc + vec2(timer, timer), vec2(12.9898, 78.233))) * 43758.5453;\n\n\tfloat noiseR = fract(noise) * 2.0 - 1.0;\n\tfloat noiseG = fract(noise * 1.2154) * 2.0 - 1.0;\n\tfloat noiseB = fract(noise * 1.3453) * 2.0 - 1.0;\n\tfloat noiseA = fract(noise * 1.3647) * 2.0 - 1.0;\n\n\treturn vec4(noiseR,noiseG,noiseB,noiseA);\n}\n\nfloat fade(in float t) {\n\treturn t * t * t * (t * (t * 6.0 - 15.0) + 10.0);\n}\n\nfloat pnoise3D(in vec3 p) {\n\tvec3 pi = 0.00195313 * floor(p) + 0.00195313;\n\tvec3 pf = fract(p); // Fractional part for interpolation\n\n\t// Noise contributions from (x=0, y=0), z=0 and z=1\n\tfloat perm00 = rnm(pi.xy).a ;\n\tvec3  grad000 = rnm(vec2(perm00, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n000 = dot(grad000, pf);\n\tvec3  grad001 = rnm(vec2(perm00, pi.z + 0.00195313)).rgb * 4.0 - 1.0;\n\tfloat n001 = dot(grad001, pf - vec3(0.0, 0.0, 1.0));\n\n\t// Noise contributions from (x=0, y=1), z=0 and z=1\n\tfloat perm01 = rnm(pi.xy + vec2(0.0, 0.00195313)).a ;\n\tvec3  grad010 = rnm(vec2(perm01, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n010 = dot(grad010, pf - vec3(0.0, 1.0, 0.0));\n\tvec3  grad011 = rnm(vec2(perm01, pi.z + 0.00195313)).rgb * 4.0 - 1.0;\n\tfloat n011 = dot(grad011, pf - vec3(0.0, 1.0, 1.0));\n\n\t// Noise contributions from (x=1, y=0), z=0 and z=1\n\tfloat perm10 = rnm(pi.xy + vec2(0.00195313, 0.0)).a ;\n\tvec3  grad100 = rnm(vec2(perm10, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n100 = dot(grad100, pf - vec3(1.0, 0.0, 0.0));\n\tvec3  grad101 = rnm(vec2(perm10, pi.z + 0.00195313)).rgb * 4.0 - 1.0;\n\tfloat n101 = dot(grad101, pf - vec3(1.0, 0.0, 1.0));\n\n\t// Noise contributions from (x=1, y=1), z=0 and z=1\n\tfloat perm11 = rnm(pi.xy + vec2(0.00195313, 0.00195313)).a ;\n\tvec3  grad110 = rnm(vec2(perm11, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n110 = dot(grad110, pf - vec3(1.0, 1.0, 0.0));\n\tvec3  grad111 = rnm(vec2(perm11, pi.z + 0.00195313)).rgb * 4.0 - 1.0;\n\tfloat n111 = dot(grad111, pf - vec3(1.0, 1.0, 1.0));\n\n\t// Blend contributions along x\n\tvec4 n_x = mix(vec4(n000, n001, n010, n011), vec4(n100, n101, n110, n111), fade(pf.x));\n\n\t// Blend contributions along y\n\tvec2 n_xy = mix(n_x.xy, n_x.zw, fade(pf.y));\n\n\t// Blend contributions along z\n\tfloat n_xyz = mix(n_xy.x, n_xy.y, fade(pf.z));\n\n\t// We're done, return the final noise value.\n\treturn n_xyz;\n}\n\n//2d coordinate orientation thing\nvec2 coordRot(in vec2 tc, in float angle) {\n\tfloat aspect = u_sourceSize.x / u_sourceSize.y;\n\tvec2 uv = (tc * 2.0) - 1.0;\n\tfloat rotX = (uv.x * aspect * cos(angle)) - (uv.y * sin(angle));\n\tfloat rotY = (uv.y * cos(angle)) + (uv.x * aspect * sin(angle));\n\trotX = ((rotX / aspect) * 0.5 + 0.5);\n\trotY = rotY * 0.5 + 0.5;\n\treturn vec2(rotX, rotY);\n}\n\nvec3 BF_Multiply(vec3 base, vec3 blend) {\n\treturn base * blend;\n}\n\nfloat BF_Screen(float base, float blend) {\n\treturn 1.0 - ((1.0 - base) * (1.0 - blend));\n}\n\nvec3 BF_Screen(vec3 base, vec3 blend) {\n\treturn 1.0 - ((1.0 - base) * (1.0 - blend));\n}\n\nvec3 Sharpness(vec3 view, float intensity) {\n\tvec2 uv = v_texCoord;\n\tvec2 step = 1.0 / u_sourceSize;\n\n\tvec3 texA = texture2D(u_image0, uv + vec2(-step.x, -step.y) * 1.0).rgb;\n\tvec3 texB = texture2D(u_image0, uv + vec2( step.x, -step.y) * 1.0).rgb;\n\tvec3 texC = texture2D(u_image0, uv + vec2(-step.x,  step.y) * 1.0).rgb;\n\tvec3 texD = texture2D(u_image0, uv + vec2( step.x,  step.y) * 1.0).rgb;\n\n\tvec3 around = 0.25 * (texA + texB + texC + texD);\n\tvec3 center  = texture2D(u_image0, uv ).rgb;\n\tvec3 col = center + (center - around) * intensity;\n\n\treturn col;\n}\n\nvec3 Grain(vec3 view, float intensity) {\n\tvec2 texCoord = v_texCoord;\n\n\tfloat timer = 0.4;\n\tfloat coloramount = 0.4;\n\tfloat grainsize = 2.0;\n\tfloat lumamount = 0.3;\n\n\tbool colored = true;\n\n\tvec3 rotOffset = vec3(1.425, 3.892, 5.835); // rotation offset values\n\tvec2 rotCoordsR = coordRot(texCoord, timer + rotOffset.x);\n\tvec3 noise = vec3(pnoise3D(vec3(rotCoordsR * vec2(u_sourceSize.x / grainsize, u_sourceSize.y / grainsize), 0.0)));\n\n\tif (colored) {\n\t\tvec2 rotCoordsG = coordRot(texCoord, timer + rotOffset.y);\n\t\tvec2 rotCoordsB = coordRot(texCoord, timer + rotOffset.z);\n\t\tnoise.g = mix(noise.r, pnoise3D(vec3(rotCoordsG * vec2(u_sourceSize.x / grainsize, u_sourceSize.y / grainsize), 1.0)), coloramount);\n\t\tnoise.b = mix(noise.r, pnoise3D(vec3(rotCoordsB * vec2(u_sourceSize.x / grainsize, u_sourceSize.y / grainsize), 2.0)), coloramount);\n\t}\n\n\tvec3 col = view.rgb;\n\tvec3 lumcoeff = vec3(0.299, 0.587, 0.114);\n\tfloat luminance = lumamount * dot(col, lumcoeff);\n\tfloat lum = smoothstep(0.2, 0.0, luminance);\n\n\tlum += luminance;\n\tnoise = mix(noise, vec3(0.0), pow(lum, 4.0));\n\tcol = col + noise * intensity;\n\n\treturn col;\n}\n\nvec3 Vignette(vec3 view, float intensity) {\n\tfloat inten = abs(intensity);\n\tfloat dist = distance(v_texCoord, vec2(0.5, 0.5));\n\tfloat size = 0.5 - inten * 0.4;\n\tfloat amount = inten * inten * 0.1 + 0.5 * inten;\n\tfloat vignette = smoothstep(0.8, size * 0.799, dist * (amount + size));\n\treturn (intensity >= 0.0) ? view * vignette : BF_Screen(view,vec3(1.0-vignette));\n}\n\n// [-1; 1]\nvec3 pSharpness(vec3 view, float intensity) {\n\tvec2 range = vec2(0.0, 1.5);\n\tintensity = clamp(intensity, 0.0, 1.0);\n\tintensity = (intensity >= 0.0) ? range.y * intensity : -range.x * (intensity+1.0) + range.x;\n\treturn Sharpness(view, intensity);\n}\n\n// [0; 1]\nvec3 pGrain(vec3 view, float intensity) {\n\tvec2 range = vec2(0.0, 0.2);\n\n\tintensity = clamp(intensity, 0.0, 1.0);\n\tintensity = (intensity >= 0.0) ? range.y * intensity : -range.x * (intensity + 1.0) + range.x;\n\treturn Grain(view, intensity);\n}\n\n// [-1; 1]\nvec3 pVignette(vec3 view, float intensity) {\n\tvec2 range = vec2(-1.0, 1.0);\n\tintensity = clamp(intensity, -1.0, 1.0);\n\tintensity = (intensity >= 0.0) ? range.y * intensity : -range.x * (intensity + 1.0) + range.x;\n\treturn Vignette(view, intensity);\n}\n\nvoid main() {\n\tvec4 texture = texture2D(u_image0, v_texCoord);\n\n\ttexture.rgb = pSharpness(texture.rgb, u_sharpness);\n\ttexture.rgb = pVignette(texture.rgb, u_vignette);\n\ttexture.rgb = pGrain(texture.rgb, u_grain);\n\n\tgl_FragColor = texture;\n}\n"),this.flippedProgram=new Pe(xe,Re,"precision mediump float;\n\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\n\nvoid main() {\n\tvec4 color = texture2D(u_texture, vec2(v_texCoord.x, 1.0 - v_texCoord.y));\n\tgl_FragColor = color;\n}\n"),this.triangleBlurProgram=new Pe(xe,Re,"precision mediump float;\n\nuniform sampler2D u_image0; // original image\nuniform vec2 u_delta;\n\nvarying vec2 v_texCoord;\n\nvoid main() {\n\tvec4 color = vec4(0.0);\n\tfloat total = 0.0;\n\tfloat offset = fract(sin(dot(gl_FragCoord.xyz, vec3(12.9898, 78.233, 151.7182))) * 43758.5453);\n\n\tfor (float t = -30.0; t <= 30.0; t++) {\n\t\tfloat percent = (t + offset - 0.5) / 30.0;\n\t\tfloat weight = 1.0 - abs(percent);\n\t\tvec4 sampleColor = texture2D(u_image0, v_texCoord + u_delta * percent);\n\t\tsampleColor.rgb *= sampleColor.a;\n\n\t\tcolor += sampleColor * weight;\n\t\ttotal += weight;\n\t}\n\n\tcolor = color / total;\n\tcolor.rgb /= color.a + 0.00001;\n\tgl_FragColor = color;\n}\n"),this.roundBlurProgram=new Pe(xe,Re,"precision mediump float;\n\nuniform sampler2D u_image0; // blurred image\nuniform sampler2D u_image1; // original image\nuniform vec2 u_position;\n\nvarying vec2 v_texCoord;\n\nvoid main() {\n\t// Хак для того, чтобы перевернуть текстуру\n\tvec2 texelCoord = v_texCoord;\n\ttexelCoord.y = 1. - texelCoord.y;\n\n\tvec4 color = texture2D(u_image0, texelCoord);\n\tfloat distanceFromCenter = distance(u_position, texelCoord);\n\n\tcolor = mix(texture2D(u_image1, texelCoord), color, clamp(smoothstep(0.3 - 0.2, 0.3, distanceFromCenter), 0.0, 1.0));\n\tgl_FragColor = color;\n}\n"),this.squareBlurProgram=new Pe(xe,Re,"precision mediump float;\n\nuniform sampler2D u_image0; // blurred image\nuniform sampler2D u_image1; // original image\nuniform vec2 u_position;\n\nvarying vec2 v_texCoord;\n\nvoid main() {\n\t// Хак для того, чтобы перевернуть текстуру\n\tvec2 texelCoord = v_texCoord;\n\ttexelCoord.y = 1. - texelCoord.y;\n\n\tvec4 color = texture2D(u_image0, texelCoord);\n\tvec2 realPosition = u_position;\n\trealPosition.x = texelCoord.x;\n\n\tfloat distanceFromCenter = distance(realPosition, texelCoord);\n\tcolor = mix(texture2D(u_image1, texelCoord), color, clamp(smoothstep(0.2 - 0.1, 0.2, distanceFromCenter), 0.0, 1.0));\n\n\tgl_FragColor = color;\n}\n"),this.colorCorrectionTexture=new Se(xe),this.postProcessTexture=new Se(xe),this.blurTexture1=new Se(xe),this.blurTexture2=new Se(xe),this.resultBlurTexture=new Se(xe)}return e.getOrCreateTexture=function(t,r,n){var o=n?r.src+"_auto":r.src;if(!Ne[o]){var i=void 0;i=n?e.getAuto(r):r;var a=new Se(t);a.attachImage(t,i),Ne[o]=a}return Ne[o]},e.loadTextures=function(t,r){return new Promise((function(n){var o=[],i=r.map((function(e){return be.get(e)}));Promise.all(i).then((function(r){r.forEach((function(r){var n=e.getOrCreateTexture(t,r);o.push(n)})),n(o)})).catch((function(){}))}))},e.getAuto=function(e){var t=document.createElement("canvas"),r=t.getContext("2d");if(!r)return t;t.width=e.width,t.height=e.height,r.drawImage(e,0,0,e.width,e.height);var n=e.width*e.height,o=r.getImageData(0,0,e.width,e.height),i=o.data;function a(e,t,r,n){t+r>=e&&(t=(e-1)/2,r=(e-1)/2);var o=function(e,t,r,n){for(var o,a=[],s=0;s<256;s++)a.push(0);for(o=0;o<e;o++)a[i[4*o+n]]+=1;for(o=1;o<256;o++)a[o]+=a[o-1];var c={};for(o=0;o<256&&a[o]<=t;)o++;for(c.min=o,o=255;o<256&&a[o]>e-r;)o--;return o<255&&o++,c.max=o,c}(e,t,r,n);!function(e,t,r,n){var o,a;if(r<=t)for(o=0;o<e;o++)i[(a=4*o)+n]=127.5;else{var s=new Array(256);for(o=0;o<t;o++)s[o]=0;for(o=t;o<r;o++)s[o]=255*(o-t)/(r-t)+.5;for(o=r;o<256;o++)s[o]=255;for(o=0;o<e;o++)i[(a=4*o)+n]=s[i[a+n]]}}(e,o.min,o.max,n)}!function(e,t,r){a(e,t,r,0),a(e,t,r,1),a(e,t,r,2)}(n,.01*n,.01*n),r.putImageData(o,0,0);var s=document.createElement("canvas");return s.width=e.width,s.height=e.height,null==(r=s.getContext("2d"))||r.drawImage(t,0,0,t.width,t.height),t},e.prototype.render=function(t,r,n,o,i,a,s){var c=this;return void 0===i&&(i={}),new Promise((function(l){requestAnimationFrame((function(){if(!xe)throw new Error(Ee);var p=function(e){var t=De[e];if(t)return Te(ke,[t])}(o);if(!p)throw new Error(ye);var d=e.getOrCreateTexture(xe,n,s);e.loadTextures(xe,p).then((function(e){var n=c.postProcessTexture;if(c.baseColorCorrectionProgram.draw({width:t,height:r,uniforms:{u_exposure:i.exposure,u_contrast:i.contrast,u_warmth:i.warmth,u_saturation:i.saturation,u_amount:i.amount},textures:Ie([d],e)},c.colorCorrectionTexture),c.postProcessProgram.draw({width:t,height:r,uniforms:{u_vignette:i.vignette,u_sharpness:i.sharpness,u_sourceSize:i.sourceSize,u_grain:i.grain},textures:[c.colorCorrectionTexture]},c.postProcessTexture),a&&a.isEnabled){var o=a.form===_.default.BLUR_TYPES.ROUND?c.roundBlurProgram:c.squareBlurProgram;c.triangleBlurProgram.draw({width:t,height:r,uniforms:{u_delta:[a.size/t,0]},textures:[c.postProcessTexture]},c.blurTexture1),c.triangleBlurProgram.draw({width:t,height:r,uniforms:{u_delta:[0,a.size/r]},textures:[c.blurTexture1]},c.blurTexture2),o.draw({width:t,height:r,uniforms:{u_position:a.position},textures:[c.blurTexture2,c.postProcessTexture]},c.resultBlurTexture),n=c.resultBlurTexture}return c.flippedProgram.draw({width:t,height:r,uniforms:{},textures:[n]}),l(Le)})).catch((function(e){console.error(new Error(e))}))}))}))},e}(),je=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ue={},We=function(e){function t(t){var r=e.call(this,t)||this;return r.canvas=n.createRef(),r.renderer=new Be,r.needUpdateSize=!0,r}return je(t,e),t.prototype.componentDidMount=function(){this.update()},t.prototype.componentDidUpdate=function(e){var t=this.props,r=t.originalWidth,n=t.originalHeight,o=t.background,i=r!==e.originalWidth||n!==e.originalHeight;this.needUpdateSize=i||JSON.stringify(o)!==JSON.stringify(e.background),this.update()},t.prototype.render=function(){var e=this.props,t=e.originalWidth,r=e.originalHeight;return n.createElement("canvas",{ref:this.canvas,className:"EditorCanvas__canvas EditorCanvas__canvas--bg",width:t,height:r,style:{width:this.props.width,height:this.props.height}})},t.prototype.update=function(){var e=this,t=this.props.currentBackgroundUrl;t&&be.get(t).then((function(t){e.renderImage(t)})).catch((function(e){console.error(e)}))},t.prototype.renderImage=function(e){var t=this,r=this.canvas.current;if(r&&r.getContext("2d")){var n=this.props.background,o=this.props,i=o.colorCorrection,a=o.filter,s=o.blur,c=o.isAutoCorrection;n.currentBackgroundType===_.default.BACKGROUND_MODES.BACKGROUND&&(a={name:_.default.PHOTO_FILTERS[0],value:0},i={exposure:0,contrast:0,saturation:0,warmth:0,vignette:0,sharpness:0,grain:0},s={isEnabled:!1,form:s.form,size:s.size,position:s.position},c=!1);var l={exposure:i.exposure,contrast:i.contrast,saturation:i.saturation,warmth:i.warmth,amount:a.value,vignette:i.vignette,sharpness:i.sharpness,grain:i.grain,sourceSize:[e.width,e.height]};this.renderer.render(e.width,e.height,e,a.name,l,s,c).then((function(n){if(n){var o,i,a=e.height/e.width;a>1.77?(o=t.props.height/a,i=t.props.height):(o=t.props.width,i=t.props.width*a);var s=Math.floor(t.props.width/2),c=Math.floor(t.props.height/2),l=function(e){var t=document.createElement("canvas"),r=t.getContext("2d");return t.width=e.width,t.height=e.height,null==r||r.drawImage(e,0,0,e.width,e.height),t}(n),p=Ue[e.src];p||(Ue[e.src]=function(e){var t,r=e.getContext("2d"),n={r:0,g:0,b:0};if(!r)return n;try{t=r.getImageData(0,0,r.canvas.width,r.canvas.height)}catch(e){return n}for(var o=-4,i=0;(o+=20)<t.data.length;)++i,n.r+=t.data[o],n.g+=t.data[o+1],n.b+=t.data[o+2];return n.r=~~(n.r/i),n.g=~~(n.g/i),n.b=~~(n.b/i),n}(l),p=Ue[e.src]),pe(r,l,p);var _={canvas:l,width:o,height:i,avgColor:p};t.needUpdateSize&&Object.assign(_,{x:s,y:c,locked:!0,rotate:0,scale:1}),t.props.updateBackgroundLayer(_)}})).catch((function(e){console.error(new Error(e))}))}},t}(n.PureComponent),He={updateBackgroundLayer:Y},Ke=Object(i.connect)((function(e){return{currentBackgroundUrl:u(e),originalWidth:e.present.data.originalWidth,originalHeight:e.present.data.originalHeight,background:e.present.background,isAutoCorrection:e.present.settings.isAutoCorrection,colorCorrection:e.present.settings.colorCorrection,filter:e.present.settings.filter,blur:e.present.settings.blur}}),He)(We),Fe=r("4+be"),Ve=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ge=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},qe=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidUpdate=function(){r.scrollWithAnimation=!1},r.render=function(){var e,t=r.props.layers,o=t.currentIndex,i=t.items,a=null!==o&&i[o],s=a&&a.type===_.default.LAYER_TYPES.TEXT&&a.isEdit,c="";return a&&(a.type===_.default.LAYER_TYPES.STICKER?c=Object(Fe.getLang)("photos_pe_delete_sticker"):a.type===_.default.LAYER_TYPES.TEXT&&(c=Object(Fe.getLang)("photos_pe_delete_text"))),r.props.currentBackgroundType!==_.default.BACKGROUND_MODES.BACKGROUND||a||(e=!0),n.createElement("div",{className:"StatusPanel"},e?r.renderBackgrounds():n.createElement("div",{className:"StatusPanel__inner"},r.renderLeftBlock(),n.createElement("div",null,a&&!s&&n.createElement("a",{className:"StatusPanel__link",onClick:r.props.deleteLayer},c),a&&s&&n.createElement("a",{className:"StatusPanel__link",onClick:r.props.closeTextEditor},Object(Fe.getLang)("photos_pe_save_text")))))},r.renderLeftBlock=function(){var e=r.props.addons;return"photo"===r.props.context?n.createElement("div",null,e&&e.edited&&e.canEdit&&n.createElement("a",{className:"StatusPanel__link",onClick:e.restore},Object(Fe.getLang)("photos_filtered_restore")),e&&!e.canEdit&&n.createElement("span",{className:"StatusPanel__info"},Object(Fe.getLang)("photos_will_be_saved_to_pe_album"))):n.createElement("div",null,r.props.currentBackgroundType===_.default.BACKGROUND_MODES.PHOTO&&n.createElement("a",{className:"StatusPanel__link",onClick:function(){return r.props.uploadPhoto()}},Object(Fe.getLang)("photos_pe_change_photo")))},r.renderBackgrounds=function(){var e=r.state.scrollBlockPosition,t=r.props.backgrounds,o=t.gradients,i=t.emojies,a=r.scrollElement.current,s=a?e+a.offsetWidth:0,c=!!e,l=!a||!!(a.scrollWidth-s);return n.createElement("div",{className:"StatusPanel__backgrounds",onWheel:r.panelMouseWheel},n.createElement("div",{className:"StatusPanel__scroll",style:{transform:"translateX(-"+e+"px)",transition:r.scrollWithAnimation?"transform .3s ease-out":""},ref:r.scrollElement},Ge(o,i).map((function(e){var t=e.id,o=e.preview;return n.createElement("a",{className:Object(de.classNames)("StatusPanel__background",{"StatusPanel__background--active":t===r.props.currentBackgroundId}),key:t,style:{backgroundImage:"url("+o+")"},onClick:function(){return r.props.setCurrentBackgroundId(t)}})}))),c&&n.createElement("div",{className:"StatusPanel__arrow StatusPanel__arrow--left",onClick:function(){return r.handleArrowClick(!0)}},n.createElement("span",{className:"StatusPanel__arrowIcon"})),l&&n.createElement("div",{className:"StatusPanel__arrow StatusPanel__arrow--right",onClick:function(){return r.handleArrowClick(!1)}},n.createElement("span",{className:"StatusPanel__arrowIcon"})))},r.panelMouseWheel=function(e){r.setPosition(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX)},r.setPosition=function(e,t){var n=r.scrollElement.current;if(n){var o=r.state.scrollBlockPosition,i=n.offsetWidth,a=Math.max(0,Math.min(o+e,n.scrollWidth-i));t&&(r.scrollWithAnimation=!0),r.setState({scrollBlockPosition:a})}},r.handleArrowClick=function(e){var t=r.scrollElement.current;if(t){var n=t.offsetWidth/2;e&&(n=-n),r.setPosition(n,!0)}},r.state={scrollBlockPosition:0},r.scrollElement=n.createRef(),r.scrollWithAnimation=!1,r}return Ve(t,e),t}(n.Component),Ye={deleteLayer:z,closeTextEditor:X},ze=Object(i.connect)((function(e){return{context:e.present.data.context,layers:e.present.layers,addons:e.present.data.addons}}),Ye)(qe),Xe=r("BiHW"),$e=r("6krn"),Je=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ze=function(){return(Ze=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Qe=function(e,t,r){[_.default.CROP_ASPECT_ORIGINAL,_.default.CROP_ASPECT_FREE].includes(e)&&(e=t/r);var n=t,o=n/e;return o>r&&(n=(o=r)*e),{x:t/2-n/2,y:r/2-o/2,width:n,height:o}},et=function(e){function t(t){var r=e.call(this,t)||this;r.controlMouseDown=function(e,t){e.stopPropagation();var n=r.areaEl.current;if(n){window.addEventListener("mousemove",r.controlMouseMove),window.addEventListener("mouseup",r.controlMouseUp);var o=ae(e.nativeEvent,n),i=o.x,a=o.y;r.shiftX=i,r.shiftY=a,r.initCrop=r.state,r.side=t}},r.controlMouseMove=function(e){var t=r.containerEl.current;if(t){var n=r.state,o=r.props,i=o.artboardWidth,a=o.artboardHeight,s=o.cropAspect,c=s===_.default.CROP_ASPECT_ORIGINAL?i/a:s,l=ae(e,t),p=l.x,d=l.y,u=l.width,h=l.height,f=n.x,m=n.y,b=n.width,E=n.height,g=_.default.CROP_MIN_SIZE,v=_.default.CROP_MIN_SIZE;if(c&&(c>1?g=_.default.CROP_MIN_SIZE*c:c<1&&(v=_.default.CROP_MIN_SIZE/c)),r.side===_.default.CROP_SIDES.CENTER)f=Math.min(Math.max(0,p-r.shiftX),u-b),m=Math.min(Math.max(0,d-r.shiftY),h-E);else{var O=Math.max(0,p-r.shiftX),w=Math.max(0,d-r.shiftY);switch(r.side){case _.default.CROP_SIDES.S:E=d-m-(r.shiftY-r.initCrop.height);break;case _.default.CROP_SIDES.N:E-=(m=w)-n.y;break;case _.default.CROP_SIDES.W:b-=(f=O)-n.x;break;case _.default.CROP_SIDES.E:b=p-f-(r.shiftX-r.initCrop.width);break;case _.default.CROP_SIDES.NW:m=w,b-=(f=O)-n.x,E-=m-n.y;break;case _.default.CROP_SIDES.NE:m=w,b=p-f-(r.shiftX-r.initCrop.width),E-=m-n.y;break;case _.default.CROP_SIDES.SW:b-=(f=O)-n.x,E=d-m-(r.shiftY-r.initCrop.height);break;case _.default.CROP_SIDES.SE:b=p-f-(r.shiftX-r.initCrop.width),E=d-m-(r.shiftY-r.initCrop.height)}if(c){var y=Math.min(b,u-f)/c;if([_.default.CROP_SIDES.NW,_.default.CROP_SIDES.NE].includes(r.side)&&(m=Math.max(0,m+E-y)),h-(m+y)<0)return;E=y}b=Math.min(Math.max(g,b),u-f),E=Math.min(Math.max(v,E),h-m),b-g<=0&&(f=n.x,b=n.width),E-v<=0&&(m=n.y,E=n.height)}r.setState({x:f,y:m,width:b,height:E})}},r.controlMouseUp=function(){window.removeEventListener("mousemove",r.controlMouseMove),window.removeEventListener("mouseup",r.controlMouseUp),delete r.shiftX,delete r.shiftY,delete r.initCrop,delete r.side},r.cropImage=function(){var e=r.state,t=e.width,n=e.height,o=e.x,i=e.y,a=r.props,s=a.currentBackgroundUrl,c=a.artboardWidth,l=a.artboardHeight;r.setState({isButtonDisable:!0});var p=document.createElement("canvas"),_=p.getContext("2d");_&&be.get(s).then((function(e){var a=e.width/c,s=e.height/l;p.width=t*a,p.height=n*s,_.drawImage(e,o*a,i*s,t*a,n*s,0,0,p.width,p.height),p.toBlob((function(e){r.props.setCrop({url:URL.createObjectURL(e),isCropped:!0,data:{artboardWidth:t,originalWidth:p.width,originalHeight:p.height,addons:Ze(Ze({},r.props.addons),{photoHeight:n})},layers:r.props.layers.items.map((function(e){return Ze(Ze({},e),{x:e.x-o,y:e.y-i})})),drawings:r.props.drawings.map((function(e){return Ze(Ze({},e),{path:e.path.map((function(e){return[e[0]-o,e[1]-i]}))})}))}),r.reset(t,n)}),"image/jpeg",1)})).catch((function(e){console.error(e)}))},r.reset=function(e,t){r.props.setAspect(_.default.CROP_ASPECT_FREE),r.setState({x:0,y:0,width:e,height:t,isButtonDisable:!1})},r.containerEl=n.createRef(),r.areaEl=n.createRef();var o=t.cropAspect,i=t.artboardWidth,a=t.artboardHeight;return r.state=Ze({isButtonDisable:!1},Qe(o,i,a)),r}return Je(t,e),t.prototype.shouldComponentUpdate=function(e){return e.cropAspect===this.props.cropAspect&&e.artboardWidth===this.props.artboardWidth&&e.artboardHeight===this.props.artboardHeight||this.setState(Qe(e.cropAspect,e.artboardWidth,e.artboardHeight)),!0},t.prototype.render=function(){var e=this,t=_.default.CROP_SIDES,r=this.props,o=r.artboardWidth,i=r.artboardHeight,a=this.state,s=a.x,c=a.y,l=a.width,p=a.height,d=a.isButtonDisable,u=l<210,h=u?100:60,f=Object(de.classNames)("CropControls__buttons",{"CropControls__buttons--top":c+p+h>=i,"CropControls__buttons--small":u}),m=0!==s||0!==c||l!==o||p!==i;return n.createElement("div",{className:"CropControls",ref:this.containerEl},n.createElement("div",{className:"CropControls__inner",ref:this.areaEl,style:{top:c,left:s,width:l,height:p}},m&&n.createElement("div",{className:f},n.createElement(Xe.default,{size:"s",className:"CropControls__button CropControls__button--cancel",onClick:function(){return e.reset(e.props.artboardWidth,e.props.artboardHeight)}},Object($e.getLang)("photos_pe_crop_cancel")),n.createElement(Xe.default,{size:"s",className:"CropControls__button",onClick:this.cropImage,disabled:d},Object($e.getLang)("photos_pe_crop_apply"))),n.createElement("div",{className:"CropControls__grid",onMouseDown:function(r){return e.controlMouseDown(r,t.CENTER)}},n.createElement("div",{className:"CropControls__line CropControls__line--v",style:{left:"33.3333%"}}),n.createElement("div",{className:"CropControls__line CropControls__line--v",style:{left:"66.6666%"}}),n.createElement("div",{className:"CropControls__line CropControls__line--h",style:{top:"33.3333%"}}),n.createElement("div",{className:"CropControls__line CropControls__line--h",style:{top:"66.6666%"}}),n.createElement("div",{className:"CropControls__handleCorner CropControls__handleCorner--nw",onMouseDown:function(r){return e.controlMouseDown(r,t.NW)}}),n.createElement("div",{className:"CropControls__handleCorner CropControls__handleCorner--ne",onMouseDown:function(r){return e.controlMouseDown(r,t.NE)}}),n.createElement("div",{className:"CropControls__handleCorner CropControls__handleCorner--sw",onMouseDown:function(r){return e.controlMouseDown(r,t.SW)}}),n.createElement("div",{className:"CropControls__handleCorner CropControls__handleCorner--se",onMouseDown:function(r){return e.controlMouseDown(r,t.SE)}}),this.props.cropAspect===_.default.CROP_ASPECT_FREE&&n.createElement(n.Fragment,null,n.createElement("div",{className:"CropControls__handle CropControls__handle--n",onMouseDown:function(r){return e.controlMouseDown(r,t.N)}}),n.createElement("div",{className:"CropControls__handle CropControls__handle--s",onMouseDown:function(r){return e.controlMouseDown(r,t.S)}}),n.createElement("div",{className:"CropControls__handle CropControls__handle--w",onMouseDown:function(r){return e.controlMouseDown(r,t.W)}}),n.createElement("div",{className:"CropControls__handle CropControls__handle--e",onMouseDown:function(r){return e.controlMouseDown(r,t.E)}})))))},t}(n.Component),tt={setAspect:Q,setCrop:ne},rt=Object(i.connect)((function(e){return{currentBackgroundUrl:u(e),cropAspect:e.present.settings.cropAspect,addons:e.present.data.addons,layers:e.present.layers,drawings:e.present.drawings}}),tt)(et),nt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ot=function(e){function t(t){var r=e.call(this,t)||this;return r.canvasBg=n.createRef(),r}return nt(t,e),t.prototype.componentDidUpdate=function(){this.drawImage()},t.prototype.render=function(){var e=this.props.layer,t=e.width*e.scale,r=e.height*e.scale;return n.createElement("canvas",{ref:this.canvasBg,width:t*_.default.CANVAS_SCALE,height:r*_.default.CANVAS_SCALE,style:{width:t,height:r}})},t.prototype.drawImage=function(){var e=this.props.layer,t=this.canvasBg.current,r=null==t?void 0:t.getContext("2d");if(r){var n=e.width*e.scale,o=e.height*e.scale;r.drawImage(e.canvas,0,0,n*_.default.CANVAS_SCALE,o*_.default.CANVAS_SCALE)}},t}(n.PureComponent),it=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),at=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.controlMouseDown=function(e,r){if(e.preventDefault(),e.stopPropagation(),t.props.startLayerScale(),t.layer=t.props.layer,t.layer.type===_.default.LAYER_TYPES.TEXT){var n=e.target.closest(".EditorLayer__inner");if(!n)return;t.width=n.offsetWidth/t.layer.scale,t.height=n.offsetHeight/t.layer.scale}else t.width=t.layer.width,t.height=t.layer.height;if(void 0!==t.width&&void 0!==t.height){switch(window.addEventListener("mousemove",t.controlMouseMove),window.addEventListener("mouseup",t.controlMouseUp),r){case"se":t.offsetFromCenter={x:t.width/2,y:t.height/2};break;case"sw":t.offsetFromCenter={x:-t.width/2,y:t.height/2};break;case"ne":t.offsetFromCenter={x:t.width/2,y:-t.height/2};break;case"nw":t.offsetFromCenter={x:-t.width/2,y:-t.height/2}}void 0!==t.offsetFromCenter&&(t.distanceToZero=Math.sqrt(t.offsetFromCenter.x*t.offsetFromCenter.x+t.offsetFromCenter.y*t.offsetFromCenter.y))}},t.controlMouseMove=function(e){var r=ae(e,document.querySelector(".EditorCanvas__canvas--draw")),n=r.x,o=r.y;if(void 0!==t.offsetFromCenter&&void 0!==t.distanceToZero&&void 0!==t.width&&void 0!==t.height){var i={x:n-t.layer.x,y:o-t.layer.y},a=180*(Math.atan2(i.y,i.x)-Math.atan2(t.offsetFromCenter.y,t.offsetFromCenter.x))/Math.PI,s=Math.max(_.default.LAYER_MIN_SIZE,Math.sqrt(i.x*i.x+i.y*i.y))/t.distanceToZero;t.props.setLayerScale(s,a)}},t.controlMouseUp=function(){window.removeEventListener("mousemove",t.controlMouseMove),window.removeEventListener("mouseup",t.controlMouseUp),delete t.width,delete t.height,delete t.centerCoordinates,delete t.offsetFromCenter,delete t.distanceToZero},t}return it(t,e),t.prototype.render=function(){var e=this;return n.createElement("div",{className:"EditorLayerSelection"},n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--nw",onMouseDown:function(t){return e.controlMouseDown(t,"nw")}}),n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--ne",onMouseDown:function(t){return e.controlMouseDown(t,"ne")}}),n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--sw",onMouseDown:function(t){return e.controlMouseDown(t,"sw")}}),n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--se",onMouseDown:function(t){return e.controlMouseDown(t,"se")}}))},t}(n.Component),st=r("Xrg9"),ct=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),lt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ct(t,e),t.prototype.render=function(){return st.default.get("story_show_clickable_zones")?this.props.clickableZones.map((function(e,t){var r=e.clickable_area,o=100*Math.abs(r[1].x-r[0].x),i=100*Math.abs(r[2].y-r[1].y);return n.createElement("div",{key:t,className:"EditorClickableZone",style:{top:100*r[0].y+"%",left:100*r[0].x+"%",width:o+"%",height:i+"%"}})})):null},t}(n.Component),pt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),_t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleDoubleClick=function(){t.props.toggleTextEditor(!0)},t}return pt(t,e),t.prototype.render=function(){var e=this.props,t=e.layer,r=e.currentIndex,n=e.index,o=null,i=Object(de.classNames)("EditorLayer","EditorLayer--"+t.type,{"EditorLayer--active":r===n,"EditorLayer--locked":t.locked});switch(t.type){case _.default.LAYER_TYPES.STICKER:o=this.renderLayerSticker(t,n,i);break;case _.default.LAYER_TYPES.TEXT:o=this.renderLayerText(t,n,i);break;case _.default.LAYER_TYPES.IMAGE:o=this.renderLayerImage(t,n,i);break;case _.default.LAYER_TYPES.BACKGROUND:o=this.renderLayerBackground(t,n,i)}if(t.isBackground){var a=document.querySelector(".EditorCanvas__layers--bg");return a?oe.createPortal(o,a):null}return o},t.prototype.renderLayerBackground=function(e,t,r){return n.createElement("div",{key:t,className:r,"data-index":t,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},n.createElement("div",{className:"EditorLayer__inner"},n.createElement(ot,{layer:e}),this.props.currentIndex===t&&n.createElement(at,{layer:e,setLayerScale:this.props.setLayerScale,startLayerScale:this.props.startLayerScale})))},t.prototype.renderLayerSticker=function(e,t,r){var o=this.props.getStickerUrlById(e.id,_.default.STICKER_LARGE);return n.createElement("div",{key:t,className:r,"data-index":t,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},n.createElement("div",{className:"EditorLayer__inner",style:{width:e.width*e.scale,height:e.height*e.scale,backgroundImage:"url('"+o+"')"}},this.props.currentIndex===t&&n.createElement(at,{layer:e,setLayerScale:this.props.setLayerScale,startLayerScale:this.props.startLayerScale})))},t.prototype.renderLayerImage=function(e,t,r){return n.createElement("div",{key:t,className:r,"data-index":t,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},n.createElement("div",{className:"EditorLayer__inner",style:{width:e.width*e.scale,height:e.height*e.scale,backgroundImage:"url('"+e.url+"')"}},this.props.currentIndex===t&&n.createElement(at,{layer:e,setLayerScale:this.props.setLayerScale,startLayerScale:this.props.startLayerScale}),e.clickableZones&&n.createElement(lt,{clickableZones:e.clickableZones})))},t.prototype.renderLayerText=function(e,t,r){var o=Math.max(10,e.fontSize*_.default.FONT_SIZE_COEFFICIENT);r+=" PhotoEditorFontStyle--"+e.fontStyle;var i={fontSize:o*e.scale,color:e.color};return this.props.currentIndex===t&&e.isEdit?null:n.createElement("div",{key:t,className:r,"data-index":t,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},n.createElement("div",{className:"EditorLayer__inner",style:i,onDoubleClick:this.handleDoubleClick},n.createElement("div",null,Object(H.decodeHTMLEntities)(e.text.replace(/(\v)/gm,"\n"))),this.props.currentIndex===t&&n.createElement(at,{layer:e,setLayerScale:this.props.setLayerScale,startLayerScale:this.props.startLayerScale})))},t}(n.Component),dt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ut=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return dt(t,e),t.prototype.render=function(){var e=this,t=this.props.layers,r=t.items,o=t.currentIndex,i=Object(de.classNames)("EditorCanvas__layers",{"EditorCanvas__layers--disabled":[_.default.TABS.PAINT,_.default.TABS.FILTERS,_.default.TABS.COLOR,_.default.TABS.CROP].includes(this.props.currentMode)});return n.createElement(n.Fragment,null,n.createElement("div",{className:i+" EditorCanvas__layers--items"},r.map((function(t,r){return n.createElement(_t,{key:r,index:r,currentIndex:o,layer:t,setLayerScale:e.props.setLayerScale,startLayerScale:e.props.startLayerScale,toggleTextEditor:e.props.toggleTextEditor,getStickerUrlById:e.props.getStickerUrlById})}))),n.createElement("div",{className:i+" EditorCanvas__layers--bg"}))},t}(n.Component),ht=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ft=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){var e=r.textareaEl.current;e&&(r.onChange(),e.select())},r.render=function(){var e=r.props.layer,t=Math.max(10,e.fontSize*_.default.FONT_SIZE_COEFFICIENT);return e.initialFontSize&&(t=e.initialFontSize*_.default.FONT_SIZE_COEFFICIENT),n.createElement("div",{className:"EditorText"},n.createElement("div",{className:"EditorText__inner"},n.createElement("textarea",{ref:r.textareaEl,className:"EditorText__textarea PhotoEditorFontStyle--"+e.fontStyle,defaultValue:Object(H.decodeHTMLEntities)(e.text).replace(/(\v)/gm,""),autoFocus:!0,onKeyDown:r.onKeyDown,onChange:r.onChange,onInput:r.onChange,onPaste:r.onChange,style:{color:e.color,fontSize:t,height:r.state.height}})))},r.onKeyDown=function(e){if("Enter"===e.key)if(e.preventDefault(),e.stopPropagation(),e.ctrlKey||e.metaKey||e.shiftKey){var t=r.textareaEl.current;if(t){var n=e.target.selectionStart,o=e.target.selectionEnd;t.value=t.value.substring(0,n)+"\n"+t.value.substring(o),t.selectionStart=t.selectionEnd=n+1,r.onChange()}}else r.props.closeTextEditor()},r.onChange=function(){var e=r.textareaEl.current;e&&(r.setState({height:0},(function(){r.setState({height:e.scrollHeight})})),r.props.onChange(r.applyLineBreaks(e)))},r.applyLineBreaks=function(e){var t=e.value,r=e.cloneNode(!0);document.querySelector(".EditorText__inner").appendChild(r),r.setAttribute("wrap","off"),r.value="";for(var n=r.scrollWidth,o=0,i=-1;o<t.length;o++){var a=t.charAt(o);if(" "!=a&&"-"!=a&&"+"!=a||(i=o),r.value+=a,r.scrollWidth>n){var s="";if(i>=0){for(var c=i+1;c<o;c++)s+=t.charAt(c);i=-1}s+=a,r.value=r.value.substr(0,r.value.length-s.length),r.value+="\n\v"+s}}return r.remove(),r.value.replace(/(\n\v)/gm,"\v")},r.state={height:0},r.textareaEl=n.createRef(),Object(W.sendStat)(W.EVENTS.EDIT_TEXT),r}return ht(t,e),t.prototype.componentDidUpdate=function(e){e.layer.fontSize===this.props.layer.fontSize&&e.layer.fontStyle===this.props.layer.fontStyle||this.onChange()},t}(n.Component),mt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),bt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setMode=function(e){e===_.default.BACKGROUND_MODES.PHOTO?Object(W.sendStat)(W.EVENTS.CLICK_TO_CAMERA_ICON):e===_.default.BACKGROUND_MODES.BACKGROUND&&Object(W.sendStat)(W.EVENTS.CLICK_TO_GRADIENT_ICON),t.props.setMode(e)},t}return mt(t,e),t.prototype.render=function(){var e=this;return n.createElement("div",{className:"SwitchMode"},Object.values(_.default.BACKGROUND_MODES).map((function(t){var r=Object(de.classNames)("SwitchMode__mode","SwitchMode__mode--"+t,{"SwitchMode__mode--active":t===e.props.current});return n.createElement("span",{key:t,className:r,onClick:function(){return e.setMode(t)}})})))},t}(n.PureComponent),Et=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),gt=function(e){function t(t){var r=e.call(this,t)||this;return r.state={onHover:!1},r}return Et(t,e),t.prototype.render=function(){var e=this,r=Object(de.classNames)("DropBox",{"DropBox--hover":this.state.onHover});return n.createElement("div",{className:r,onMouseOver:function(){return e.setState({onHover:!0})},onMouseOut:function(){return e.setState({onHover:!1})},onMouseUp:this.props.onDelete},t.renderIcon())},t.renderIcon=function(){return n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"50",height:"50",fill:"none"},n.createElement("path",{fill:"#fff",d:"M17.5 18.38a1 1 0 00-2 .24l1.8 15.23a3 3 0 002.98 2.65h9.44a3 3 0 002.98-2.65l1.8-15.23a1 1 0 10-2-.24l-1.78 15.24a1 1 0 01-1 .88h-9.44a1 1 0 01-1-.88L17.5 18.38z"}),n.createElement("path",{fill:"#fff",d:"M22 21.45a1 1 0 00-2 .1l.5 10a1 1 0 102-.1l-.5-10zm8 .1a1 1 0 00-2-.1l-.5 10a1 1 0 102 .1l.5-10zm-4-.05a1 1 0 10-2 0v10a1 1 0 002 0v-10z"}),n.createElement("path",{fill:"#fff",fillRule:"evenodd",d:"M20.62 16.5c.08-.35.2-.77.42-1.2.32-.64.8-1.19 1.38-1.59A4.55 4.55 0 0125 13c1.05 0 1.9.27 2.58.71.59.4 1.06.95 1.38 1.6.21.42.34.84.42 1.19H36a1 1 0 010 2H14a1 1 0 010-2h6.63zm6.68 0a2.9 2.9 0 00-.13-.3c-.16-.33-.4-.61-.7-.82-.31-.2-.77-.38-1.47-.38s-1.16.17-1.47.38c-.32.2-.54.5-.7.82-.05.1-.1.2-.13.3h4.6z",className:"DropBox__cap",clipRule:"evenodd"}))},t}(n.PureComponent),vt=r("s0Wt"),Ot=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),wt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render=function(){var e=t.props.data.artboardContainer;return e?oe.createPortal(t.renderCanvas(),e):t.renderCanvas()},t.renderCanvas=function(){var e=t.props,r=e.layers,o=e.background,i=e.data,a=e.ui,s=e.settings,c=i.addons,l=i.artboardWidth,p=i.artboardHeight,d=i.attachment,u=t.props.layers,h=u.currentIndex,f=u.items,m=null!==h&&f[h],b=m&&m.type===_.default.LAYER_TYPES.TEXT&&m.isEdit,E=t.props.ui.isDataLoaded&&t.props.data.context===_.default.CONTEXT_TYPES.STORY,g=t.props.marginTop,v=p;c&&c.photoHeight&&(v=c.photoHeight);var O=Object(de.classNames)("EditorCanvas",{"EditorCanvas--blurCursor":_.default.TABS.COLOR===a.currentMode&&s.blur.isEnabled}),w=Object(de.classNames)("EditorCanvas__scaleButton",{"EditorCanvas__scaleButton--enabled":!r.items[0].locked});return n.createElement(n.Fragment,null,n.createElement("div",{style:{width:l,height:v,marginTop:g},className:O},t.props.ui.isDataLoaded&&a.currentMode===_.default.TABS.CROP&&n.createElement(rt,{artboardWidth:l,artboardHeight:v}),n.createElement(ut,{setLayerScale:t.props.setLayerScale,startLayerScale:t.props.startLayerScale,toggleTextEditor:t.props.toggleTextEditor,currentMode:t.props.ui.currentMode,getStickerUrlById:t.props.getStickerUrlById,layers:r}),b&&m?n.createElement(ft,{layer:m,onChange:t.onChangeText,closeTextEditor:t.props.closeTextEditor}):E&&n.createElement(n.Fragment,null,!!d&&!a.isShowDropBox&&n.createElement(vt.default,{text:Object($e.getLang)("photos_pe_attached_post"),position:"b",marginTop:5,align:"left"},n.createElement("span",{className:"EditorCanvas__postIcon"})),!a.isShowDropBox&&t.props.background.currentBackgroundType===_.default.BACKGROUND_MODES.PHOTO&&[_.default.TABS.STICKERS,_.default.TABS.TEXT].includes(t.props.ui.currentMode)&&n.createElement("button",{className:w,onClick:t.onClickScaleButton}),!a.isShowDropBox&&n.createElement(bt,{current:o.currentBackgroundType,setMode:t.props.setMode})),a.isShowDropBox&&m&&m.canDelete&&n.createElement(gt,{onDelete:t.props.deleteLayer}),t.props.ui.isDataLoaded&&n.createElement(me,{width:l,height:v}),t.props.ui.isDataLoaded&&n.createElement(Ke,{width:l,height:v})),t.props.ui.isDataLoaded&&n.createElement(ze,{currentBackgroundId:o.currentBackgroundId,setCurrentBackgroundId:t.props.setCurrentBackgroundId,currentBackgroundType:o.currentBackgroundType,uploadPhoto:t.props.uploadPhoto,backgrounds:t.props.data.backgrounds}))},t.onClickScaleButton=function(){var e,r,n=t.props.layers.items[0],o={},i=t.props.data,a=i.artboardWidth,s=i.artboardHeight,c=n.height/n.width;c>1.77?e=(r=s)/c:(e=a,r=a*c);var l=a/2,p=s/2;n.locked?(Object(W.sendStat)(W.EVENTS.ZOOM),Object.assign(o,{locked:!1,scale:.7})):(Object(W.sendStat)(W.EVENTS.UNZOOM),Object.assign(o,{locked:!0,rotate:0,x:l,y:p,width:e,height:r,scale:1})),t.props.updateBackgroundLayer(o),t.props.setCurrentLayer(n.locked?0:null)},t.onChangeText=function(e){t.props.setLayerText(e)},t}return Ot(t,e),t}(n.Component),yt={setCurrentBackgroundId:function(e){return Object(W.sendStat)(W.EVENTS.SELECT_BACKGROUND),{type:"SET_CURRENT_BACKGROUND_ID",value:e}},setLayerScale:function(e,t){return function(r,n){var o=n().present.layers,i=o.currentIndex,a=o.items;null!==i&&a[i]&&r({type:"SET_LAYER_SCALE",payload:{scale:e,rotate:t}})}},startLayerScale:function(){return{type:"START_LAYER_SCALE"}},setLayerText:function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,i=n.items;null!==o&&i[o]&&t({type:"SET_LAYER_TEXT",payload:{text:e}})}},toggleTextEditor:q,deleteLayer:z,updateBackgroundLayer:Y,setCurrentLayer:F,setBackgroundType:ee,closeTextEditor:X},At=Object(i.connect)((function(e){return{ui:e.present.ui,settings:e.present.settings,layers:e.present.layers,drawings:e.present.drawings,background:e.present.background,data:e.present.data,marginTop:h(e)}}),yt)(wt),St=r("JxXo"),Ct=r("x9XA"),Pt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Rt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onTabClick=function(e,r){r||t.props.change(e)},t}return Pt(t,e),t.prototype.render=function(){var e=this,t=this.props.current;return n.createElement("div",{className:"EditorTabs"},n.createElement("div",{className:"EditorTabs__header"},n.Children.map(this.props.children,(function(r){if(r){var o=r.props["data-disabled"],i=Object(de.classNames)("EditorTabs__item","EditorTabs__item--"+r.props["data-mode"],{"EditorTabs__item--current":t===r.props["data-mode"],"EditorTabs__item--disabled":o}),a=n.createElement("div",{className:i,key:r.props["data-mode"],onClick:function(){return e.onTabClick(r.props["data-mode"],o)}});if(o){var s=n.createElement("div",{className:"EditorTabsTooltip"},n.createElement("span",{className:"EditorTabsTooltip__text"},Object($e.getLang)("photos_pe_filters_disabled_text")),n.createElement(Ct.default,{onClick:function(){return e.props.setMode(_.default.BACKGROUND_MODES.PHOTO)},className:"EditorTabsTooltip__link"},Object($e.getLang)("photos_pe_filters_disabled_button")));return n.createElement(St.default,{className:"EditorTabs__tooltip",text:s,appearance:"light",position:"b",maxWidth:203},a)}return a}}))),n.createElement("div",{className:"EditorTabs__content"},n.Children.map(this.props.children,(function(e){if(e){var r={className:Object(de.classNames)(e.props.className,"EditorTabs__tab",{"EditorTabs__tab--current":t===e.props["data-mode"]})};return n.cloneElement(e,r)}}))))},t}(n.Component),Tt=r("URsI"),Dt=r("EasH"),kt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),It=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){r.fetchStickers()},r.componentDidUpdate=function(){r.scrollWithAnimation=!1},r.render=function(){var e=r.props,t=e.stickers,o=e.stickerMouseDown,i=r.props.ui,a=i.stickerHeaderScrollPosition,s=i.currentStickerPackIndex,c=r.scrollElement.current,l=!!a,p=!1,d=0;c&&(d=a+c.offsetWidth,p=!!(c.scrollWidth-d));var u=t[s]?t[s].items:[];r.needReset&&(r.needReset=!1,u=[],r.setState({}));for(var h=[],f=0,m=u.length;f<m;f+=3)h.push(u.slice(f,f+3));return n.createElement("div",{className:"StickersPanel"},n.createElement("div",{className:"StickersPanel__header"},n.createElement("div",{className:"StickersPanel__scroll",style:{transform:"translateX(-"+a+"px)",transition:r.scrollWithAnimation?"transform .3s ease-out":""},ref:r.scrollElement,onWheel:r.tabsMouseWheel},n.createElement("div",{className:"StickersPanel__tab StickersPanel__tab--store",onClick:function(){return r.showStickerShop()}}),t.map((function(e,t){var o=e.id,i=r.getTabPreviewUrl(t);if(!i)return null;var a=!Object(Ce.inArray)(o,["recent","editor"]),c=Object(de.classNames)("StickersPanel__tab",{"StickersPanel__tab--selected":t===s,"StickersPanel__tab--recent":"recent"===o,"StickersPanel__tab--editor":"editor"===o});return n.createElement("div",{key:o,className:c,style:a?{backgroundImage:"url('"+i+"')"}:void 0,onClick:function(){return r.selectStickerPack(t)}})}))),l&&n.createElement("div",{className:"StickersPanel__arrow StickersPanel__arrow--left",onClick:function(){return r.handleTabArrowClick(!0)}},n.createElement("span",{className:"StickersPanel__arrowIcon"})),p&&n.createElement("div",{className:"StickersPanel__arrow StickersPanel__arrow--right",onClick:function(){return r.handleTabArrowClick(!1)}},n.createElement("span",{className:"StickersPanel__arrowIcon"}))),n.createElement(Tt.default,{virtualized:!0,loadMore:function(){},hasMore:!1,className:"StickersPanel__content",itemHeight:98},h.map((function(e,t){return n.createElement("div",{key:t,className:"StickersPanel__row"},e.map((function(e){var t=e.id,r=e.sizes;return n.createElement("div",{key:t,className:"StickersPanel__preview",onMouseDown:function(e){return o(e,t)}},n.createElement("img",{src:r[_.default.STICKER_MEDIUM],className:"StickersPanel__previewImage"}))})))}))))},r.getTabPreviewUrl=function(e){var t=r.props.stickers[e].items,n=(t||[])[0],o=void 0===n?null:n;return!(!t||!o)&&o.sizes[_.default.STICKER_THUMB]},r.selectStickerPack=function(e){r.needReset=!0,r.props.setCurrentStickerPackIndex(e)},r.tabsMouseWheel=function(e){r.setPosition(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX)},r.handleTabArrowClick=function(e){var t=r.scrollElement.current;if(t){var n=t.offsetWidth;e&&(n=-n),r.setPosition(n,!0)}},r.setPosition=function(e,t){var n=r.scrollElement.current,o=r.props.ui.stickerHeaderScrollPosition;if(n){var i=n.offsetWidth,a=Math.max(0,Math.min(o+e,n.scrollWidth-i));t&&(r.scrollWithAnimation=!0),r.props.setHeaderScrollPosition(a)}},r.loadingLimit=25,r.scrollElement=n.createRef(),r.scrollWithAnimation=!1,r.needReset=!1,r}return kt(t,e),t.prototype.fetchStickers=function(){var e=this;window.ajax.post("al_photos.php",{act:"get_editor_data"},{onDone:function(t){var r={};t.stickers.forEach((function(e){e.items.forEach((function(e){r[e.id]=e}))})),e.props.setData({stickers:t.stickers,stickersMap:r})},onFail:function(e){return console.error(e),!0}})},t.prototype.showStickerShop=function(){var e=this;Object(Dt.showBox)("al_im.php",{act:"stickers_store",box:1},{dark:1,stat:["im.css","imn.js","page_help.css",window.jsc("web/sorter.js")],params:{onDestroy:function(){e.fetchStickers()}}})},t}(n.Component),Mt={setCurrentStickerPackIndex:function(e){return{type:"SET_CURRENT_STICKER_PACK_INDEX",value:e}},setHeaderScrollPosition:function(e){return{type:"SET_HEADER_SCROLL_POSITION",value:e}},setData:re},Lt=Object(i.connect)((function(e){return{ui:e.present.ui,stickers:e.present.data.stickers}}),Mt)(It),xt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Nt=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},Bt=function(e){function t(t){var r=e.call(this,t)||this;return r.colors=r.getColors(t.avgColor),r}return xt(t,e),t.prototype.shouldComponentUpdate=function(e){return JSON.stringify(e.avgColor)!==JSON.stringify(this.props.avgColor)&&(this.colors=this.getColors(e.avgColor)),!0},t.prototype.render=function(){var e=this;return n.createElement("div",{className:"ColorPicker"},this.colors.map((function(t,r){var o=Object(de.classNames)("ColorPicker__color",{"ColorPicker__color--white":"#FFFFFF"===t,"ColorPicker__color--selected":t===e.props.color});return n.createElement("div",{key:r,className:o,style:{backgroundColor:t},onClick:function(){return e.props.setColor(t)}})})))},t.prototype.getColors=function(e){var t,r=function(e,t,r){var n=0,o=0,i=e/255,a=t/255,s=r/255,c=Math.max(i,a,s),l=c-Math.min(i,a,s),p=function(e){return(c-e)/6/l+.5},_=function(e){return Math.round(100*e)/100};if(0!==l){o=l/c;var d=p(i),u=p(a),h=p(s);i===c?n=h-u:a===c?n=1/3+d-h:s===c&&(n=2/3+u-d),n<0?n+=1:n>1&&(n-=1)}return{h:Math.round(360*n),s:_(100*o),v:_(100*c)}}(e.r,e.g,e.b),n=[];return _.default.AVERAGE_COLORS_MAP.forEach((function(e){var t=Math.round(Math.min(Math.max(r.s+e.s,0),100)),o=Math.round(Math.min(Math.max(r.v+e.v,0),100));n.push(function(e,t,r){t/=100,r/=100;var n=(1-Math.abs(2*r-1))*t,o=n*(1-Math.abs(e/60%2-1)),i=r-n/2,a=0,s=0,c=0;return 0<=e&&e<60?(a=n,s=o,c=0):60<=e&&e<120?(a=o,s=n,c=0):120<=e&&e<180?(a=0,s=n,c=o):180<=e&&e<240?(a=0,s=o,c=n):240<=e&&e<300?(a=o,s=0,c=n):300<=e&&e<360&&(a=n,s=0,c=o),a=Math.round(255*(a+i)).toString(16),s=Math.round(255*(s+i)).toString(16),c=Math.round(255*(c+i)).toString(16),1==a.length&&(a="0"+a),1==s.length&&(s="0"+s),1==c.length&&(c="0"+c),"#"+a+s+c}(r.h,t,o).toUpperCase())})),(t=Nt(_.default.COLORS,n),t.filter((function(e,t,r){return r.indexOf(e)==t}))).slice(0,30)},t}(n.Component),jt=r("eP0d"),Ut=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Wt=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){r.updateDrawingPreview()},r.render=function(){var e=r.props,t=e.settings,o=e.setColor,i=e.setBrushWidth,a=e.setBrushOpacity,s=e.avgColor;return r.updateDrawingPreview(),n.createElement("div",{className:"DrawPanel"},n.createElement("canvas",{ref:r.previewCanvas,className:"DrawPanel__preview",width:_.default.DRAWING_PREVIEW_WIDTH*_.default.CANVAS_SCALE,height:_.default.DRAWING_PREVIEW_HEIGHT*_.default.CANVAS_SCALE,style:{width:_.default.DRAWING_PREVIEW_WIDTH,height:_.default.DRAWING_PREVIEW_HEIGHT}}),n.createElement("div",{className:"DrawPanel__sliders"},n.createElement("div",{className:"DrawPanel__slider"},n.createElement("div",{className:"DrawPanel__title"},Object($e.getLang)("photos_pe_intensity")),n.createElement(jt.default,{min:0,max:1,isShowHandle:!0,defaultValue:t.brushOpacity,formatHint:function(e){return Math.round(100*e)+"%"},onChange:function(e){return a(e)}})),n.createElement("div",{className:"DrawPanel__slider"},n.createElement("div",{className:"DrawPanel__title"},Object($e.getLang)("photos_pe_line_width")),n.createElement(jt.default,{min:0,max:1,isShowHandle:!0,defaultValue:t.brushWidth,formatHint:function(e){return Math.round(100*e)+"%"},onChange:function(e){return i(e)}}))),n.createElement("div",{className:"DrawPanel__colors"},n.createElement("div",{className:"DrawPanel__title DrawPanel__title--largeOffset"},Object($e.getLang)("photos_pe_color")),n.createElement(Bt,{color:t.color,avgColor:s,setColor:o})))},r.updateDrawingPreview=function(){var e=r.previewCanvas.current,t=r.props.settings;if(e){var n=e.getContext("2d");if(n){var o=n.canvas,i=o.width,a=o.height;n.clearRect(0,0,i,a);var s=_.default.CANVAS_SCALE,c=new Path2D("M"+69*s+" "+65*s+"L"+93*s+" "+41*s+"L"+121*s+" "+69*s+"L"+149*s+" "+41*s+"L"+177*s+" "+69*s+"L"+201*s+" "+45*s),l="#FFFFFF"===t.color?"#F1F1F1":t.color;n.lineWidth=t.brushWidth*_.default.BRUSH_WIDTH_COEFFICIENT*s,n.strokeStyle=se(l,t.brushOpacity),n.lineJoin=n.lineCap="round",n.stroke(c)}}},r.previewCanvas=n.createRef(),r}return Ut(t,e),t}(n.Component),Ht={setColor:Z,setBrushWidth:function(e){return{type:"SET_SETTING_BRUSH_WIDTH",brushWidth:Math.max(.1,e)}},setBrushOpacity:function(e){return{type:"SET_SETTING_BRUSH_OPACITY",brushOpacity:e}}},Kt=Object(i.connect)((function(e){return{settings:e.present.settings,drawings:e.present.drawings,avgColor:e.present.layers.items[0].avgColor}}),Ht)(Wt),Ft=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Vt=function(){return(Vt=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Gt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.flip=function(e,r){var n=document.createElement("canvas"),o=null==n?void 0:n.getContext("2d"),i=t.props.currentBackgroundUrl;o&&be.get(i).then((function(i){n.width=i.width,n.height=i.height,e?(o.translate(n.width,0),o.scale(-1,1)):r&&(o.translate(0,n.height),o.scale(1,-1)),o.drawImage(i,0,0),n.toBlob((function(n){var o={url:URL.createObjectURL(n)};e&&(o.flipX=!t.props.flipX),r&&(o.flipY=!t.props.flipY),t.props.setCrop(o)}),"image/jpeg",1)})).catch((function(e){console.error(e)}))},t.rotate=function(e){var r=document.createElement("canvas"),n=null==r?void 0:r.getContext("2d"),o=t.props,i=o.currentBackgroundUrl,a=o.originalWidth,s=o.originalHeight;n&&be.get(i).then((function(o){r.width=o.height,r.height=o.width;var i=e?-90:90;n.translate(r.width/2,r.height/2),n.rotate(i*Math.PI/180),n.drawImage(o,-o.width/2,-o.height/2),r.toBlob((function(e){var n=r.height/r.width,o=t.props.rotate+i;t.props.rotate>o?Object(W.sendStat)(W.EVENTS.TURN_LEFT):Object(W.sendStat)(W.EVENTS.TURN_RIGHT);var c,l,p=document.getElementById("pv_photo").getBoundingClientRect(),d=p.width,u=p.height;u-=_.default.BOTTOM_PANEL_HEIGHT,n>=.67?(c=u/n,l=u):(c=d,l=d*n),t.props.setCrop({url:URL.createObjectURL(e),data:{artboardWidth:c,originalWidth:s,originalHeight:a,addons:Vt(Vt({},t.props.addons),{photoHeight:l})},rotate:o>270?0:o})}),"image/jpeg",1)})).catch((function(e){console.error(e)}))},t}return Ft(t,e),t.prototype.render=function(){var e=this;return n.createElement("div",{className:"CropPanel"},n.createElement("span",{className:"CropPanel__title"},Object($e.getLang)("photos_pe_crop_aspect_title")),n.createElement("ul",{className:"CropPanelRatioTabs"},_.default.CROP_ASPECTS.map((function(t){var r=Object(de.classNames)("CropPanelRatioTabs__button",{"CropPanelRatioTabs__button--active":e.props.cropAspect===t.value});return n.createElement("li",{className:"CropPanelRatioTabs__item",key:t.title},n.createElement("button",{className:r,onClick:function(){return e.props.setAspect(t.value)}},Object($e.getLang)(t.title)))}))),n.createElement("ul",{className:"CropPanelSettings"},n.createElement("li",{className:"CropPanelSettings__item"},n.createElement(Ct.default,{className:"CropPanelSettings__link CropPanelSettings__link--rotateRight",onClick:function(){return e.rotate(!1)}},Object($e.getLang)("photos_pe_rotate_right"))),n.createElement("li",{className:"CropPanelSettings__item"},n.createElement(Ct.default,{className:"CropPanelSettings__link CropPanelSettings__link--rotateLeft",onClick:function(){return e.rotate(!0)}},Object($e.getLang)("photos_pe_rotate_left"))),n.createElement("li",{className:"CropPanelSettings__item"},n.createElement(Ct.default,{className:"CropPanelSettings__link CropPanelSettings__link--flipHorizontal",onClick:function(){return e.flip(!0,!1)}},Object($e.getLang)("photos_pe_flip_horizontal"))),n.createElement("li",{className:"CropPanelSettings__item"},n.createElement(Ct.default,{className:"CropPanelSettings__link CropPanelSettings__link--flipVertical",onClick:function(){return e.flip(!1,!0)}},Object($e.getLang)("photos_pe_flip_vertical")))))},t}(n.Component),qt={setCrop:ne,setAspect:Q},Yt=Object(i.connect)((function(e){return{flipX:e.present.settings.flipX,flipY:e.present.settings.flipY,rotate:e.present.settings.rotation,cropAspect:e.present.settings.cropAspect,currentBackgroundUrl:u(e),addons:e.present.data.addons,artboardWidth:e.present.data.artboardWidth,artboardHeight:e.present.data.artboardHeight,originalWidth:e.present.data.originalWidth,originalHeight:e.present.data.originalHeight}}),qt)(Gt),zt=r("W8yn"),Xt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),$t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render=function(){var e=t.props,r=e.settings,o=e.setColor,i=e.setFontSize,a=e.layer,s=e.fontsPlaceholders,c=e.avgColor,l=a&&a.isEdit,p=a&&a.fontStyle,d=a&&a.fontSize,u=a&&a.color;return n.createElement("div",{className:"TextPanel"},l?n.createElement(Xe.default,{className:"TextPanelButton",onClick:t.props.closeTextEditor},Object(Fe.getLang)("photos_pe_save_text")):n.createElement(Xe.default,{className:"TextPanelButton",onClick:function(){return t.props.addLayerText(!0,{isEdit:!0})}},n.createElement("div",{className:"TextPanelButton__icon"}),Object(Fe.getLang)("photos_pe_add_text")),n.createElement("div",{className:"TextPanelButton__fonts"},n.createElement("div",{className:"TextPanelButton__title"},Object(Fe.getLang)("photos_pe_font")),_.default.FONTS.map((function(e,o){return n.createElement(zt.default,{key:e,value:e,name:"photo_editor_fonts",className:"TextPanelButton__radio",onChange:function(){return t.props.setFontStyle(e)},checked:p?p===e:r.fontStyle===e},n.createElement("span",{className:"TextPanelButton__font TextPanelButton__font--"+e+" PhotoEditorFontStyle--"+e},s[o]))}))),n.createElement("div",{className:"TextPanelButton__fontSize"},n.createElement("div",{className:"TextPanelButton__title"},Object(Fe.getLang)("photos_pe_font_size")),n.createElement(jt.default,{min:0,max:1,isShowHandle:!0,value:d||r.fontSize,formatHint:function(e){return""+Math.round(100*e)},onChange:function(e){return i(e)}})),n.createElement("div",{className:"TextPanelButton__colors"},n.createElement("div",{className:"TextPanelButton__title"},Object(Fe.getLang)("photos_pe_color")),n.createElement(Bt,{color:u||r.color,avgColor:c,setColor:o})))},t}return Xt(t,e),t}(n.Component),Jt={addLayerText:G,setColor:Z,setFontSize:function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,i=n.items;o&&!i[o]||t(function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,i=n.items;null!==o&&i[o]&&t({type:v,payload:{fontSize:e}})}}(e)),t({type:"SET_SETTING_FONT_SIZE",fontSize:e})}},setFontStyle:function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,i=n.items;o&&!i[o]||t(function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,i=n.items;null!==o&&i[o]&&t({type:"SET_LAYER_FONT_STYLE",payload:{fontStyle:e}})}}(e)),t({type:"SET_SETTING_FONT_FAMILY",fontStyle:e})}},closeTextEditor:X},Zt=Object(i.connect)((function(e){var t=e.present.layers,r=t.items,n=t.currentIndex,o=null;return null!==n&&(o=r[n]),{settings:e.present.settings,layer:o,fontsPlaceholders:e.present.data.fontsPlaceholders,avgColor:e.present.layers.items[0].avgColor}}),Jt)($t),Qt=r("hN/p"),er=r("85vT"),tr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),rr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return tr(t,e),t.prototype.render=function(){var e=this.props,t=e.settings,r=e.setColorCorrection;return n.createElement("div",{className:"ColorPanel"},n.createElement("div",{className:"ColorPanel__items"},n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object($e.getLang)("photos_pe_correction_exposure")),n.createElement(jt.default,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.exposure,onChange:function(e){return r("exposure",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object($e.getLang)("photos_pe_correction_contrast")),n.createElement(jt.default,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.contrast,onChange:function(e){return r("contrast",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object($e.getLang)("photos_pe_correction_saturation")),n.createElement(jt.default,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.saturation,onChange:function(e){return r("saturation",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object($e.getLang)("photos_pe_correction_warmth")),n.createElement(jt.default,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.warmth,onChange:function(e){return r("warmth",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object($e.getLang)("photos_pe_correction_vignette")),n.createElement(jt.default,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.vignette,onChange:function(e){return r("vignette",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object($e.getLang)("photos_pe_correction_sharpness")),n.createElement(jt.default,{min:0,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.sharpness,onChange:function(e){return r("sharpness",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object($e.getLang)("photos_pe_correction_grain")),n.createElement(jt.default,{min:0,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.grain,onChange:function(e){return r("grain",e)},formatHint:function(e){return Math.round(100*e)}}))),n.createElement("div",{className:"ColorPanel__linkBox"},this.renderAutoCorrectionPanel()),n.createElement("div",{className:"ColorPanel__linkBox"},this.renderBlurPanel()))},t.prototype.renderAutoCorrectionPanel=function(){var e=this.props,t=e.settings,r=e.setAutoCorrection;return t.isAutoCorrection?n.createElement("div",{className:"ColorPanelEnabledBox"},n.createElement("div",{className:"ColorPanelEnabledBox__header"},n.createElement(er.default,{className:""},Object($e.getLang)("photos_pe_correction_auto_enabled")),n.createElement("span",{className:"dvd"}),n.createElement(Ct.default,{className:"ColorPanelEnabledBox__link",onClick:function(){return r(!1)}},Object($e.getLang)("photos_pe_cancel")))):n.createElement(Ct.default,{className:"ColorPanel__link ColorPanel__link--auto",onClick:function(){return r(!0)}},Object($e.getLang)("photos_pe_correction_auto"))},t.prototype.renderBlurPanel=function(){var e=this.props,t=e.settings,r=e.setBlurEnable,o=e.setBlurForm,i=e.setBlurSize,a=t.blur,s=[{label:Object($e.getLang)("photos_pe_correction_blur_type_round"),value:_.default.BLUR_TYPES.ROUND},{label:Object($e.getLang)("photos_pe_correction_blur_type_rec"),value:_.default.BLUR_TYPES.RECTANGULAR}];return a.isEnabled?n.createElement("div",{className:"ColorPanelEnabledBox"},n.createElement("div",{className:"ColorPanelEnabledBox__header"},n.createElement(er.default,{className:""},Object($e.getLang)("photos_pe_correction_blur_enabled")),n.createElement("span",{className:"dvd"}),n.createElement(Ct.default,{className:"ColorPanelEnabledBox__link",onClick:function(){return r(!1)}},Object($e.getLang)("photos_pe_cancel"))),n.createElement("div",{className:"ColorPanelEnabledBox__select"},n.createElement("span",{className:"ColorPanelEnabledBox__type"},Object($e.getLang)("photos_pe_correction_blur_type")),n.createElement(Qt.default,{appearance:"fancy",value:a.form,options:s,onChange:function(e){return o(String(e.selected.value))}})),n.createElement(jt.default,{min:0,max:100,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.blur.size,onChange:function(e){return i(e)},formatHint:function(e){return Math.round(e)}})):n.createElement(Ct.default,{className:"ColorPanel__link ColorPanel__link--blur",onClick:function(){return r(!0)}},Object($e.getLang)("photos_pe_correction_blur"))},t}(n.Component),nr={setColorCorrection:function(e,t){return{type:m,filter:e,value:t}},setBlurEnable:function(e){return e?Object(W.sendStat)(W.EVENTS.ENABLE_BLUR):Object(W.sendStat)(W.EVENTS.DISABLE_BLUR),{type:"SET_SETTING_BLUR_ENABLE",isEnabled:e}},setBlurForm:function(e){return{type:"SET_SETTING_BLUR_FORM",form:e}},setBlurSize:function(e){return{type:E,size:e}},setAutoCorrection:function(e){return e?Object(W.sendStat)(W.EVENTS.ENABLE_AUTOCORRECTION):Object(W.sendStat)(W.EVENTS.DISABLE_AUTOCORRECTION),{type:"SET_SETTING_AUTO_CORRECTION",isAutoCorrection:e}}},or=Object(i.connect)((function(e){return{settings:e.present.settings}}),nr)(rr),ir=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ar=function(e){function t(t){var r=e.call(this,t)||this;return r.shouldComponentUpdate=function(e){var t=r.props,n=t.currentBackgroundUrl,o=t.currentFilterName,i=n!==e.currentBackgroundUrl;return o!==e.currentFilterName||(i&&r.update(e.currentBackgroundUrl),!1)},r.handleClick=function(){r.props.setFilter(r.props.filter)},r.canvas=n.createRef(),r.renderer=new Be,r}return ir(t,e),t.prototype.componentDidMount=function(){this.update(this.props.currentBackgroundUrl)},t.prototype.render=function(){var e=Object(de.classNames)("FiltersItem",{"FiltersItem--active":this.props.currentFilterName===this.props.filter});return n.createElement("div",{className:e,onClick:this.handleClick},n.createElement("div",{className:"FiltersItem__inner",style:{width:_.default.FILTER_PREVIEW_WIDTH}},n.createElement("canvas",{className:"FiltersItem__image",ref:this.canvas,width:_.default.FILTER_PREVIEW_WIDTH*_.default.CANVAS_SCALE,height:_.default.FILTER_PREVIEW_HEIGHT*_.default.CANVAS_SCALE,style:{width:_.default.FILTER_PREVIEW_WIDTH,height:_.default.FILTER_PREVIEW_HEIGHT}}),n.createElement("span",{className:"FiltersItem__name"},Object($e.getLang)("photos_pe_filter_"+this.props.filter))))},t.prototype.update=function(e){var t=this;e&&be.get(e).then((function(e){t.renderImage(e)})).catch((function(e){console.error(e)}))},t.prototype.renderImage=function(e){var t=this;this.renderer.render(_.default.FILTER_PREVIEW_WIDTH*_.default.CANVAS_SCALE,_.default.FILTER_PREVIEW_HEIGHT*_.default.CANVAS_SCALE,e,this.props.filter,{amount:.75,sourceSize:[e.width,e.height]}).then((function(r){if(r){var n=t.canvas.current;if(n){var o=n.getContext("2d");if(o){var i,a,s=+(e.height/e.width).toFixed(2);s>1.77?(i=n.height/s,a=n.height):(i=n.width,a=n.width*s);var c=n.width/2-i/2,l=n.height/2-a/2;pe(n,r,t.props.avgColor),o.drawImage(r,c,l,i,a)}}}})).catch((function(e){console.error(new Error(e))}))},t}(n.Component),sr={setFilter:function(e){return"regular"===e?Object(W.sendStat)(W.EVENTS.REMOVE_FILTER):Object(W.sendStat)(W.EVENTS.ADD_FILTER),{type:"SET_SETTING_FILTER",name:e}}},cr=Object(i.connect)((function(e){return{currentFilterName:e.present.settings.filter.name,currentBackgroundUrl:u(e)}}),sr)(ar),lr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),pr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return lr(t,e),t.prototype.render=function(){var e=this;return n.createElement("div",{className:"FiltersPanel"},n.createElement("div",{className:"FiltersPanel__header"},this.renderHeader()),n.createElement("div",{className:"FiltersPanel__inner"},_.default.PHOTO_FILTERS.map((function(t){return n.createElement(cr,{key:t,avgColor:e.props.avgColor,filter:t})}))))},t.prototype.renderHeader=function(){var e=this.props.settings;return"regular"===e.filter.name?n.createElement("span",null,Object($e.getLang)("photos_pe_filter_disabled")):n.createElement("div",{className:"FiltersPanel__slider"},n.createElement("span",{className:"FiltersPanel__title"},Object($e.getLang)("photos_pe_filter_enabled")),n.createElement(jt.default,{min:0,max:1,value:e.filter.value,isShowHandle:!0,onChange:this.props.setFilterAmount,formatHint:function(e){return Math.round(100*e)+"%"}}))},t}(n.Component),_r={setFilterAmount:function(e){return{type:b,value:e}}},dr=Object(i.connect)((function(e){return{settings:e.present.settings,avgColor:e.present.layers.items[0].avgColor}}),_r)(pr),ur=s.ActionCreators,hr=Object(i.connect)((function(e){return{canUndo:e.past.length>0,canRedo:e.future.length>0}}),ur)((function(e){var t=e.canUndo,r=e.canRedo,n=e.undo,i=e.redo;return o.a.createElement("div",{className:"UndoRedo"},o.a.createElement("button",{className:"UndoRedo__button UndoRedo__button--undo",onClick:function(){Object(W.sendStat)(W.EVENTS.UNDO),n()},disabled:!t}),o.a.createElement("button",{className:"UndoRedo__button UndoRedo__button--redo",onClick:function(){Object(W.sendStat)(W.EVENTS.REDO),i()},disabled:!r}))})),fr=new(function(){function e(){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d")}return e.prototype.draw=function(e,t,r,n,o,i){var a=this;return new Promise((function(s,c){var l=r[0];a.canvas.width=e,a.canvas.height=t,pe(a.canvas,l.canvas,l.avgColor);var p=l.width*l.scale,_=l.height*l.scale,d=l.x-p/2,u=l.y-_/2;a.drawImage(l.canvas,p*o,_*o,d*o,u*o,l.rotate),a.drawBrush(n,o),a.drawLayers(r,o,e,t,i).then((function(){a.canvas.toBlob((function(e){s({blob:e,width:a.canvas.width,height:a.canvas.height})}),"image/jpeg",1)})).catch((function(e){c(e)}))}))},e.prototype.drawImage=function(e,t,r,n,o,i){this.context&&(this.context.save(),this.context.translate(n,o),this.context.translate(t/2,r/2),this.context.rotate(i*Math.PI/180),this.context.translate(-t/2,-r/2),this.context.drawImage(e,0,0,t,r),this.context.restore())},e.prototype.drawBrush=function(e,t){var r=this.context;r&&(r.save(),r.lineCap="round",r.lineJoin="round",e.forEach((function(e){r.lineWidth=e.width*_.default.BRUSH_WIDTH_COEFFICIENT*t,r.strokeStyle=se(e.color,e.opacity),r.beginPath(),r.moveTo(e.path[0][0]*t,e.path[0][1]*t),e.path.forEach((function(e){r.lineTo(e[0]*t,e[1]*t)})),r.stroke()})),r.restore())},e.prototype.drawLayers=function(e,t,r,n,o){var i=this;return new Promise((function(r,n){var a=[];e.forEach((function(e,t){var r=null;if(e.type!==_.default.LAYER_TYPES.BACKGROUND){if(e.type===_.default.LAYER_TYPES.STICKER){var n=o((e=e).id,_.default.STICKER_LARGE);r=i.fetchImage(n,e.width*e.scale,e.height*e.scale,e.x,e.y,e.rotate)}else if(e.type===_.default.LAYER_TYPES.IMAGE)e=e,r=i.fetchImage(e.url,e.width*e.scale,e.height*e.scale,e.x,e.y,e.rotate);else if(e.type===_.default.LAYER_TYPES.TEXT){var s=document.querySelector('[data-index="'+t+'"] .EditorLayer__inner');s&&(r=i.drawTextLayer(e,s))}r&&a.push(r)}})),Promise.all(a).then((function(e){e.forEach((function(e){var r=e.width,n=e.height,o=e.x-r/2,a=e.y-n/2;i.drawImage(e.image,r*t,n*t,o*t,a*t,e.rotate)})),r()})).catch((function(e){n(e)}))}))},e.prototype.drawTextLayer=function(e,t){return new Promise((function(r,n){var o=document.createElement("canvas"),i=o.getContext("2d");if(!i)return n();o.width=t.offsetWidth*_.default.CANVAS_SCALE+100,o.height=t.offsetHeight*_.default.CANVAS_SCALE+100;var a="";switch(e.fontStyle){case"classic":a="RobotoPE";break;case"cursive":a="PacificoPE";break;case"marker":a="AmaticPE";break;case"italics":a="TTCommonsPE";break;case"typewriter":a="GoraPE";break;case"poster":a="DinPE";break;case"retro":a="Rodchenko";break;case"impact":a="Impact";break;case"lobster":a="Lobster"}var s=e.fontSize*e.scale*_.default.FONT_SIZE_COEFFICIENT*_.default.CANVAS_SCALE;i.font=s+"px "+a+", serif",i.fillStyle=e.color,i.textAlign="center",i.textBaseline="top",function(e,t,r,n,o,i){if((i=i||0)<=0)e.fillText(t,r,n);else{for(var a=t.replace(/(\v)/gm,"\n").split("\n"),s=0,c=1;a.length>0&&c<=a.length;){var l=a.slice(0,c).join(" ");e.measureText(l).width>i?(1===c&&(c=2),e.fillText(a.slice(0,c-1).join(" "),r,n+o*s),s++,a=a.splice(c-1),c=1):c++}c>0&&e.fillText(a.join(" "),r,n+o*s)}}(i,e.text,o.width/2,50,s,o.width-100),r({image:o,width:o.width/_.default.CANVAS_SCALE,height:o.height/_.default.CANVAS_SCALE,x:e.x,y:e.y,rotate:e.rotate})}))},e.prototype.fetchImage=function(e,t,r,n,o,i){return new Promise((function(a){ie(e).then((function(e){a({image:e,width:t,height:r,x:n,y:o,rotate:i})})).catch((function(e){console.error(e)}))}))},e}()),mr=r("3oLO"),br=r("W9Tc"),Er=r("zxIV"),gr=r("WfnU"),vr=r("3blr"),Or=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),wr=function(){return(wr=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},yr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.componentDidMount=function(){window.addEventListener("keydown",t.handleKeyDown,{capture:!0}),window.addEventListener("mousedown",t.canvasMouseDown),t.getEditorData().then((function(e){var r,n,o=e.stickers,i=e.backgrounds,a=e.storyUploadUrlHash,s=e.storySaveHash,c={};o.forEach((function(e){e.items.forEach((function(e){c[e.id]=e}))})),t.props.setData({stickers:o,stickersMap:c,backgrounds:i,placeholders:Object($e.getLang)("photos_pe_texts_placeholders").split("<br>"),fontsPlaceholders:Object($e.getLang)("photos_pe_fonts").split("<br>"),storyUploadUrlHash:a,storySaveHash:s}),t.props.setDataLoaded(),(null===(n=null===(r=t.props.data)||void 0===r?void 0:r.serviceInfo)||void 0===n?void 0:n.open_text_editor)?t.props.addLayerText(!0,{isEdit:!0,text:""}):t.props.background.currentBackgroundType===_.default.BACKGROUND_MODES.BACKGROUND&&(t.props.addLayerText(!0,{isEdit:!0}),t.props.closeTextEditor(),t.props.setCurrentLayer(null)),t.props.stickers&&t.prepareStickers(t.props.stickers)})).catch((function(){window.showFastBox({title:Object($e.getLang)("global_error")},Object($e.getLang)("global_error"),Object($e.getLang)("global_close"),(function(){window.curBox().hide(),t.props.data.close(!1,!0)}))}))},t.componentWillUnmount=function(){window.removeEventListener("keydown",t.handleKeyDown,{capture:!0}),window.removeEventListener("mousedown",t.canvasMouseDown),delete window.cur.storyPublishContext},t.getEditorData=function(){return new Promise((function(e,t){mr.ajax.post("al_photos.php",{act:"get_editor_data"},{onDone:function(t){e(t)},onFail:function(){return t(),!0}})}))},t.render=function(){var e,r=t.props,o=r.ui,i=r.data,a=r.drawings,s=r.layers,c=r.settings;if(i.artboardContainer||(e={width:i.artboardWidth,height:parseInt(i.artboardHeight)+_.default.BOTTOM_PANEL_HEIGHT}),t.isSaveDisabled=!0,i.context===_.default.CONTEXT_TYPES.STORY)t.isSaveDisabled=!1;else{var l=c.colorCorrection,p=c.filter,d=c.blur,u=c.isAutoCorrection,h=c.isCropped,f=c.flipX,m=c.flipY,b=c.rotation;t.isSaveDisabled=!(!(s.items.length<=1)||a.length||l.exposure||l.contrast||l.saturation||l.warmth||l.vignette||l.sharpness||l.grain||"regular"!==p.name||d.isEnabled||u||h||f||m||b)}return n.createElement("div",{className:"PhotoEditor",style:{height:parseInt(i.artboardHeight)+_.default.BOTTOM_PANEL_HEIGHT}},n.createElement("div",{className:"PhotoEditor__canvas",style:e},n.createElement(At,{getStickerUrlById:t.getStickerUrlById,uploadPhoto:t.uploadPhoto,setMode:t.setMode})),n.createElement("div",{className:"PhotoEditor__tabs"},o.isDataLoaded?t.renderTabs():n.createElement(vr.default,null)),!o.isDataLoaded&&t.renderFontsPreloading())},t.renderTabs=function(){var e,r=t.props,o=r.data,i=r.background,a=o.context===_.default.CONTEXT_TYPES.STORY&&i.currentBackgroundType===_.default.BACKGROUND_MODES.BACKGROUND,s=Object(br.partConfigEnabled)("web_new_photo_editor"),c=Object(br.partConfigEnabled)("web_new_photo_editor_crop"),l=Object($e.getLang)("photos_pe_save_action");return t.props.data.context===_.default.CONTEXT_TYPES.STORY&&(l=Object($e.getLang)("photos_pe_publish_action")),n.createElement("div",{className:"PhotoEditor__inner"},n.createElement(Rt,{current:t.props.ui.currentMode,change:t.props.setMode,setMode:t.setMode},n.createElement("div",{"data-mode":_.default.TABS.STICKERS},n.createElement(Lt,{stickerMouseDown:t.addSticker})),n.createElement("div",{"data-mode":_.default.TABS.TEXT},n.createElement(Zt,null)),n.createElement("div",{"data-mode":_.default.TABS.PAINT},n.createElement(Kt,null)),c&&!(null===(e=o.addons)||void 0===e?void 0:e.disableCrop)&&o.context===_.default.CONTEXT_TYPES.PHOTO&&n.createElement("div",{"data-mode":_.default.TABS.CROP},n.createElement(Yt,null)),s&&n.createElement("div",{"data-mode":_.default.TABS.FILTERS,"data-disabled":a},n.createElement(dr,null)),s&&n.createElement("div",{"data-mode":_.default.TABS.COLOR,"data-disabled":a},n.createElement(or,null))),n.createElement("div",{className:"PhotoEditor__actions"},n.createElement(hr,null),n.createElement("div",null,n.createElement(Xe.default,{appearance:"secondary",onClick:t.props.data.close},Object($e.getLang)("photos_pe_cancel_action")),n.createElement(gr.default,{appearance:"primary",loading:t.props.ui.isSaveLoading,disabled:t.isSaveDisabled,onClick:t.save},l))))},t.renderFontsPreloading=function(){return n.createElement("div",{className:"PhotoEditor__fontPreload"},_.default.FONTS.map((function(e){return n.createElement("span",{key:e,className:"PhotoEditorFontStyle--"+e})})))},t.save=function(){var e=t.props.data,r=e.artboardWidth,n=e.originalWidth,o=e.originalHeight,i=n/r;t.props.closeTextEditor(),t.props.setCurrentLayer(null),t.props.setSaveLoading(!0),setTimeout((function(){fr.draw(n,o,t.props.layers.items,t.props.drawings,i,t.getStickerUrlById).then((function(e){var r=e.blob,n=e.width,o=e.height,i=t.props,a=i.layers,s=i.drawings,c=i.background,l=i.settings,p=Object(W.prepareStat)(a.items,s,c.currentBackgroundType,c.currentBackgroundId),_=Object(W.prepareMediaEditorStat)(a.items,l),d=[];t.props.layers.items.forEach((function(e){e.clickableZones&&e.clickableZones.forEach((function(r){d.push(t.getPreparedClickableZone(e,r))}))}));var u={original_width:n,original_height:o,clickable_stickers:d};t.props.data.save(r,(function(){t.props.setSaveLoading(!1)}),{attachment:t.props.data.attachment,storyUploadUrlHash:t.props.data.storyUploadUrlHash,storySaveHash:t.props.data.storySaveHash,analytics:JSON.stringify(p),mediaEditorAnalytics:JSON.stringify(_),clickableStickers:JSON.stringify(u)})})).catch((function(e){t.props.setSaveLoading(!1),console.error(e)}))}),0)},t.getPreparedClickableZone=function(e,r){var n,o=t.props.data.originalWidth/t.props.data.artboardWidth,i=e.rotate*(Math.PI/180),a=e.x-e.width/2,s=e.y-e.height/2,c=parseFloat(e.x)+(a-e.x)*Math.cos(i)-(s-e.y)*Math.sin(i),l=parseFloat(e.y)+(s-e.y)*Math.cos(i)+(a-e.x)*Math.sin(i),p=null===(n=r.clickable_area)||void 0===n?void 0:n.map((function(t){var r=t.x*e.width,n=t.y*e.height,a=r*Math.cos(i)-n*Math.sin(i),s=r*Math.sin(i)+n*Math.cos(i);return{x:(c+a)*o,y:(l+s)*o}})),_={type:r.action_type,clickable_area:p};return"link"===r.action_type?(_.link=r.action.link,r.action.tooltip_text_key&&(_.tooltip_text_key=r.action.tooltip_text_key)):"app"===r.action_type&&(_.app_id=r.action.app_id,r.action.app_context&&(_.app_id=r.action.app_id)),_},t.handleKeyDown=function(e){if("Escape"==e.key&&t.props.layers.currentIndex&&t.props.layers.items[t.props.layers.currentIndex].isEdit&&(e.preventDefault(),e.stopPropagation(),t.props.closeTextEditor()),(e.ctrlKey||e.metaKey)&&"z"===e.key&&(e.shiftKey?t.props.redo():t.props.undo()),null!==t.props.layers.currentIndex&&"TEXTAREA"!==e.target.nodeName)if(["Backspace","Delete"].includes(e.key))e.preventDefault(),t.props.layers.items[t.props.layers.currentIndex].canDelete&&t.props.deleteLayer();else if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)){var r=t.getCurrentLayer();if(!r)return;var n={x:r.x,y:r.y},o=e.shiftKey?10:1;switch(e.key){case"ArrowUp":n.y-=o;break;case"ArrowDown":n.y+=o;break;case"ArrowLeft":n.x-=o;break;case"ArrowRight":n.x+=o}t.props.setLayerPosition(n.x,n.y)}},t.canvasMouseDown=function(e){var r=t.getCurrentLayer(),n=e.target;if("TEXTAREA"!==n.tagName)return!!n.closest(".EditorCanvas")&&(!n.closest(".SwitchMode")&&void([_.default.TABS.PAINT,_.default.TABS.FILTERS].includes(t.props.ui.currentMode)||(r&&r.type===_.default.LAYER_TYPES.TEXT&&r.isEdit?t.props.closeTextEditor():(t.props.ui.currentMode===_.default.TABS.COLOR&&t.props.settings.blur.isEnabled&&t.moveBlurStart(e),n.closest(".EditorLayer")?t.layerDragStart(e):r&&t.props.setCurrentLayer(null)))))},t.moveBlurStart=function(e){window.addEventListener("mousemove",t.moveBlurProcess),window.addEventListener("mouseup",t.moveBlurFinish),t.moveBlurProcess(e)},t.moveBlurProcess=function(e){var r=ae(e,document.querySelector(".EditorCanvas__canvas--bg")),n=r.x,o=r.y,i=r.width,a=r.height,s=[Math.max(0,Math.min(n/i,1)),1-Math.max(0,Math.min(o/a,1))];t.props.setBlurPosition(s)},t.moveBlurFinish=function(){window.removeEventListener("mousemove",t.moveBlurProcess),window.removeEventListener("mouseup",t.moveBlurFinish)},t.getCurrentLayer=function(){var e=t.props.layers,r=e.items,n=e.currentIndex;return null===n?n:r[n]},t.layerDragStart=function(e){window.addEventListener("mousemove",t.layerDragProcess),window.addEventListener("mouseup",t.layerDragFinish);var r,n=e.target.closest("[data-index]");r=n?+Object(Er.domData)(n,"index"):t.props.layers.currentIndex,t.props.layers.currentIndex!==r&&t.props.setCurrentLayer(r);var o=ae(e,document.querySelector(".EditorCanvas__canvas--draw")),i=o.x,a=o.y;if(t.currentLayer=t.getCurrentLayer(),t.currentLayer){var s=t.currentLayer;s.isBackground&&s.locked?t.props.setCurrentLayer(null):(t.clientX=e.clientX,t.clientY=e.clientY,t.shiftX=i-t.currentLayer.x,t.shiftY=a-t.currentLayer.y)}},t.layerDragProcess=function(e){if(t.currentLayer){var r=document.querySelector(".EditorCanvas__canvas--draw");if(r){var n=ae(e,r),o=n.x,i=n.y;if(void 0!==t.shiftX&&void 0!==t.shiftY){var a=o-t.shiftX,s=i-t.shiftY;t.props.setLayerPosition(a,s),t.props.ui.isShowDropBox||t.props.setShowDropBox(!0)}}}},t.layerDragFinish=function(e){if(window.removeEventListener("mousemove",t.layerDragProcess),window.removeEventListener("mouseup",t.layerDragFinish),t.getCurrentLayer()&&t.currentLayer&&void 0!==t.shiftX&&void 0!==t.shiftY){var r=document.querySelector(".EditorCanvas__canvas--draw");if(r){var n=ae(e,r),o=n.x,i=n.y,a=o-t.shiftX,s=i-t.shiftY;t.props.setLayerPosition(Math.round(a),Math.round(s)),t.props.setShowDropBox(!1),delete t.currentLayer,delete t.shiftX,delete t.shiftY,delete t.clientX,delete t.clientY}}},t.getStickerUrlById=function(e,r){var n=t.props.data.stickersMap[e];return n?n.sizes[r]:""},t.addSticker=function(e,r){e.persist();var n=document.querySelector(".EditorCanvas__canvas--draw");if(n){var o=ae(e.nativeEvent,n),i=o.width,a=o.height;t.props.addLayerSticker({id:r,x:i/2,y:a/2,width:_.default.LAYER_DEFAULT_SIZE,height:_.default.LAYER_DEFAULT_SIZE,rotate:0,canDelete:!0,scale:1})}},t.prepareStickers=function(e){var r=t.props.data,n=r.artboardWidth,o=r.artboardHeight;e.forEach((function(e){var r=e.sticker.transform||{},i=r.gravity,a=void 0===i?"center":i,s=r.rotation,c=void 0===s?0:s,l=r.translation_x,p=void 0===l?0:l,d=r.translation_y,u=void 0===d?0:d,h=r.relation_width;if(p=Math.min(Math.max(p,-1),1),u=Math.min(Math.max(u,-1),1),h&&(h=Math.min(Math.max(h,.1),1)),"renderable"===e.sticker_type)t.prepareRenderableSticker(e.sticker,a,p,u,h).then((function(e){var r=e.url,n=e.x,o=e.y,i=e.stickerWidth,a=e.stickerHeight,s=e.clickableZones;t.props.addLayerImage({url:r,x:n,y:o,width:Math.round(i),height:Math.round(a),rotate:-c,clickableZones:s,canDelete:!0,scale:1})})).catch((function(e){console.error(e)}));else if("native"===e.sticker_type)switch(e.sticker.action_type){case"sticker":var f=h?n*h:_.default.LAYER_DEFAULT_SIZE,m=h?n*h:_.default.LAYER_DEFAULT_SIZE,b=e.sticker.action.pack_id+"_"+e.sticker.action.sticker_id;if(t.props.data.stickersMap[b]){var E=le(a,n,o,f/2,m/2,p*n,u*o),g=E.x,v=E.y;t.props.addLayerSticker({id:b,x:g,y:v,width:f,height:m,rotate:-c,canDelete:!0,scale:1})}break;case"text":var O=.5;h&&(O=t.getFontSize(e.sticker.action.text,n*h,e.sticker.action.style));var w=t.getTextRect(e.sticker.action.text,O*_.default.FONT_SIZE_COEFFICIENT,e.sticker.action.style),y=(f=w.width,m=w.height,le(a,n,o,f/2,m/2,p*n,u*o));g=y.x,v=y.y;t.props.addLayerText(!1,{text:e.sticker.action.text,style:e.sticker.action.style,color:e.sticker.action.selection_color,fontSize:O,initialFontSize:O,rotate:-c,scale:1,x:g,y:v})}}))},t.prepareRenderableSticker=function(e,r,n,o,i){var a=t.props.data,s=a.artboardWidth,c=a.artboardHeight,l=a.originalWidth/s;return new Promise((function(t,a){"string"!=typeof e.url&&"string"!=typeof e.blob&&a();var p=e.url||e.blob||"";ie(p).then((function(a){var _=a.height/a.width,d=0,u=0;i?u=(d=s*i)*_:(d=a.width/l,u=a.height/l,d>s&&(u=(d=s)*_));var h,f=le(r,s,c,d/2,u/2,n*s,o*c),m=f.x,b=f.y;e.clickable_zones&&(h=e.clickable_zones.map((function(e){var t;return t=e.clickable_area?e.clickable_area.map((function(e){return{x:e.x/a.width,y:e.y/a.height}})):[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}],wr(wr({},e),{clickable_area:t})}))),t({url:p,x:m,y:b,stickerWidth:d,stickerHeight:u,clickableZones:h})})).catch((function(){a()}))}))},t.getTextRect=function(e,t,r){var n=document.createElement("span");n.innerHTML=e,n.style.display="inline-block",n.style.fontSize=t+"px",n.style.lineHeight="1em",n.style.whiteSpace="pre",r&&n.classList.add("PhotoEditorFontStyle--"+r),document.body.append(n);var o=n.getBoundingClientRect();return n.remove(),o},t.getFontSize=function(e,t,r){var n=2*t,o=document.createElement("span");for(o.innerHTML=e,o.style.display="inline-block",o.style.width=t+"px",o.style.fontSize=n+"px",o.style.lineHeight="1em",o.style.whiteSpace="pre",r&&o.classList.add("PhotoEditorFontStyle--"+r),document.body.append(o);n&&o.scrollWidth>Math.round(t);)n--,o.style.fontSize=n+"px";return o.remove(),n/100},t.uploadPhoto=function(e){ce().then((function(r){e&&e(),t.props.setCurrentPhotoUrl(r)})).catch((function(){window.showFastBox({title:Object($e.getLang)("global_error")},Object($e.getLang)("stories_create_image_incorrect"))}))},t.setMode=function(e){var r=t.props.ui,n=t.props.background,o=n.currentBackgroundType,i=n.currentPhotoUrl;t.props.setCurrentLayer(null),e===_.default.BACKGROUND_MODES.PHOTO&&!i||o===_.default.BACKGROUND_MODES.PHOTO&&o===e?t.uploadPhoto((function(){t.props.setBackgroundType(e)})):(t.props.setBackgroundType(e),e===_.default.BACKGROUND_MODES.BACKGROUND&&[_.default.TABS.COLOR,_.default.TABS.FILTERS].includes(r.currentMode)&&t.props.setMode(_.default.TABS.STICKERS))},t}return Or(t,e),t}(n.Component),Ar=Object.assign(s.ActionCreators,{setMode:J,addLayerSticker:function(e){return Object(W.sendStat)(W.EVENTS.ADD_STICKER),V("ADD_LAYER_STICKER",{type:_.default.LAYER_TYPES.STICKER,id:e.id,x:e.x,y:e.y,width:e.width,height:e.height,rotate:e.rotate,canDelete:e.canDelete,scale:e.scale})},addLayerText:G,addLayerImage:function(e){return V("ADD_LAYER_IMAGE",{type:_.default.LAYER_TYPES.IMAGE,url:e.url,x:e.x,y:e.y,width:e.width,height:e.height,rotate:e.rotate,clickableZones:e.clickableZones,canDelete:e.canDelete,scale:e.scale})},setLayerPosition:function(e,t){return function(r,n){var o=n().present.layers,i=o.currentIndex,a=o.items;null!==i&&a[i]&&r({type:"SET_LAYER_POSITION",payload:{x:e,y:t}})}},deleteLayer:z,setCurrentLayer:F,setDataLoaded:function(){return{type:"SET_DATA_LOADED"}},setShowDropBox:$,setSaveLoading:function(e){return{type:"SET_SAVE_LOADING",value:e}},closeTextEditor:X,setData:re,setBlurPosition:function(e){return{type:g,position:e}},setCurrentPhotoUrl:te,setBackgroundType:ee}),Sr=Object(i.connect)((function(e){return{ui:e.present.ui,settings:e.present.settings,layers:e.present.layers,drawings:e.present.drawings,background:e.present.background,data:e.present.data}}),Ar)(yr),Cr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Pr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.getBackgroundType=function(){var e=_.default.CONTEXT_TYPES,r=_.default.BACKGROUND_MODES;return t.props.context===e.STORY?t.props.photoUrl?r.PHOTO:r.BACKGROUND:r.PHOTO},t}return Cr(t,e),t.prototype.render=function(){var e,t,r;return window.cur.photoEditorStore=(e={data:this.props,background:{currentBackgroundType:this.getBackgroundType(),currentPhotoUrl:this.props.photoUrl,currentBackgroundId:1}},t=Object(s.newHistory)([],e,[]),r=l.composeWithDevTools(Object(a.applyMiddleware)(p.default)),Object(a.createStore)(U,t,r)),n.createElement(i.Provider,{store:window.cur.photoEditorStore},n.createElement(Sr,{stickers:this.props.stickers}))},t.defaultProps={originalWidth:_.default.STORY_BASE_WIDTH,originalHeight:_.default.STORY_BASE_HEIGHT},t}(n.Component);t.default=Pr},137:function(e,t,r){e.exports=r("aYW+")},"1VNw":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActionCreators=t.ActionTypes=void 0;var n={UNDO:"@@redux-undo/UNDO",REDO:"@@redux-undo/REDO",JUMP_TO_FUTURE:"@@redux-undo/JUMP_TO_FUTURE",JUMP_TO_PAST:"@@redux-undo/JUMP_TO_PAST",JUMP:"@@redux-undo/JUMP",CLEAR_HISTORY:"@@redux-undo/CLEAR_HISTORY"};t.ActionTypes=n;var o={undo:function(){return{type:n.UNDO}},redo:function(){return{type:n.REDO}},jumpToFuture:function(e){return{type:n.JUMP_TO_FUTURE,index:e}},jumpToPast:function(e){return{type:n.JUMP_TO_PAST,index:e}},jump:function(e){return{type:n.JUMP,index:e}},clearHistory:function(){return{type:n.CLEAR_HISTORY}}};t.ActionCreators=o},"1y80":function(e,t,r){"use strict";function n(e,t,r,n,o){return window.statlogsValueEvent(e,t,r,n,o)}function o(e){return Math.random()<e}function i(e,t,r,i,a,s){o(e)&&n(t,r,i,a,s)}r.r(t),r.d(t,"statlogsValueEvent",(function(){return n})),r.d(t,"randEnabled",(function(){return o})),r.d(t,"statlogsProbValueEvent",(function(){return i}))},"2mql":function(e,t,r){"use strict";var n=r("TOwV"),o={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function c(e){return n.isMemo(e)?a:s[e.$$typeof]||o}s[n.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s[n.Memo]=a;var l=Object.defineProperty,p=Object.getOwnPropertyNames,_=Object.getOwnPropertySymbols,d=Object.getOwnPropertyDescriptor,u=Object.getPrototypeOf,h=Object.prototype;e.exports=function e(t,r,n){if("string"!=typeof r){if(h){var o=u(r);o&&o!==h&&e(t,o,n)}var a=p(r);_&&(a=a.concat(_(r)));for(var s=c(t),f=c(r),m=0;m<a.length;++m){var b=a[m];if(!(i[b]||n&&n[b]||f&&f[b]||s&&s[b])){var E=d(r,b);try{l(t,b,E)}catch(e){}}}}return t}},"3UD+":function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},"3f+a":function(e,t,r){"use strict";r.r(t);var n=class{constructor(e){this.link=e,this.onClick=this.onClick.bind(this)}onClick(){this.copyToClipboard(this.link),this.copy.classList.add("vk_app_copy_link__copy--hidden"),this.copied.classList.add("vk_app_copy_link__copied--visible"),setTimeout(()=>{this.copy.classList.remove("vk_app_copy_link__copy--hidden"),this.copied.classList.remove("vk_app_copy_link__copied--visible")},2400)}copyToClipboard(e){var t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t);var r=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);t.select(),document.execCommand("copy"),document.body.removeChild(t),r&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(r))}renderCopied(){this.copied=document.createElement("span"),this.copied.classList.add("vk_app_copy_link__copied"),this.copied.innerHTML=getLang("vkapps_link_copied")}renderCopy(){this.copy=document.createElement("span"),this.copy.classList.add("vk_app_copy_link__copy"),this.copy.innerHTML=getLang("vkapps_link_copy"),this.copy.addEventListener("click",this.onClick)}render(){return this.linkEl=document.createElement("span"),this.linkEl.classList.add("vk_app_copy_link__container"),this.renderCopy(),this.renderCopied(),this.linkEl.appendChild(this.copy),this.linkEl.appendChild(this.copied),this.linkEl}},o=r("wZQE"),i=r("lNyc"),a=r("9kLB"),s=r("gT3r"),c=r("UlUB");t.default=class{constructor(){this.onHide=this.onHide.bind(this),this.show=this.show.bind(this),this.hide=this.hide.bind(this),this.toggle=this.toggle.bind(this),this.isVisible=!1,this.addScroll=Object(c.throttle)(this.addScroll.bind(this),s.THROTTLE_TIME)}addScroll(){Object(s.addPopupScroll)(this.modal,this.benchmarkElement)}init(e,t){this.render(),this.benchmarkElement=e;var r=t||(Boolean(cur.app)?cur.app.cont:ge("apps_test_id"));r&&r.appendChild(this.container),this.benchmarkElement?this.benchmarkElement.addEventListener("scroll",this.addScroll):window.addEventListener("scroll",this.addScroll)}toggle(){this.isVisible?this.hide():this.show()}show(){var e,t;setTimeout(()=>this.container.classList.add("show"),300),this.container.addEventListener("click",this.onHide),this.isVisible=!0,this.container.setAttribute("aria-hidden",this.isVisible),cur.app&&Object(i.sendMessage)({type:(e=a.CONNECT_EVENTS.SHARE,t=a.EVENT_STATES.SUCCESS,void 0===t&&(t=a.EVENT_STATES.FIRE),""+e+t),data:{type:"qr"}},cur.app.cont),this.addScroll()}hide(){setTimeout(()=>this.container.classList.remove("show"),300),this.container.removeEventListener("click",this.onHide),this.closeBtn.removeEventListener("click",this.onHide),this.isVisible=!1,this.container.setAttribute("aria-hidden",this.isVisible)}onHide(e){(e.target===this.container||e.target===this.closeBtn||this.closeBtn.contains(e.target))&&(this.hide(),this.destroy())}destroy(){this.benchmarkElement?this.benchmarkElement.removeEventListener("scroll",this.addScroll):window.removeEventListener("scroll",this.addScroll),this.container.parentNode.removeChild(this.container),this.callback&&this.callback()}_renderCloseBtn(){this.closeBtn=document.createElement("button"),this.closeBtn.setAttribute("type","button"),this.closeBtn.classList.add("vk_app_modal_close_btn"),this.closeBtn.innerHTML='<svg class="vk_app_modal_close_btn__icon" viewBox="0 0 24 24" id="cancel_24" width="24" height="24">\n        <g fill="none" fill-rule="evenodd">\n          <path d="M0 0h24v24H0z"></path>\n          <path\n              d="M18.3 5.7a.99.99 0 0 0-1.4 0L12 10.6 7.1 5.7a.99.99 0 0 0-1.4 1.4l4.9 4.9-4.9 4.9a.99.99 0 0 0 1.4 1.4l4.9-4.9 4.9 4.9a.99.99 0 0 0 1.4-1.4L13.4 12l4.9-4.9a.99.99 0 0 0 0-1.4z"\n              fill="currentColor"></path>\n        </g>\n      </svg>',this.closeBtn.addEventListener("click",this.onHide),this.container.childNodes[0].appendChild(this.closeBtn)}_renderOuter(){this.container=document.createElement("div"),this.container.classList.add("vk_app_modal_outer")}renderModal(){var e=new n(window.location.href);this.modal=document.createElement("div"),this.modal.classList.add("vk_app_modal_container","vk_app_modal_container--qr","vk_app_modal_container--flex","MiniAppModalContainer__qr");var t=window.location.href,r=o.createQR(t,120,"",{isShowLogo:!0});this.modal.innerHTML=`\n      ${r}\n      <h2>${cur.backLang}</h2>\n      <p>\n        ${getLang("vkapps_focus_camera_on_qr_code")}\n      </p>\n    `,this.modal.appendChild(e.render())}render(){this.container||this._renderOuter(),this.renderModal(),this.container.innerHTML="",this.container.appendChild(this.modal),this._renderCloseBtn(this.container)}}},"4zn2":function(e,t,r){"use strict";r.r(t),r.d(t,"API_VERSION",(function(){return n})),r.d(t,"VKPAY_TRANSACTION_EVENT",(function(){return o})),r.d(t,"PLATFORM",(function(){return i})),r.d(t,"CLIENT_SCHEME",(function(){return a})),r.d(t,"ERROR_CODES",(function(){return s})),r.d(t,"ERROR_REASONS",(function(){return c})),r.d(t,"ERROR_TYPES",(function(){return l})),r.d(t,"CLOSE_STATUS",(function(){return p})),r.d(t,"GROUP_STATUS",(function(){return _})),r.d(t,"VKPAY_APPS",(function(){return d})),r.d(t,"TEXTLIVE_APPS",(function(){return u})),r.d(t,"VK_CONNECT_EVENTS",(function(){return h})),r.d(t,"PROMO_NEWSLETTER_INTENT",(function(){return f})),r.d(t,"NON_PROMO_NEWSLETTER_INTENT",(function(){return m})),r.d(t,"CONFIRMED_NOTIFICATION_INTENT",(function(){return b})),r.d(t,"VK_CONNECT_SUPERAPPKIT_EVENT_TYPE",(function(){return E}));var n="5.95",o="VKWebAppActionDone",i={WEB:"web",MOBILE_WEB:"mobile-web"},a={BRIGHT_LIGHT:"bright_light",SPACE_GRAY:"space_gray"},s={UNKNOWN:1,MISSING_PARAM:2,OLD_MISSING_PARAM:100,CONNECTION_LOST:3,USER_DENIED:4,INVALID_PARAMS:5,CUSTOM:6,REQUESTS_LIMIT_REACHED:10,ACCESS_DENIED:11},c={UNSUPPORTED_PLATFORM:"Unsupported platform",UNSUPPORTED_ACTION:"Unsupported action",NATIVE_APP_IS_NOT_INSTALLED:"VK client is not installed on device",USER_NOT_A_PRIVATE_GROUP_MEMBER:"User is not a member of the given private group",UNKNOWN_ERROR:"Unknown error",NETWORK_ERROR:"Network error",USER_DENIED:"User denied",INVALID_PARAMS:"Invalid params"},l={CLIENT:"client_error",API:"api_error",AUTH:"auth_error"},p=["success","failed"],_={OPEN:0,CLOSED:1,PRIVATE:2},d=[6217559,7131443],u=[7512376],h={VKWebAppAddToCommunity:"add_to_community",VKWebAppAddToCommunityPreload:"get_groups_list",VKWebAppAddToFavorites:"add_to_favorites",VKWebAppAddToFavoritesPreload:"already_added_to_favorites",VKWebAppAddToMenu:"add_to_menu",VKWebAppAddToMenuPreload:"is_in_left_menu",VKWebAppGetCommunityAuthToken:"get_community_token",VKWebAppGetCommunityAuthTokenPreload:"get_community_scope",VKWebAppGetCommunityToken:"get_community_token",VKWebAppGetCommunityTokenPreload:"get_community_scope",VKWebAppGetAuthToken:"get_auth_token",VKWebAppGetAuthTokenPreload:"get_auth_token_info",VKWebAppGetPhoneNumber:"get_phone_number",VKWebAppGetPhoneNumberPreload:"already_get_phone_number",VKWebAppGetEmail:"get_email",VKWebAppGetEmailPreload:"already_get_email",VKWebAppGetFriends:"get_friends",VKWebAppAllowNotificationsPreload:"are_notifications_allowed",VKWebAppAllowNotifications:"allow_notifications",VKWebAppDenyNotifications:"deny_notifications",VKWebAppAllowMessagesFromGroup:"allow_messages_from_group",VKWebAppAllowMessagesFromGroupPreload:"can_send_messages_from_group",VKWebAppJoinGroup:"join_group",VKWebAppJoinGroupPreload:"is_group_member",VKWebAppLeaveGroup:"leave_group",VKWebAppLeaveGroupPreload:"is_group_member",VKWebAppOpenApp:"open_app",VKWebAppGetUserInfo:"get_user_info",VKWebAppSendPayload:"send_payload",VKWebAppSendToClient:"send_to_client",VKWebAppSendToClientPreload:"get_open_in_native_permission",VKWebAppShowOrderBox:"order",VKWebAppShowLeaderBoardBox:"show_leader_board",VKWebAppShowInviteBox:"invite_friends",VKWebAppShowStoryBox:"story_box",VKWebAppShowRequestBox:"send_request",VKWebAppShowRequestBoxPreload:"request_box_preload",VKWebAppStorageGetKeys:"storage_get_keys",VKWebAppStorageSet:"storage_set",VKWebAppStorageGet:"storage_get",VKWebAppOpenArticleEditor:"open_article_edit",VKWebAppSubscribeStoryApp:"subscribe_story_app",VKWebAppClose:"close",VKWebAppGetGroupInfo:"get_group_info",VKWebAppGetGroupInfoPreload:"is_group_info_allowed",VKWebAppGetSilentToken:"get_silent_token"},f="promo_newsletter",m="non_promo_newsletter",b="confirmed_notification",E="vk-sak-sdk"},"5Hok":function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return VkIframeApp}));var core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("a1Th"),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("Btvt"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("pIFo"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("KKXr"),core_js_modules_es6_array_sort__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("Vd3H"),_shared_apps_xdm__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("lyAj"),_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("gdug"),_shared_apps_SessionTimeLogger__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("xo6n"),_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("4zn2"),_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("EasH"),_web_lib_lang__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("4+be"),_shared_lib_common__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("jE6c"),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("t7n3"),_shared_constants_platforms__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("z9Td"),_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("zxIV"),_web_lib_ui__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("v+DW"),blueimp_md5__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("jYEY"),_web_legacy_ui_ui_scroll__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("59zB"),_web_lib_scroll__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("lXE5"),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("Egk5"),_web_apps_AppsUtils__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("F+Y4"),_shared_apps_connect_libs_utils__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("d4g6"),_web_gifts_gifts__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("HwS1"),IFRAME_APP_TYPE=1;class VkIframeApp{constructor(e,t,r,n){this.onReady=[],this.vkBridgeCallbacks=Object.create(null),this.funcs=Object.create(null),this.sessionLogger=null,this.frame=null,this.RPC=null,this.params=r||{},this.options=t||{},this.onInit=n,this._init(e),this._initSessionLogger()}isOpenInLayer(){return"layer"===this.params.source}checkExternalAppResponse(){cur.onExternalAppResults&&this.params.api_id===cur.onExternalAppResults.api_id&&(cur.onExternalAppResults.result&&this.runCallback("onExternalAppDone",cur.onExternalAppResults.result),cur.onExternalAppResults.error&&this.runCallback("onExternalAppFail",cur.onExternalAppResults.error)),cur.onExternalAppResults=null}runCallback(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t[0];this.vkBridgeCallbacks[n]&&(this.vkBridgeCallbacks[n](...t.slice(1)),this.vkBridgeCallbacks[n]=null),this.options.type===IFRAME_APP_TYPE&&this.RPC.callMethod("runCallback",t),"onExternalAppClose"===n&&cur.clearVKMiniAppsLayerPopups&&cur.clearVKMiniAppsLayerPopups()}onAppReady(){for(var e in this.onReady)this.onReady.hasOwnProperty(e)&&this.onReady[e]()}setHeight(e){if(e&&("100%"===e&&(e=this.options.heightMax),Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.isNumber)(e))){this.inlineApp&&e>this.options.heightMax&&!this.params.is_vkpay_service&&(e=this.options.heightMax);var t=e+"px";this.frame.style.height=t,this.options.boxed||(this.cont.style.height=t),this.options.layer&&window.WkView&&WkView.onResize(),this.options.onResize&&this.options.onResize(),this.sendResizePostMessageEvent()}}isVkpayTransferLayer(){return!!this.params.is_vkpay_service&&(this.options.openapi?!!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.domCA)(this.cont,".vkPayOpenApiBox_transfer"):!!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.domCA)(this.cont,".vkpay_transfer"))}setWidth(e,t){var r=this.options.vkApp?600:100,n=165;"100%"===e&&(e=1e3),Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.isNumber)(e)&&e&&!this.inlineApp&&cur.app&&(e=Math.min(Math.max(e,r),1e3),this.options.layout_width&&(n=this.options.layout_width-e),this.isVkpayTransferLayer()&&t&&(this.cont.style.maxWidth="none",this.cont.style.minWidth="none"),this.options.layer?window.WkView&&window.WkView.onResize():window.handlePageView&&window.handlePageView({noleftmenu:vk.noleftmenu,nobottommenu:vk.nobottommenu,notopmenu:vk.notopmenu,body_class:vk.body_class,staticheader:vk.staticheader,no_ads:vk.no_ads,ad_preview:vk.ad_preview,top_home_link_class:vk.top_home_link_class,width:Math.max(e,625)+n}),this.frame.style.width=this.cont.style.width=e+"px",this.sendResizePostMessageEvent())}sendResizePostMessageEvent(){if(this.options.embed&&window.parent){var e=this.getParentUrl(),t=this.options.embed_allow_parent_origins||[],r=Object(_shared_apps_connect_libs_utils__WEBPACK_IMPORTED_MODULE_21__.getHostName)(e);if(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.inArray)(r,t)){var n={event_type:"VKGamesFrameResize",width:this.cont.offsetWidth,height:this.cont.offsetHeight};window.parent.postMessage(n,e)}}}getParentUrl(){return window.location&&location.ancestorOrigins&&location.ancestorOrigins[0]?location.ancestorOrigins[0]:window.document&&document.referrer}showProgress(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.addClass)(this.cont,"loading"),this.loaderEl=Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_15__.showProgress)(this.cont,"","pr_big app_container_progress",!0)}hideProgress(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.removeClass)(this.cont,"loading"),this.loaderEl&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.re)(this.loaderEl)}showDummy(e){if(this.cont&&~["no_flash","no_unity"].indexOf(e)){var t={act:e};"no_flash"!==e||_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.iphone||_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.ipad?"no_unity"!==e||_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.mobile||(t.screen=_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.msie||_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.amigo||_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.mac&&_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.safari?"install":"browser"):t.screen="install",ajax.post("al_apps.php",t,{onDone:e=>{cur.app&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.addClass)(this.cont,"dummy"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.val)(this.cont,e))},showProgress:this.showProgress.bind(this),hideProgress:this.hideProgress.bind(this)})}}balanceUpdated(e){this.runCallback("onBalanceChanged",e)}checkMethod(e,t,r){var n=e.toLowerCase();if("wall.post"===n||"activity.set"===n){var o=t["wall.post"===n?"message":"text"];return o||(o=""),t.attachments=this.getValidPostAttachments(t.attachments||t.attachment),Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("apps",{act:"wall_post_box",aid:this.options.aid,post_id:t.post_id,owner_id:t.owner_id,lat:t.lat,long:t.long,place_id:t.place_id,from_group:t.from_group,publish_date:t.publish_date,signed:t.signed,attachments:t.attachments,text:o,method:n},{params:{width:"430px",dark:1},onFail:function(e){e=e||"Unknown network error occurred",r&&r({error:{error_code:1,error_message:e}})}}),cur.apiWallPost=(n,o)=>{o?r&&r({error:o}):this.api(e,extend(t,{method_access:n}),r)},!1}return!0}checkMethodResult(e,t,r,n){switch(e){case"photos.saveProfilePhoto":if(!r.error)return cur.profilePhotoBoxCallback=e=>{n(e?{response:{photo_src:r.response.photo_src}}:{error:{error_code:10007,error_msg:"Operation denied by user"}}),window.profilePhotoBoxCallback=!1},this.funcs.showProfilePhotoBox(r.response.photo_hash),!1}return!0}initClientExternalApp(){this.clientRpc=new fastXDM.Client({},{safe:!0}),cur.onExternalAppDone=(e,t)=>{t=!!t,this.clientRpc.callMethod("externalAppDone",e,t)}}onLocChanged(e){e||(e=""),cur.appLoc!==e&&(cur.appLoc=e,this.runCallback("onLocationChanged",e))}api(method,inputParams,callback,captcha){if(2===arguments.length&&(inputParams={}),inputParams||(inputParams={}),captcha||inputParams.method_access||inputParams.method_force||this.checkMethod(method,inputParams,callback)){delete inputParams.callback,delete inputParams.access_token;var params={v:"5.95",api_id:this.params.api_id,method,format:"json",rnd:parseInt(1e4*Math.random())};if(inputParams)for(var i in inputParams)inputParams.hasOwnProperty(i)&&(i=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.trim)(i),/^(rnd|format|api[\s.\[_]id|method|callback|access[\s.\[_]token)(\s*\[|$)/.test(i)||(params[i]=inputParams[i]));var lParams=[];for(var _i in params)params.hasOwnProperty(_i)&&lParams.push([_i,params[_i]]);lParams.sort(sName);var sig=this.params.viewer_id;for(var _i2 in lParams)lParams.hasOwnProperty(_i2)&&(sig+=lParams[_i2][0]+"="+lParams[_i2][1]);sig+=this.params.secret,params.sid=this.params.sid,params.sig=blueimp_md5__WEBPACK_IMPORTED_MODULE_16__(sig);var done=text=>{var response=eval("("+text+")");if(response.error&&14===response.error.error_code)cur.appCaptcha=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showCaptchaBox)(response.error.captcha_sid,0,!1,{onSubmit:(e,t)=>{inputParams.captcha_sid=e,inputParams.captcha_key=t,this.api(method,inputParams,callback,!0),cur.appCaptcha.setOptions({onHide:function(){}}).hide()},onHide:()=>{callback(response)},imgSrc:response.error.captcha_img});else{if(captcha&&cur.appCaptcha.setOptions({onHide:function(){}}).hide(),!this.checkMethodResult(method,inputParams,response,callback))return;callback&&callback(response)}},fail=()=>{callback&&callback({error:{error_code:1,error_message:"Unknown network error occurred"}})};ajax.plainpost(this.params.api_script||"/api.php",params,done,fail)}function sName(e,t){return e[0]>t[0]?1:e[0]<t[0]?-1:0}}getValidPostAttachments(e){var t=/(^https?:\/\/)|(^(poll|album|photo|video|doc|audio|page|note)-?\d+_-?\d+)$/,r=[];return e=e||[],isString(e)&&(e=e.split(",")),each(e,(function(){var e=this.trim();t.test(e)&&r.push(e)})),r.join(",")}startHandleWheelEvent(){this._wheelEventListener||stManager.add(["ui_common.js"],()=>{this._wheelEventListener=e=>{var t=_web_legacy_ui_ui_scroll__WEBPACK_IMPORTED_MODULE_17__.default.scrollEventDelta(e);this.runCallback("onWheel",t,document.documentElement.clientHeight)},addEvent(window,_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browserFeatures.wheelEvent,this._wheelEventListener),cur.destroy.push(()=>{this._wheelEventListener&&Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_19__.removeEvent)(window,_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browserFeatures.wheelEvent,this._wheelEventListener)})})}stopHandleWheelEvent(){this._wheelEventListener&&(Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_19__.removeEvent)(window,"wheel",this._wheelEventListener),this._wheelEventListener=null)}getQueryParts(e){var t=[];for(var r in e)if(e.hasOwnProperty(r)){var n="";void 0!==e[r]&&(n="object"==typeof e[r]?encodeURIComponent(JSON.stringify(e[r])):encodeURIComponent(e[r])),t.push(encodeURIComponent(r)+"="+n)}return t}openAppInLayer(e,t,r,n){cur.openerAppsQueue=cur.openerAppsQueue||[],cur.openerAppsQueue.push(this),n=n||{},showWiki({w:e},null,null,extend(n,{queue:1,onHide:()=>{cur.openerAppsQueue.length>0&&(cur.app=cur.openerAppsQueue.pop()),t&&t(this.params.api_id)},noClickHide:r}))}getOpenerApp(){return cur.openerAppsQueue&&cur.openerAppsQueue[cur.openerAppsQueue.length-1]}close(e){if(this.params.is_vkpay_service&&window.Apps.closeExternalApp(),!window.WkView||this.params.is_mobile)if(window.opener){if(e){window.opener.postMessage({method:"closeApp"},"*")}window.close()}else e&&this.runCallback("onCloseApp"),window.nav.objLoc.back?window.location.href=nav.objLoc.back:window.nav.go("/feed");else window.WkView.hide(!1,!0)}setVkPayMobileHeight(){if(this.params.is_vkpay_service&&this.params.is_mobile){var e=window.innerHeight||document.documentElement.clientHeight||bodyNode.clientHeight;(_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.safari||_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.safari_mobile)&&(e+=window.pageYOffset),e+="px",this.frame.style.minHeight=e,this.frame.style.height=e,this.cont.style.minHeight=e,this.cont.style.height=e}}apiCallback(){}registerVkBridgeCallback(e,t){this.vkBridgeCallbacks[e]=t}_init(e){(!window.parent||window.parent===window||this.options.checking||this.options.openapi||this.options.embed)&&(this.cont=document.getElementById(e),this.cont&&(this._prepareParamsAndOptions(),this._initPublicApi(),this.isOpenInLayer()&&this.onReady.push(this.checkExternalAppResponse.bind(this)),this._initDestroy(),window.GamesCatalog&&window.GamesCatalog.halloweenGhost&&window.GamesCatalog.halloweenGhost.destroy()))}_prepareParamsAndOptions(){this._makeHashParam(),this.options.inlineApp&&(this.inlineApp=!0),this.options=extend({heightMax:4500},this.options),this.params.widget&&(this.options.type=IFRAME_APP_TYPE,this.options.widget=!0)}_initPublicApi(){if(this.options.type!==IFRAME_APP_TYPE)throw new Error("Invalid application type");this._definePublicApi(),this.options.no_init||(this._initXDMClient(),this.params.widget&&setTimeout((function(){self.inited||show("app_connect_error")}),8e3))}_initXDMClient(){var e=this._getIframeUrl(),t=this.options.vkApp?{}:this.funcs;this.options.layer?this.RPC=new fastXDM.Server(t,e=>Object(_shared_apps_connect_libs_utils__WEBPACK_IMPORTED_MODULE_21__.filterPostMessageOrigin)(this.options,e),{layer:1}):this.RPC=new fastXDM.Server(t,e=>Object(_shared_apps_connect_libs_utils__WEBPACK_IMPORTED_MODULE_21__.filterPostMessageOrigin)(this.options,e));var r={src:e,width:"100%",overflow:"hidden"};this.options.vkApp?r.vkApp=!0:r.scrolling="no",this.options.widget||(r.height=this.options.height),this.options.is_only_dg_runnable_on_web&&(r.width=this.options.width);var n='webkitallowfullscreen="true" mozallowfullscreen="true" allowfullscreen="true" allow="geolocation; microphone; camera; autoplay;"';this.options.iframe_background_color&&(n+=` style="background-color: ${this.options.iframe_background_color};"`),this.frame=this.RPC.append(this.cont,r,n)}_definePublicApi(){this.funcs.onInit=()=>(this.options.heightSync&&this.RPC.callMethod("getHeight",e=>{this.setHeight(e)}),this.inited||(this.onInit&&this.onInit(),this.inited=!0,this.inlineApp||this.onAppReady()),this.sessionLogger&&this.sessionLogger.start(),!0),this.funcs.ApiCall=(e,t)=>{var r=e.shift();this.api(r,e[0],t)},this.funcs._getAppInfo=e=>{e([this.params.api_id,window.location.hash])},this.funcs.api=(e,t,r)=>{this.api(t,r,t=>{this.apiCallback(e,t)})},this.funcs.setHeight=e=>{this.setHeight(e)},this.funcs.scrollWindow=(e,t)=>{if(!this.inlineApp){var r=Math.max(e,0);t=Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_11__.intval)(t),this.options.layer?this.params.is_vkpay_service&&window.wkLayerWrap&&animate(window.wkLayerWrap,{scrollTop:r},t):t&&t>0?(animate(htmlNode,{scrollTop:r},t),animate(bodyNode,{scrollTop:r},t)):window.scroll(0,r)}},this.funcs.scrollTop=()=>{var e=window.innerHeight||document.documentElement.clientHeight||bodyNode.clientHeight;cur.appTopOffset||(cur.appTopOffset=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.getXY)(this.cont)[1]);var t=0;window.curNotifier&&curNotifier.idle_manager&&curNotifier.idle_manager.is_idle&&(t=1),this.runCallback("onScrollTop",parseInt(Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_18__.scrollGetY)()),parseInt(e),parseInt(cur.appTopOffset),t)},this.funcs.scrollSubscribe=e=>{var t,r=this.isOpenInLayer();t=r&&ge("wk_layer_wrap")||(_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.msie6?pageNode:window);var n=()=>{var e=window.innerHeight||document.documentElement.clientHeight||bodyNode.clientHeight,n=r?()=>t.scrollTop:_web_lib_scroll__WEBPACK_IMPORTED_MODULE_18__.scrollGetY;this.runCallback("onScroll",parseInt(n()),parseInt(e))},o=()=>{addEvent(t,"scroll",n)};o(),e&&n(),cur._back?(cur._back.show.push(o),cur._back.hide.push(()=>{Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_19__.removeEvent)(t,"scroll",n)})):cur.destroy.push(()=>{Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_19__.removeEvent)(t,"scroll",n)})},this.funcs.showRequestBox=(e,t,r)=>{this.options.vkApp||Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("al_apps.php",{act:"show_request_box",aid:cur.aid,message:t,uid:e,request_key:r},{params:{width:430,dark:1},onFail:e=>(this.runCallback("onRequestFail",e),!0)})},this.funcs.showInstallPushBox=()=>{this.options.vkApp||Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("al_apps.php",{act:"show_install_push_box",aid:cur.aid},{params:{width:430,dark:1},onFail:e=>(this.runCallback("onInstallPushFail",e),!0)})},this.funcs.showProfilePhotoBox=e=>{this.options.vkApp||Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("al_apps.php",{act:"show_profile_photo_box",hash:e,aid:cur.aid},{params:{dark:1}})},this.funcs.setTitle=e=>{var t=this.options.is_textlive_app;if((!this.options.vkApp||t)&&!this.inlineApp){e=e.replace(/[<>]+/gi,"");var r="",n=" | ";t?n="":r=cur.backLang||Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_10__.getLang)("global_vkontakte"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.setDocumentTitle)(r+(e?n+e:""))}},this.funcs.resizeWindow=(e,t,r)=>{this.options&&this.options.is_widescreen_mode||(this.setWidth(e,r),this.setHeight(t,r),e=this.frame.clientWidth,t=this.frame.clientHeight,this.runCallback("onWindowResized",e,t))},this.funcs.getLocationProtocol=e=>{e(location.protocol)},this.funcs.setLocation=(e,t)=>{e=e.toString(),cur.appLoc=e,t&&this.runCallback("onLocationChanged",e),window.nav.setLoc(extend(nav.objLoc,{"#":e}))},this.funcs.showInstallBox=()=>{if(!this.options.vkApp)if(cur.appUser)Apps.onAppAdded();else{if(cur.installBoxShown)return;cur.installBoxShown=!0,Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("apps",{act:"install_box",aid:this.options.aid},{params:{dark:1}}).setOptions({onHide:()=>{setTimeout(()=>{cur.installBoxShown=!1},3e3)}})}},this.funcs.showSettingsBox=e=>{if(!this.options.vkApp&&!cur.settingsBoxShown){cur.onSettingsEventSended=!1,cur.canSendOnSettingsEventFromHide=!0,cur.onSettingsChange=(e,t)=>{cur.onSettingsEventSended||(cur.onSettingsEventSended=!0,"ok"===e?this.runCallback("onSettingsChanged",t):this.runCallback("onSettingsCancel"))},cur.settingsBoxShown=!0;var t={act:"settings_box",aid:this.options.aid,mask:e};this.options.gid&&(t.gid=this.options.gid),Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("apps",t,{params:{dark:1,width:550}}).setOptions({onHide:()=>{cur.canSendOnSettingsEventFromHide&&cur.onSettingsChange("cancel"),setTimeout(()=>{cur.settingsBoxShown=!1},3e3)}})}},this.funcs.showGroupSettingsBox=e=>{this.options.vkApp||(cur.settingsBoxShown||(cur.settingsBoxShown=!0,this.options.gid&&(cur.onSettingsEventSended=!1,cur.canSendOnSettingsEventFromHide=!0,cur.onSettingsChange=(e,t,r)=>{cur.onSettingsEventSended||(cur.onSettingsEventSended=!0,"ok"===e?this.runCallback("onGroupSettingsChanged",t,r):this.runCallback("onGroupSettingsCancel"))},Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("apps",{act:"group_settings_box",aid:this.options.aid,mask:e,gid:this.options.gid},{params:{dark:1,width:550}}).setOptions({onHide:()=>{cur.canSendOnSettingsEventFromHide&&cur.onSettingsChange("cancel"),setTimeout(()=>{cur.settingsBoxShown=!1},3e3)}}))))},this.funcs.showAppWidgetPreviewBox=(e,t)=>{if(!this.options.vkApp&&!cur.appWidgetPreviewBox&&this.options.gid){cur.appWidgetPreviewBox=!0;var r=()=>{delete cur.onAppWidgetPreviewFail,delete cur.onAppWidgetPreviewCancel,delete cur.onAppWidgetPreviewSuccess,setTimeout(()=>{delete cur.appWidgetPreviewBox},3e3)};cur.onAppWidgetPreviewFail=e=>{r(),this.runCallback("onAppWidgetPreviewFail",e)},cur.onAppWidgetPreviewCancel=()=>{r(),this.runCallback("onAppWidgetPreviewCancel")},cur.onAppWidgetPreviewSuccess=()=>{r(),this.runCallback("onAppWidgetPreviewSuccess")};var n=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("apps",{act:"app_widget_preview_box",aid:this.options.aid,gid:this.options.gid,hash:this.options.hash,type:e,code:t},{params:{width:600,containerClass:"apps_app_widget_preview_box"},onDone:()=>{n.setOptions({onHide:()=>{Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_11__.isFunction)(cur.onAppWidgetPreviewCancel)&&cur.onAppWidgetPreviewCancel()}})},onFail:e=>(~e.indexOf("413 Request Entity Too Large")&&(e="413 Request Entity Too Large"),Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_11__.isFunction)(cur.onAppWidgetPreviewFail)&&cur.onAppWidgetPreviewFail(e),!0)})}},this.funcs.showAllowMessagesFromCommunityBox=e=>{if(!this.options.vkApp&&!cur.allowMessagesFromCommunityBox){cur.allowMessagesFromCommunityBox=!0,cur.allowMessagesFromCommunityStatus="",cur.onAllowMessagesFromCommunity=e=>{"ok"===e?this.runCallback("onAllowMessagesFromCommunity"):this.runCallback("onAllowMessagesFromCommunityCancel")};var t={act:"allow_messages_from_community_box",aid:this.options.aid};t.gid=e||this.options.gid,Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("apps",t,{params:{dark:1,width:550}}).setOptions({onHide:()=>{cur.onAllowMessagesFromCommunity(cur.allowMessagesFromCommunityStatus),setTimeout(()=>{cur.allowMessagesFromCommunityBox=!1},3e3)}})}},this.funcs.showInviteBox=(e,t)=>{this.options.vkApp||Apps.showInviteBox(this.options.aid,this.options.hash,e,t)},this.funcs.showPaymentBox=e=>{Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("al_apps.php",{act:"show_payment_box",votes:e,aid:this.options.aid},{params:{dark:1}})},this.funcs.showLeadsPaymentBox=e=>{Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("al_apps.php",{act:"show_payment_box",aid:this.options.aid,offers:isArray(e)?e.join(","):Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_11__.intval)(e)||1},{params:{dark:1}})},this.funcs.showOrderBox=e=>{if("object"!=typeof e){var t=Array.prototype.slice.call(arguments);e={},each(t,(function(){var t=this.split("=");2===t.length&&(e[t[0]]=t[1])}))}var r={};for(var n in e)Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.inArray)(n,["type","votes","offer_id","item","currency"])&&(r[n]=e[n]+"");"offers"===r.type&&isArray(r.offer_id)&&(r.offer_id=r.offer_id.join(",")),r.act="show_order_box",r.aid=this.options.aid,r.hash=this.options.hash,this.params.sales_ref&&(r.sales_ref=this.params.sales_ref),Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("al_apps.php",r,{params:{dark:1},onDone(e,t){t&&-1e3!==t&&_web_gifts_gifts__WEBPACK_IMPORTED_MODULE_22__.Gifts.processBoxOptions(e,t)},onFail:e=>(void 0===e&&this.options.embed||(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showFastBox)({title:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_10__.getLang)("global_error")},e),this.runCallback("onOrderFail",_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_8__.ERROR_CODES.INVALID_PARAMS)),!0)}),cur.onAppOrderCancel=()=>{this.runCallback("onOrderCancel")},cur.onAppOrderSuccess=e=>{this.runCallback("onOrderSuccess",e)},cur.onAppOrderFail=e=>{this.runCallback("onOrderFail",e)}},this.funcs.showSubscriptionBox=(e,t)=>{if(!this.options.vkApp){if("object"!=typeof t){var r=Array.prototype.slice.call(arguments);t={},each(r,(function(){var e=this.split("=");2===e.length&&(t[e[0]]=e[1])}))}var n={act:"show_subscription_box",aid:this.options.aid,action:e,hash:this.options.hash};"create"===n.action?n.item=t.item:"resume"!==n.action&&"cancel"!==n.action||(n.subscription_id=t.subscription_id),Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showBox)("al_apps.php",n,{onFail:e=>(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_9__.showFastBox)({title:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_10__.getLang)("global_error")},e),!0)}),cur.onSubscriptionCancel=()=>{this.runCallback("onSubscriptionCancel")},cur.onSubscriptionSuccess=e=>{this.runCallback("onSubscriptionSuccess",e)},cur.onSubscriptionFail=e=>{this.runCallback("onSubscriptionFail",e)}}},this.funcs.addToMenu=()=>{ajax.post("al_apps.php",{act:"add_left_menu",aid:cur.aid,hash:this.options.hash},{onDone:function(e){Apps.updateLeftNav(e.left_nav),Apps.addToMenuErrorResolve(e),Apps.updateAddToMenuAction()}})},this.funcs.adsPublish=()=>{AdsLight.handleEvent.apply(AdsLight,arguments)},this.funcs.debug=()=>{window.debugLog(1===arguments.length?arguments[0]:arguments)},this.funcs.openExternalApp=(e,t,r)=>{if(e){var n=["pay-to-user","pay-to-service","pay-to-group","transfer-to-user","transfer-to-group","open-service","add-card","recurrent"],o=["pay-to-user","transfer-to-user"],i=["pay-to-group","transfer-to-group"],a=this.options.vkApp;if(t&&~n.indexOf(t.action))if(!~o.indexOf(t.action)||t.user_id)if(!~i.indexOf(t.action)||t.group_id)if("open-service"!==t.action||this.params.is_vkpay){var s="open-service"!==t.action;if(Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_11__.isObject)(t.data))try{t.data=JSON.stringify(t.data)}catch(e){t.data=""}var c="",l=[];if(t&&(t.aid=this.options.aid,c=e+"?"+(l=this.getQueryParts(t)).join("&")),c){var p,_=!_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.mozilla&&!_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.msi&&!_web_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.msie_edge,d=!1;if("open-service"===t.action){var u=/^app(\d+)(?:_-(\d+))?$/.exec(e),h=this.options.vkpay_not_layer_services||[],f=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.positive)(u[1]);u&&Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.inArray)(f,h)&&(d=!0,_&&(p=window.open("","_blank"))),this.params.is_vkpay_service&&this.params.is_mobile&&(d=!0,_&&(p=window.open("","_blank")))}ajax.post("al_apps.php",{act:"open_external_app",url:e,q:l.join("&"),aid:this.options.aid},{onDone:(e,r)=>{if(r){if("open-service"===t.action&&d)return e=decodeURIComponent(e),p?void(p.location.href="/"+e):this.params.is_mobile?void(window.location.href="/"+e):void nav.go("/"+e);this.openAppInLayer(e,()=>{cur.onExternalAppDone&&(cur.onExternalAppResults?this.checkExternalAppResponse():this.runCallback("onExternalAppClose"),cur.onExternalAppDone=null)},s),cur.onExternalAppDone=(e,t)=>{t=!!t,this.isOpenInLayer()||t?cur.onExternalAppResults={api_id:this.params.api_id,result:e}:(cur.onExternalAppResults=null,this.runCallback("onExternalAppDone",e)),t||(cur.onExternalAppDone=null,window.WkView&&WkView.hide(!1,!0))}}},onFail:e=>{try{e=JSON.parse(e)}catch(t){e={error:{error_msg:"Unknown error",error_code:1}}}return p&&p.close(),a?r(e.error):this.runCallback("onExternalAppFail",e.error),!0}})}}else a?r({error_msg:"Invalid action",error_code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_8__.ERROR_CODES.OLD_MISSING_PARAM}):this.runCallback("onExternalAppFail",{error_msg:"Invalid action",error_code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_8__.ERROR_CODES.OLD_MISSING_PARAM});else this.options.vkApp?r({error_msg:"Missing required param group_id",error_code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_8__.ERROR_CODES.OLD_MISSING_PARAM}):this.runCallback("onExternalAppFail",{error_msg:"Missing required param group_id",error_code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_8__.ERROR_CODES.OLD_MISSING_PARAM});else a?r({error_msg:"Missing required param user_id",error_code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_8__.ERROR_CODES.OLD_MISSING_PARAM}):this.runCallback("onExternalAppFail",{error_msg:"Missing required param user_id",error_code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_8__.ERROR_CODES.OLD_MISSING_PARAM});else a?r({error_msg:"Invalid action",error_code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_8__.ERROR_CODES.OLD_MISSING_PARAM}):this.runCallback("onExternalAppFail",{error_msg:"Invalid action",error_code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_8__.ERROR_CODES.OLD_MISSING_PARAM})}},this.funcs.externalAppDone=(e,t)=>{if(cur.onExternalAppDone?cur.onExternalAppDone(e,t):t||window.WkView&&WkView.hide(!1,!0),this.params.is_mobile||window.opener&&window.opener.vk&&window.opener.vk.platform===_shared_constants_platforms__WEBPACK_IMPORTED_MODULE_13__.PLATFORM_MVK){if(window.opener){var r={method:"externalAppDone",params:e};window.opener.postMessage(r,"*")}this.close(!1)}},this.funcs.externalAppFail=e=>{if(!Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_11__.isObject)(e))try{e=JSON.parse(e)}catch(t){e={error:{error_msg:"Unknown error",error_code:1}}}var t=this.getOpenerApp();t&&t.isOpenInLayer()?cur.onExternalAppResults={api_id:t.params.api_id,error:e.error}:t&&t.runCallback("onExternalAppFail",e.error),cur.onExternalAppDone=null,window.WkView&&WkView.hide(!1,!0)},this.funcs.closeExternalApp=()=>{Apps.closeExternalApp()},this.funcs.closeApp=()=>{this.params.is_vkpay_service&&this.close(!0)},this.funcs.sendStats=e=>{(Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_11__.isObject)(e)||isArray(e))&&(e=JSON.stringify(e)),ajax.post("al_apps.php",{act:"save_stats",data:e,hash:this.params.stats_hash,app_id:cur.aid},{onDone:()=>{this.runCallback("onSendStatsDone")},onFail:()=>(this.runCallback("onSendStatsFail"),!0)})},this.funcs.showWallPostBox=(e,t,r)=>{if(e.message||e.attachments&&e.attachments.length)this.api("wall.post",e,e=>{e.error?r?r(e.error):this.runCallback("onShowWallPostBoxCancel",e.error):t?t({post_id:e.response.post_id}):this.runCallback("onShowWallPostBoxDone")});else{var n={error_code:100,error_msg:"One of the parameters specified was missing or invalid"};r?r(n):this.runCallback("onShowWallPostBoxCancel",n)}},this.funcs.enableBodyScroll=()=>{this.params.is_vkpay_service&&cur.bodyScrollDisabled&&(Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_18__.enableBodyScroll)(),cur.bodyScrollDisabled=!1,this.runCallback("onBodyScrollDisabled"))},this.funcs.disableBodyScroll=()=>{this.params.is_vkpay_service&&!cur.bodyScrollDisabled&&(cur.destroy.push((function(){cur.bodyScrollDisabled&&Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_18__.enableBodyScroll)()})),Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_18__.disableBodyScroll)(),cur.bodyScrollDisabled=!0,this.runCallback("onBodyScrollEnabled"))},this.funcs.startHandleWheelEvent=()=>{this.params.is_vkpay_service&&this.startHandleWheelEvent()},this.funcs.stopHandleWheelEvent=()=>{this.params.is_vkpay_service&&this.stopHandleWheelEvent()},this.funcs.startHandleDeviceOrientation=()=>{this.runCallback("onDeviceOrientationNotSupported")},this.funcs.unIdle=()=>{this.sessionLogger&&this.sessionLogger.unIdle()},this.funcs.idle=()=>{this.sessionLogger&&this.sessionLogger.idle()},this.funcs.checkUnitySupport=()=>{Object(_web_apps_AppsUtils__WEBPACK_IMPORTED_MODULE_20__.detectUnityWebPlayer)(e=>{e?this.runCallback("onCheckUnitySupportSuccess"):(this.showDummy("no_unity"),this.runCallback("onCheckUnitySupportFail"))})},this.funcs.checkFlashSupport=e=>{(e=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.positive)(e))||(e=9),window.browser.flash>=e?this.runCallback("onCheckFlashSupportSuccess"):(this.showDummy("no_flash"),this.runCallback("onCheckFlashSupportFail"))}}_initDestroy(){window.cur.destroy=window.cur.destroy||[],window.cur.destroy.push(()=>{this.RPC&&this.RPC.destroy()})}_initSessionLogger(){this.options.log_session&&!this.options.vkApp&&(this.sessionLogger=new _shared_apps_SessionTimeLogger__WEBPACK_IMPORTED_MODULE_7__.default(window.cur.aid),cur.destroy.unshift(()=>{this.sessionLogger.stop()}))}_getIframeUrl(){var e="";if(this.options.type===IFRAME_APP_TYPE)if(this.options.vkApp){e=this.options.vk_app_url;var t=this.options.hash_as_param,r=this.params.hash?""+this.params.hash:location.hash.substr(1);this.params.hash?r=this.params.hash:location.hash&&(r=location.hash.substr(1)),r&&(t&&(e+="&hash="+encodeURIComponent(r)),e+="#"+r)}else{e=this.options.src;var n=[];for(var o in this.params)this.params.hasOwnProperty(o)&&("hash"===o?n.push(o+"="+encodeURIComponent(this.params[o])):n.push(o+"="+this.params[o]));e+=(-1===e.indexOf("?")?"?":"&")+n.join("&")}return e}_makeHashParam(){if(this.params.hash=this.params.hash||"",-1!==this.params.hash.indexOf("#")){var e=this.params.hash.split("#").pop();(e||"").substr(0,1)===window.vk.navPrefix?this.params.hash="":this.params.hash=e}}}},"9O7i":function(e,t,r){"use strict";function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Array.isArray(e)?e:"string"==typeof e?[e]:t}Object.defineProperty(t,"__esModule",{value:!0}),t.parseActions=n,t.isHistory=function(e){return void 0!==e.present&&void 0!==e.future&&void 0!==e.past&&Array.isArray(e.future)&&Array.isArray(e.past)},t.includeAction=function(e){var t=n(e);return function(e){return t.indexOf(e.type)>=0}},t.excludeAction=function(e){var t=n(e);return function(e){return t.indexOf(e.type)<0}},t.combineFilters=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce((function(e,t){return function(r,n,o){return e(r,n,o)&&t(r,n,o)}}),(function(){return!0}))},t.groupByActionTypes=function(e){var t=n(e);return function(e){return t.indexOf(e.type)>=0?e.type:null}},t.newHistory=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return{past:e,present:t,future:r,group:n,_latestUnfiltered:t,index:e.length,limit:e.length+r.length+1}}},"9kLB":function(e,t,r){"use strict";var n,o;r.r(t),r.d(t,"EVENT_STATES",(function(){return n})),r.d(t,"CONNECT_EVENTS",(function(){return o})),function(e){e.FIRE="",e.FAILURE="Failed",e.SUCCESS="Result"}(n||(n={})),function(e){e.ADD_TO_COMMUNITY="VKWebAppAddToCommunity",e.ADD_TO_COMMUNITY_PRELOAD="VKWebAppAddToCommunityPreload",e.ADD_TO_FAVORITES="VKWebAppAddToFavorites",e.ADD_TO_MENU="VKWebAppAddToMenu",e.ADD_TO_HOME_SCREEN_INFO="VKWebAppAddToHomeScreenInfo",e.ALLOW_MESSAGES_FROM_GROUP="VKWebAppAllowMessagesFromGroup",e.ALLOW_MESSAGES_FROM_GROUP_PRELOAD="VKWebAppAllowMessagesFromGroupPreload",e.ALLOW_NOTIFICATIONS="VKWebAppAllowNotifications",e.ALLOW_NOTIFICATIONS_PRELOAD="VKWebAppAllowNotificationsPreload",e.COPY_TEXT="VKWebAppCopyText",e.CALL_API_METHOD="VKWebAppCallAPIMethod",e.CLOSE="VKWebAppClose",e.DENY_NOTIFICATIONS="VKWebAppDenyNotifications",e.FLASH_GET_INFO="VKWebAppFlashGetInfo",e.FLASH_SET_LEVEL="VKWebAppFlashSetLevel",e.GET_AUTH_TOKEN="VKWebAppGetAuthToken",e.GET_AUTH_TOKEN_PRELOAD="VKWebAppGetAuthTokenPreload",e.GET_CLIENT_VERSION="VKWebAppGetClientVersion",e.GET_COMMUNITY_AUTH_TOKEN="VKWebAppGetCommunityAuthToken",e.GET_COMMUNITY_TOKEN="VKWebAppGetCommunityToken",e.GET_COMMUNITY_AUTH_TOKEN_PRELOAD="VKWebAppGetCommunityAuthTokenPreload",e.GET_EMAIL_PRELOAD="VKWebAppGetEmailPreload",e.GET_EMAIL="VKWebAppGetEmail",e.GET_FRIENDS="VKWebAppGetFriends",e.GET_FLASH_INFO="VKWebAppGetFlashInfo",e.GET_GEODATA="VKWebAppGetGeodata",e.GET_PERSONAL_CARD="VKWebAppGetPersonalCard",e.GET_PHONE_NUMBER_PRELOAD="VKWebAppGetPhoneNumberPreload",e.GET_PHONE_NUMBER="VKWebAppGetPhoneNumber",e.GET_USER_INFO="VKWebAppGetUserInfo",e.INIT="VKWebAppInit",e.JOIN_GROUP="VKWebAppJoinGroup",e.JOIN_GROUP_PRELOAD="VKWebAppJoinGroupPreload",e.LEAVE_GROUP="VKWebAppLeaveGroup",e.LEAVE_GROUP_PRELOAD="VKWebAppLeaveGroupPreload",e.LOCATION_CHANGED="VKWebAppLocationChanged",e.OPEN_APP="VKWebAppOpenApp",e.OPEN_CONTACTS="VKWebAppOpenContacts",e.OPEN_IN_NATIVE_APP="VKWebAppOpenInNativeApp",e.OPEN_PAY_FORM="VKWebAppOpenPayForm",e.OPEN="VKWebAppOpenQR",e.REDIRECT="VKWebAppRedirect",e.RESIZE_WINDOW="VKWebAppResizeWindow",e.SCROLL="VKWebAppScroll",e.SEND_PAYLOAD="VKWebAppSendPayload",e.SEND_TO_CLIENT="VKWebAppSendToClient",e.SEND_TO_CLIENT_PRELOAD="VKWebAppSendToClientPreload",e.SETTINGS="VKWebAppSettings",e.SET_LOCATION="VKWebAppSetLocation",e.SET_TITLE="VKWebAppSetTitle",e.SET_VIEW_SETTINGS="VKWebAppSetViewSettings",e.SHARE="VKWebAppShare",e.SHOW_NEW_POST_BOX="VKWebAppShowNewPostBox",e.SHOW_IMAGES="VKWebAppShowImages",e.SHOW_INVITE_BOX="VKWebAppShowInviteBox",e.SHOW_STORY_BOX="VKWebAppShowStoryBox",e.SHOW_LEADER_BOARD_BOX="VKWebAppShowLeaderBoardBox",e.SHOW_ORDER_BOX="VKWebAppShowOrderBox",e.SHOW_REQUEST_BOX="VKWebAppShowRequestBox",e.SHOW_WALL_POST_BOX="VKWebAppShowWallPostBox",e.TAPTIC_IMPACT_OCCURRED="VKWebAppTapticImpactOccurred",e.TAPTIC_NOTIFICATION_OCCURRED="VKWebAppTapticNotificationOccurred",e.TAPTIC_SELECTION_CHANGED="VKWebAppTapticSelectionChanged",e.UPDATE_CONFIG="VKWebAppUpdateConfig",e.VIEW_UPDATE_NAVIGATION_STATE="VKWebAppViewUpdateNavigationState",e.OPEN_ARTICLE_EDIT="VKWebAppOpenArticleEditor",e.OPEN_ARTICLE="VKWebAppOpenArticle"}(o||(o={}))},ANjH:function(e,t,r){"use strict";r.r(t),r.d(t,"createStore",(function(){return s})),r.d(t,"combineReducers",(function(){return l})),r.d(t,"bindActionCreators",(function(){return _})),r.d(t,"applyMiddleware",(function(){return f})),r.d(t,"compose",(function(){return h})),r.d(t,"__DO_NOT_USE__ActionTypes",(function(){return i}));var n=r("bCCX"),o=function(){return Math.random().toString(36).substring(7).split("").join(".")},i={INIT:"@@redux/INIT"+o(),REPLACE:"@@redux/REPLACE"+o(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+o()}};function a(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function s(e,t,r){var o;if("function"==typeof t&&"function"==typeof r||"function"==typeof r&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function");if("function"==typeof t&&void 0===r&&(r=t,t=void 0),void 0!==r){if("function"!=typeof r)throw new Error("Expected the enhancer to be a function.");return r(s)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var c=e,l=t,p=[],_=p,d=!1;function u(){_===p&&(_=p.slice())}function h(){if(d)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return l}function f(e){if("function"!=typeof e)throw new Error("Expected the listener to be a function.");if(d)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");var t=!0;return u(),_.push(e),function(){if(t){if(d)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");t=!1,u();var r=_.indexOf(e);_.splice(r,1)}}}function m(e){if(!a(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(d)throw new Error("Reducers may not dispatch actions.");try{d=!0,l=c(l,e)}finally{d=!1}for(var t=p=_,r=0;r<t.length;r++){(0,t[r])()}return e}function b(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");c=e,m({type:i.REPLACE})}function E(){var e,t=f;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");function r(){e.next&&e.next(h())}return r(),{unsubscribe:t(r)}}})[n.default]=function(){return this},e}return m({type:i.INIT}),(o={dispatch:m,subscribe:f,getState:h,replaceReducer:b})[n.default]=E,o}function c(e,t){var r=t&&t.type;return"Given "+(r&&'action "'+String(r)+'"'||"an action")+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function l(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++){var o=t[n];0,"function"==typeof e[o]&&(r[o]=e[o])}var a,s=Object.keys(r);try{!function(e){Object.keys(e).forEach((function(t){var r=e[t];if(void 0===r(void 0,{type:i.INIT}))throw new Error('Reducer "'+t+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===r(void 0,{type:i.PROBE_UNKNOWN_ACTION()}))throw new Error('Reducer "'+t+"\" returned undefined when probed with a random type. Don't try to handle "+i.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')}))}(r)}catch(e){a=e}return function(e,t){if(void 0===e&&(e={}),a)throw a;for(var n=!1,o={},i=0;i<s.length;i++){var l=s[i],p=r[l],_=e[l],d=p(_,t);if(void 0===d){var u=c(l,t);throw new Error(u)}o[l]=d,n=n||d!==_}return n?o:e}}function p(e,t){return function(){return t(e.apply(this,arguments))}}function _(e,t){if("function"==typeof e)return p(e,t);if("object"!=typeof e||null===e)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===e?"null":typeof e)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');for(var r=Object.keys(e),n={},o=0;o<r.length;o++){var i=r[o],a=e[i];"function"==typeof a&&(n[i]=p(a,t))}return n}function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){d(e,t,r[t])}))}return e}function h(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function f(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return function(){var r=e.apply(void 0,arguments),n=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},o={getState:r.getState,dispatch:function(){return n.apply(void 0,arguments)}},i=t.map((function(e){return e(o)}));return u({},r,{dispatch:n=h.apply(void 0,i)(r.dispatch)})}}}},"F+Y4":function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"detectUnityWebPlayer",(function(){return detectUnityWebPlayer}));var core_js_modules_es6_object_assign__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("91GP"),core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("rE2o"),core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("ioFf"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("rGqo"),core_js_modules_es6_array_from__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("HEwt"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("KKXr"),core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("Oyvg"),core_js_modules_es6_regexp_search__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("OG14"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("pIFo"),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("SRfc"),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("a1Th"),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("Btvt"),_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("zxIV"),_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("v+DW"),_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("EasH"),_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("FWc3"),_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("4+be"),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("t7n3"),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("Egk5"),_web_lib_stats__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("XzvV"),_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("gdug"),_web_lib_fx__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("7jxN"),_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("jE6c"),_shared_apps_connect_libs_QRCodeModal__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__("3f+a"),_shared_apps_connect_lib__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__("lMzL"),_vkontakte_vk_qr__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__("wZQE"),_web_apps_games_gifts_GameGifts__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__("WPHA"),_web_apps_WideScreenMode__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__("eiY0"),_web_apps_games_GamesFlashBanner__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__("HDq7"),_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__("4zn2"),_web_apps_games_catalog_tooltip__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__("nB7T"),_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__("kcIO"),_web_apps_games_catalog_nav__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__("hPa7"),_web_apps_games_catalog_slider__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__("WRIt"),_web_lib_scroll__WEBPACK_IMPORTED_MODULE_34__=__webpack_require__("lXE5"),_web_legacy_ui_ui_search__WEBPACK_IMPORTED_MODULE_35__=__webpack_require__("btP0"),_web_lib_utils__WEBPACK_IMPORTED_MODULE_36__=__webpack_require__("aong"),_shared_counters_tmr__WEBPACK_IMPORTED_MODULE_37__=__webpack_require__("JlTo"),_shared_apps_utils__WEBPACK_IMPORTED_MODULE_38__=__webpack_require__("n4MN"),_web_gifts_gifts__WEBPACK_IMPORTED_MODULE_39__=__webpack_require__("HwS1");function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var ID_APP_CHECKBACK=6739175;window._iconAdd||(window._iconAdd=window.devicePixelRatio>=2?"_2x":"");var AppsUtils={optionHiddenClass:"apps_hidden",optionLoadingClass:"loading",address:"apps",init:function init(obj,appTpl){if(extend(cur,{module:"apps",preventFastBack:!1,aTabs:ge("apps_top_tabs"),aSubTabs:geByClass1("_apps_top_subtabs"),aSearch:ge("s_search"),aSearchWrap:ge("apps_search"),aWrap:ge("apps_wrap"),aSummary:ge("apps_summary"),aSummaryCounter:ge("apps_summary_counter"),lShowMoreButton:ge("apps_list_show_more"),lPreload:ge("apps_list_preload"),lContent:ge("apps_list_content"),fWrap:ge("apps_feed_wrap"),fShowMoreButton:ge("apps_feed_show_more"),rNotCounter:ge("apps_recent_notifications_counter"),rNotWrap:ge("apps_notifications_wrap"),rNotNoContent:ge("apps_recent_notifications_no_content"),rNotBlackList:ge("apps_recent_notifications_black_list"),rNotShowMoreButton:ge("apps_recent_notifications_show_more"),rAppsWrap:ge("apps_recent_apps_wrap"),rAppsShowMoreButton:ge("apps_recent_more"),rAppsNoContent:ge("apps_recent_apps_no_content"),catalogSearchShown:+!document.querySelector("#apps_search.SearchToggle__hide"),onSilentLoad:{},apps:{},deletedApps:{},appTpl:appTpl||function(){return""}}),extend(cur,obj),cur.defaultCount=cur.shownApps,"notifications"===nav.objLoc.act&&(delete nav.objLoc.act,nav.objLoc.tab="notifications",nav.setLoc(nav.objLoc)),this.setHistoryBackRules(),this.searchLoadFromAddressBar(),cur.aSearch&&(_web_legacy_ui_ui_search__WEBPACK_IMPORTED_MODULE_35__.default["list"===cur.section?"setFixed":"setStatic"](cur.aSearch),_web_legacy_ui_ui_search__WEBPACK_IMPORTED_MODULE_35__.default.startEvents(cur.aSearch)),setTimeout(function(){this.scrollCheckBinded=this.scrollCheck.bind(this),this.sliderInit(),this.notificationsInit(),cur.scrollToHeader&&(setTimeout(this.scrollToHeader.bind(this),100),delete cur.scrollToHeader),cur.scrollToTop&&(Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_34__.scrollToTop)(),delete cur.scrollToTop),this.startEvents(),cur.destroy.push(function(e){setTimeout((function(){var t;e.feedScrollbar&&cur.fScrollbar!==e.feedScrollbar&&(t=!1,globalHistory.forEach((function(r){r.cur!==e&&r.cur.feedScrollbar===e.feedScrollbar&&(t=!0)})),t||e.feedScrollbar.destroy()),e.rNotScrollbar&&cur.rNotScrollbar!==e.rNotScrollbar&&(t=!1,globalHistory.forEach((function(r){r.cur!==e&&r.cur.rNotScrollbar===e.rNotScrollbar&&(t=!0)})),t||e.rNotScrollbar.destroy())}),0),cur.featuredSlider&&(cur.featuredSlider.destroy(),cur.featuredSlider=null)}.pbind(cur)),cur.destroy.push(this.stopEvents.bind(this)),cur.aSearch&&_web_legacy_ui_ui_search__WEBPACK_IMPORTED_MODULE_35__.default.scrollResize(cur.aSearch)}.bind(this),0),cur.silent_mode){if(cur.silent=!0,cur.preload&&(cur.leavePreloadedHeader||delete cur.preload.header,cur.leavePreloadedBefore||delete cur.preload.before),!cur.isGamesCatalogRedesign){var query={act:"load_apps_silent",gid:cur.gid,oid:cur.oid,header:cur.leavePreloadedHeader?0:1,before:cur.leavePreloadedBefore?0:1,section:cur.section,preload:1,preloaded:[]},prop=null;for(prop in cur.preload=cur.preload||{},cur.preload)cur.preload.hasOwnProperty(prop)&&query.preloaded.push(prop);ajax.post(this.address,query,{cache:1,local:1,onDone:this.withFastBackCheck((json,preload,preloadBefore,preloadHeader)=>{cur.preload=extend(cur.preload||{},preload),cur.preload.before=preloadBefore,cur.preload.header=preloadHeader,json=eval("("+json+")"),cur.curList="all",cur.appsList=json&&json[cur.curList]?json:{all:[]},cur.sectionCount=cur.appsList[cur.curList].length,void 0===cur.searchOffset&&(cur.searchOffset=0),json?this.indexAll(()=>this.onSilentLoad()):this.onSilentLoad()})})}_web_apps_games_gifts_GameGifts__WEBPACK_IMPORTED_MODULE_26__.default.defineGamesGifts(),obj.has_notify&&this.notifyAction(),cur.isGamesCatalogRedesign&&"list"===obj.section&&window.GamesCatalog._initNav("list")}},notifyAction:()=>{var e=document.querySelector("#l_ap");e&&e.classList.remove("AppLeftMenuWithNotify"),showWiki({w:"play_safe_at_home",ref:"challenge_landing_banner"})},onSilentLoad:function(){if(cur.silent=!1,cur.onSilentLoad)for(var e in cur.onSilentLoad)cur.onSilentLoad.hasOwnProperty(e)&&Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.isFunction)(cur.onSilentLoad[e])&&cur.onSilentLoad[e]()},withFastBackCheck:function(e){cur.preventFastBack=!0;var t=cur;return function(){cur===t&&(cur.preventFastBack=!1,e.apply(null,Array.prototype.slice.call(arguments)))}},startEvents:function(){addEvent(window,"scroll",this.scrollCheckBinded),addEvent(window,"resize",this.scrollCheckBinded),this.scrollCheck(),this.sliderStart()},stopEvents:function(){Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.removeEvent)(window,"scroll",this.scrollCheckBinded),Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.removeEvent)(window,"resize",this.scrollCheckBinded),this.sliderStop()},isSection:function(){for(var e=arguments.length;e--;)if(arguments[e]===cur.section)return!0;return!1},isDelayedOnSilentLoad:function e(t,r){if(cur.silent)return e.count=e.count||0,e.count++,cur.onSilentLoad[t||"key_"+e.count]=r,!0},handlePageCount:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return handlePageCount("ap",e)})),incomingCall:function(e){stManager.add(["notifier.js","notifier.css","apps.css","call.css"],()=>{var t=se('<div><div class="call_apps_wrap clear_fix">'+e+"</div></div>"),r={movable:geByClass1("call_invitation_wrap",t,"div"),startLeft:parseInt((window.innerWidth-224)/2)+"px",startTop:parseInt((window.innerHeight-404)/2)+"px",startWidth:224,startHeight:404,resize:!1,onBeforeHide:function(){},onDragEnd:function(e,t){},onResize:function(e,t){}};this.appCall&&this.appCall.close(),this.appCall=new RBox(t,r)}),window.Notifier&&Notifier.setRecvClbk("apps_call_hide",()=>{this.appCall&&(this.appCall.close(),this.appCall=!1)})},callApprove:function(e){window.Notifier&&Notifier.lcSend("apps_call_hide",(new Date).getTime()),this.appCall&&(this.appCall.close(),this.appCall=!1),nav.go(e)},callReject:function(){window.Notifier&&Notifier.lcSend("apps_call_hide",(new Date).getTime()),this.callOnReject()},callOnReject:function(){this.appCall&&(this.appCall.close(),this.appCall=!1),ajax.post("/al_apps.php",{act:"do_call_reject"},{onDone:function(){}})},editBlacklist:function(){return Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showBox)(this.address,{act:"blacklist_box",height:lastWindowHeight},{stat:["privacy.css",jsc("web/indexer.js")]}),!1},blacklistInit:function(e,t,r){r=r||{};var n=geByClass1("apps_blacklist_wrap",e.bodyNode),o=geByClass1("apps_blacklist",e.bodyNode),i=geByClass1("olist_more",e.bodyNode,"a"),a={},s=new vkIndexer(t,(function(e){return e[1]}));e.setOptions({width:560,bodyStyle:"padding: 0px"}),e.removeButtons().addButton(Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_close"),(function(){e.hide(200)}),"yes"),o.parentNode.style.height=r.boxHeight+"px";var c=ge("apps_blacklist_filter");r.nofocus||setTimeout(elfocus.pbind(c),100);var l=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(c,"opts");function p(){if(n.scrollTop>0?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(e.bodyNode.parentNode,"olist_topsh"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(e.bodyNode.parentNode,"olist_topsh"),n.scrollTop+(n.offsetHeight||n.clientHeight)<o.scrollHeight?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(e.bodyNode.parentNode,"olist_botsh"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(e.bodyNode.parentNode,"olist_botsh"),i&&i.offsetTop&&i.onclick){var t=i.offsetTop;o.scrollTop+(o.offsetHeight||o.clientHeight)+100>=t&&i.onclick()}}function _(n,c){var l,p,d=(c=~~c||0)?60:120;n&&(n=clean(n).replace(/\u2013|\u2014/g,"-")),l=n?s.search(n):t,p=r.tpl;var u=l.length;l=l.slice(c,c+d);var h,f=[];if(n){var m=escapeRE(n),b=Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.parseLatin)(n);null!=b&&(m=m+"|"+escapeRE(b)),h=new RegExp("(?![^&;]+;)(?!<[^<>]*)((\\(*)("+m+"))(?![^<>]*>)(?![^&;]+;)","gi")}each(l,(function(){f.push(rs(p,function(e,t,r,n){var o=e[1];if(t){o=-1==t.indexOf(" ")?o.split(" "):[o];var i="";for(var a in o)o.hasOwnProperty(a)&&(i+=(a>0?" ":"")+o[a].replace(n,"$2<em>$3</em>"));o=i}return{id:e[0],name:o,photo:e[2],wrap_class:e[0]&&r[e[0]]?" olist_item_wrap_on":"",link:e[3]||(e[0]>0?"id"+e[0]:"app"+(1e9-e[0]))}}(this,n,a,h)))})),c||f.length||f.push('<div class="no_rows">'+(n?Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_search_not_found").replace("{search}",clean(n)):r.lang.apps_blacklist_empty)+"</div>"),re(i),f=f.join(" "),c?o.appendChild(cf(f)):val(o,f),u>c+d&&(o.appendChild(i),i.onclick=function(e){return _(n,c+d),Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.cancelEvent)(e)}),e&&e.scroll&&e.scroll.update(!1,!0)}Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(c,"opts",extend(l,{onChange:function(e){_(e,0)}})),i&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(i)?i.onclick=function(e){return _("",60),Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.cancelEvent)(e)}:(re(i),show(i))),addEvent(o,"click",(function(r){var n=r.originalTarget||r.target;hasClass(n,"olist_item_wrap")||(n=gpeByClass("olist_item_wrap",n));if(!n||n==bodyNode)return;if(hasClass(n,"olist_item_loading"))return Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.cancelEvent)(r);if(Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.checkEvent)(r))return!0;e.changed=!0;var i=n.id.match(/-?\d+/)[0],s=a[i],l=!1;each(t,(function(){if(this[0]==i)return l=this[4],!1})),ajax.post("/al_apps.php",{act:"a_blacklist_delete",cancel:s?1:0,owner_id:i,hash:l},{onDone:function(){toggleClass(n,"olist_item_wrap_on",!s),a[i]=!s},showProgress:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(n,"olist_item_loading")},hideProgress:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(n,"olist_item_loading")}}),o.scrollTop<50&&setTimeout((function(){elfocus(c),val(c).length&&c.select()}),100);return Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.cancelEvent)(r)})),addEvent(n,"scroll",p),setTimeout(p,10)},initDescription:function(e){if(!document.querySelector(".DownloadedGamePage")){var t=geByClass1("apps_i_description_content");val(t,e);var r=parseInt(getStyle(t,"line-height"));Math.ceil(getSize(t)[1]/r)>7&&(setStyle(t,"height",5*r),val(t,e),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(geByClass1("apps_i_description_show_more"),this.optionHiddenClass))}},showFullDescription:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(geByClass1("apps_i_description_show_more"),this.optionHiddenClass),setStyle(geByClass1("apps_i_description_content"),"height","")},appSsSliderNext:function(e){e?cur.appSsSlider&&cur.appSsSlider.next():cur.wkviewAppsSlider&&cur.wkviewAppsSlider.next()},initAppSsSlider:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t=t||"";var n,o=ge("apps_i_slider_next"+t),i=ge("apps_i_slider_prev"+t),a=ge("apps_i_slider_outer"+t),s=ge("apps_i_slider_thumbs"+t),c=s?domPN(s):null,l=s?s.children:[],p=null,_=null;function d(){if(s){var e=c.offsetWidth,t=s.scrollWidth;if(t<=e||!t||!e)return;null===p&&(p=0);var r=l[p],o=r.offsetLeft,i=(e-r.offsetWidth)/2-o;i=Math.max(-t+e,Math.min(0,i)),_&&_.stop(),_=animate(s,{left:i},{duration:n.options.animationDuration,transition:Fx.Transitions.easeOutCubic})}}function u(e){return e>=n.slides.length-2}function h(){Array.from(l).forEach(e=>{Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(e,"in-view")})}function f(e){if(h(),0===e)for(var t=e;t<=2;t++)Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(l[t],"in-view");else if(u(e))for(var r=n.slides.length-4,o=n.slides.length-1;o>r;)Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(l[o],"in-view"),o--;else for(var i=e-1;i<=e+1;i++)Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(l[i],"in-view")}function m(t){s&&t!==p&&(null!==p&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(l[p],"selected"),p=t,e&&f(p),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(l[p],"selected"),d())}function b(){m(null!==n.required?n.required:n.current)}function E(){n.slideNext?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(o,"apps_i_slider_available"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(o,"apps_i_slider_available"),n.slidePrev?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(i,"apps_i_slider_available"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(i,"apps_i_slider_available"),hasClass(n.slideCurrent,"apps_promo_video_slide")?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(a,"apps_i_slider_video"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(a,"apps_i_slider_video"),n.slideNext?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(a,"apps_i_slider_run"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(a,"apps_i_slider_run"),hasClass(n.slidePrev,"apps_promo_video_slide")&&cur&&cur.videoInlinePlayer&&cur.videoInlinePlayer.pause(),hasClass(n.slideCurrent,"apps_promo_video_slide")&&cur&&cur.videoInlinePlayer&&cur.videoInlinePlayer.play()}if(n=new _web_apps_games_catalog_slider__WEBPACK_IMPORTED_MODULE_33__.default({inner:ge("apps_i_slider_inner"+t),outer:a,next:o,prev:i,onChange:E,onRequired:b,infinite:!1,isVkApp:e}),r?cur.appSsSlider=n:cur.wkviewAppsSlider=n,window.layerQueue&&window.layerQueue.push(),E(),b(),each(l,(function(e,t){var r=new Image;r.onload=d,r.src=geByTag1("img",t).src,addEvent(t,"click",(function(){n&&n.requireIndex(e)}))})),cur.promoVideo){var g=ge("apps_promo_video_thumb"+t);g&&showInlineVideo(cur.promoVideo,"",{autoplay:1,module:"app_promo",addParams:{from_autoplay:1}},null,g)}},initSimilarAppsSlider:function(){var e=document.querySelector(".apps_similarApps");if(e){var t=e.querySelector(".apps_similarApps__listContent");t&&stManager.add(["ui_common.js"],()=>{var e=e=>{window.tooltips&&tooltips.hideAll();var r=Math.abs(e.deltaX||e.wheelDeltaX||0);Math.abs(e.deltaY||e.wheelDeltaY||0)>r&&(Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.cancelEvent)(e),t.scrollLeft+=uiScroll.scrollEventDelta(e))};addEvent(t,browserFeatures.wheelEvent,e),cur.destroy.push(()=>{Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.removeEvent)(t,browserFeatures.wheelEvent,e)})})}},showWinInstructions:function(e,t,r){setTimeout((function(){new MessageBox({width:800,title:cur.winInstrTitle,hideButtons:!0,containerClass:"apps_win_instr_wrap"}).content(rs(trim(cur.winInstrTpl),{download_link:t,help_link:r})).show()}),500)},sendInstallRequest:function(e,t,r,n,o,i,a){var s=!!geByClass1("apps_install_header");if(e&&!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isButtonLocked)(e)&&!hasClass(e,"button_disabled")){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton)(e);var c=getSize(e),l=window.isAppLanding?"apps":this.address;if(t){var p={act:"send_install_request",aid:r,ref:n,cid:o,hash:i},_=/^\/app(\d+)_?(-\d+)?(#(.*))?$/.exec(location.pathname);_&&_.length>2&&parseInt(_[2],10)<0&&(p.group_id=Math.abs(parseInt(_[2]))),ajax.post(l,p,{onDone:function(){window.isAppLanding&&(ge("apps-landing-modal-trigger").checked=!0,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(e,"button__disabled"))},onFail:function(){window.isAppLanding&&(ge("apps-landing-modal-trigger-fail").checked=!0)},hideProgress:function(){var t=Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_install_push_sent_msg");Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton)(e),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(e,"button_disabled"),a||setStyle(e,"width",c[0]),!window.isAppLanding&&val(e,t);var r=ge("apps_i_run_box");Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(r,"sent"),val(r,t)}})}else cur.ref=n,ajax.post(this.address,{act:"send_install_request_box",aid:r},{onDone:function(t,o,i){if(Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton)(e),o){cur.lang||(cur.lang={}),extend(cur.lang,t);var a=new MessageBox({title:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_get_push_w_install_link")});a.removeButtons(),a.content(o),a.addButton(Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_install_sms_send"),function(t){if(e=ge("apps_i_request_btn")||e,t&&e&&!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isButtonLocked)(t)){var o=getSize(e);Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton)(t),ajax.post(this.address,{act:"send_install_request",ref:n,aid:r,cid:-3,hash:i},{onFail:function(e){if(e){var r=ge("app_sms_tt_error");val(r,e),show(r),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton)(t)}},onDone:function(){this.ttDestroyAll(),a.hide();var r=Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_install_push_sent_msg");Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton)(t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(e,"button_disabled"),s||setStyle(e,"width",o[0]),val(e,r);var n=ge("apps_i_run_box");Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(n,"sent"),val(n,r)}.bind(this)})}}.bind(this),"yes"),a.addButton(Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_cancel"),a.hide,"no"),a.show()}else Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showBox)("activation.php",{act:"change_phone_box",hash:i})}.bind(this)})}},deletingApp:!1,showInviteBox:function(e,t,r,n){e||(e=cur.app.options.aid,t=cur.app.options.hash),showTabbedBox("al_friends.php",{act:"select_friends_box",checked:"",invite:1,aid:e,from:"apps"},{stat:[jsc("web/privacy.js"),"ui_controls.js","ui_controls.css"],cache:1,params:{dark:1,onFail:()=>{n&&n()},onHideAttempt:e=>(!e&&n&&n({reason:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_29__.ERROR_REASONS.USER_DENIED,code:_shared_apps_connect_config__WEBPACK_IMPORTED_MODULE_29__.ERROR_CODES.USER_DENIED}),!0)}}),cur.onFlistSave=function(o){ajax.post("apps",{act:"invite_friends",aid:e,friends:o.join(","),hash:t},{onDone:function(e,t,n,o){setTimeout(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)({title:e},t).hide,2e3),r&&r({success:!0,notSentIds:o})},onFail:function(e){return setTimeout(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)({title:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_error")},e).hide,2e3),n&&n(),!0}})}},showAppFriends:function(e,t,r){var n=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showBox)(this.address,{act:"show_app_friends_box",aid:e},{cache:1,dark:1,params:{width:"400px",bodyStyle:"padding: 0px"},onDone:function(){new uiScroll("apps_friendslist")}},t);return n.setControlsText('<a href="" onclick="Apps.showInviteBox('+e+", '"+r+"'); return false;\">"+Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_invite_friends")+"</a>"),n},showMiniAppFriends:function(e,t,r){var n=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showBox)(this.address,{act:"show_mini_app_friends_box",app_id:e},{cache:1,dark:1,params:{width:"400px",bodyStyle:"padding: 0px",containerClass:"apps_catalog_popup_box_container"},onDone:function(){new uiScroll("apps_friendslist")}},t);return n.setControlsText(`<button class="flat_button secondary button_light" onclick="Apps.showInviteBox(${e}, '${r}'); return false;">${Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_invite_friends")}</button>`),n},recountAddVotes:function(e){var t=e.value.replace(/[^0-9]/g,"");val("add_votes",Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("votes_flex",t)),t>0&&ge("app_pay_withdraw")&&(ge("app_pay_withdraw").value=0,this.recountWithdrawVotes(ge("app_pay_withdraw")))},recountWithdrawVotes:function(e){var t=e.value.replace(/[^0-9]/g,"");val("withdraw_votes",Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("votes_flex",t)),t>0&&(ge("app_pay_add").value=0,this.recountAddVotes(ge("app_pay_add")))},initAppView:function(e,t){var r,n;t.layer||cur.nav.push((function(e,r,n,o){if(void 0===e[0]&&!e.join&&!o.pass){if(e["#"])return cur.app.onLocChanged(e["#"]),o.back?3!=vk.al&&nav.setLoc(n):nav.setLoc(n),!1;if(!t.not_block_nav)return nav.setLoc(n),!1}})),cur.app.params.is_vkpay_service&&(r=()=>{t.layer||cur.app.runCallback("onWindowBlur")},n=()=>{var e=window.innerWidth||document.documentElement.clientWidth||bodyNode.clientWidth,t=window.innerHeight||document.documentElement.clientHeight||bodyNode.clientHeight;cur.app.runCallback("onTopWindowResized",e,t),cur.app.setVkPayMobileHeight()},cur.app.setVkPayMobileHeight());var o=function(e){cur.app._lastFocusState!==e.type&&("block"==e.type?cur.app.runCallback("onWindowBlur"):cur.app.runCallback("onWindowFocus")),cur.app._lastFocusState=e.type};cur.app.onReady.push((function(){cur.app&&(cur.app.onLocChanged(e.hash),addEvent(document,"block unblock",o,!0),r&&addEvent(window,"mousedown",r),n&&addEvent(window,"resize",n),cur.destroy.push((function(){Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.removeEvent)(document,"block unblock",o),r&&Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.removeEvent)(window,"mousedown",r),n&&Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.removeEvent)(window,"resize",n)})))})),t.vkApp&&(this._initMytrackerStats(t),this.markAppAsOpened(t.aid,t.mark_app_as_opened_hash),this._cutTechnicalParamsFromUrl()),t.icon&&(setFavIcon(t.icon),cur.destroy.push((function(){setFavIcon("/images/favicon"+(vk.intnat?"_vk":"new")+window._iconAdd+".ico")}))),t.is_widescreen_mode&&("loading"===document.readyState?_web_apps_WideScreenMode__WEBPACK_IMPORTED_MODULE_27__.default.deferredInit():_web_apps_WideScreenMode__WEBPACK_IMPORTED_MODULE_27__.default.init()),t.show_flash_banner&&_web_apps_games_GamesFlashBanner__WEBPACK_IMPORTED_MODULE_28__.default.init(cur.app.cont,document.getElementById("apps")),this.initSimilarAppsSlider(),this.changeCheckBackUrl(),window.GamesCatalog&&window.GamesCatalog.initOnNavToCatalog()},initVkConnect:function(e,t,r,n,o){Object(_shared_apps_connect_lib__WEBPACK_IMPORTED_MODULE_24__.default)(e,t,r,n,o),window.hasOwnProperty("wkcur")&&wkcur._hide.push(cur.clearVKMiniAppsLayerPopups)},loadSettings:function(e){ajax.post(this.address,{act:"show_settings",aid:cur.aid},extend({cache:1},e))},showSettings:function(){this.ttHideAll(),cur.settShown?(Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_34__.scrollToTop)(200),cur.settShown=!1,delete ajaxCache["/apps#act=show_settings&aid="+cur.aid]):Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showBox)(this.address,{act:"show_settings",aid:cur.aid},{params:{dark:1}})},saveSettings:function(e,t,r,n){if(!cur.savingSettings){r||(n&&n.btn&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton)(n.btn),show("apps_settings_progress"));var o=curBox(),i=ge("app_pay_add"),a=ge("app_pay_withdraw"),s={act:"save_settings",aid:e,hash:t,from:"appview",app_settings_1:isChecked("app_settings_1"),app_settings_256:isChecked("app_settings_256"),add:i?i.value:0,withdraw:a?a.value:0,only_checkboxes:r?1:0,cur_aid:cur.aid};Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)("app_settings_2097152")&&(s.app_settings_2097152=isChecked("app_settings_2097152")),ajax.post("apps",s,extend({onDone:e=>{n&&n.btn&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton)(n.btn),e.left_nav&&this.updateLeftNav(e.left_nav),!r&&cur.app&&cur.app.runCallback("onSettingsChanged",e.settings),cur.settingsOnLoad=!1,void 0!==e.coins&&cur.app&&cur.app.balanceUpdated(e.coins),void 0!==e.balance&&Object(_web_lib_utils__WEBPACK_IMPORTED_MODULE_36__.updateMoney)(e.balance),o&&!r&&o.hide(),this.addToMenuErrorResolve(e,(function(e){r&&checkbox("app_settings_256",256&e.settings)})),this.updateAddToMenuAction()},onFail:function(e){e&&val("apps_settings_error",e),show("apps_settings_error"),hide("apps_settings_progress"),Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_34__.scrollToTop)(200)},showProgress:function(){cur.savingSettings=!0,o&&o.showProgress()},hideProgress:function(){cur.savingSettings=!1,o&&o.hideProgress()}},n||{}))}},updateAddToMenuAction(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=ge("app_add_to_menu_action");if(t&&cur.aid&&cur.app&&cur.app.options){var r={add:cur.app.options.vkApp?Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_vk_app_add_to_favourite"):Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_add_to_left_menu"),remove:cur.app.options.vkApp?Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_vk_app_remove_from_favourite"):Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_remove_from_left_menu")};e&&this.isAppInLeftMenu(e=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.actionsMenuItemLocked)(t)&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockActionsMenuItem)(t),t.setAttribute("onclick","return Apps.addToMenu("+cur.aid+", '"+cur.app.options.hash+"', "+intval(!e)+", this);"),val(t,e?r.remove:r.add)})}},isAppInLeftMenu(e,t){ajax.post("al_apps.php",{act:"is_in_left_menu",aid:cur.aid,hash:cur.app.options.hash},{onDone:t=>{var r=t.result;e&&e(r)},onFail:t})},addToMenu:function(e,t,r,n){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.actionsMenuItemLocked)(n)||this.addToMenuApi(e,t,r,n)},addToMenuApi:function(e,t,r,n,o,i){var a,s;ajax.post("al_apps.php",{act:"a_left_menu",aid:e,hash:t,show:r,layer:null===(a=cur.app)||void 0===a||null===(s=a.options)||void 0===s?void 0:s.layer},{onDone:e=>{this.updateLeftNav(e.left_nav),this.updateAddToMenuAction(),this.addToMenuErrorResolve(e),o&&o(e)},onFail:i,showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockActionsMenuItem.pbind(n),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockActionsMenuItem.pbind(n)})},vkAppNotifications:function(e,t,r,n){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.actionsMenuItemLocked)(n)||ajax.post("al_apps.php",{act:"vk_app_notifications",aid:e,hash:t,allow:r},{onDone:e=>{this.updateNotificationsAction(e)},showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockActionsMenuItem.pbind(n),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockActionsMenuItem.pbind(n)})},updateNotificationsAction:function(e){var t=ge("app_notifications_action");if(t&&cur.aid&&cur.app&&cur.app.options){var r=e,n={add:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_vk_app_notifications_action_enable"),remove:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_vk_app_notifications_action_disable")};Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.actionsMenuItemLocked)(t)&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockActionsMenuItem)(t),t.setAttribute("onclick","return Apps.vkAppNotifications("+cur.aid+", '"+cur.app.options.hash+"', "+intval(!r)+", this);"),val(t,r?n.remove:n.add)}},runFromFeed:e=>{e.preventDefault(),e.stopPropagation();var t=e.target.closest("._game-params");t&&Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.positive)(t.dataset.appId)&&AppsUtils.runFromInfoElement(t)},runFromFeedRowWrap:e=>{var t=e.querySelector("._game-params");t&&Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.positive)(t.dataset.appId)&&AppsUtils.runFromInfoElement(t)},runFromInfoElement:e=>{var t=e.dataset,r=t.appId,n=t.needInstall,o=t.ref,i=t.fromId,a=t.options,s=a?JSON.parse(a):null;return window.showApp(window.event,r,n,o,i,s)},addToMenuErrorResolve:function(e,t){e.left_nav_error?window.menuSettings&&cur.app?(cur.settingsBoxSetLeftMenuAppCallback=function(r){delete cur.settingsBoxSetLeftMenuAppCallback,!r||256&e.settings||(e.settings+=256),Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.isFunction)(t)&&t(e)},showTabbedBox("al_settings.php",{act:"menu_box",type:2,aid:cur.aid})):(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)({title:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_error")},e.left_nav_error),Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.isFunction)(t)&&t(e)):Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.isFunction)(t)&&t(e)},showAppSettings:function(e,t){this.ttHideAll(),t?Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showBox)(this.address,{act:"settings_box_info",aid:e},{params:{dark:1}}):Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showBox)(this.address,{act:"settings_box",aid:e,mask:0,main:1},{params:{dark:1}})},updateOnline:function(){ajax.post(this.address,{act:"update_online",aid:cur.aid,hash:cur.app.options.hash},{ads:1})},updateOffline:function(e){ajax.post(this.address,{act:"update_offline",aid:(e||cur).aid,hash:(e||cur).app.options.hash})},deleteApp:function(e,t,r,n){if(!this.deletingApp){this.deletingApp=!0;var o=cur.app.options.vkApp,i=o?"/services":"/apps?act=popular",a=window.location.pathname.startsWith("/services");cur.app&&cur.app.options&&o&&this.deleteVkApp();var s=function(r,n,o,i){var a,s;ajax.post(this.address,{act:"quit",id:e,hash:t||cur.app.options.hash,from:"app",layer:null===(a=cur.app)||void 0===a||null===(s=a.options)||void 0===s?void 0:s.layer},{onDone:this.withFastBackCheck(function(e){this.deletingApp=!1,window.appsListChanged=!0,this.notificationsSetCounters(e.count_all),e.left_nav&&this.updateLeftNav(e.left_nav),cur._back=!1,window.wkcur&&window.wkcur.shown&&WkView.hide(!1,!0),r.apply(null,[].slice.call(arguments))}.bind(this)),onFail:this.withFastBackCheck(function(){this.deletingApp=!1,n.apply(null,[].slice.call(arguments))}.bind(this)),showProgress:o,hideProgress:i})}.bind(this);switch(n){case"appactions":s((function(){a||nav.go(i,!1)}),(function(e){e&&Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)({title:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_error")},e),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockActionsMenuItem)(r)}),_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockActionsMenuItem.pbind(r));break;default:var c=curBox();s((function(){a||nav.go(i,!1)}),(function(e){if(e){var t=ge("apps_settings_error");val(t,e),show(t),Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_34__.scrollToTop)()}c&&c.hideProgress()}),(function(){c&&c.showProgress()}))}}},reportApp:function(e,t){var r,n;Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showBox)("al_reports.php",{act:"report_app_box",app_id:e,layer:null===(r=cur.app)||void 0===r||null===(n=r.options)||void 0===n?void 0:n.layer},{params:{dark:1},stat:["ui_controls.js","ui_controls.css"]})},cancelInstall:function(){nav.go("/apps",!1)},deleteVkApp:function(){var e=cur.app.options.aid,t=cur.app.options.layer&&ge(`app_${e}_container_layer`)?`app_${e}_container_layer`:`app_${e}_container`;cur.vkAppQueue[t]&&cur.vkAppQueue[t].destroyView(),delete cur.vkAppQueue[t]},approveInstall:function(e,t,r){r&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.actionsMenuItemLocked)(r)||(r&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockActionsMenuItem)(r),window.appsListChanged=1,cur.app&&cur.app.options&&cur.app.options.vkApp&&this.deleteVkApp(),nav.go(extend(nav.objLoc,{join:1,hash:e,sett:t,notify:isChecked("apps_notifications_checkbox")&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)("apps_notifications_checkbox")?1:void 0}),!1,{pass:!0}))},installApp:function(e,t,r){ajax.post(this.address,{act:"do_install",aid:e,hash:t},{onDone:e=>{e==cur&&(this.onAppAdded(),r&&r())}})},onAppAdded:function(){window.appsListChanged=!0,cur.preload&&delete cur.preload.before,cur.app&&(cur.app.runCallback("onApplicationAdded"),cur.appUser=!0,hide("apps_install_btn"),show("apps_show_settings"))},rateOver:function(e){var t=!!geByClass1("apps_install_header"),r=!!geByClass1("WideScreenAppPage"),n=!0,o=!1;cur.rated||hasClass(e,"not_installed")||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(e,"over");var i="",a=[],s=0,c=[cur.installPage?-70:-66,0,-36],l="left",p=15,_=0,d=cur.appUser?cur.userRate?Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_you_voted"):Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_you_not_voted"):Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_rating_title"),u=rs(cur.rateStatsLabelTpl,{label:d});for(var h in cur.rateStats=cur.rateStats||{},cur.rateStats)cur.rateStats.hasOwnProperty(h)&&(s+=intval(cur.rateStats[h]));val("app_rate_label",d);for(var f=1;f<=5;f++){i+='<span class="app_rate stats fl_r"></span>';var m=intval(cur.rateStats[f]),b=s?intval(100*m/s):0,E=langNumeric(m,"%s",!0),g=cur.userRate!=10*f&&cur.userRate?"":"my";a.push(rs(cur.rateStatsRowTpl,{id:"apps_rate_row"+f,stars:i,count:E,percent:b,classname:g}));var v=ge("apps_rate_row"+f);v&&(setStyle(geByClass1("app_rate_bg",v),{width:b+"%"}),val(geByClass1("app_rate_percent",v),b+"%"),val(geByClass1("app_rate_cnt",v),E),geByClass1("app_rate_stars",v).className="app_rate_stars fl_l "+g)}u+=a.reverse().join(""),t&&(l="top",c=[210,0,10],p=0,_=15),r&&(l="top",c=[3,10,100],p=0,_=15,n=!1,o=!0),Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_15__.showTooltip)(e,{text:u,slideX:p,slide:_,className:"app_rate_tt",shift:c,appendEl:window.bodyNode,forcetodown:n,forcetoup:o,dir:l,hasover:1})},rateOut:function(e){this.showRate(),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(e,"over")},rateApp:function(e){if(cur.rated)return!1;var t=ge("apps_ratings");cur.appRate=cur.userRate=e,this.rateOut(t),cur.rated=!0,ajax.post("/al_apps.php",{act:"rate_app",aid:cur.aid,rate:e,hash:cur.rate_hash},{onDone:e=>{cur.rateStats=e,this.rateOver(t)}})},showRate:function(e){if(cur.rated)return!1;var t=intval(cur.appRate||0),r=geByClass("app_rate",ge("apps_ratings")),n=Math.floor((t+2)/10),o=Math.floor((t+2)/5)-n;for(var i in r)if(r.hasOwnProperty(i)){var a="app_rate fl_l "+(i<n?"full":i<o?"half":"empty");r[i].className=a}if(e){var s=Math.floor(e/10);for(var c in r)if(r.hasOwnProperty(c)){if(c>=s)break;r[c].className+=" over"}}},recentTabsUpdate:function recentTabsUpdate(needApps,needNotifications){if(cur.rAppsWrap&&cur.rNotWrap){if(needApps=window.appsListChanged||needApps,needNotifications=window.notificationsListChanged||needNotifications,delete window.appsListChanged,delete window.notificationsListChanged,!needApps&&!needNotifications)return;ajax.post(this.address,{act:"update_recent",notifications:needNotifications,apps:needApps,hash:cur.recentUpdateHash},{onDone:this.withFastBackCheck(function(apps,notifications){if(apps&&(each(geByClass("apps_recent_row",cur.rAppsWrap),(function(e,t){re(t)})),apps[0]?(show(cur.rAppsShowMoreButton),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(cur.rAppsNoContent,"hidden_no_content"),domInsertBefore(cf(apps[0]),cur.rAppsShowMoreButton)):(hide(cur.rAppsShowMoreButton),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.rAppsNoContent,"hidden_no_content")),cur.recentOffset=apps[1],apps[2]))for(var i in apps[2]=eval("("+apps[2]+")"),apps[2])apps[2].hasOwnProperty(i)&&(cur.apps[apps[2][i][0]]=apps[2][i]);if(notifications){each(geByClass("apps_notification_row",cur.rNotWrap),(function(e,t){re(t)}));var tab=ge("apps-recent-notifications-tab");notifications[0]?((notifications[2]?hide:show)(cur.rNotShowMoreButton),show(tab),hide(cur.rNotNoContent),domInsertBefore(cf(notifications[0]),cur.rNotShowMoreButton)):(hide(cur.rNotShowMoreButton),show(cur.rNotNoContent),"notifications"!=nav.objLoc.tab&&hide(tab)),cur.notificationsOffset=notifications[1],cur.notificationsNewest=notifications[4],this.notificationsSetCounters(notifications[3]),this.notificationsInit()}this.ttDestroyAll()}.bind(this)),showProgress:()=>{needApps&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(cur.rAppsWrap,this.optionLoadingClass),needNotifications&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(domPN(cur.rNotWrap),this.optionLoadingClass)},hideProgress:this.withFastBackCheck(function(){needApps&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.rAppsWrap,this.optionLoadingClass),needNotifications&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(domPN(cur.rNotWrap),this.optionLoadingClass)}.bind(this))})}},optionNotificationsReadTimeout:1e3,notificationsReadTimeout:null,notificationsRemovedCount:0,notificationTabSelect:function(){nav.objLoc.tab="notifications",nav.setLoc(nav.objLoc),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.rNotBlackList,this.optionHiddenClass),cur.rNotScrollbar&&cur.rNotScrollbar.update(),this.notificationsReadContent()},notificationsInit:function(){cur.rNotWrap&&cur.notificationsOffset&&!cur.rNotScrollbar?(this.notificationsRemovedCount=0,cur.rNotScrollbar=new uiScroll(cur.rNotWrap,{autoresize:!1,global:!0,onmore:this.notificationsLoadContent.bind(this),onscroll:this.notificationsReadContent.bind(this)}),this.notificationsReadContent()):cur.rNotWrap&&cur.rNotScrollbar&&(cur.rNotScrollbar.update(),this.notificationsReadContent())},notificationsMarkReaded:function(e){e.removeAttribute("data-read"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(e,"apps_notification_row_new"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(e,"GamesCatalogFeed__rowWrap--new")},notificationsReadContent:function(){"notifications"===nav.objLoc.tab&&(this.notificationsReadTimeout&&clearTimeout(this.notificationsReadTimeout),this.notificationsReadTimeout=setTimeout(function(){var e=[],t=[];each(cur.rNotWrap.querySelectorAll('div[data-read="1"]'),(function(r,n){n.offsetTop+n.offsetHeight/2<=cur.rNotScrollbar.data.scrollTop+cur.rNotScrollbar.data.viewportHeight&&(e.push(n.getAttribute("data-id")),t.push(n))})),e.length&&ajax.post(this.address,{act:"a_mark",newest:cur.notificationsNewest,notif_ids:e.join(","),hash:cur.notificationsHash},{onDone:this.withFastBackCheck(function(e){this.notificationsSetCounters(e),each(t,function(e,t){this.notificationsMarkReaded(t)}.bind(this))}.bind(this))})}.bind(this),this.optionNotificationsReadTimeout))},notificationsLoadContent:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(cur.rNotShowMoreButton)&&!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isButtonLocked)(cur.rNotShowMoreButton)&&(Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton)(cur.rNotShowMoreButton),ajax.post(this.address,{act:"more_notifications",offset:cur.notificationsOffset,hash:cur.notificationsHash},{onDone:this.withFastBackCheck((function(e,t,r){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton)(cur.rNotShowMoreButton),cur.notificationsOffset=t,e&&cur.rNotShowMoreButton&&cur.rNotShowMoreButton.parentNode.insertBefore(cf(e),cur.rNotShowMoreButton),r&&hide(cur.rNotShowMoreButton),cur.rNotScrollbar&&cur.rNotScrollbar.update()})),onFail:this.withFastBackCheck((function(){hide(cur.rNotShowMoreButton)}))}))},notificationsRemoveAll:function(e,t,r,n,o){if(!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.linkLocked)(e)&&!Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.checkEvent)(o)){var i=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)({title:t},r,Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_delete"),function(t){ajax.post(this.address,{act:"remove_all_notifications_and_requests",newest:cur.notificationsNewest,hash:n},{onDone:this.withFastBackCheck(function(){each(geByClass("apps_notification_row",cur.rNotWrap),(function(e,t){re(t)})),hide(cur.rNotShowMoreButton),show(cur.rNotNoContent),this.notificationsSetCounters(0),cur.rNotScrollbar&&cur.rNotScrollbar.update()}.bind(this)),showProgress:function(){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton)(t),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockLink)(e)},hideProgress:this.withFastBackCheck((function(){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton)(t),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockLink)(e),i.hide()}))})}.bind(this),Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_cancel"));return!1}},notificationsSetCounters:function(e){if(void 0!==e&&(cur.notificationsNew=e,this.handlePageCount(e),cur.rNotCounter)){var t=e<1e3?e+"":".."+(e+"").substr(-3);e&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.rNotCounter,this.optionHiddenClass),e?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.rNotCounter,"ui_tab_count_hidden"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(cur.rNotCounter,"ui_tab_count_hidden"),Object(_web_lib_fx__WEBPACK_IMPORTED_MODULE_21__.animateCount)(cur.rNotCounter,t,{str:t,onDone:e?void 0:_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass.pbind(cur.rNotCounter,this.optionHiddenClass)})}},rejectRequest:function(e,t,r,n,o){if(e.stopPropagation(),!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isButtonLocked)(t)){var i=ge("apps_notification_"+r);this.notificationsMarkReaded(i),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(i,"html",i.innerHTML),setStyle(i,{minHeight:getSize(i)[1]}),ajax.post(this.address,{act:"reject_"+o,newest:cur.notificationsNewest,rid:r,hash:n},{onDone:this.withFastBackCheck(function(e,t,r){t=cf(trim(t)),this.notificationsRemovedCount++>1&&domFC(t).appendChild(cf(cur.notificationsRemoveAllTpl||"")),val(e,""),e.appendChild(t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(e,"apps_notification_service"),this.notificationsSetCounters(r),cur.rNotScrollbar&&cur.rNotScrollbar.update()}.bind(this,i)),showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton.pbind(t),hideProgress:this.withFastBackCheck(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton.pbind(t))}),cur.rNotScrollbar&&cur.rNotScrollbar.update(),cur.preload&&delete cur.preload.before}},requestsRestore:function(e,t,r,n){if(e.stopPropagation(),!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.linkLocked)(t)){var o=ge("apps_notification_"+r);ajax.post(this.address,{act:"request_restore",newest:cur.notificationsNewest,rid:r,hash:n},{onDone:this.withFastBackCheck(function(e,t){this.notificationsRemovedCount--,val(e,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(e,"html")),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(e,"apps_notification_service"),setStyle(e,{minHeight:""}),this.notificationsSetCounters(t),cur.rNotScrollbar&&cur.rNotScrollbar.update()}.bind(this,o)),showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockLink.pbind(t),hideProgress:this.withFastBackCheck(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockLink.pbind(t))}),cur.rNotScrollbar&&cur.rNotScrollbar.update(),cur.preload&&delete cur.preload.before}},deleteNotification:function(e,t,r,n,o){if(e.stopPropagation(),!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isButtonLocked)(t)){var i=ge("apps_notification_"+r);setStyle(i,{minHeight:getSize(i)[1]}),ajax.post(this.address,{act:"delete_notification",newest:cur.notificationsNewest,nid:r,aid:n,hash:o},{onDone:this.withFastBackCheck(function(e,t,r){t=cf(trim(t)),this.notificationsRemovedCount++>1&&domFC(t).appendChild(cf(cur.notificationsRemoveAllTpl||"")),val(e,""),e.appendChild(t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(e,"apps_notification_service"),this.notificationsSetCounters(r)}.bind(this,i)),showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton.pbind(t),hideProgress:this.withFastBackCheck(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton.pbind(t))})}},denyNotifications:function(e,t,r,n,o){if(e.stopPropagation(),!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.linkLocked)(t)){var i=ge("apps_notification_"+r);setStyle(i,{minHeight:getSize(i)[1]}),ajax.post(this.address,{act:"deny_notifications",aid:n,hash:o},{onDone:this.withFastBackCheck(function(e,t){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(e,"apps_notification_service"),t&&val(e,t)}.pbind(i)),showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockLink.pbind(t),hideProgress:this.withFastBackCheck(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockLink.pbind(t))})}},requestsBanUser:function(e,t,r,n,o){if(e.stopPropagation(),!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.linkLocked)(t)){var i=ge("apps_notification_"+r);setStyle(i,{minHeight:getSize(i)[1]}),ajax.post(this.address,{act:"request_ban_user",mid:n,hash:o},{onDone:this.withFastBackCheck(function(e,t){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(e,"apps_notification_service"),t&&val(e,t)}.pbind(i)),showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockLink.pbind(t),hideProgress:this.withFastBackCheck(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockLink.pbind(t))})}},removingApp:!1,restoringApp:!1,feedTabSelect:function(){delete nav.objLoc.tab,nav.setLoc(nav.objLoc),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(cur.rNotBlackList,this.optionHiddenClass),cur.fScrollbar&&cur.fScrollbar.update()},updateLeftNav:function(e){e&&val(geByTag1("ol",ge("side_bar")),e)},restoreApp:function(e,t,r){if(this.restoringApp)return!1;var n=ge("app"+e);return cur.deletedApps[e]&&"al_apps"==cur.deletedApps[e].from&&val(geByClass1("app_deleted_layer",n,"div"),cur.progressTpl),ajax.post(this.address,{act:"join",gid:cur.gid,gidhash:r,id:e,hash:t,restore:1,from:"al_apps",section:cur.section},{onDone:this.withFastBackCheck(function(t){cur.deletedApps[e]&&(val(n,cur.deletedApps[e].html),t.left_nav&&this.updateLeftNav(t.left_nav),delete cur.deletedApps[e]),cur.apps[e]&&(delete cur.apps[e].deleted,cur.appsIndex&&cur.appsIndex.add(cur.apps[e])),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(n,"deleted")}.bind(this)),showProgress:function(){this.restoringApp=!0,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(n,this.optionLoadingClass)}.bind(this),hideProgress:this.withFastBackCheck(function(){this.restoringApp=!1,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(n,this.optionLoadingClass)}.bind(this))}),!1},removeApp:function(e,t,r,n,o){if(n&&Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.cancelEvent)(n),this.removingApp)return!1;if(this.isDelayedOnSilentLoad("removeApp"+e,this.removeApp.bind(this,e,t,r)))return!1;this.ttDestroyAll();var i=r?ge("recent"+e):ge("app"+e),a=i&&cur.lContent&&cur.lContent.contains(i)&&this.isSection("settings")?"settings":r?"recent":"al_apps";if(cur.isGamesCatalogRedesign)window.GamesCatalog.removeApp(e);else{var s=function(){var r;"al_apps"==a&&(r=i&&geByClass1("app_deleted_layer",i,"div"),val(r,cur.progressTpl)),ajax.post(this.address,{act:"quit",gid:cur.gid,id:e,hash:t,offset:cur.recentOffset,from:a},{onDone:this.withFastBackCheck(function(t){"apps"==cur.module&&(delete cur.preload,cur.rNotWrap&&this.isSection("catalog","list")?this.recentTabsUpdate(!1,!0):(window.notificationsListChanged=!0,t.count_all&&this.notificationsSetCounters(t.count_all)),window.appsListChanged=!0,cur.apps[e]&&(cur.appsIndex&&cur.appsIndex.remove(cur.apps[e]),cur.apps[e].deleted=!0),t.left_nav&&this.updateLeftNav(t.left_nav),"settings"==a?(cur.deletedApps[e]={from:a,html:i.innerHTML},i&&i.appendChild(cf(t.html))):"recent"==a?(hide(i),geByClass1("apps_recent_row",cur.rAppsWrap)?cur.recentOffset+=t.offset:(hide(cur.rAppsShowMoreButton),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.rAppsNoContent,"hidden_no_content"),cur.recentOffset=0)):(cur.deletedApps[e]={from:a,html:i.innerHTML},t.html&&val(r,t.html)),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(i,"deleted"))}.bind(this)),showProgress:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(i,this.optionLoadingClass),this.removingApp=!0}.bind(this),hideProgress:this.withFastBackCheck(function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(i,this.optionLoadingClass),this.removingApp=!1}.bind(this))})}.bind(this);if("recent"==a)var c=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)({title:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_quit_app_box_title")},Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)(o?"apps_game_quit_confirm":"apps_quit_confirm"),Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_remove"),(function(){s(),c.hide()}),Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_cancel"));else if(cur.adminApps&&cur.adminApps[e])var l=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)({title:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_deletingapp")},Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_admin_quit"),Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_delete"),(function(){s(),l.hide()}),Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_cancel"));else s()}},runApp:function(e,t,r,n,o,i,a,s){if(!vk.id)return Object(_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_31__.showDoneBox)(cur.pleaseSignInLang),!1;Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton)(e);var c=clone(nav.objLoc);delete c.w,nav.setLoc(c),window.appsListChanged=1;var l="/"+t+"?join=1&hash="+r+"&sett="+n;if(a&&(l="/"+t+"?act=embed&join=1&join_hash="+r+"&sett="+n+"&hash="+s),cur.fromInstallBox&&(l+="&from_install="+(1==cur.fromInstallBox?1:2)),o)if(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.isObject)(o))for(var p in o)"w"!=p&&(l+="&"+p+"="+o[p]);else""!=o&&(l+="&ref="+o);i&&(l+="&mid="+i),nav.objLoc["#"]&&(l+="#"+nav.objLoc["#"]),a&&(location.href=l),cur.isGamesCatalogRedesign&&window.GamesCatalog&&window.GamesCatalog.nav&&(window.GamesCatalog.nav.clear(_web_apps_games_catalog_nav__WEBPACK_IMPORTED_MODULE_32__.SECTION_INSTALLED),window.GamesCatalog.nav.clear(_web_apps_games_catalog_nav__WEBPACK_IMPORTED_MODULE_32__.SECTION_PROFILE)),nav.go(l)},myAppOver:function(e,t,r,n){if(hasClass(t,"deleted")||!vk.id)return!1;if(window.cur.isGamesCatalogRedesign)return n=n||t.dataset.ref,void _web_apps_games_catalog_tooltip__WEBPACK_IMPORTED_MODULE_30__.default.show(t,e,n,+t.dataset.genreId,+t.dataset.collectionId);var o=!!t.dataset.forcetoup,i=!!t.dataset.forcetodown;Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_15__.showTooltip)(t,{url:this.address,params:{act:"show_app_friends_tt",aid:e,no_size:r?1:0},typeClass:"tt_black",slide:15,center:1,forcetoup:o,forcetodown:i,shift:[0,8,8],ajaxdt:200,showdt:300,hidedt:200,dir:"auto"})},ttScore:function(e,t,r){var n=void 0;return cur.ttScoreShown&&window.tooltips&&(tooltips.hideAll(),n=0),Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_15__.showTooltip)(e,{center:1,black:1,shift:[0,8,8],showsp:n,text:'<div class="apps_score_tt_cont"><b>'.concat(t,"</b>",r?'<div class="apps_score_tt">'+r+"</div>":"","</div>")})},ttCommon:function(e,t,r){return 0===(r=extend({parent:void 0,center:void 0,event:0,appendEl:void 0,shift:void 0},r)).event&&(r.event=window.event),r.event&&Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.cancelEvent)(r.event),r.appendEl&&(r.appendEl=ge(r.appendEl)),r.center?Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_15__.showTooltip)(e,{center:r.center,shift:r.shift||[0,8,8],black:1,appendEl:r.appendEl,text:t}):showTitle(e,t,r.shift,r)},ttHideAll:function(){window.tooltips&&tooltips.hideAll()},ttDestroyAll:function(){window.tooltips&&tooltips.destroyAll()},scrollToHeader:function(){var e=ge("apps_header_block"),t=scrollNode.scrollTop,r=getSize("page_header_cont")[1];if(e){var n=Math.max(0,getXY(e)[1]-parseInt(getStyle(e,"marginTop"),10));t+(vk.staticheader?Math.max(0,r-t):r)>n&&Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_34__.scrollToY)(n,200)}},scrollToSearch:function(){var e=scrollNode.scrollTop,t=getSize("page_header_cont")[1];if(cur.aSearchWrap){var r=getXY(domPN(cur.aSearchWrap))[1];e+(vk.staticheader?Math.max(0,t-e):t)>r&&Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_34__.scrollToY)(r,200)}},scrollCheck:function(){!cur.isGamesCatalogRedesign&&this.isDelayedOnSilentLoad("scrollCheck",this.scrollCheck.bind(this))||!_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.mobile&&!cur.isAppsLoading&&!cur.disableAutoMore&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(cur.lShowMoreButton)&&(window.innerHeight||document.documentElement.clientHeight||bodyNode.clientHeight)+scrollGetY()+400>=cur.lShowMoreButton.offsetTop&&this.searchLoadContent()},searchFocusedClass:"apps_search_focused",backupListContent:function(e){if(cur.backupList||e){if(cur.backupList&&!cur.backupList.contentCopied&&e){for(cur.backupList.content=document.createDocumentFragment();cur.lContent.firstChild;)cur.backupList.content.appendChild(cur.lContent.firstChild);for(cur.backupList.preload=document.createDocumentFragment();cur.lPreload.firstChild;)cur.backupList.content.appendChild(cur.lPreload.firstChild);cur.backupList.contentCopied=!0}}else cur.backupList={cur:{loadMore:cur.loadMore,shownApps:cur.shownApps,sectionCount:cur.sectionCount,searchOffset:cur.searchOffset},content:null,preload:null,contentCopied:!1}},restoreListContent:function(){return cur.backupList?(this.searchProgress(!1),val(cur.lContent,""),val(cur.lPreload,""),extend(cur,cur.backupList.cur),cur.lContent.appendChild(cur.backupList.content),cur.lPreload.appendChild(cur.backupList.preload),delete cur.backupList,!0):(delete cur.backupList,!1)},indexAll:function(e){cur.appsIndex=new vkIndexer(cur.appsList.all,(function(e){try{return cur.apps[parseInt(e[0])]=e,e[3]}catch(e){return""}}),e)},searchUpdate:function(e){if(!this.isDelayedOnSilentLoad("searchUpdate",this.searchUpdate.bind(this,e))){((e=e||"").length<2||cur.previewTagsStr)&&(e="");var t=cur.previewTagsStr||Object.keys(cur.searchTags||{}).join(",");if(cur.ignoreEqual||cur.searchStr!==e||t!==cur.searchTagsStr){this.isSection("list")&&e&&this.backupListContent(),cur.searchStr=e||"",cur.searchTagsStr=t;var r=this.isSection("apps","settings","admined","manage","admin_requests","reports","ads"),n=r?"all":"search";if(e&&r){var o=cur.appsIndex.search(clean(e));cur.curList=n+"_search_"+e+"_"+cur.searchTagsStr,cur.appsList[cur.curList]=o,e+=" "+(Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.parseLatin)(e)||""),e=trim(escapeRE(e).split("&").join("&amp;")),cur.selection={re:new RegExp("("+e.replace(cur.appsIndex.delimiter,"|")+")","gi"),val:"<span>$1</span>"}}else cur.curList=n,cur.selection=!1;this.ttHideAll(),this.searchProgress(!0),this.scrollToSearch(),hide(cur.lShowMoreButton),this.isSection("catalog","list")&&this.searchWriteToAddressBar(),cur.loadMore=1,cur.shownApps=cur.searchOffset=0,this.showRows()}delete cur.ignoreEqual}},showRows:function(){if(!this.isDelayedOnSilentLoad("showRows",this.showRows.bind(this))){if(cur.searchStr||cur.searchTagsStr)this.isSection("list","catalog")&&this.searchLoadContent();else{if(this.isSection("list"))return this.restoreListContent()||(extend(cur,{searchOffset:0,sectionCount:0,shownApps:0,loadMore:0}),this.searchCatalog(cur.searchStr,cur.searchOffset)),window[cur.loadMore?"show":"hide"](cur.lShowMoreButton),!1;if(this.isSection("catalog"))return extend(cur,{searchOffset:0,sectionCount:0,shownApps:0,loadMore:0}),val(cur.lContent,""),val(cur.lPreload,""),this.switchLayout("catalog"),this.searchProgress(!1),this.sliderStart(),window[cur.loadMore?"show":"hide"](cur.lShowMoreButton),!1}if(this.isSection("settings","manage","admined","admin_requests","apps","reports","ads")){if(cur.defaultCount&&cur.shownApps<cur.sectionCount){var e=clean(cur.searchStr),t=this.isSection("manage","admined","admin_requests"),r="",n=cur.appsList[cur.curList]||[],o=n.length;if((n=this.filter(n.slice(cur.shownApps)).slice(0,cur.defaultCount)).length&&cur.appTpl){var i=[];each(n,(function(e,r){r=clone(r),cur.selection&&(r[3]=r[3].replace(cur.selection.re,cur.selection.val)),i.push(cur.appTpl(r,e==n.length-1,t))})),r=i.join("")}if(cur.shownApps?r&&cur.lContent.appendChild(cf(r)):r?(val(cur.lContent,r),val(cur.aSummaryCounter,o)):(val(cur.lContent,cur.aSummary.innerHTML.replace("{query}","<b>"+e+"</b>")),val(cur.aSummaryCounter,"")),cur.shownApps+=cur.defaultCount,cur.shownApps>=cur.sectionCount?hide(cur.lShowMoreButton):(show(cur.lShowMoreButton),this.scrollCheck()),cur.searchStr&&!cur.searchOffset&&this.isSection("apps","manage","admined")){var a=this.isSection("apps")?_web_lib_stats__WEBPACK_IMPORTED_MODULE_19__.serviceAppsList:_web_lib_stats__WEBPACK_IMPORTED_MODULE_19__.serviceManage;Object(_web_lib_stats__WEBPACK_IMPORTED_MODULE_19__.saveSearchAttemptStats)(a,0,n.length,e)}this.searchProgress(!1)}return!1}return!0}},searchLoadContent:function(){if(this.isSection("catalog","list")){if(cur.searchStr||(cur.searchStr=""),cur.lPreload.innerHTML){for(var e=document.createDocumentFragment();cur.lPreload.firstChild;)e.appendChild(cur.lPreload.firstChild);cur.lContent.appendChild(e)}return cur.loadMore?this.searchCatalog(cur.searchStr,cur.searchOffset):(cur.loadMore=!0,hide(cur.lShowMoreButton)),!1}return!this.isSection("apps","manage","admined","admin_requests","settings","reports","ads")||this.showRows()},searchCatalog:function(e,t){e=e||"";var r=cur.searchTagsStr,n=+new Date;ajax.post(this.address,{act:e||r||!this.isSection("list")?"search":cur.list,q:e,offset:t,oid:cur.oid,from:cur.section,catalog_search:1,id:cur.listId||void 0,tags:r},{cache:e||cur.searchTagsStr?0:1,onDone:this.withFastBackCheck(function(o,i,a){if(e==cur.searchStr&&r==cur.searchTagsStr&&(this.isSection("catalog","list")&&((cur.searchStr||r)&&this.sliderStop(),this.switchLayout(cur.searchStr||r?"list":cur.section),this.searchWriteToAddressBar()),this.backupListContent(!0),o&&val(cur.lContent,o),val(cur.lPreload,i||""),cur.loadMore=!!i,extend(cur,a),cur.loadMore&&show(cur.lShowMoreButton),this.scrollCheck(),e&&!t)){var s=this.isSection("catalog","list")?_web_lib_stats__WEBPACK_IMPORTED_MODULE_19__.serviceApps:"manage"===cur.section||"admined"===cur.section?_web_lib_stats__WEBPACK_IMPORTED_MODULE_19__.serviceAppsManage:_web_lib_stats__WEBPACK_IMPORTED_MODULE_19__.serviceAppsList;Object(_web_lib_stats__WEBPACK_IMPORTED_MODULE_19__.saveSearchAttemptStats)(s,n,a.count,e)}}.bind(this)),showProgress:function(){cur.isAppsLoading=!0,Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton)(cur.lShowMoreButton)},hideProgress:this.withFastBackCheck(function(){cur.isAppsLoading=!1,this.searchProgress(!1),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton)(cur.lShowMoreButton)}.bind(this))})},filter:function(e){for(var t=e.length,r=[],n=0;n<t;n++){var o=e[n];cur.apps&&cur.apps[o[0]]&&!cur.apps[o[0]].deleted&&r.push(o)}return r},searchLoadFromAddressBar:function(){setTimeout(()=>{cur.searchStr=nav.objLoc.q||"",cur.searchStr&&Object(_web_lib_stats__WEBPACK_IMPORTED_MODULE_19__.saveSearchAttemptStats)(_web_lib_stats__WEBPACK_IMPORTED_MODULE_19__.serviceApps,0,cur.shownApps,cur.searchStr)},0)},searchWriteToAddressBar:function(e){nav.setLoc(extend(nav.objLoc,{q:cur.searchStr||null,tags:cur.searchTagsStr||null}))},searchProgress:function(e){cur.aSearch&&_web_legacy_ui_ui_search__WEBPACK_IMPORTED_MODULE_35__.default[e?"showProgress":"hideProgress"](cur.aSearch)},searchFocused:function(){cur.aWrap&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(cur.aWrap,this.searchFocusedClass)},searchBlured:function(){cur.aWrap&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.aWrap,this.searchFocusedClass)},searchReset:function(){cur.aSearch&&_web_legacy_ui_ui_search__WEBPACK_IMPORTED_MODULE_35__.default.reset(cur.aSearch),cur.searchStr=""},switchLayout:function(e){cur.aWrap&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.aWrap,"apps_catalog_layout"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.aWrap,"apps_list_layout"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.aWrap,"apps_manage_layout"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.aWrap,"apps_admin_requests_layout"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.aWrap,"apps_settings_layout"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.aWrap,"apps_apps_layout"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClass)(cur.aWrap,"apps_page_layout"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(cur.aWrap,"apps_"+e+"_layout"))},geTabBySection:function(e,t){var r=ge("apps_tab_"+e+(t?"_"+t:""));return!(!r||!(r=geByTag1("a",r)))&&r},setHistoryBackRules:function(){this.isSection("manage","admined","admin_requests")||(cur._back={show:[function(){if(cur._back.swap&&each(cur._back.swap,(function(e,t){t.dummy.parentNode.replaceChild(t.content,t.dummy)})),cur.fScrollbar&&cur.fScrollbar.scrollTop(cur.fScrollbar.data.scrollTop),cur.rNotScrollbar&&cur.rNotScrollbar.scrollTop(cur.rNotScrollbar.data.scrollTop),delete cur._back.swap,setTimeout(function(){cur.aSearch&&(_web_legacy_ui_ui_search__WEBPACK_IMPORTED_MODULE_35__.default["list"===cur.section?"setFixed":"setStatic"](cur.aSearch),_web_legacy_ui_ui_search__WEBPACK_IMPORTED_MODULE_35__.default.startEvents(cur.aSearch),cur.aSearch.value=cur.searchStr||"",_web_legacy_ui_ui_search__WEBPACK_IMPORTED_MODULE_35__.default.scrollResize(cur.aSearch)),this.searchWriteToAddressBar(cur.searchStr)}.bind(this),0),this.ttHideAll(),this.recentTabsUpdate(),this.startEvents(),cur.aTabs){var e=this.geTabBySection(this.isSection("list")?cur.list+(cur.listId||""):cur.section);e&&uiTabs.switchTab(e),uiTabs.hideProgress(cur.aTabs)}if(cur.aSubTabs){var t=this.geTabBySection(cur.section,cur.subsection);t&&uiTabs.switchTab(t),uiTabs.hideProgress(cur.aSubTabs)}}.bind(this)],hide:[this.stopEvents.bind(this),this.ttHideAll.bind(this)],text:cur.backLang})},switchTab:function(){},sliderInit:function(){"catalog"!=cur.section||cur.featuredSlider||(cur.featuredSlider=new _web_apps_games_catalog_slider__WEBPACK_IMPORTED_MODULE_33__.default({inner:"apps_featured_slides",outer:"apps_featured_slider",next:"apps_featured_next",prev:"apps_featured_prev",onSlide:function(){window.AdsLight&&AdsLight.applyAds()}}))},sliderStart:function(){cur.featuredSlider&&(cur.featuredSlider.slideshowStart(),cur.featuredSlider.addHandler())},sliderStop:function(){cur.featuredSlider&&(cur.featuredSlider.removeHandler(),cur.featuredSlider.slideshowStop())},addToMineGroups:function(e,t,r,n){var o={act:"add_to_mine_group_box",aid:e,hash:t,height:lastWindowHeight,from_gid:n};r&&(o.source=r),Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showBox)("apps",o,{params:{dark:1,width:570,bodyStyle:"padding: 22px 0 0"}})},makeAppSlider:function(e){return new _web_apps_games_catalog_slider__WEBPACK_IMPORTED_MODULE_33__.default(e)},closeExternalApp:function(){cur.app.clientRpc&&cur.app.clientRpc.callMethod("closeExternalApp")},adminRequestRow:function(e){var t="",r=_slicedToArray(e,6),n=r[0],o=r[1],i=r[2],a=r[3],s=r[4],c=r[5];if(s=intval(s),o=`<img src="${o}"/>`,i)if("away.php"==i.substr(0,8)){var l=i.replace(/&/g,"&amp;");a=`<a href="${i}" target="_blank" rel="nofollow noopener" onclick="return goAway('${l}')">${a}</a>`,o=`<a href="${i}" target="_blank" rel="nofollow noopener" onclick="return goAway('${l}')">${o}</a>`}else a=`<a href="${i}">${a}</a>`,o=`<a href="${i}">${o}</a>`;return cur.adminRequest&&void 0!==cur.adminRequest[n]?null!==cur.adminRequest&&(t=cur.adminRequest[n]?Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_admin_request_accepted"):Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_admin_request_declined")):t=`<a onclick='Apps.adminRequestAccept(this, ${n}, "${c}")'>${Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_admin_request_accept")}</a> | <a onclick='Apps.adminRequestDecline(this, ${n}, "${c}")'>${Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_admin_request_decline")}</a>`,rs(cur.rowTpl,{id:n,name:a,img:o,info:`<div class="apps_settings_size">${s?Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_X_participants",s,!0):Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("apps_noparticipants")}</div>`,actions:t})},adminRequestAccept:function(e,t,r){var n=gpeByClass("_app_settings_actions",e);n&&!cur.adminRequestProcess&&(cur.adminRequestProcess=!0,ajax.post("al_apps_edit.php",{act:"a_accept_admin_request",aid:t,hash:r},{onDone:function(e,r,o){cur.adminRequest||(cur.adminRequest={}),cur.adminRequest[t]=o,val(n,e),r&&Object(_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_31__.showDoneBox)(r)},hideProgress:function(){cur.adminRequestProcess=!1}}))},adminRequestDecline:function(e,t,r){var n=gpeByClass("_app_settings_actions",e);n&&!cur.adminRequestProcess&&(cur.adminRequestProcess=!0,ajax.post("al_apps_edit.php",{act:"a_decline_admin_request",aid:t,hash:r},{onDone:function(e,r,o){cur.adminRequest||(cur.adminRequest={}),cur.adminRequest[t]=o,val(n,e),r&&Object(_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_31__.showDoneBox)(r)},hideProgress:function(){cur.adminRequestProcess=!1}}))},share:function(e,t){var r,n;Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showBox)("like.php",{act:"publish_box",object:"app"+e+"_"+t,layer:null===(r=cur.app)||void 0===r||null===(n=r.options)||void 0===n?void 0:n.layer})},qrCodeModal:function(){var e;cur.qrModal||(cur.qrModal=new _shared_apps_connect_libs_QRCodeModal__WEBPACK_IMPORTED_MODULE_23__.default),window.wkcur&&window.wkcur.shown&&(e=ge("wk_layer_wrap")),cur.qrModal.init(e),cur.qrModal.toggle()},unverifiedGoBack:function(){return window.history.back(),!1},initUnverifiedRunScreen:function(){if(window.globalHistory&&window.globalHistory.length){var e=geByClass1("apps_unverifiedAppWarning__btn_back");e&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.addClass)(e,"apps_unverifiedAppWarning__btn_active")}},runUnverified:function(e,t){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton)(e),nav.setLoc(extend(nav.objLoc,{run_hash:t})),nav.reload()},addAppQrCode:function(e){var t=geByClass1("apps_install_header__qr"),r=`${location.origin}/app${e}${location.hash}`,n=_vkontakte_vk_qr__WEBPACK_IMPORTED_MODULE_25__.createQR(r,120,"",{isShowLogo:!0});t&&(t.innerHTML=n)},showHint:function(e,t,r){return Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.cancelEvent)(t),r=r||{},r=extend({dir:"bottom",shift:[12,8],appendEl:document.body,width:200},r),Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_15__.showHint)(e,r)},hideVkPayPromoBanner:function(e){window.tooltips&&window.tooltips.hideAll(),re(document.querySelector(".apps_vkPayPromo")),ajax.post("/apps",{act:"hide_vkpay_banner",hash:e})},openVkPayGamesMarket:e=>(Object(_web_lib_stats__WEBPACK_IMPORTED_MODULE_19__.statlogsValueEvent)("apps_catalog_vkpay_games_store_button",1),!0),changeCheckBackUrl:()=>{if(window.nav.objLoc&&cur.aid===ID_APP_CHECKBACK){var e=window.nav.objLoc[0];"check"!==e&&e!=="app"+ID_APP_CHECKBACK||(nav.objLoc[0]="checkback",window.nav.setLoc(nav.objLoc))}},showPaymentsBox:e=>{if(!Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.checkEvent)(e))return Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.cancelEvent)(e),_web_gifts_gifts__WEBPACK_IMPORTED_MODULE_39__.Gifts.showGetMoneyBox(),!1},searchToggle:()=>{var e=document.querySelector("#apps_search"),t=document.querySelector("#s_search");e&&window.cur&&(cur.catalogSearchShown=+!e.classList.toggle("SearchToggle__hide")),t&&t.focus()},openPlayAtHomeLanding:e=>{if("A"!==e.target.tagName)return showWiki({w:"play_safe_at_home",ref:"challenge_landing_banner"})},addIcon(){window._iconAdd||(window._iconAdd=window.devicePixelRatio>=2?"_2x":"")},scrollToY:_web_lib_scroll__WEBPACK_IMPORTED_MODULE_34__.scrollToY,_initMytrackerStats(e){if(e.vk_app_url){var t=Object(_shared_apps_utils__WEBPACK_IMPORTED_MODULE_38__.extractVkAppQueryParams)(e.vk_app_url,!1);Object(_shared_counters_tmr__WEBPACK_IMPORTED_MODULE_37__.tmrTrackMiniAppOpen)(String(e.aid),t)}var r=!1,n=()=>{r||(Object(_shared_counters_tmr__WEBPACK_IMPORTED_MODULE_37__.tmrTrackMiniAppClose)(String(e.aid)),r=!0)};if(e.layer&&wkcur){var o=wkcur.onHide;wkcur.onHide=()=>{Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.isFunction)(o)&&o(),n()}}window.addEventListener("beforeunload",n),cur.destroy.push((function(){window.removeEventListener("beforeunload",n),n()}))},markAppAsOpened:(e,t)=>{window.vk&&window.vk.id&&ajax.post("/al_apps.php",{act:"mark_app_as_opened",app_id:e,hash:t})},_cutTechnicalParamsFromUrl:()=>{var e=_extends({},nav.objLoc);delete e.fragment,window.nav.setLoc(e)},removeFortuneRedPoint:e=>{var t=document.querySelector("#l_fortune");t&&t.classList.contains("AppLeftMenuWithNotify")&&(t.classList.remove("AppLeftMenuWithNotify"),ajax.post("/al_apps.php",{act:"fortune_red_point_was_displayed",hash:e},{onFail:()=>{var e=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)({title:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_error")},Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_error_occured"),Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_16__.getLang)("global_close"));setTimeout(e.hide,2e3)}}))}};function detectUnityWebPlayer(e,t){var r,n=function(e,t){var r=0,n=0,o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("object",{type:"application/vnd.unity"},{visibility:"hidden"});window.bodyNode.appendChild(o),function i(){if(void 0===o.GetPluginVersion)n++<10?setTimeout(i,10):(window.bodyNode.removeChild(o),e(null));else{var a={};if(t)for(r=0;r<t.length;++r)a[t[r]]=o.GetUnityVersion(t[r]);a.plugin=o.GetPluginVersion(),window.bodyNode.removeChild(o),e(a)}}()},o=function(e){var t,r,n,o,i,a=0;if(e){var s=e.toLowerCase().match(/^(\d+)(?:\.(\d+)(?:\.(\d+)([dabfr])?(\d+)?)?)?$/);s&&s[1]&&(t=s[1],r=s[2]?s[2]:0,n=s[3]?s[3]:0,o=s[4]?s[4]:"r",i=s[5]?s[5]:0,a|=t/10%10<<28,a|=t%10<<24,a|=r%10<<20,a|=n%10<<16,a|={d:8192,a:16384,b:24576,f:32768,r:32768}[o],a|=i/100%10<<8,a|=i/10%10<<4,a|=i%10)}return a},i=!1;if(navigator.plugins.refresh(),void 0!==navigator.plugins&&navigator.plugins["Unity Player"]&&void 0!==navigator.mimeTypes&&navigator.mimeTypes["application/vnd.unity"]&&navigator.mimeTypes["application/vnd.unity"].enabledPlugin){if(i=!0,_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.safari&&/Mac OS X 10_6/.test(navigator.appVersion))return void n((function(t){t&&t.plugin||(i=!1),e(i,t)}),t);if(_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.mac&&_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.chrome)return void n((function(t){t&&o(t.plugin)<=o("2.6.1f3")&&(i=!1),e(i,t)}),t);if(t)return void n((function(t){e(i,t)}),t)}else if(_web_lib_browser__WEBPACK_IMPORTED_MODULE_20__.browser.msie){var a=!1;try{null!=ActiveXObject.prototype&&(a=!0)}catch(e){}if(a&&(!/win64/i.test(navigator.userAgent)||!/x64/i.test(navigator.userAgent)))try{var s=new ActiveXObject("UnityWebPlayer.UnityWebPlayer.1"),c=s.GetPluginVersion();if(t){r={};for(var l=0;l<t.length;++l)r[t[l]]=s.GetUnityVersion(t[l]);r.plugin=c}if(i=!0,"2.5.0f5"==c){var p=/Windows NT \d+\.\d+/.exec(navigator.userAgent);if(p&&p.length>0)parseFloat(p[0].split(" ")[2])>=6&&(i=!1)}}catch(e){}}e(i,r)}__webpack_exports__.default=AppsUtils},FEd1:function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o.set(t.debug);var r,n=l({limit:void 0,filter:function(){return!0},groupBy:function(){return null},undoType:i.ActionTypes.UNDO,redoType:i.ActionTypes.REDO,jumpToPastType:i.ActionTypes.JUMP_TO_PAST,jumpToFutureType:i.ActionTypes.JUMP_TO_FUTURE,jumpType:i.ActionTypes.JUMP,neverSkipReducer:!1,ignoreInitialState:!1,syncFilter:!1},t,{initTypes:(0,a.parseActions)(t.initTypes,["@@redux-undo/INIT"]),clearHistoryType:(0,a.parseActions)(t.clearHistoryType,[i.ActionTypes.CLEAR_HISTORY])}),s=n.neverSkipReducer?function(t,r){for(var n=arguments.length,o=new Array(n>2?n-2:0),i=2;i<n;i++)o[i-2]=arguments[i];return l({},t,{present:e.apply(void 0,[t.present,r].concat(o))})}:function(e){return e};return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o.start(i,t);for(var c,l=t,p=arguments.length,_=new Array(p>2?p-2:0),E=2;E<p;E++)_[E-2]=arguments[E];if(!r){if(o.log("history is uninitialized"),void 0===t){var g={type:"@@redux-undo/CREATE_HISTORY"},v=e.apply(void 0,[t,g].concat(_));return l=d(v,n.ignoreInitialState),o.log("do not set initialState on probe actions"),o.end(l),l}(0,a.isHistory)(t)?(l=r=n.ignoreInitialState?t:(0,a.newHistory)(t.past,t.present,t.future),o.log("initialHistory initialized: initialState is a history",r)):(l=r=d(t,n.ignoreInitialState),o.log("initialHistory initialized: initialState is not a history",r))}switch(i.type){case void 0:return l;case n.undoType:return c=m(l,-1),o.log("perform undo"),o.end(c),s.apply(void 0,[c,i].concat(_));case n.redoType:return c=m(l,1),o.log("perform redo"),o.end(c),s.apply(void 0,[c,i].concat(_));case n.jumpToPastType:return c=f(l,i.index),o.log("perform jumpToPast to ".concat(i.index)),o.end(c),s.apply(void 0,[c,i].concat(_));case n.jumpToFutureType:return c=h(l,i.index),o.log("perform jumpToFuture to ".concat(i.index)),o.end(c),s.apply(void 0,[c,i].concat(_));case n.jumpType:return c=m(l,i.index),o.log("perform jump to ".concat(i.index)),o.end(c),s.apply(void 0,[c,i].concat(_));case b(i.type,n.clearHistoryType):return c=d(l.present,n.ignoreInitialState),o.log("perform clearHistory"),o.end(c),s.apply(void 0,[c,i].concat(_));default:if(c=e.apply(void 0,[l.present,i].concat(_)),n.initTypes.some((function(e){return e===i.type})))return o.log("reset history due to init action"),o.end(r),r;if(l._latestUnfiltered===c)return l;var O="function"==typeof n.filter&&!n.filter(i,c,l);if(O){var w=(0,a.newHistory)(l.past,c,l.future,l.group);return n.syncFilter||(w._latestUnfiltered=l._latestUnfiltered),o.log("filter ignored action, not storing it in past"),o.end(w),w}var y=n.groupBy(i,c,l);if(null!=y&&y===l.group){var A=(0,a.newHistory)(l.past,c,l.future,l.group);return o.log("groupBy grouped the action with the previous action"),o.end(A),A}return l=u(l,c,n.limit,y),o.log("inserted new state into history"),o.end(l),l}}};var o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==n(e)&&"function"!=typeof e)return{default:e};var t=s();if(t&&t.has(e))return t.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var a=o?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(r,i,a):r[i]=e[i]}r.default=e,t&&t.set(e,r);return r}(r("Hh3O")),i=r("1VNw"),a=r("9O7i");function s(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return s=function(){return e},e}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){p(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function d(e,t){var r=(0,a.newHistory)([],e,[]);return t&&(r._latestUnfiltered=null),r}function u(e,t,r,n){var i=e.past.length+1;o.log("inserting",t),o.log("new free: ",r-i);var s=e.past,c=e._latestUnfiltered,l=r&&r<=i,p=s.slice(l?1:0),d=null!=c?[].concat(_(p),[c]):p;return(0,a.newHistory)(d,t,[],n)}function h(e,t){if(t<0||t>=e.future.length)return e;var r=e.past,n=e.future,o=e._latestUnfiltered,i=[].concat(_(r),[o],_(n.slice(0,t))),s=n[t],c=n.slice(t+1);return(0,a.newHistory)(i,s,c)}function f(e,t){if(t<0||t>=e.past.length)return e;var r=e.past,n=e.future,o=e._latestUnfiltered,i=r.slice(0,t),s=[].concat(_(r.slice(t+1)),[o],_(n)),c=r[t];return(0,a.newHistory)(i,c,s)}function m(e,t){return t>0?h(e,t-1):t<0?f(e,e.past.length+t):e}function b(e,t){return t.indexOf(e)>-1?e:!e}},HDq7:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return o}));var n=["GamesFlashBanner--step1","GamesFlashBanner--step2","GamesFlashBanner--step3"];class o{static init(e,t){var r=window.document.getElementById("GamesFlashBanner");r.classList.add("GamesFlashBanner--visible"),e&&e.classList.add("apps_hidden"),t&&t.classList.add("GamesFlashBanner__pageWrap"),r.addEventListener("click",e=>{if(e.target&&e.target.classList.contains("GamesFlashBanner__flashInstallBtn")&&!e.metaKey&&!e.ctrlKey){n.forEach(e=>{r.classList.remove(e)});var t=e.target.dataset.gotostep;r.classList.add(n[t-1])}})}}},Hh3O:function(e,t,r){"use strict";function n(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var o,i;Object.defineProperty(t,"__esModule",{value:!0}),t.set=function(e){o=e},t.start=function(e,t){void(i={header:[],prev:[],action:[],next:[],msgs:[]}),o&&(console.group?(i.header=["%credux-undo","font-style: italic","action",e.type],i.action=l("action",s,e),i.prev=l("prev history",a,t)):(i.header=["redux-undo action",e.type],i.action=["action",e],i.prev=["prev history",t]))},t.end=function(e){o&&(console.group?i.next=l("next history",c,e):i.next=["next history",e],function(){var e=i,t=e.header,r=e.prev,o=e.next,a=e.action,s=e.msgs;if(console.group){var c,l,p,_,d;(c=console).groupCollapsed.apply(c,n(t)),(l=console).log.apply(l,n(r)),(p=console).log.apply(p,n(a)),(_=console).log.apply(_,n(o)),(d=console).log.apply(d,n(s)),console.groupEnd()}else{var u,h,f,m,b;(u=console).log.apply(u,n(t)),(h=console).log.apply(h,n(r)),(f=console).log.apply(f,n(a)),(m=console).log.apply(m,n(o)),(b=console).log.apply(b,n(s))}}())},t.log=function(){if(o){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];i.msgs=i.msgs.concat([].concat(t,["\n"]))}};var a="#9E9E9E",s="#03A9F4",c="#4CAF50";function l(e,t,r){return["%c".concat(e),"color: ".concat(t,"; font-weight: bold"),r]}},JX7q:function(e,t,r){"use strict";function n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}r.r(t),r.d(t,"default",(function(){return n}))},QLaP:function(e,t,r){"use strict";e.exports=function(e,t,r,n,o,i,a,s){if(!e){var c;if(void 0===t)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[r,n,o,i,a,s],p=0;(c=new Error(t.replace(/%s/g,(function(){return l[p++]})))).name="Invariant Violation"}throw c.framesToPop=1,c}}},SLVX:function(e,t,r){"use strict";function n(e){var t,r=e.Symbol;return"function"==typeof r?r.observable?t=r.observable:(t=r("observable"),r.observable=t):t="@@observable",t}r.r(t),r.d(t,"default",(function(){return n}))},TOwV:function(e,t,r){"use strict";e.exports=r("qT12")},UlUB:function(e,t,r){"use strict";function n(e,t){var r,n,o=!1;return function i(){if(o)return r=arguments,void(n=this);e.apply(this,arguments),o=!0,setTimeout((function(){o=!1,r&&(i.apply(n,r),r=n=null)}),t)}}r.r(t),r.d(t,"throttle",(function(){return n}))},WPHA:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return w}));r("rGqo"),r("rE2o"),r("ioFf"),r("a1Th"),r("Btvt"),r("HEwt");var n=r("D1OX"),o=r("EasH"),i=r("4+be"),a=r("zxIV"),s=r("kcIO"),c=r("FWc3"),l=r("v+DW"),p=r("t7n3"),_=r("qJhe"),d=r("bKAG");var u=r("59zB"),h=r("k487"),f=r("Egk5"),m=r("BJj/"),b=r("jE6c"),E=Object(a.clientHeight)();class g{constructor(){this.scrollEl=null,this.offset=0,this.contentEl=null,this.allLoaded=!1,this.loading=!1,this.scrollHandler=null}init(){this.offset=20,this.allLoaded=!1,this.scrollEl=window.wkLayerWrap,this.contentEl=document.querySelector(".wk_wiki_content"),this.scrollHandler=()=>{this._onScroll()},addEvent(this.scrollEl,"scroll",this.scrollHandler),this.initDestroy()}initDestroy(){window.cur=window.cur||{},window.cur.destroy=window.cur.destroy||[],window.cur.destroy.push(()=>{this.destroy()});var e=window.wkcur.onHide;window.wkcur.onHide=()=>{Object(b.isFunction)(e)&&e(),this.destroy()}}destroy(){removeEvent(this.scrollEl,"scroll",this.scrollHandler)}_loadMore(){if(!this.allLoaded&&!this.loading){this.loading=!0;var e=Object(a.ce)("div",{className:"GamesGiftsLoader",id:"gifts_loader"});Object(l.showProgress)(e),this.contentEl.appendChild(e),ajax.post("/apps",{act:"gifts_friends_wish_list_more",offset:this.offset},{onDone:(t,r)=>{this.loading=!1,Object(a.re)(e),t?(this.offset=r,this.contentEl.insertAdjacentHTML("beforeend",t),window.cur.GameGifts&&window.cur.GameGifts.initGallery()):(this.allLoaded=!0,removeEvent(this.scrollEl,"scroll",this.scrollHandler))}})}}_onScroll(){return Object(m.debounce)(()=>{E>=this.scrollEl.scrollHeight-this.scrollEl.scrollTop-Object(a.clientHeight)()&&this._loadMore()},20)()}}function v(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return O(e,t)}(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,i=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){a=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(a)throw o}}}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}class w{static isEnabled(){return!0}static defineGamesGifts(){w.isEnabled()&&(window.cur=window.cur||{},window.cur.GameGifts=new w,window.cur.GiftsFriendsWishListLoader=new g)}constructor(){this.receiverId=0,this.boxWrap=null,this.giftBox=null,this.tooltipHash=""}initGallery(){var e,t=v(document.querySelectorAll(".ui_gallery"));try{for(t.s();!(e=t.n()).done;){var r=e.value;new n.UIGallery(r,{scrollY:!1,markOutside:!0})}}catch(e){t.e(e)}finally{t.f()}}init(e,t){this.initGallery(),e&&(this.tooltipHash=t,this.showFeatureToolTip())}showTooltip(e){var t=e.dataset.title;Object(c.showTitle)(e,t,[0,8],{center:1,appendEl:document.body})}showSendGiftBox(e,t,r,n){return"button"===e.tagName.toLowerCase()&&this.disableBtn(e),Object(o.showBox)("/apps",{act:"game_gifts_show_send_box",recipient_id:t,gift_id:r,hash:n},{params:{width:450,onHide:()=>{"button"===e.tagName.toLowerCase()&&this.enableBtn(e)}}}),!1}disableBtn(e){e.classList.add("GameGifts__giftItem--BtnDisabled"),e.disabled=!0}enableBtn(e){e.disabled=!1,e.classList.remove("GameGifts__giftItem--BtnDisabled")}showFriendsDropBox(e,t){var r=document.querySelector(".GameGifts__giftBox--dropBox");new Dropdown(r,e,{big:1,multiselect:!1,width:400,autocomplete:!0,selectedItems:t||void 0,noResult:Object(i.getLang)("apps_game_gifts_box_friends_not_found"),introText:Object(i.getLang)("apps_game_gifts_box_friends_placeholder"),placeholder:Object(i.getLang)("apps_game_gifts_box_friends_placeholder"),withIcons:!0,onChange:e=>{this.giftBox&&(e?this.enableBtn(this.giftBox.btns.ok[0]):this.disableBtn(this.giftBox.btns.ok[0])),this.receiverId=e}})}sendGift(e,t,r,n,a){var s=Object(l.isChecked)("GameGifts__giftBox--nonameInput");Object(o.showBox)("/apps",{act:"show_order_box",aid:t,hash:r,receiver_id:this.receiverId,item:n,type:"item",gift_hash:a,is_gift:1,is_anonymous_gift:Object(p.intval)(s),gift_id:e},{params:{dark:1,onDestroy:()=>{this.hideSendGiftBox()}},onFail:e=>(Object(o.showFastBox)({title:Object(i.getLang)("global_error")},e),!0)})}removeItemFromWishList(e){var t=Array.from(document.querySelectorAll(".GameGifts__giftItem")).length,r=Object(a.domCA)(e,".GameGifts__giftItem"),n=Object(a.domCA)(e,".GameGifts__gameItem");if(r&&(t--,Object(a.re)(r),n.querySelector(".GameGifts__giftItem")||Object(a.re)(n),!t)){var o=document.querySelector(".wk_wiki_content");Object(a.re)(document.querySelector(".GameGifts__gameItem")),o.insertAdjacentHTML("beforeend",`\n              <div class="GameGiftsLayer__empty">\n                <div class="GameGiftsLayer__emptyMessage">${Object(i.getLang)("apps_game_gifts_empty_wish_list")}</div>\n              </div>\n            `)}}toggleWishList(e,t,r,n,o){Object(f.cancelEvent)(t),this.featureToooltip&&this.hideFeatureTooltip(),window.tooltips&&window.tooltips.hideAll(),e.classList.toggle("GameGifts__giftItemFavorite--isFavorite"),e.classList.contains("GameGifts__giftItemFavorite--isFavorite")?(Object(s.showDoneBox)(Object(i.getLang)("apps_game_gifts_added_to_wish_list"),{timeout:2e3}),e.dataset.title=Object(i.getLang)("apps_game_gifts_favorite_delete")):(e.dataset.title=Object(i.getLang)("apps_game_gifts_favorite_add"),Object(s.showDoneBox)(Object(i.getLang)("apps_game_gifts_removed_from_wish_list"),{timeout:2e3}),o&&this.removeItemFromWishList(e)),ajax.post("/apps",{act:"gifts_toggle_wish_list",hash:n,gift_id:r})}initSendGiftBox(e,t,r,n,o,a,s){this.boxWrap=document.querySelector(".GameGifts__giftBox--wrap"),this.showFriendsDropBox(a,s),this.giftBox=curBox(),this.giftBox.removeButtons(),this.giftBox.removeButtons(),this.receiverId=s,this.giftBox.addButton(Object(i.getLang)("apps_game_gifts_box_send"),()=>{this.receiverId?this.sendGift(e,t,r,n,o):Object(l.notaBene)(this.boxWrap.querySelector(".selector_input"))}),this.giftBox.addButton(Object(i.getLang)("global_cancel"),null,"no"),this.receiverId||this.disableBtn(this.giftBox.btns.ok[0])}share(e,t,r,n){return class{static share(e,t,r,n){ajax.post("/apps",{act:"gifts_get_story_share_data",gift_id:t,sender_id:+n,hash:r,share_type:e},{onDone:e=>{_.StoryPublisher.init({entrypoint:d.StoryEntryPoint.MINI_APP,photoUrl:e.image_url,attachment:{type:"url",text:"learn_more",url:e.link},stickers:[{sticker_type:"native",sticker:{action_type:"text",action:{text:e.message,style:"marker",selection_color:"#fff"},transform:{gravity:"center",rotation:0,relation_width:.9,translation_x:0,translation_y:.01}}},{sticker_type:"native",sticker:{action_type:"text",action:{text:e.additional_message,style:"marker",selection_color:"#fff"},transform:{gravity:"center",rotation:0,relation_width:.5,translation_x:0,translation_y:.3}}}]})},onFail:()=>(Object(o.showFastBox)(getLang("global_error"),getLang("global_error")),!0)})}}.share(e,t,r,n),!1}hideSendGiftBox(){setTimeout(()=>{this.giftBox&&this.giftBox.hide()},0)}loadMoreUsersWithGift(e,t,r){if(t.data.scrollBottom-200<=0&&!t.loading&&t.hasMore){var n=document.querySelector("#users-with-gift-list");if(!n)return;var o=n.querySelector(".ui_scroll_content");if(!o)return;t.loading=!0,ajax.post("/apps",{act:"gifts_users_with_gift_more",gift_id:e,offset:t.dataOffset,only_friends:Object(p.intval)(r)},{onDone:(e,r,n)=>{t.loading=!1,e&&o.insertAdjacentHTML("beforeend",e),t.dataOffset=n,t.hasMore=r},onFail:()=>{t.loading=!1}})}}hideFeatureTooltip(e){Object(f.cancelEvent)(e),this.featureToooltip&&(this.featureToooltip.hide(),ajax.post("/al_index.php",{act:"hide_feature_tt",type:"games_gifts_favorites",hash:this.tooltipHash}))}showFeatureToolTip(){var e=document.querySelector(".GameGifts__giftItemFavorite ");this.featureToooltip&&this.featureToooltip.destroy(),this.featureToooltip=new h.default(e,{autoShow:!1,content:'<div class="feature_intro_tt_hide" onclick="cur.GameGifts.hideFeatureTooltip(event);"></div>'+Object(i.getLang)("apps_game_gifts_feature_tt"),appendToParent:!0,cls:"feature_intro_tt GamesGiftsFeatureTooltip",offset:[1,-4],onHide:()=>{e.classList.remove("GameGifts__giftItemFavorite--focused"),this.featureToooltip&&this.featureToooltip.destroy()},onShow:()=>{e.classList.add("GameGifts__giftItemFavorite--focused"),ajax.post("/al_index.php",{act:"show_feature_tt",type:"games_gifts_favorites",hash:this.tooltipHash})}}),setTimeout(()=>{this.featureToooltip.show()},500)}showUsersWithGiftBox(e,t){return!Object(o.showBox)("/apps",{act:"gifts_users_with_gift_box",gift_id:e,only_friends:Object(p.intval)(t)},{params:{width:500},containerClass:"GamesFriendsWithGiftBox",cache:1,onDone:(r,n)=>{var o={};n.has_more&&(o.onupdate=r=>{this.loadMoreUsersWithGift(e,r,t)});var i=new u.default("users-with-gift-list",o);i.dataOffset=n.new_offset,i.hasMore=n.has_more}})}}},WRIt:function(e,t,r){"use strict";r.r(t);var n=r("jE6c"),o=function(e){if(this.options=extend({inner:null,outer:null,next:null,prev:null,infinite:!0,slideshowDuration:4e3,animationDuration:500,isVkApp:!1},e||{}),this.required=null,this.current=null,this.slideNext=null,this.slidePrev=null,this.slideCurrent=null,this.hasVideoSlides=!1,this.videoPlayer=null,this._handlerInst=null,this._arrowNextHandler=null,this._arrowPrevtHandler=null,this.options.outer&&this.options.inner&&(this.outer=ge(this.options.outer),this.inner=ge(this.options.inner),this.outer&&this.inner)){if(this.slideshow=!1,this.animation={stop:function(){}},this.slideshowTimeout=null,this.interacted=!1,this.slides=domChildren(this.inner),this.options.infinite){if(!this.slides.length)return void re(this.outer);if(this.slides.length<3)for(var t=null,r=0;this.slides.length<4;)t=this.slides[r++].cloneNode(!0),this.slides.push(t),this.inner.appendChild(t)}(this.arrowNext=ge(this.options.next))&&(this._arrowNextHandler=this.next.bind(this),addEvent(this.arrowNext,"mousedown",this._arrowNextHandler)),(this.arrowPrev=ge(this.options.prev))&&(this._arrowPrevtHandler=this.prev.bind(this),addEvent(this.arrowPrev,"mousedown",this._arrowPrevtHandler)),this.inited=!1,this.init()}};o.prototype={init:function(){if(void 0!==this.inited)return!!this.inited||(0!==this.outer.offsetWidth&&0!==this.slides[0].offsetWidth?(this.widthOuter=this.outer.offsetWidth,this.widthInner=this.inner.offsetWidth,this.widthSlide=this.widthInner/this.slides.length,this.offsetInner=this.inner.offsetLeft,this.widthSide=(this.widthOuter-this.widthSlide)/2,this.indexNext=this.slides.length-1,this.indexPrev=0,this.indexMargin=(this.slides.length-1)/2|0,this.indexRequired=this.indexCurrent=this.getIndex(),this.highlight(),this.rearrange(),this._initVideoSlides(),this.slideshow&&!this.slideshowTimeout&&this.slideshowStart(),this.inited=!0):void 0)},highlight:function(){this.slideHighlighted&&(removeClass(this.slideHighlighted,"selected"),this.slideHighlighted=null,this.indexHighlighted=null),this.indexHighlighted!==this.indexCurrent&&(this.indexHighlighted=this.indexCurrent,this.slideHighlighted=this.slides[this.getIndex(this.indexCurrent)],addClass(this.slideHighlighted,"selected"))},handler:function(e){var t=e.target&&(e.target===this.outer||this.outer.contains(e.target));this.interacted!=t&&(this.interacted=t,t?(this.slideshowInterrupted=this.slideshow,this.slideshowStop()):(this.slideshow=this.slideshowInterrupted,this.slideshow&&this.slideshowStart()))},slideshowStart:function(){this.slideshow=!0,this.interacted||this._videosIsPlay||(this.slideshowStop(),this.slideshow=!0,this.slideshowTimeout=setTimeout(function(){this.slideshowTimeout=null,vk.rtl?this.indexRequired--:this.indexRequired++,this.serve()}.bind(this),this.options.slideshowDuration))},slideshowStop:function(){this.slideshow=!1,this.slideshowTimeout&&(clearTimeout(this.slideshowTimeout),this.slideshowTimeout=null)},addHandler:function(){this.init()&&(this.removeHandler(),this._handlerInst=this.handler.bind(this),addEvent(document,"mousemove",this._handlerInst))},removeHandler:function(){this._handlerInst&&removeEvent(document,"mousemove",this._handlerInst)},removeAllHandlers:function(){this.removeHandler(),this._arrowNextHandler&&removeEvent(this.arrowNext,"mousemove",this._arrowNextHandler),this._arrowPrevtHandler&&removeEvent(this.arrowPrev,"mousemove",this._arrowPrevtHandler)},requireIndex:function(e){this.indexRequired=this.getIndex(e||0),this.serve()},next:function(){if(this.init()){if(!this.options.infinite&&this.indexRequired>=this.slides.length-1)return;this.indexRequired++,this.serve()}},last:function(){this.indexRequired=this.slides.length-1,this.serve()},prev:function(){if(this.init()){if(!this.options.infinite&&this.indexRequired<1)return;this.indexRequired--,this.serve()}},getIndex:function(e,t){return void 0!==e?(e=e%this.slides.length+(e<0?this.slides.length:0))===this.slides.length?0:e:(e=(this.offsetInner-this.widthSide)/-this.widthSlide,t?e:Math.round(e))},serve:function(){if(this.init()){var e=this.getIndex(this.indexRequired),t=this.required!=e,r=-(this.indexRequired*this.widthSlide-(this.widthOuter-this.widthSlide)/2);this.required=e,t&&Object(n.isFunction)(this.options.onRequired)&&this.options.onRequired(),this.options.infinite||(this.indexRequired=this.required),this.animation.stop(),this.animation=new Fx.Base({style:{}},{duration:this.options.animationDuration,transition:Fx.Transitions.easeOutCubic,onComplete:this.served.bind(this),onStep:function(e){this.offsetInner=e.left,setStyle(this.inner,"left",this.offsetInner);var t=this.indexCurrent;this.indexCurrent=this.getIndex(),t!==this.indexCurrent&&(this.indexCurrent===this.indexRequired&&this.highlight(),this.rearrange(),Object(n.isFunction)(this.options.onChange)&&this.options.onChange())}.bind(this)}),this.animation.start({left:this.offsetInner},{left:r})}},served:function(){var e=this.indexCurrent-this.getIndex(this.indexCurrent);e>30&&(this.indexPrev=0,this.indexNext=this.slides.length-1,this.indexCurrent-=e,this.indexRequired-=e,this.offsetInner=-(this.indexRequired*this.widthSlide-(this.widthOuter-this.widthSlide)/2),this.inner.style.left=this.offsetInner+"px",each(this.slides,(function(e,t){t.style.left=0}))),this.hasVideoSlides&&this._serveVideoSlide(),this.rearrange(),Object(n.isFunction)(this.options.onSlide)&&this.options.onSlide(),this.slideshow&&this.slideshowStart()},rearrange:function(){if(this.options.infinite){for(;this.indexCurrent>=this.indexNext-this.indexMargin;){var e=this.getIndex(this.indexNext);this.slides[e].style.left=(this.indexNext-e)*this.widthSlide+"px",this.indexNext++,this.indexPrev++}for(;this.indexCurrent<=this.indexPrev+this.indexMargin;){var t=this.getIndex(this.indexPrev);this.slides[t].style.left=(this.indexPrev-t)*this.widthSlide+"px",this.indexPrev--,this.indexNext--}}this.current=this.getIndex(this.indexCurrent),this.slideNext=this.slides[this.options.infinite?this.getIndex(this.indexCurrent+1):this.indexCurrent+1]||null,this.slidePrev=this.slides[this.options.infinite?this.getIndex(this.indexCurrent-1):this.indexCurrent-1]||null,this.slideCurrent=this.slides[this.current]},update:function(){this.inited=!1,this.slides=domChildren(this.inner),this.init()},destroy:function(){this.slideshowStop(),this.removeAllHandlers(),this.hasVideoSlides=!1},getCurrentSlide:function(){return this.slides[this.current]},_initVideoSlides:function(){var e=this;each(this.slides,(function(){if(domData(this,"video"))return e.hasVideoSlides=!0,!1})),e.hasVideoSlides&&(this._preloadVideos(),this._serveVideoSlide())},_isPreloadedVideo:function(e){var t=!1;return each(ajaxCache,(function(r,n){if(0==r.indexOf("/al_video.php?act=show_inline")&&r.indexOf("&video="+e)>0)return t=!0,!1})),t},_onVideoPreloaded:function(e,t){if(e&&t[3]&&t[3].player){var r=t[3].player.params[0];VideoPlayer.preload(r)}},_preloadVideos:function(){var e=this;each(this.slides,(function(){if(domData(this,"video")){var t=e._getVideoParams(this);e._isPreloadedVideo(t.video)||loadInlineVideo(t,e._onVideoPreloaded,!0)}}))},_onVideoStop:function(){this._videosIsPlay=!1,this.interacted=!1,this.slideshowStart()},_onVideoStart:function(){this._videosIsPlay=!0,this.interacted=!0,this.slideshowStop()},_onVideoLoaded:function(e,t){this.videoPlayer=t,t.on("media.playing",function(){this.getCurrentSlide()===e?this._onVideoStart():(t.seekTo(0),t.pause())}.bind(this)),t.on("media.ended",function(){this._onVideoStop(),this.next()}.bind(this)),t.on("media.error",function(){this._onVideoStop(),this.next()}.bind(this)),t.on("media.pause",this._onVideoStop.bind(this)),t.on("_destroy",this._onVideoStop.bind(this))},_getVideoParams:function(e){return{video:domData(e,"video"),list:domData(e,"hash"),autoplay:1,from_autoplay:1,module:"apps_slider",addParams:{from_autoplay:1},no_progress:1,cache:1}},_serveVideoSlide:function(){var e,t,r,n,o=this.getCurrentSlide();domData(o,"video")?(e=geByTag1("img",o),t=domData(e,"loading"),r=domData(e,"playing"),t||r?this._canUseVideo()&&this.videoPlayer&&this.videoPlayer.play():((n=this._getVideoParams(o)).onLoaded=this._onVideoLoaded.bind(this,o),this._canUseVideo()&&showInlineVideo(n.video,n.list,n,!1,e))):this._canUseVideo()&&this.videoPlayer&&this.videoPlayer.pause()},_canUseVideo:function(){var e=window.wkcur&&window.wkcur.shown&&window.wkLayerWrap&&isVisible(window.wkLayerWrap)||window.Videoview.isLayerShown();if(e)return!1;var t=cur.videoInlinePlayer?cur.videoInlinePlayer.getState():"unknown",r=~["paused","ended"].indexOf(t);return!cur.videoInlinePlayer||cur.videoInlinePlayer===this.videoPlayer||r&&!e}},t.default=o},aJgW:function(e,t,r){"use strict";r.r(t),r.d(t,"ColorSchemeMode",(function(){return n})),r.d(t,"ColorSchemeName",(function(){return o})),r.d(t,"ColorScheme",(function(){return s})),r.d(t,"colorScheme",(function(){return a}));var n,o,i=r("J8bf");!function(e){e.Light="light",e.Dark="dark",e.Auto="auto"}(n||(n={})),function(e){e.Dark="space_gray",e.Light="bright_light"}(o||(o={}));var a,s=function(){function e(){this.currentMode="",this.subscribers=[],this.initSubscribers=[],this.isExecuted=!1,this.isModeSavingAllowed=!0,this.isSchemeSavingAllowed=!0}return e.prototype.init=function(t){var r=this;this.isExecuted||(this.schemesMap=t.schemesMap,this.setMode(t.mode),this.initSubscribers.forEach((function(e){e()})),e.isSchemesAutoSwitchingSupported()&&(window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(function(e){r.currentMode===n.Auto&&r.setScheme(e.matches)})),this.isExecuted=!0))},e.prototype.setScheme=function(t){e.isSchemesSupported()&&(this.applyScheme(document.body,t?o.Dark:o.Light),this.currentIsDark=t,this.isSchemeSavingAllowed&&Object(i.setCookie)("remixdark_color_scheme",Number(t),365),this.subscribers.forEach((function(e){e()})))},e.prototype.isDarkScheme=function(){return this.currentIsDark},e.prototype.getMode=function(){return this.currentMode},e.prototype.setMode=function(t){this.currentMode=t;var r=!1;switch(t){case n.Light:r=!1;break;case n.Dark:r=!0;break;case n.Auto:if(e.isSchemesAutoSwitchingSupported())r=window.matchMedia("(prefers-color-scheme: dark)").matches}this.setScheme(r),this.isModeSavingAllowed&&Object(i.setCookie)("remixcolor_scheme_mode",t,365)},e.prototype.applyScheme=function(e,t){var r,n=(null===(r=this.schemesMap)||void 0===r?void 0:r[t])||t;e.setAttribute("scheme",n)},e.prototype.subscribe=function(e){var t=this;return this.subscribers.push(e),function(){t.subscribers=t.subscribers.filter((function(t){return e!==t}))}},e.prototype.onInit=function(e){var t=this;return this.initSubscribers.push(e),function(){t.initSubscribers=t.initSubscribers.filter((function(t){return e!==t}))}},e.isSchemesSupported=function(){return window.isNewMail&&window.CSS&&CSS.supports&&CSS.supports("color","var(--custom-property)")},e.isSchemesAutoSwitchingSupported=function(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme)").matches},e}();a=window.colorScheme?window.colorScheme:new s,window.colorScheme=a,window.isSchemesSupported=s.isSchemesSupported.bind(null)},"aYW+":function(e,t,r){"use strict";r.r(t);var n=r("WPHA"),o=r("5Hok"),i=r("Egk5"),a=r("v+DW"),s=r("EasH"),c=r("kcIO"),l=r("4+be");class p{static downloadDistributive(e,t,r,n){var o=n.currentTarget;Object(i.cancelEvent)(n),Object(a.isButtonLocked)(o)||(Object(a.lockButton)(o),ajax.post("/al_apps.php",{act:"download_distributive",ref_id:t,hash:r,app_id:e},{onDone:e=>{Object(a.unlockButton)(o),o&&o.classList.add("button_disabled"),e.url&&(location.href=e.url),e.callback_message_box&&new MessageBox({width:800,title:e.callback_message_box.title,hideButtons:!0,containerClass:"apps_win_instr_wrap"}).content(e.callback_message_box.content).show()},onFail:e=>{Object(c.showDoneBox)(e),Object(a.unlockButton)(o)}}))}static showAllPaidGames(e){Object(a.isButtonLocked)(e)||(Object(a.lockButton)(e),ajax.post("/al_apps.php",{act:"paid_downloaded_games"},{onDone:t=>{var r=document.querySelector(".DownloadedGamesList--paidGames .DownloadedGamesList__content");e&&e.remove(),r&&r.insertAdjacentHTML("beforeend",t)},onFail:()=>{Object(a.unlockButton)(e)}}))}static buyDownloadedGame(e,t,r){var n=e.currentTarget;if(!n)return!1;Object(i.cancelEvent)(e),Object(a.isButtonLocked)(n)||(Object(a.lockButton)(n),Object(s.showBox)("al_payments.php",{act:"card_payment_box",type:"game_purchase",game_id:t},{onDone:e=>{e.onSuccessCompleteOrder=()=>{p.updateDownloadedGameButton(t,n,r)},Object(a.unlockButton)(n)},onFail:()=>{Object(a.unlockButton)(n),Object(c.showDoneBox)(Object(l.getLang)("apps_fail_pay_downloaded_game"))}}))}static updateDownloadedGameButton(e,t,r){Object(a.isButtonLocked)(t)||(Object(a.lockButton)(t),ajax.post("/al_apps.php",{act:"downloaded_game_button",ref_id:r,app_id:e},{onDone:r=>{r.res?(t.outerHTML=r.html||"",window.showApp&&r.need_show_box_game&&window.showApp(window.event,e,1),Object(a.unlockButton)(t)):Object(a.unlockButton)(t)},onFail:()=>{Object(a.unlockButton)(t)}}))}static tryShowTooltip(e,t){if(t)return window.Apps&&window.Apps.ttCommon(e,t)}}var _=r("F+Y4");window.vkApp=o.default,window.DownloadedGames=p,window.Apps=window.Apps||_.default,window.Apps.addIcon&&window.Apps.addIcon(),n.default.defineGamesGifts();try{window.stManager.done(window.jsc("web/apps.js"))}catch(e){}},bCCX:function(e,t,r){"use strict";r.r(t),function(e,n){var o,i=r("SLVX");o="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:n;var a=Object(i.default)(o);t.default=a}.call(this,r("yLpj"),r("3UD+")(e))},bKAG:function(e,t,r){"use strict";r.r(t),r.d(t,"MAX_STORY_VIDEO_DURATION",(function(){return l})),r.d(t,"StoryType",(function(){return n})),r.d(t,"StoryEntryPoint",(function(){return o})),r.d(t,"StorySource",(function(){return i})),r.d(t,"getStoryUploadUrl",(function(){return p})),r.d(t,"uploadStoryBlobToServer",(function(){return _})),r.d(t,"saveStoryOnServer",(function(){return d}));var n,o,i,a=r("jE6c"),s=r("PU8N"),c=function(){return(c=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},l=16;function p(e){return new Promise((function(t,r){window.ajax.post(Object(s.isMvk)()?"stories.php":"al_stories.php",c({act:"get_upload_url"},e),{onDone:t,onError:r,onFail:r})}))}function _(e,t){var r=new FormData,n=encodeURIComponent("edited_"+Object(a.irand)(0,99999)+".jpg");return r.append("file0",e,n),fetch(t,{method:"POST",body:r}).then((function(e){return e.json()}))}function d(e,t){return new Promise((function(r,n){window.ajax.post(Object(s.isMvk)()?"stories.php":"al_stories.php",{act:"save",upload_result:e,hash:t},{onDone:r,onError:n,onFail:n})}))}!function(e){e.PHOTO="photo",e.VIDEO="video"}(n||(n={})),function(e){e.SWIPE="swipe",e.NAVIGATION_BUTTON="navigation_button",e.SIT_POSTING="sit_posting",e.LINK="link",e.STORY_REPLY="story_reply",e.STORY_REPOST="story_repost",e.CATALOG_ADD="catalog_add",e.DIALOG="dialog",e.STORY_LIVE_FINISHED="story_live_finished",e.DIALOG_VKME="dialog_vkme",e.STORY_VIEWER_FINISHED="story_viewer_finished",e.PUSH_TRY_MASK="push_try_mask",e.STORY_VIEWER_TRY_MASK="story_viewer_try_mask",e.LINK_MASK="link_mask",e.POSTING="posting",e.NEW_STORY_AVATAR="new_story_avatar",e.STORY_REPLIES_LIST="story_replies_list",e.STORIES_FEED="stories_feed",e.STORIES_SEARCH_NEWS="stories_search_news",e.QUESTION_STICKER="question_sticker",e.LIST_MIDDLE="list_middle",e.ARCHIVE_EMPTY_BUTTON="archive_empty_button",e.ARCHIVE_MENU_BUTTON="archive_menu_button",e.IM="im",e.PROFILE_BUTTON="profile_button",e.SHARE="share",e.MINI_APP="mini_app",e.SYSTEM_SHARING="system_sharing",e.SHORTCUT="shortcut",e.ARCHIVE_SHARING="archive_sharing",e.STORY_VIEWER_CAMERA_BUTTON="story_viewer_camera_button",e.STORY_VIEWER_MUSIC="story_viewer_music",e.STORY_VIEWER_MUSIC_SHEET="story_viewer_music_sheet",e.REPOST_TO_STORY_ACTIVITY="repost_to_story_activity",e.CHANGE_AVATAR="change_avatar"}(o||(o={})),function(e){e.FEED="feed",e.FEED_MIDDLE="feed_middle",e.LINK="link",e.PROFILE="profile",e.IM_DIALOGS="im_dialogs",e.IM_DIALOG_HEADER="im_dialog_header",e.SNIPPET="snippet",e.REPLY="reply",e.REPLIES_LIST="replies_list",e.REPLY_STORY="reply_story",e.DISCOVER="discover",e.STORIES_MANAGE="stories_manage",e.USER_PERSONAL_CARD="user_personal_card",e.GROUP_PERSONAL_CARD="group_personal_card",e.NARRATIVE_SNIPPET="narrative_snippet",e.NARRATIVE_STORY="narrative_story",e.NARRATIVE_LINK="narrative_link",e.NARRATIVE_RECOMMENDATIONS="narrative_recommendations",e.NARRATIVE_SECTION="narrative_section",e.FAVE="fave",e.SPAMFEED="sf",e.ADS_PREVIEW="ads_preview",e.LIST_MIDDLE="list_middle",e.PLACE_STORY_LIST="place_story_list",e.SEARCH_STORY_LIST="search_story_list",e.STORY_ARCHIVE="story_archive",e.IM_MSG_LIST="im_msg_list",e.NOSPAM="nospam",e.PROFILE_SNACKBAR="profile_snackbar"}(i||(i={}))},d4g6:function(e,t,r){"use strict";r.r(t),r.d(t,"objectToQuerystring",(function(){return o})),r.d(t,"getHostName",(function(){return i})),r.d(t,"destroyOpenedApp",(function(){return a})),r.d(t,"isVKPayApp",(function(){return s})),r.d(t,"filterPostMessageOrigin",(function(){return c})),r.d(t,"isAllowedPostMessageOriginHost",(function(){return l})),r.d(t,"isVKMiniAppsHostingStaticUrl",(function(){return p}));r("Oyvg"),r("SRfc"),r("rGqo"),r("Btvt");var n=r("4zn2"),o=e=>Object.keys(e).reduce((t,r,n)=>[t,0===n?"?":"&",encodeURIComponent(r),"=",encodeURIComponent(e[r])].join(""),""),i=e=>{var t=e.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i);return null!=t&&t.length>2&&"string"==typeof t[2]&&t[2].length>0?t[2].toLowerCase():null},a=e=>{if(cur.vkAppQueue){var t=Object.keys(cur.vkAppQueue).filter(t=>~t.indexOf(e));if(t.length>0){var r=t[0];cur.vkAppQueue[r].destroyView(),delete cur.vkAppQueue[r]}}},s=e=>n.VKPAY_APPS.includes(e);function c(e,t){var r=i(t),n=e.vkApp?e.vk_app_url:e.src,o=i(n);if(r!==o&&!l(e,r))throw Error(`Insecure method call from ${r}. Call must be from ${o}`);return!0}function l(e,t){return!!e.allowed_origin_regexp&&new RegExp(e.allowed_origin_regexp).test(t)}function p(e){return-1!==e.indexOf("pages.vk-apps.com")||-1!==e.indexOf("pages-ac.vk-apps.com")}},dI71:function(e,t,r){"use strict";function n(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}r.r(t),r.d(t,"default",(function(){return n}))},dImZ:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ActionTypes",{enumerable:!0,get:function(){return o.ActionTypes}}),Object.defineProperty(t,"ActionCreators",{enumerable:!0,get:function(){return o.ActionCreators}}),Object.defineProperty(t,"parseActions",{enumerable:!0,get:function(){return i.parseActions}}),Object.defineProperty(t,"isHistory",{enumerable:!0,get:function(){return i.isHistory}}),Object.defineProperty(t,"includeAction",{enumerable:!0,get:function(){return i.includeAction}}),Object.defineProperty(t,"excludeAction",{enumerable:!0,get:function(){return i.excludeAction}}),Object.defineProperty(t,"combineFilters",{enumerable:!0,get:function(){return i.combineFilters}}),Object.defineProperty(t,"groupByActionTypes",{enumerable:!0,get:function(){return i.groupByActionTypes}}),Object.defineProperty(t,"newHistory",{enumerable:!0,get:function(){return i.newHistory}}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a.default}});var n,o=r("1VNw"),i=r("9O7i"),a=(n=r("FEd1"))&&n.__esModule?n:{default:n}},eiY0:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return s}));var n=r("UlUB"),o=r("59zB"),i=null,a=e=>{var t;t=s.isEmbedApp()?window.document.querySelector("#apps_layer"):window.document.querySelector("#apps");var r,n=window.document.querySelector(".HeaderNav__item"),o=n?n.getBoundingClientRect().left:0,a=s.getMarginWrap();t&&(t.style.height=window.innerHeight-a+"px"),r=o<0?n.offsetLeft:o,r+=36,e&&(e.style.left=r+"px"),i&&i.update()};class s{static init(){var e=window.document.querySelector(".WideScreenAppBack"),t=window.document.querySelector("#page_body"),r=window.document.querySelector(".apps_similarApps__list"),s=1030;if(r&&(i=new o.default(r,{stopScrollPropagation:!1,onscroll:()=>{window.tooltips&&tooltips.hideAll()},onscrollstop:e=>{var t=r.querySelectorAll(".apps_cat_row");t&&t.forEach((t,r)=>{t.removeAttribute("data-forcetodown"),t.removeAttribute("data-forcetotop");var n=(++r/2).toFixed(0);184+e.data.scrollTop>184*n&&t.setAttribute("data-forcetodown",!0)})}})),window.document.body&&t&&t.style&&t.style.width){var c=parseInt(t.style.width)+195;c>s&&(s=c),document.body.style.minWidth=s+"px"}var l=Object(n.throttle)(()=>{a(e)},100);window.addEventListener("resize",l),a(e),e&&e.classList.remove("hidden"),window.cur&&window.cur.destroy&&window.cur.destroy.push(()=>{window.removeEventListener("resize",l)})}static isEmbedApp(){return window.cur&&window.cur.app&&window.cur.app.options.embed}static deferredInit(){document.addEventListener("DOMContentLoaded",s.init),window.cur&&window.cur.destroy&&window.cur.destroy.push(()=>{document.removeEventListener("DOMContentLoaded",s.init)})}static getMarginWrap(){if(s.isEmbedApp())return 0;var e=document.getElementById("page_header");return e?parseInt(getComputedStyle(e).getPropertyValue("--header-height"),10)+55:55}}},gF8j:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return s})),r.d(t,"getVisibilityState",(function(){return p})),r.d(t,"getVisiblityEvent",(function(){return _}));var n=r("uQjJ"),o=r("PU8N"),i=new(function(){function e(){this.onVisibilityChange=this._onVisibilityChange.bind(this)}return e.prototype._onVisibilityChange=function(){this.wakeLockSentinel&&"visible"===document.visibilityState&&this.lock().then((function(){})).catch(console.error)},e.prototype.requestWakeLock=function(){var e=this;return navigator.wakeLock?this.wakeLockSentinel?Promise.resolve():navigator.wakeLock.request("screen").then((function(t){e.wakeLockSentinel=t})):Promise.reject()},e.prototype.isLocked=function(){return!!this.wakeLockSentinel&&!this.wakeLockSentinel.released},e.prototype.lock=function(){var e=this;return this.requestWakeLock().then((function(){e.wakeLockSentinel&&document.addEventListener("visibilitychange",e.onVisibilityChange)})).catch((function(){}))},e.prototype.unlock=function(){var e=this;return this.wakeLockSentinel?(document.removeEventListener("visibilitychange",this.onVisibilityChange),this.wakeLockSentinel.release().finally((function(){e.wakeLockSentinel=null}))):Promise.resolve()},e}()),a=browser.iphone||browser.ipad||browser.ipod;function s(e){this.started=!1,this.is_idle=!0,this.activeTimeStart=null,this.cbActiveB=this.cbActive.bind(this),this.cbInactiveB=this.cbInactive.bind(this),this.onVisiblityChange=this.onVisiblityChange.bind(this),this.opts=extend({triggerEvents:"mousemove keydown",onIdleCb:function(){},onUnIdleCb:function(){},focusElement:e.element,element:null,idleTimeout:3e4},e)}function c(e,t,r){Object(o.isMvk)()?window.addEvent(e,t,r,{passive:!0}):window.addEvent(e,t,r)}function l(e,t,r){Object(o.isMvk)()?window.removeEvent(e,t,r,{passive:!0}):window.removeEvent(e,t,r)}function p(){return document.visibilityState||document.webkitVisibilityState}function _(){var e="visibilitychange";return document.visibilityState||(document.webkitVisibilityState?e+="webkit":e=""),e}extend(s.prototype,n.default.prototype),extend(s.prototype,{stop:function(){this.started=!1,l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),Object(o.isMvk)()&&this._isTopLevel()&&_()&&l(document,_(),this.onVisiblityChange),Object(o.isMvk)()&&a||(l(this.opts.focusElement,"focus",this.cbActiveB),l(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.setIdleTo),clearTimeout(this.checkIdleCbTo),clearTimeout(this.sendCbTO),this.is_idle=!0,this.opts.parentManager&&this.opts.parentManager.off("idle",this.cbInactiveB)},idle:function(e){this.is_idle=!0,e||this.opts.onIdleCb(),this.emit("idle")},unidle:function(e){this.is_idle=!1,e||this.opts.onUnIdleCb(),this.emit("unidle")},start:function(){this.started=!0,!Object(o.isMvk)()&&browser.mobile||(this.is_idle=!this._isFocused(),this.opts.parentManager&&this.opts.parentManager.on("idle",this.cbInactiveB),Object(o.isMvk)()&&this._isTopLevel()&&_()&&c(document,_(),this.onVisiblityChange),Object(o.isMvk)()&&a||(c(this.opts.focusElement,"focus",this.cbActiveB),c(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.checkIdleCbTo),this.checkIdleCb(),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},checkIdleCb:function(){this.started&&(c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.setIdleTo),this.setIdleTo=setTimeout(this.cbInactiveB,this.opts.idleTimeout))},cbActive:function(){this.started&&(this.activeTimeStart=(new Date).getTime(),clearTimeout(this.setIdleTo),this.is_idle&&(this.is_idle=!1,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("unidle"),this.opts.onUnIdleCb&&this.opts.onUnIdleCb()}.bind(this),100)),l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.checkIdleCbTo),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},cbInactive:function(){this.started&&(i.isLocked()||(this.activeTimeStart=null,this.is_idle||(this.is_idle=!0,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("idle"),this.opts.onIdleCb&&this.opts.onIdleCb()}.bind(this),100)),clearTimeout(this.checkIdleCbTo),l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),this.checkIdleCbTo=setTimeout(this.checkIdleCb,this.opts.idleTimeout)))},getActiveTime(){return!this.is_idle&&this.activeTimeStart?(new Date).getTime()-this.activeTimeStart:0},onVisiblityChange(){"visible"===p()?this.cbActiveB():this.cbInactiveB()},_isTopLevel(){var e=this.opts.focusElement;return e===window||e===document},_isFocused(){var e=this.opts.focusElement;if(this._isTopLevel()){var t=p();return"string"==typeof t&&"visible"===t}return document.activeElement===e}})},gT3r:function(e,t,r){"use strict";r.r(t),r.d(t,"THROTTLE_TIME",(function(){return o})),r.d(t,"addPopupScroll",(function(){return i}));var n=r("PU8N"),o=300,i=(e,t)=>{var r=t?t.scrollTop:window.pageYOffset,o=window.cur.app;if(o&&!Object(n.isMvk)()){var i=o.frame.clientHeight-360,a=Math.max(103,Math.min(r,i));requestAnimationFrame((function(){e.style.transform=`translateX(-50%) translateY(${a}px)`}))}}},hPa7:function(e,t,r){"use strict";r.r(t),r.d(t,"GAMES_CATALOG_MODULE",(function(){return c})),r.d(t,"SECTION_CATALOG",(function(){return l})),r.d(t,"SECTION_PROFILE",(function(){return p})),r.d(t,"SECTION_SEARCH",(function(){return _})),r.d(t,"SECTION_INSTALLED",(function(){return d})),r.d(t,"SECTION_LIST",(function(){return u})),r.d(t,"SECTION_GENRE",(function(){return h})),r.d(t,"SECTION_DOWNLOADED_GAME",(function(){return f})),r.d(t,"SECTION_ACHIEVEMENTS",(function(){return m})),r.d(t,"default",(function(){return g}));r("OG14"),r("VRzm"),r("9AAn"),r("rGqo"),r("Btvt"),r("T39b");var n=r("lXE5"),o=r("zxIV"),i=r("kHqu"),a=r("t7n3"),s=r("4+be"),c="apps",l="catalog",p="profile",_="search_page",d="apps",u="list",h="genre",f="downloaded_games",m="achievements",b=new Set([l,p,_,d,f]),E=new Set([_,p,u,m]);class g{constructor(){this.preloaded=Object.create(null),this.currentSection=null,this.headerContentEl=null,this.promoContentEl=null,this.mainContentEl=null,this.navEl=null,this.breadCrumbsEl=null,this.breadCrumbsCurrentEl=null,this.currentSection=null,this.catalogLayoutEl=null,this.inProgessPreloaded=new Map,this.preloadBlocksObserver=null,this.topMainContentEl=null,this.history=[]}init(e){this.headerContentEl=document.getElementById("games_catalog_header_content"),this.mainContentEl=document.getElementById("games_catalog_main_content"),this.navEl=document.querySelector(".GamesCatalogNav"),this.breadCrumbsEl=document.getElementById("games-catalog-bread-crumbs"),this.breadCrumbsCurrentEl=document.getElementById("games-catalog-bread-current"),this.catalogLayoutEl=document.getElementById("games_catalog"),this.promoContentEl=document.getElementById("games_catalog_promo_content"),this.topMainContentEl=document.getElementById("games_catalog_top_main_content"),E.has(e)||(this.preloaded[e]={header:this.headerContentEl.innerHTML,content:this.mainContentEl.innerHTML,promo:this.promoContentEl.innerHTML,top_main:this.topMainContentEl.innerHTML,title:this.breadCrumbsCurrentEl.textContent||null}),this.currentSection=e,this._initBack(),this._initNavChanged()}goToPreload(e,t,r,n){return e===this.currentSection?Promise.reject():(window.tooltips&&window.tooltips.hideAll(),new Promise((o,i)=>{this.inProgessPreloaded.has(e)?this.inProgessPreloaded.get(e).then(()=>{this._processPreload(e,o,i,t,r,n)}).catch(()=>{this._processPreload(e,o,i,t,r,n)}):this._processPreload(e,o,i,t,r,n)}))}preload(e){if(window.vk.id&&(e=(e=[...new Set(e)]).filter(e=>!this.preloaded[e]&&!this.inProgessPreloaded.has(e))).length){var t=new Promise((t,r)=>{ajax.post("/apps",{act:"preload",sections:e},{onDone:e=>{e=e||{},Object.keys(e).forEach(t=>{this.preloaded[t]=e[t],this.inProgessPreloaded.delete(t)}),t()},onFail:()=>{r()}})});e.forEach(e=>{this.inProgessPreloaded.set(e,t)})}}clear(e){this.preloaded[e]=null}destroy(){this.preloaded=Object.create(null),this.stopObserveBlocks(),this.inProgessPreloaded=new Map,this.preloadBlocksObserver=null,cur._back={},this.headerContentEl=null,this.mainContentEl=null,this.navEl=null,this.breadCrumbsEl=null,this.breadCrumbsCurrentEl=null,this.catalogLayoutEl=null,this.promoContentEl=null}startObserveBlocks(e){var t=[];this.preloadBlocksObserver=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){var r=e.target;r.dataset.preloaded||(t.push(r.dataset.blockId),r.dataset.preloaded="1")}}),setTimeout(()=>{this.preload(t),t=[]},100)},{threshold:.01}),e.forEach(e=>{document.querySelectorAll(e).forEach(e=>{this.preloadBlocksObserver.observe(e)})})}stopObserveBlocks(){this.preloadBlocksObserver&&(this.preloadBlocksObserver.disconnect(),this.preloadBlocksObserver=null)}isPreloaded(e){return!!this.preloaded[e]}_initBack(){cur._back={hide:[()=>{window.GamesCatalog&&window.GamesCatalog.destroyHalloweenGhost(),window.GamesCatalog&&window.GamesCatalog.destroyFortuneWheel()}],onBack:e=>{var t=window.location.pathname+window.location.search+window.location.hash;if("/apps"===window.location.pathname){var r=this.history.pop()||{},n=r.section,o=r.scroll,s=r.landing;if(o=Object(a.positive)(o),!n){var c=nav.fromStr(e);(n=c.act||l)===l&&c.w&&(s=c.w)}n?window.GamesCatalog.go(n,null,!0,o,s):window.nav.go(t),this.history.length||Object(i.showBackLink)()}else window.nav.go(t)}}}_initNavChanged(){window.cur=window.cur||{},window.cur.module=c,window.cur.nav.push(e=>{e[0]!==c&&Object(i.showBackLink)(window.nav.strLoc,Object(s.getLang)("global_back"),1)})}_selectNavTab(e){var t=document.getElementById("games_tab_"+e);(t=t&&t.querySelector("a"))&&window.uiTabs.switchTab(t)}_processPreload(e,t,r,a,c,l){if(this.navEl&&document.body.contains(this.navEl))if(this.preloaded[e]){var p=Object(n.scrollGetY)();b.has(e)?(Object(o.show)(this.navEl),Object(o.hide)(this.breadCrumbsEl),this._selectNavTab(e)):(Object(o.hide)(this.navEl),Object(o.show)(this.breadCrumbsEl)),this.preloaded[e].title&&(Object(o.hide)(this.navEl),Object(o.show)(this.breadCrumbsEl),this.breadCrumbsCurrentEl.innerHTML=this.preloaded[e].title||""),this.headerContentEl.innerHTML=this.preloaded[e].header||"",this.mainContentEl.innerHTML=this.preloaded[e].content||"",this.promoContentEl.innerHTML=this.preloaded[e].promo||"",this.topMainContentEl.innerHTML=this.preloaded[e].top_main||"",this.catalogLayoutEl.classList.remove("GamesCatalog--"+this.currentSection),this.catalogLayoutEl.classList.add("GamesCatalog--"+e),Object(n.scrollToTop)(300),Object(i.showBackLink)(nav.strLoc,Object(s.getLang)("global_back"),1),this._updateLocation(e),t([this.currentSection,e,this.preloaded[e]]),a?Object(n.scrollToY)(c,300):this.history.push({section:this.currentSection,scroll:p,landing:l}),this.currentSection=e}else r(),window.nav.go("apps?act="+e);else{r();var _=l?"&w="+l:"";window.nav.go("apps?act="+e+_)}}_updateLocation(e){window.nav.objLoc.act=e,window.nav.setLoc(nav.objLoc)}}},jYEY:function(e,t,r){var n;!function(o){"use strict";function i(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function a(e,t,r,n,o,a){return i((s=i(i(t,e),i(n,a)))<<(c=o)|s>>>32-c,r);var s,c}function s(e,t,r,n,o,i,s){return a(t&r|~t&n,e,t,o,i,s)}function c(e,t,r,n,o,i,s){return a(t&n|r&~n,e,t,o,i,s)}function l(e,t,r,n,o,i,s){return a(t^r^n,e,t,o,i,s)}function p(e,t,r,n,o,i,s){return a(r^(t|~n),e,t,o,i,s)}function _(e,t){var r,n,o,a,_;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var d=1732584193,u=-271733879,h=-1732584194,f=271733878;for(r=0;r<e.length;r+=16)n=d,o=u,a=h,_=f,d=s(d,u,h,f,e[r],7,-680876936),f=s(f,d,u,h,e[r+1],12,-389564586),h=s(h,f,d,u,e[r+2],17,606105819),u=s(u,h,f,d,e[r+3],22,-1044525330),d=s(d,u,h,f,e[r+4],7,-176418897),f=s(f,d,u,h,e[r+5],12,1200080426),h=s(h,f,d,u,e[r+6],17,-1473231341),u=s(u,h,f,d,e[r+7],22,-45705983),d=s(d,u,h,f,e[r+8],7,1770035416),f=s(f,d,u,h,e[r+9],12,-1958414417),h=s(h,f,d,u,e[r+10],17,-42063),u=s(u,h,f,d,e[r+11],22,-1990404162),d=s(d,u,h,f,e[r+12],7,1804603682),f=s(f,d,u,h,e[r+13],12,-40341101),h=s(h,f,d,u,e[r+14],17,-1502002290),d=c(d,u=s(u,h,f,d,e[r+15],22,1236535329),h,f,e[r+1],5,-165796510),f=c(f,d,u,h,e[r+6],9,-1069501632),h=c(h,f,d,u,e[r+11],14,643717713),u=c(u,h,f,d,e[r],20,-373897302),d=c(d,u,h,f,e[r+5],5,-701558691),f=c(f,d,u,h,e[r+10],9,38016083),h=c(h,f,d,u,e[r+15],14,-660478335),u=c(u,h,f,d,e[r+4],20,-405537848),d=c(d,u,h,f,e[r+9],5,568446438),f=c(f,d,u,h,e[r+14],9,-1019803690),h=c(h,f,d,u,e[r+3],14,-187363961),u=c(u,h,f,d,e[r+8],20,1163531501),d=c(d,u,h,f,e[r+13],5,-1444681467),f=c(f,d,u,h,e[r+2],9,-51403784),h=c(h,f,d,u,e[r+7],14,1735328473),d=l(d,u=c(u,h,f,d,e[r+12],20,-1926607734),h,f,e[r+5],4,-378558),f=l(f,d,u,h,e[r+8],11,-2022574463),h=l(h,f,d,u,e[r+11],16,1839030562),u=l(u,h,f,d,e[r+14],23,-35309556),d=l(d,u,h,f,e[r+1],4,-1530992060),f=l(f,d,u,h,e[r+4],11,1272893353),h=l(h,f,d,u,e[r+7],16,-155497632),u=l(u,h,f,d,e[r+10],23,-1094730640),d=l(d,u,h,f,e[r+13],4,681279174),f=l(f,d,u,h,e[r],11,-358537222),h=l(h,f,d,u,e[r+3],16,-722521979),u=l(u,h,f,d,e[r+6],23,76029189),d=l(d,u,h,f,e[r+9],4,-640364487),f=l(f,d,u,h,e[r+12],11,-421815835),h=l(h,f,d,u,e[r+15],16,530742520),d=p(d,u=l(u,h,f,d,e[r+2],23,-995338651),h,f,e[r],6,-198630844),f=p(f,d,u,h,e[r+7],10,1126891415),h=p(h,f,d,u,e[r+14],15,-1416354905),u=p(u,h,f,d,e[r+5],21,-57434055),d=p(d,u,h,f,e[r+12],6,1700485571),f=p(f,d,u,h,e[r+3],10,-1894986606),h=p(h,f,d,u,e[r+10],15,-1051523),u=p(u,h,f,d,e[r+1],21,-2054922799),d=p(d,u,h,f,e[r+8],6,1873313359),f=p(f,d,u,h,e[r+15],10,-30611744),h=p(h,f,d,u,e[r+6],15,-1560198380),u=p(u,h,f,d,e[r+13],21,1309151649),d=p(d,u,h,f,e[r+4],6,-145523070),f=p(f,d,u,h,e[r+11],10,-1120210379),h=p(h,f,d,u,e[r+2],15,718787259),u=p(u,h,f,d,e[r+9],21,-343485551),d=i(d,n),u=i(u,o),h=i(h,a),f=i(f,_);return[d,u,h,f]}function d(e){var t,r="",n=32*e.length;for(t=0;t<n;t+=8)r+=String.fromCharCode(e[t>>5]>>>t%32&255);return r}function u(e){var t,r=[];for(r[(e.length>>2)-1]=void 0,t=0;t<r.length;t+=1)r[t]=0;var n=8*e.length;for(t=0;t<n;t+=8)r[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return r}function h(e){var t,r,n="";for(r=0;r<e.length;r+=1)t=e.charCodeAt(r),n+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return n}function f(e){return unescape(encodeURIComponent(e))}function m(e){return function(e){return d(_(u(e),8*e.length))}(f(e))}function b(e,t){return function(e,t){var r,n,o=u(e),i=[],a=[];for(i[15]=a[15]=void 0,o.length>16&&(o=_(o,8*e.length)),r=0;r<16;r+=1)i[r]=909522486^o[r],a[r]=1549556828^o[r];return n=_(i.concat(u(t)),512+8*t.length),d(_(a.concat(n),640))}(f(e),f(t))}function E(e,t,r){return t?r?b(t,e):h(b(t,e)):r?m(e):h(m(e))}void 0===(n=function(){return E}.call(t,r,t,e))||(e.exports=n)}()},lMzL:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return u}));r("91GP"),r("rGqo"),r("Btvt"),r("pIFo"),r("OG14");var n=r("d4g6"),o=r("lNyc"),i=r("4zn2"),a=r("9kLB"),s=r("xo6n"),c=r("PU8N"),l=r("aJgW"),p=r("W9Tc");function _(){return(_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var d=class{constructor(e,t,r,n,i){this.sendIframeMessage=(e,t)=>{var r=document.getElementById(this.containerId);r&&Object(o.sendMessage)({type:e,data:_({},t)},r)},this.appId=t.aid,this.src=t.src,this.pic=n,this.params=_({},r),this.containerId=e,this.vkApp=i,this.apiHost=t.vk_app_api_host,this.isDirectGame=t.is_direct_game,this.isVKPayApp=t.is_vkpay_app,this.isTextliveApp=t.is_textlive_app,this.isMiniAppWidget=t.is_mini_app_widget,this.handler=this.handler.bind(this),this.onResize=this.onResize.bind(this),this.i=0,this.eventQueue=[]}init(){this.sessionLogger=new s.default(this.appId),cur.destroy.unshift(()=>{this.destroyView()}),window.addEventListener("visibilitychange",()=>{document.hidden?this.sessionLogger&&this.sessionLogger.idle():this.sessionLogger&&this.sessionLogger.unIdle()}),window.addEventListener("message",this.handler),window.addEventListener("beforeunload",()=>{this.destroyView()}),this.getWindowSize(),cur.VKApp=cur.VKApp||{},cur.VKApp.vkMiniAppsHistoryLength=window.history.length,Object(c.isMvk)()?(l.colorScheme.subscribe(()=>{var e=l.colorScheme.isDarkScheme()?i.CLIENT_SCHEME.SPACE_GRAY:i.CLIENT_SCHEME.BRIGHT_LIGHT;this.sendUpdateEvent(e)}),this.onResize(),window.addEventListener("resize",this.onResize),this.checkDevice()):(window.matchMedia("(prefers-color-scheme: dark)").addListener(e=>e.matches&&this.sendUpdateEvent(Object(c.isMvk)()?i.CLIENT_SCHEME.SPACE_GRAY:i.CLIENT_SCHEME.BRIGHT_LIGHT)),window.matchMedia("(prefers-color-scheme: light)").addListener(e=>e.matches&&this.sendUpdateEvent(i.CLIENT_SCHEME.BRIGHT_LIGHT)))}initOpenExternalApp(){var e=new URLSearchParams(location.search);if(cur.zNavInfo&&cur.zNavInfo.info.w&&e.has("w")){var t=/app[0-9]+/.exec(cur.zNavInfo.info.w);if(t){var r=parseInt(t[0].replace("app",""),10);Object(o.chooseAction)({eventData:{app_id:r},params:{app_id:r,request_id:"vkopenexternalapp"},handler:a.CONNECT_EVENTS.OPEN_APP},this)}}}destroyView(){window.removeEventListener("message",this.handler),this.sessionLogger&&this.sessionLogger.stop()}sendUpdateEvent(e){Object(o.chooseAction)({handler:a.CONNECT_EVENTS.UPDATE_CONFIG,params:{viewport_width:this.currentWidth,viewport_height:this.currentHeight,scheme:e||this.getColorScheme(),api_host:this.apiHost}},this)}onResize(){if(!this.isDirectGame&&!(Object(c.isMvk)()&&cur.share||this.currentHeight===window.innerHeight)){this.getWindowSize();var e=document.querySelector(".app_container"),t=e&&e.childNodes[0];t&&!Object(p.partConfigEnabled)("mini_apps_m_web_navigation_redesign")&&(t.style.height=this.currentHeight+"px",t.style.minHeight=this.currentHeight+"px",this.sendUpdateEvent())}}getWindowSize(){this.currentHeight=window.innerHeight,this.currentWidth=window.innerWidth}getColorScheme(){if(Object(c.isMvk)())return l.colorScheme.isDarkScheme()?i.CLIENT_SCHEME.SPACE_GRAY:i.CLIENT_SCHEME.BRIGHT_LIGHT;var e=window.matchMedia("(prefers-color-scheme: dark)").matches,t=window.matchMedia("(prefers-color-scheme: light)").matches,r=window.matchMedia("(prefers-color-scheme: no-preference)").matches,n=!e&&!t&&!r;return e&&Object(c.isMvk)()?i.CLIENT_SCHEME.SPACE_GRAY:t||r||n?i.CLIENT_SCHEME.BRIGHT_LIGHT:void 0}handler(e){var t=Object(n.getHostName)(e.origin)===Object(n.getHostName)(this.src)||Object(n.isAllowedPostMessageOriginHost)(this.vkApp?this.vkApp.options:{},Object(n.getHostName)(e.origin))||Object(n.isVKMiniAppsHostingStaticUrl)(Object(n.getHostName)(e.origin));if(e.data&&"vk-connect"===e.data.type&&t){var r=this;if(e.data.handler===a.CONNECT_EVENTS.INIT&&(this.sessionLogger&&this.sessionLogger.start(),r&&r.sendUpdateEvent(),!Object(c.isMvk)())){var i=document.getElementById(this.containerId);i&&Object(o.sendMessage)({type:a.CONNECT_EVENTS.SETTINGS,frameId:this.containerId},i)}if(cur.vkAppQueue&&Object.keys(cur.vkAppQueue).length>1){var s=e.data.frameId||e.data.webFrameId||this.containerId;if(!s)throw new Error("There is no specified id for container");s===this.containerId&&(r=cur.vkAppQueue[s],Object(o.chooseAction)(_({},e.data,{pic:this.pic}),r))}else Object(c.isMvk)()?cur.app.hideVkAppPreload():this.initOpenExternalApp(),Object(o.chooseAction)(_({},e.data,{pic:this.pic}),r)}else if(e.data&&e.data.type===a.CONNECT_EVENTS.CLOSE&&Object(c.isMvk)()){var l=ge(this.containerId);l&&Object(o.sendMessage)({type:e.data.name,data:e.data.eventData},l)}}checkDevice(){this.isIOS()&&this.checkIOSXDevice()&&document.body.classList.add("vk_ios_x_device")}isIOS(){return document.body.classList.contains("vk_ios_yes")}checkIOSXDevice(){var e=window.screen.height;return e>=812&&e<900}actualizeEventQueue(){var e=Date.now()-3e4,t=this.eventQueue.findIndex(t=>t.timeInMs>=e);-1===t?this.eventQueue=[]:this.eventQueue.splice(0,t)}isRequestsLimitReached(){return this.actualizeEventQueue(),15===this.eventQueue.length}};function u(e,t,r,n,o){if(cur.vkAppQueue||(cur.vkAppQueue={}),!cur.vkAppQueue[e]){var i=new d(e,t,r,n,o);i.init(),cur.vkAppQueue[e]=i}}},lNyc:function(e,t,r){"use strict";r.r(t),r.d(t,"sendMessage",(function(){return At})),r.d(t,"chooseAction",(function(){return St}));var n={};r.r(n),r.d(n,"VKWebAppInit",(function(){return g})),r.d(n,"VKWebAppGetCommunityAuthToken",(function(){return y})),r.d(n,"VKWebAppGetCommunityToken",(function(){return S})),r.d(n,"VKWebAppGetFriends",(function(){return Je})),r.d(n,"VKWebAppAddToCommunity",(function(){return P})),r.d(n,"VKWebAppAddToHomeScreenInfo",(function(){return R})),r.d(n,"VKWebAppCopyText",(function(){return D})),r.d(n,"VKWebAppAddToFavorites",(function(){return Ye})),r.d(n,"VKWebAppAddToMenu",(function(){return Xe})),r.d(n,"VKWebAppGetUserInfo",(function(){return k})),r.d(n,"VKWebAppSetLocation",(function(){return M})),r.d(n,"VKWebAppGetClientVersion",(function(){return L})),r.d(n,"VKWebAppGetPhoneNumber",(function(){return N})),r.d(n,"VKWebAppGetEmail",(function(){return j})),r.d(n,"VKWebAppOpenArticle",(function(){return Ae})),r.d(n,"VKWebAppGetGeodata",(function(){return U})),r.d(n,"VKWebAppOpenQR",(function(){return W})),r.d(n,"VKWebAppSetViewSettings",(function(){return K})),r.d(n,"VKWebAppSetTitle",(function(){return F})),r.d(n,"VKWebAppGetAuthToken",(function(){return G})),r.d(n,"VKWebAppCallAPIMethod",(function(){return $})),r.d(n,"VKWebAppJoinGroup",(function(){return ee})),r.d(n,"VKWebAppLeaveGroup",(function(){return re})),r.d(n,"VKWebAppAllowMessagesFromGroup",(function(){return ae})),r.d(n,"VKWebAppDenyNotifications",(function(){return se})),r.d(n,"VKWebAppAllowNotifications",(function(){return _e})),r.d(n,"VKWebAppOpenPayForm",(function(){return le})),r.d(n,"VKWebAppOpenApp",(function(){return ue})),r.d(n,"VKWebAppShare",(function(){return he})),r.d(n,"VKWebAppShowNewPostBox",(function(){return fe})),r.d(n,"VKWebAppShowWallPostBox",(function(){return me})),r.d(n,"VKWebAppSendToClient",(function(){return H})),r.d(n,"VKWebAppOpenArticleEditor",(function(){return Be})),r.d(n,"VKWebAppScroll",(function(){return be})),r.d(n,"VKWebAppStorageGet",(function(){return Ge})),r.d(n,"VKWebAppStorageGetKeys",(function(){return He})),r.d(n,"VKWebAppStorageSet",(function(){return Fe})),r.d(n,"VKWebAppResizeWindow",(function(){return ve})),r.d(n,"VKWebAppSendPayload",(function(){return we})),r.d(n,"VKWebAppUpdateConfig",(function(){return Ce})),r.d(n,"VKWebAppTapticImpactOccurred",(function(){return Pe})),r.d(n,"VKWebAppTapticNotificationOccurred",(function(){return Re})),r.d(n,"VKWebAppTapticSelectionChanged",(function(){return Te})),r.d(n,"VKWebAppShowImages",(function(){return De})),r.d(n,"VKWebAppShowOrderBox",(function(){return Me})),r.d(n,"VKWebAppShowLeaderBoardBox",(function(){return xe})),r.d(n,"VKWebAppShowInviteBox",(function(){return Ne})),r.d(n,"VKWebAppShowRequestBox",(function(){return Ue})),r.d(n,"VKWebAppShowCommunityWidgetPreviewBox",(function(){return Ze})),r.d(n,"VKWebAppOpenInNativeApp",(function(){return Qe})),r.d(n,"VKWebAppLocationChanged",(function(){return et})),r.d(n,"VKWebAppClose",(function(){return tt})),r.d(n,"VKWebAppShowStoryBox",(function(){return st})),r.d(n,"VKWebAppSubscribeStoryApp",(function(){return ct})),r.d(n,"VKWebAppGetPersonalCard",(function(){return lt})),r.d(n,"VKWebAppOpenContacts",(function(){return pt})),r.d(n,"VKWebAppOpenCodeReader",(function(){return _t})),r.d(n,"VKWebAppShowSubscriptionBox",(function(){return dt})),r.d(n,"VKWebAppShowInstallPushBox",(function(){return ut})),r.d(n,"VKWebAppGetGroupInfo",(function(){return ft})),r.d(n,"VKWebAppFlashGetInfo",(function(){return mt})),r.d(n,"VKWebAppOpenWallPost",(function(){return gt})),r.d(n,"VKWebAppGetSilentToken",(function(){return Ot})),r.d(n,"VKWebAppOpenReportForm",(function(){return wt}));r("91GP"),r("pIFo"),r("KKXr");var o=new class{constructor(){this.checkStack=()=>{cur.vkMiniAppsStack||(cur.vkMiniAppsStack=[])},this.checkStack(),cur.clearVKMiniAppsLayerPopups=this.clearLayerPopups.bind(this)}push(e){e.init(),this.checkStack(),0===cur.vkMiniAppsStack.length&&e.show(),cur.vkMiniAppsStack.push(e)}clearLayerPopups(){this.checkStack(),cur.vkMiniAppsStack.length>0&&(cur.vkMiniAppsStack=cur.vkMiniAppsStack.filter(e=>!~e.appNode.id.indexOf("container_layer")))}pop(e){var t=cur.vkMiniAppsStack.indexOf(e);~t&&(cur.vkMiniAppsStack.splice(t,1),this.checkForNext())}checkForNext(){cur.vkMiniAppsStack.length>0&&cur.vkMiniAppsStack[0].show()}},i=r("4zn2");var a=class{constructor(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.ERROR_TYPES.CLIENT;this.data=t||{},this.method=e,this.type=r}_errorStrucuture(e,t){var r={type:this.method,data:{error_type:this.type,error_data:{error_code:e}}};return this.type===i.ERROR_TYPES.API?r.data.error_data.error_msg=t:r.data.error_data.error_reason=t,this.data.request_id&&(r.data.request_id=this.data.request_id),this.data.description&&(r.data.error_data.error_description=this.data.description),r}selectErrorType(){if(!this.data.hasOwnProperty("code"))return this.data.error_msg&&"operation denied by user"===this.data.error_msg.toLowerCase()?this._errorStrucuture(i.ERROR_CODES.USER_DENIED,"User denied"):this._errorStrucuture(i.ERROR_CODES.UNKNOWN,this.data.reason||this.data.error_msg||"Unknown error");switch(this.data.code){case i.ERROR_CODES.MISSING_PARAM:return this._errorStrucuture(i.ERROR_CODES.MISSING_PARAM,this.data.reason||"Missing required params or wrong type of param");case i.ERROR_CODES.CONNECTION_LOST:return this._errorStrucuture(i.ERROR_CODES.CONNECTION_LOST,this.data.reason||"Connection lost");case i.ERROR_CODES.USER_DENIED:return this._errorStrucuture(i.ERROR_CODES.USER_DENIED,this.data.reason||"User denied");case i.ERROR_CODES.INVALID_PARAMS:return this._errorStrucuture(i.ERROR_CODES.INVALID_PARAMS,this.data.reason||"Invalid params");case i.ERROR_CODES.CUSTOM:return this._errorStrucuture(i.ERROR_CODES.CUSTOM,this.data.reason||this.data.error_msg);case i.ERROR_CODES.REQUESTS_LIMIT_REACHED:return this._errorStrucuture(i.ERROR_CODES.REQUESTS_LIMIT_REACHED,"Requests limit reached");default:return this._errorStrucuture(this.data.code?this.data.code:i.ERROR_CODES.UNKNOWN,this.data.reason||this.data.error_msg||"Unknown error")}}},s=(r("HEwt"),r("a1Th"),r("rE2o"),r("ioFf"),r("rGqo"),r("Btvt"),r("/8Fb"),r("PU8N")),c=r("gT3r"),l=r("UlUB");function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class h{constructor(e,t){this.props=u({},e),t&&(this.callback=t),this.props.buttons=this.props.buttons||[],this.containerNode=ge(this.props.containerId),this.modal=null,this.onAction=this.onAction.bind(this),this.addScroll=Object(l.throttle)(this.addScroll.bind(this),c.THROTTLE_TIME),this.renderModal(),this._destroyed=!1}addScroll(){Object(c.addPopupScroll)(this.modal.children[0])}init(){this.containerNode&&this.containerNode.appendChild(this.modal),window.addEventListener("scroll",this.addScroll)}show(){Object(s.isMvk)()&&document.body.classList.add("vk_app_fixed"),this.props.withoutAnimation?this.modal.classList.add("show"):setTimeout(()=>this.modal.classList.add("show"),300),this.initMvkCloseActions(),this.addScroll()}initMvkCloseActions(){if(Object(s.isMvk)()){if(!window.DirectGames||!cur.app.isDirectGame)return;window.DirectGames.onBoxOpen(this),this.props.onlyButtonHide||(this.modal.onclick=e=>{e.target===this.modal&&this.onAction(this.props.cancelAction)})}}close(){this.props.onlyButtonHide||this.onAction(this.props.cancelAction)}destroy(){window.removeEventListener("scroll",this.addScroll),this._destroyed||(Object(s.isMvk)()&&(document.body.classList.remove("vk_app_fixed"),window.DirectGames&&cur.app.isDirectGame&&(window.DirectGames.onBoxClose(this),cur.app.frame.focus())),this.modal.parentNode.removeChild(this.modal),this.callback&&this.callback(),this._destroyed=!0)}onAction(e){e(),this.destroy()}_renderBtn(e){var t=document.createElement("button");return t.setAttribute("type","button"),t.classList.add("vk_app_modal_btn"),t.classList.add("vk_app_modal_btn--"+e.type),e.disabled&&(t.disabled=e.disabled),t.innerText=e.title,t.addEventListener("click",()=>this.onAction(e.action)),t}_renderBtns(e){var t=e.getElementsByClassName("vk_app_modal_btns")[0];t&&(this.props.buttons.map(e=>{t.appendChild(this._renderBtn(e))}),1===this.props.buttons.length&&t.classList.add("vk_app_modal_btns--single-btn"))}_renderCloseBtn(e){var t=document.createElement("button");t.setAttribute("type","button"),t.classList.add("vk_app_modal_close_btn"),t.innerHTML='<svg class="vk_app_modal_close_btn__icon" viewBox="0 0 24 24" id="cancel_24" width="24" height="24">\n        <g fill="none" fill-rule="evenodd">\n          <path d="M0 0h24v24H0z"></path>\n          <path\n              d="M18.3 5.7a.99.99 0 0 0-1.4 0L12 10.6 7.1 5.7a.99.99 0 0 0-1.4 1.4l4.9 4.9-4.9 4.9a.99.99 0 0 0 1.4 1.4l4.9-4.9 4.9 4.9a.99.99 0 0 0 1.4-1.4L13.4 12l4.9-4.9a.99.99 0 0 0 0-1.4z"\n              fill="currentColor"></path>\n        </g>\n      </svg>',t.addEventListener("click",()=>this.onAction(this.props.cancelAction)),e.children[0].appendChild(t)}_renderCheckboxFields(e,t){var r=document.createElement("div");r.classList.add("MiniAppsCheckbox__fields");var n=document.createElement("h5");if(n.classList.add("MiniAppsCheckbox__fields-title"),n.innerHTML=e,r.appendChild(n),t){var o=document.createElement("h6");o.classList.add("MiniAppsCheckbox__fields-description"),o.innerHTML=t,r.appendChild(o)}return r}_renderCheckbox(e){var t=e.title,r=e.description,n=d(e,["title","description"]),o=document.createElement("label");o.classList.add("MiniAppsCheckbox");var i=document.createElement("input");i.type="checkbox",i.classList.add("MiniAppsCheckbox__checkbox"),i.addEventListener("change",t=>e.checked=t.target.checked),o.appendChild(i),Object.entries(n).forEach(e=>{var t=p(e,2),r=t[0],n=t[1];i[r]=n});var a=document.createElement("div");a.classList.add("MiniAppsCheckbox__fake_checkbox"),o.appendChild(a);var s=this._renderCheckboxFields(t,r);return o.appendChild(s),o}_renderCheckboxWrap(e){var t=e.querySelector(".MiniAppsModalCheckbox");t&&this.props.checkbox.map(e=>t.appendChild(this._renderCheckbox(e)))}_renderOuter(){var e=document.createElement("div");return e.classList.add("vk_app_modal_outer"),e}_enhanceBtnsWithActions(){this.props.buttons&&this.props.buttons.forEach((e,t)=>{"deny"===e.type?this.props.buttons[t].action=this.props.cancelAction:this.props.buttons[t].action=this.props.allowAction})}_renderScopes(e){return e.map((e,t)=>0===t?getLang("vkapps_scope_"+e):getLang("vkapps_scope_"+e).toLowerCase()).join(", ")}prepareScopes(e){return 0===e.length?["general"]:e}prepareExtraBtn(){var e=document.createElement("button");return e.setAttribute("type","button"),e.classList.add("vk_app_modal_btn","vk_app_modal_btn--transparent"),e.innerHTML=getLang("apps_connect_modal_messages_scopes_edit"),e.addEventListener("click",this.props.extraAction),e}getThumb(){if(this.props.svgIcon)return this.props.svgIcon;var e=this.props.picClass?this.props.picClass:"";return this.props.pic?`<img src="${this.props.pic}" class="vk_app_modal_container__pic MiniAppModalContainer__pic ${e}" alt aria-label="product">`:""}renderModal(){this.props.containerClass=this.props.containerClass||"",this.props.buttonsClass=this.props.buttonsClass||"",this.props.isGradientModal&&Object(s.isMvk)()&&(this.props.containerClass+=" MiniAppsGradientModal"),this.props.isNoWrapButtons&&Object(s.isMvk)()&&(this.props.buttonsClass+=" MiniAppsNoWrapButtons");var e=`\n    <div class="vk_app_modal_container vk_app_modal_container--flex ${this.props.containerClass||""}">\n      <div class="vk_app_modal_content">\n        ${this.getThumb()}\n        <h2 class="vk_app_modal_container__heading">${this.props.title}</h2>\n        ${this.props.text?`<p class="vk_app_modal_container__text">${this.props.text}</p>`:""}\n      `;this.props.scopes&&(e+=`\n          <p class="vk_app_modal_container__text">${getLang("apps_connect_modal_messages_scopes_text")}</p>\n          <p class="vk_app_modal_container__list">${this._renderScopes(this.prepareScopes(this.props.scopes))}.</p>`),e+=`\n          </div>\n          <div class="MiniAppsModalCheckbox"></div>\n          <div class="vk_app_modal_btns ${this.props.buttonsClass}"></div>\n      </div>`,this._enhanceBtnsWithActions(),this.modal=this._renderOuter(),this.modal.innerHTML=e,this.props.showCloseBtn&&this._renderCloseBtn(this.modal),this.props.scopes&&this.props.scopes.length&&this.props.extraAction&&this.modal.getElementsByClassName("vk_app_modal_content")[0].appendChild(this.prepareExtraBtn()),this._renderBtns(this.modal),this.props.checkbox&&this._renderCheckboxWrap(this.modal)}}var f=r("jE6c"),m=r("FbVm");function b(){return(b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class E{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.params=b({handlerName:"handler",method:"method"},e),this.callApi=!0,this.useUI=!1,this.callback=null,this.modal=null,this.actionHandler=this.actionHandler.bind(this),this.errorHandler=this.errorHandler.bind(this),this.successHandler=this.successHandler.bind(this),this.denyUIAction=this.denyUIAction.bind(this),this.allowUIAction=this.allowUIAction.bind(this),cur.vkAppSuccessHandler=this.successHandler,cur.vkAppErrorHandler=this.errorHandler,this.checkResponse=this.checkResponse.bind(this)}get successDescriptor(){return this.params.handlerName+"Result"}get errorDescriptor(){return this.params.handlerName+"Failed"}getEventHash(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return cur.app.options[i.VK_CONNECT_EVENTS[`${this.params.handlerName}${e?"Preload":""}`]+"_hash"]}getEventHashes(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return cur.app.options[i.VK_CONNECT_EVENTS[`${this.params.handlerName}${e?"Preload":""}`]+"_hashes"]}getEventName(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return i.VK_CONNECT_EVENTS[`${this.params.handlerName}${e?"Preload":""}`]}sendNetworkError(){this.errorHandler({code:i.ERROR_CODES.UNKNOWN,error_type:i.ERROR_TYPES.CLIENT,reason:i.ERROR_REASONS.UNKNOWN_ERROR})}checkParams(e,t){for(var r=0;r<t.length;r++){var n=t[r],o=n.param,a=n.type,s=n.isRequired,c=n.extraChecks;if(!e.hasOwnProperty(o)&&s)return this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:`Missing required param "${o}"`}),!1;if(e.hasOwnProperty(o)&&typeof e[o]!==a)return this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:`Param "${o}" should be ${a}`},this.callback),!1;if(e.hasOwnProperty(o)&&c&&c.length>0)for(var l=0;l<c.length;l++)if(!c[l].check(e[o]))return this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:c[l].error(o)},this.callback),!1}return!0}actionHandler(e){return this.callApi?ajax.post("apps.php",b({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},e),{onDone:t=>{this.handleResponse(t,e,this.checkResponse)},onFail:e=>(this.errorHandler(e),!0)}):{}}checkResponse(e){1===e||0===e?this.successHandler(Boolean(e)):this.successHandler(e)}scopeStringToArray(e){return e?e.replace(/ /g,"").split(","):[]}denyUIAction(){this.errorHandler({error_type:"client_error",code:i.ERROR_CODES.USER_DENIED},null),o.pop(this.modal)}allowUIAction(e){this.actionHandler(e),o.pop(this.modal)}createDenyUIAction(e){this.params.modal.cancelAction=void 0!==e?()=>this.denyUIAction(e):this.denyUIAction}createAllowUIAction(e){this.params.modal.allowAction=void 0!==e?()=>this.allowUIAction(e):this.allowUIAction}launchUI(e){this.createDenyUIAction(),this.createAllowUIAction(),this.modal=new h(b({},this.params.modal,{},e)),o.push(this.modal)}_enhanceBtnsWithActions(){this.params.modal.buttons&&this.params.modal.buttons.forEach((e,t)=>{"deny"===e.type?this.params.modal.buttons[t].action=this.params.modal.cancelAction:this.params.modal.buttons[t].action=this.params.modal.allowAction})}setData(e,t){e.request_id&&(this.params.request_id=e.request_id),this.params.modal||(this.params.modal={}),e.containerId&&(this.params.modal.containerId=e.containerId),e.pic&&(this.params.modal.pic=e.pic),this.app=t}handleResponse(e,t,r,n){try{var o=JSON.parse(e);o.hasOwnProperty("error")?this.errorHandler(o.error):r(o,t)}catch(e){n?n(e):this.errorHandler(e)}}handler(e,t,r){this.setData(e,t),this.callback=r,this.useUI?this.launchUI(e):this.useUI||this.actionHandler(e)}getAppWebviewUrl(){return cur.app.frame.src}successHandler(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;t&&t(),Object(f.isObject)(e)||(e={result:e}),this.params.request_id&&e&&(e.request_id=this.params.request_id),this.callback({type:this.successDescriptor,data:e},this.params.handlerName),Object(s.isMvk)()&&cur.app.frame.focus(),m.bridgeEventItemStat.logEvent(this.getAppWebviewUrl(),this.app.appId,{event_type:this.params.handlerName,is_success:!0})}errorHandler(e,t,r){"string"==typeof e&&(e={reason:e}),this.params.request_id&&(e.request_id=this.params.request_id);var n=new a(this.errorDescriptor,e,r);t&&t(),this.callback(n.selectErrorType()),Object(s.isMvk)()&&cur.app.frame.focus(),m.bridgeEventItemStat.logEvent(this.getAppWebviewUrl(),this.app.appId,{event_type:this.params.handlerName,is_success:!1},{error_type:n.type,error_code:n.data.code})}}class g extends E{constructor(e){super(e),this.params.handlerName="VKWebAppInit"}handler(e,t,r){this.setData(e,t),this.callback=r,this.successHandler({result:!0})}}function v(){return(v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var O=class{constructor(e,t){this.props=v({},e),t&&(this.callback=t),this.appNode=ge(this.props.containerId),this.modal=null,this.onAction=this.onAction.bind(this),this.onCancelAction=this.onCancelAction.bind(this),this.onAllow=this.onAllow.bind(this)}show(){setTimeout(()=>this.modal.classList.add("show"),300)}destroy(){this.modal.parentNode.removeChild(this.modal),this.callback&&this.callback()}onAction(e){this.props.allowUIAction({scope:e,app_id:this.props.app_id}),this.destroy()}onCancelAction(e){e&&e(),this.destroy()}onAllow(){var e=[];Array.from(this.modal.querySelectorAll(".blind_label:checked")).map(t=>{var r=parseInt(t.id.replace("scope_",""),10);if(!this.props.scopes[r])throw new Error("There is no such scope");e.push(this.props.scopes[r])}),this.onAction(e.join(","))}_renderBtn(e){var t=document.createElement("button");return t.setAttribute("type","button"),t.classList.add("vk_app_modal_btn"),t.classList.add("vk_app_modal_btn--"+e.type),t.innerText=e.title,"success"===e.type?t.addEventListener("click",()=>this.onAllow()):t.addEventListener("click",()=>this.onCancelAction(e.action)),t}_renderBtns(e){this.props.buttons.map(t=>{e.getElementsByClassName("vk_app_modal_btns")[0].appendChild(this._renderBtn(t))})}_renderCloseBtn(e){var t=document.createElement("div");t.setAttribute("aria-label","Close"),t.setAttribute("tabindex","0"),t.setAttribute("role","button"),t.classList.add("box_x_button"),t.addEventListener("click",()=>this.onCancelAction(this.props.cancelAction)),e.querySelector(".box_title_wrap").appendChild(t)}_renderOuter(){return document.querySelector(".vk_app_modal_outer")}_enhanceBtnsWithActions(){this.props.buttons&&this.props.buttons.forEach((e,t)=>{"deny"===e.type?this.props.buttons[t].action=this.props.cancelAction:this.props.buttons[t].action=this.props.allowAction})}_renderScopes(e){return e.map((e,t)=>`\n    <div class="scope_row">\n      <input class="blind_label" type="checkbox" id="scope_${t}" checked="">\n      <label for="scope_${t}">${getLang("vkapps_scope_"+e)}</label>\n    </div>\n    `).join("\n")}renderModal(){this._enhanceBtnsWithActions(),this.modal=this._renderOuter(),this.modal.innerHTML=`\n  <div class="box_layout vk_app_modal_container">\n    <div class="box_title_wrap">\n       <div class="box_title">${this.props.title}</div>\n    </div>\n    <div class="box_body" style="display: block;">\n      ${this.props.text?`<p>${this.props.text}</p>`:""}\n      ${this.props.scopes&&`<div class="vk_app_modal_scopes">${this._renderScopes(this.props.scopes)}</div>`}\n    </div>\n    <div class="box_controls_wrap" style="display: block;">\n      <div class="box_controls vk_app_modal_btns"></div>\n    </div>\n  </div>\n`,this.props.showCloseBtn&&this._renderCloseBtn(this.modal),this._renderBtns(this.modal)}};function w(){return(w=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class y extends E{constructor(e){super(e),this.params.handlerName="VKWebAppGetCommunityAuthToken",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_community_request_token")},this.callApi=!0,this.useUI=!0,this.allowUIAction=this.allowUIAction.bind(this),this.checkToken=this.checkToken.bind(this),this.checkIntroData=this.checkIntroData.bind(this),this.onEditClick=this.onEditClick.bind(this)}scopeList(e){var t=this.app.params.group_whitelist_scopes?e.filter(e=>this.app.params.group_whitelist_scopes.includes(e)):e;return t=t.filter((e,t,r)=>t===r.indexOf(e))}checkScopes(e){return 0===e.filter(e=>!this.app.params.group_whitelist_scopes.includes(e)).length}onEditClick(e){this.editScopesModal.renderModal()}launchUI(e){this.createDenyUIAction(),this.createAllowUIAction(e),this.modal=new h(w({},this.params.modal,{},e,{scopes:this.params.scope,showCloseBtn:!0,extraAction:this.onEditClick})),this.editScopesModal=new O(w({},this.params.modal,{},e,{text:getLang("apps_connect_modal_messages_scopes_available"),scopes:this.params.scope,showCloseBtn:!0,allowUIAction:this.allowUIAction})),o.push(this.modal)}takeAction(e){ajax.post("apps.php",w({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName()},this.request,{},e),{onDone:e=>{this.handleResponse(e,null,this.checkToken)},onFail:e=>(this.errorHandler(e),!0)})}checkToken(e){e.access_token?this.successHandler(w({},e)):this.errorHandler({reason:"Invalid params"})}loadIntroData(e){this.request=w({},e),ajax.post("apps.php",w({act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},this.request),{onDone:t=>{this.handleResponse(t,e,this.checkIntroData)},onFail:e=>(this.errorHandler(e),!0)})}allowUIAction(e){this.takeAction(e),o.pop(this.modal)}checkIntroData(e,t){if(e.hasOwnProperty("status")){if(!e.hasOwnProperty("group"))return this.errorHandler();e.group.photo_100&&(t.pic=e.group.photo_100),e.group.name&&(t.title=getLang("apps_group_access_request").replace("%s",e.group.name)),this.launchUI(w({},t,{scopes:this.scopeStringToArray(t.scope)}))}}handler(e,t,r){if(this.setData(e,t),this.callback=r,e.scope||""===e.scope)if("string"==typeof e.scope)if(e.app_id)if("number"!=typeof e.app_id||e.app_id<0)this.errorHandler({code:2,reason:'Param "app_id" should be a positive number'},r);else if(e.app_id===parseInt(this.app.appId,10))if(e.group_id)if("number"!=typeof e.group_id||e.group_id<0)this.errorHandler({code:2,reason:'Param "group_id" should be a positive number'},r);else{var n=this.scopeStringToArray(e.scope);n&&this.checkScopes(n)?(this.params.scope=this.scopeList(n),this.loadIntroData(e)):this.errorHandler({code:i.ERROR_CODES.UNKNOWN,error_type:i.ERROR_TYPES.CLIENT,reason:i.ERROR_REASONS.UNKNOWN_ERROR},r)}else this.errorHandler({code:2,reason:'Missing required param "group_id"'},r);else this.errorHandler({code:2,reason:'Wrong param "app_id"'},r);else this.errorHandler({code:2,reason:'Missing required param "app_id"'},r);else this.errorHandler({code:2,reason:'Param "scope" should be a string'},r);else this.errorHandler({code:2,reason:'Missing required param "scope"'},r)}actionHandler(e){this.loadIntroData(e)}}function A(){return(A=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class S extends E{constructor(e){super(e),this.params.handlerName="VKWebAppGetCommunityToken",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_community_request_token")},this.callApi=!0,this.useUI=!0,this.allowUIAction=this.allowUIAction.bind(this),this.checkToken=this.checkToken.bind(this),this.checkIntroData=this.checkIntroData.bind(this),this.onEditClick=this.onEditClick.bind(this)}scopeList(e){var t=this.app.params.group_whitelist_scopes?e.filter(e=>this.app.params.group_whitelist_scopes.includes(e)):e;return t=t.filter((e,t,r)=>t===r.indexOf(e))}checkScopes(e){return 0===e.filter(e=>!this.app.params.group_whitelist_scopes.includes(e)).length}onEditClick(e){this.editScopesModal.renderModal()}launchUI(e){this.createDenyUIAction(),this.createAllowUIAction(e),this.modal=new h(A({},this.params.modal,{},e,{scopes:this.params.scope,showCloseBtn:!0,extraAction:this.onEditClick})),this.editScopesModal=new O(A({},this.params.modal,{},e,{text:getLang("apps_connect_modal_messages_scopes_available"),scopes:this.params.scope,showCloseBtn:!0,allowUIAction:this.allowUIAction})),o.push(this.modal)}takeAction(e){ajax.post("apps.php",A({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName()},this.request,{},e),{onDone:e=>{this.handleResponse(e,null,this.checkToken)},onFail:e=>{this.errorHandler(e)}})}checkToken(e){e.access_token?this.successHandler(A({},e)):this.errorHandler({reason:"Invalid params"})}loadIntroData(e){this.request=A({},e),ajax.post("apps.php",A({act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},this.request),{onDone:t=>{this.handleResponse(t,e,this.checkIntroData)},onFail:e=>(this.errorHandler(e),!0)})}allowUIAction(e){this.takeAction(e),o.pop(this.modal)}checkIntroData(e,t){if(e.hasOwnProperty("status")){if(!e.hasOwnProperty("group"))return this.errorHandler();e.group.photo_100&&(t.pic=e.group.photo_100),e.group.name&&(t.title=getLang("apps_group_access_request").replace("%s",e.group.name)),this.launchUI(A({},t,{scopes:this.scopeStringToArray(t.scope)}))}}handler(e,t,r){if(this.setData(e,t),this.callback=r,this.checkParams(e,[{param:"scope",type:"string",isRequired:!0},{param:"app_id",type:"number",isRequired:!0,extraChecks:[{check:e=>e>0,error:e=>`Param "${e}" should be a positive number`}]},{param:"group_id",type:"number",isRequired:!0,extraChecks:[{check:e=>e>0,error:e=>`Param "${e}" should be a positive number`}]}])){var n=this.scopeStringToArray(e.scope);n&&this.checkScopes(n)?(this.params.scope=this.scopeList(n),this.loadIntroData(e)):this.errorHandler({code:i.ERROR_CODES.UNKNOWN,error_type:i.ERROR_TYPES.CLIENT,reason:i.ERROR_REASONS.UNKNOWN_ERROR},r)}}actionHandler(e){this.loadIntroData(e)}}r("VRzm");function C(){return(C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class P extends E{constructor(e){super(e),this.params.handlerName="VKWebAppAddToCommunity",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_undo"),type:"deny"},{title:getLang("apps_connect_modal_btn_add"),type:"success"}],title:getLang("apps_connect_modal_messages_request_add_to_community")},this.callApi=!0,this.useUI=!0,this.allowUIAction=this.allowUIAction.bind(this),this.addToCommunitySuccessHandler=this.addToCommunitySuccessHandler.bind(this),this.addToCommunityErrorHandler=this.addToCommunityErrorHandler.bind(this),this.unsetCurHandlers=this.unsetCurHandlers.bind(this),this.checkIntroData=this.checkIntroData.bind(this),this.checkAppAdd=this.checkAppAdd.bind(this),this.showConfirmationModal=this.showConfirmationModal.bind(this)}takeAction(){ajax.post("apps.php",C({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},this.request),{onDone:e=>{this.handleResponse(e,{},this.checkAppAdd)},onFail:e=>(this.errorHandler(e),!0)})}checkAppAdd(e){parseInt(e,10)&&this.successHandler({result:!0})}loadIntroData(e){this.request=C({},e);var t=Object(s.isMvk)()?C({act:"vkapps_add_to_community_box",hash:cur.app.options.hash,app_id:this.app.appId},this.request):C({act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},this.request);Object(s.isMvk)()?window.ajax.post("apps.php",t,{onDone:(e,t)=>{cur.app.showAppsBox(e,t)},onFail:e=>(this.errorHandler(e),!0)}):ajax.post("apps.php",t,{onDone:e=>{this.handleResponse(e,{},this.checkIntroData)},onFail:e=>(this.errorHandler(e),!0)})}checkIntroData(e){e.items.length>0?showBox("apps",{act:"add_vk_app_to_groups_box",app_id:this.app.appId},{params:{dark:1,width:570,bodyStyle:"padding: 22px 0 0"},onFail:function(e){return window.showFastBox(getLang("global_error"),e),!0}}):0===e.items.length&&(this.errorHandler({code:1}),this.noCommunitiesBox=new MessageBox({title:getLang("global_error"),dark:1}).content(getLang("vkapps_no_admin_communities_warning")).addButton(getLang("global_close"),()=>{this.noCommunitiesBox.hide()}).show())}unsetCurHandlers(){cur.vkAppAddToCommunitySuccessHandler=null,cur.vkAppAddToCommunityErrorHandler=null,cur.vkAppShowModal=null,Object(s.isMvk)()&&VKApps.cancelSettings()}addToCommunitySuccessHandler(e){this.successHandler(e),this.unsetCurHandlers()}addToCommunityErrorHandler(e){this.errorHandler(e||{code:4}),this.unsetCurHandlers()}showConfirmationModal(e){return this.params.modal.checkbox=this._getCheckboxParams(e),this.params.modal.isGradientModal="hidden"!==e,this.params.modal.containerId="apps",new Promise((e,t)=>{this.params.modal.allowAction=()=>{this.params.modal.checkbox?e(this.params.modal.checkbox[0].checked):e(!1),o.pop(this.modal)},this.params.modal.cancelAction=()=>{t(),o.pop(this.modal)},this.modal=new h(this.params.modal),o.push(this.modal)})}_getCheckboxParams(e){if("hidden"!==e)return[{title:getLang("apps_add_app_to_community_modal_checkbox_title"),description:getLang("apps_add_app_to_community_modal_checkbox_description"),checked:!1,disabled:"disabled"===e}]}handler(e,t,r){this.setData(e,t),this.callback=r,cur.vkAppAddToCommunitySuccessHandler=this.addToCommunitySuccessHandler,cur.vkAppAddToCommunityErrorHandler=this.addToCommunityErrorHandler,cur.vkAppShowModal=this.showConfirmationModal,this.loadIntroData(e)}}class R extends E{constructor(e){super(e),this.params.handlerName="VKWebAppAddToHomeScreenInfo"}actionHandler(e){this.successHandler({is_feature_supported:!1,is_added_to_home_screen:!1})}}var T=r("c8JK");class D extends E{constructor(e){super(e),this.params.handlerName="VKWebAppCopyText"}copyError(){this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:"Can’t copy text on this device"},this.callback)}actionHandler(e){e.text?Object(T.copyToClipboard)(e.text).then(()=>{this.successHandler({result:!0})}).catch(()=>{this.copyError()}):this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Missing required param "text"'})}}class k extends E{constructor(e){super(e),this.params.handlerName="VKWebAppGetUserInfo",this.callApi=!0,this.useUI=!1}}r("OG14");var I=r("9kLB");class M extends E{constructor(e){super(e),this.params.handlerName="VKWebAppSetLocation"}actionHandler(e){e.hasOwnProperty("location")?"string"==typeof e.location?(Object(s.isMvk)()?nav.set({replace:!0,nav:{push:location.pathname+location.search+"#"+e.location,path:location.pathname,hash:"#"+e.location}}):cur.app.funcs.setLocation(e.location),St({handler:I.CONNECT_EVENTS.LOCATION_CHANGED,params:{location:e.location}},this.app),this.successHandler({result:!0})):this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "location" should be a string'}):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "location"'})}}class L extends E{constructor(e){super(e),this.params.handlerName="VKWebAppGetClientVersion"}actionHandler(e){var t=i.PLATFORM.WEB;Object(s.isMvk)()&&(t=i.PLATFORM.MOBILE_WEB),this.successHandler({platform:t,version:"0.0"},this.callback)}}function x(){return(x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class N extends E{constructor(e){super(e),this.params.handlerName="VKWebAppGetPhoneNumber",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_request_phone"),text:getLang("apps_connect_modal_messages_request_phone_text")},this.callApi=!0,this.useUI=!0}loadIntroData(e){this.request=x({},e),ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[i.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"]+"_hash"],event:i.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"],app_id:this.app.appId},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var r=JSON.parse(t);this.checkIntroData(r,e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}checkIntroData(e,t){e.hasOwnProperty("phone_number")&&e.sign?this.successHandler(e):this.launchUI(t)}handler(e,t,r){this.setData(e,t),this.callback=r,this.loadIntroData()}}function B(){return(B=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class j extends E{constructor(e){super(e),this.params.handlerName="VKWebAppGetEmail",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_request_email"),text:getLang("apps_connect_modal_messages_request_email_text")},this.callApi=!0,this.useUI=!0}loadIntroData(e){this.request=B({},e),ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[i.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"]+"_hash"],event:i.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"],app_id:this.app.appId},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var r=JSON.parse(t);this.checkIntroData(r,e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}checkIntroData(e,t){e.hasOwnProperty("email")&&e.sign?this.successHandler(e):this.launchUI(t)}handler(e,t,r){this.setData(e,t),this.callback=r,this.loadIntroData()}}class U extends E{constructor(e){super(e),this.params.handlerName="VKWebAppGetGeodata",this.callApi=!0,this.useUI=!1,this.timeoutFails=0,this.options={maximumAge:15e5,timeout:2e3},this.geodataSuccess=this.geodataSuccess.bind(this),this.geodataFail=this.geodataFail.bind(this)}get successDescriptor(){return"VKWebAppGeodataResult"}get errorDescriptor(){return"VKWebAppGeodataFailed"}geodataSuccess(e){var t=e.coords,r=t.longitude,n=t.latitude,o=t.accuracy;this.successHandler({available:1,lat:n,long:r,accuracy:o},this.callback)}geodataFail(e){switch(e.code){case 3:this.timeoutFails++,this.timeoutFails<2?navigator.geolocation.getCurrentPosition(this.geodataSuccess,this.geodataFail,this.options):this.successHandler({available:0},this.callback);break;case 2:this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:"Device can't get geodata"},this.callback);break;case 1:this.errorHandler({code:i.ERROR_CODES.USER_DENIED,reason:"User didn't allowed"},this.callback)}}actionHandler(e){if(!this.callApi)return{};navigator.geolocation.getCurrentPosition(this.geodataSuccess,this.geodataFail,this.options)}}class W extends E{constructor(e){super(e),this.params.handlerName="VKWebAppOpenQR"}actionHandler(e){this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}}class H extends E{constructor(e){super(e);var t=getLang("apps_connect_modal_messages_send_install_push");this.params.handlerName="VKWebAppSendToClient",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:t.replace("{app_name}",cur.app.options.app_name)},this.callApi=!0,this.useUI=!0}handler(e,t,r){this.setData(e,t),this.props=e,this.callback=r,this.loadIntroData()}loadIntroData(e){ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},{onDone:t=>{var r=JSON.parse(t);this.checkIntroData(r,e)},onFail:()=>{this.sendNetworkError()}})}checkIntroData(e,t){e.result?this.actionHandler():this.launchUI(t)}actionHandler(){return new Promise((e,t)=>{ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId,group_id:this.props.group_id,fragment:this.props.fragment,al:1,cid:0,ref:0},{onDone:t=>{e(t)},onFail:e=>{t(e)}})}).then(()=>{this.successHandler({result:!0})}).catch(()=>{this.sendNetworkError()})}}class K extends E{constructor(e){super(e),this.params.handlerName="VKWebAppSetViewSettings"}actionHandler(e){this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}}class F extends E{constructor(e){super(e),this.params.handlerName="VKWebAppSetTitle"}handler(e,t,r){if(this.setData(e,t),this.callback=r,this.app.isTextliveApp){if(!this.checkParams(e,[{param:"title",type:"string",isRequired:!0}]))return;setDocumentTitle(e.title)}else this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM},r)}}function V(){return(V=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class G extends E{constructor(e){super(e);var t=cur.app.isDirectGame?getLang("vkapps_connect_modal_game_request_token"):getLang("apps_connect_modal_messages_request_token_var");this.params.handlerName="VKWebAppGetAuthToken",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:t.replace("{app_name}",cur.app.options.app_name)},this.callApi=!0,this.useUI=!0,this.onEditClick=this.onEditClick.bind(this)}get successDescriptor(){return"VKWebAppAccessTokenReceived"}get errorDescriptor(){return"VKWebAppAccessTokenFailed"}scopeList(e){var t=this.app.params.whitelist_scopes?e.filter(e=>~this.app.params.whitelist_scopes.indexOf(e)):e;return t=t.filter((e,t,r)=>t===r.indexOf(e))}checkScopes(e){return 0===e.filter(e=>!this.app.params.whitelist_scopes.includes(e)).length}onEditClick(e){this.editScopesModal.renderModal()}launchUI(e){this.createDenyUIAction(),this.createAllowUIAction(e),this.modal=new h(V({},this.params.modal,{},e,{scopes:this.params.scope,showCloseBtn:!0,extraAction:this.onEditClick}));var t=cur.app.isDirectGame?getLang("vkapps_connect_modal_game_request_token_available_title"):getLang("apps_connect_modal_messages_scopes_available");this.editScopesModal=new O(V({},this.params.modal,{},e,{text:t,scopes:this.params.scope,showCloseBtn:!0,allowUIAction:this.allowUIAction})),o.push(this.modal)}actionHandler(e){return this.callApi?ajax.post("apps.php",V({act:"handle_vk_connect_event",hash:cur.app.options[i.VK_CONNECT_EVENTS[this.params.handlerName]+"_hash"],event:i.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId},e),{onDone:e=>{if(e.hasOwnProperty("error"))this.errorHandler(e.error);else try{var t=JSON.parse(e);t.access_token?this.successHandler(V({},t)):this.errorHandler({reason:"Invalid params"})}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)}):{}}loadIntroData(e){this.request=V({},e),this.app.appId==e.app_id?ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[i.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"]+"_hash"],event:i.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"],app_id:this.app.appId,scope:e.scope},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var r=JSON.parse(t);this.checkIntroData(r,e)}catch(e){console.log(e),this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)}):this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:"Wrong app id"})}checkIntroData(e,t){if(e.status){var r={};e.access_token&&(r.access_token=e.access_token),r.scope=this.params.scope.join(","),this.successHandler(r)}else this.launchUI(t)}handler(e,t,r){if(this.setData(e,t),this.callback=r,e.scope||""===e.scope)if("string"==typeof e.scope)if(e.app_id)if("number"==typeof e.app_id){var n=this.scopeStringToArray(e.scope);n&&this.checkScopes(n)?(this.params.scope=this.scopeList(n),this.loadIntroData(e)):this.errorHandler({code:i.ERROR_CODES.UNKNOWN,error_type:i.ERROR_TYPES.CLIENT,reason:i.ERROR_REASONS.UNKNOWN_ERROR},r)}else this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Param "app_id" should be a number'},r);else this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "app_id"'},r);else this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Param "scope" should be a string'},r);else this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "scope"'},r)}}var q=r("d4g6"),Y=r("W9Tc");function z(){return(z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function X(){return(X=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class $ extends E{constructor(e){super(e),this.params.handlerName="VKWebAppCallAPIMethod",this.params.v="5.85",this.params.method=null,this.resolveResponse=this.resolveResponse.bind(this)}actionHandler(e){var t=X({},e.params);e.request_id&&(t.request_id=e.request_id),function(e,t,r,n,o){if(r||(r={}),delete r.callback,t)if(r.hasOwnProperty("access_token")){Object.keys(r).forEach(e=>{"object"==typeof r[e]&&(r[e]=JSON.stringify(r[e]))});var a=z({api_id:e.appId,method:t,format:"json",v:i.API_VERSION},r),s=Object(q.objectToQuerystring)(a),c=new XMLHttpRequest,l=Object(Y.partConfigEnabled)("mini_apps_web_call_api_form_data")&&6911063!==parseInt(e.appId,10);l?(c.open("POST",`https://${e.apiHost}/method/${t}`),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded")):c.open("POST",`https://${e.apiHost}/method/${t}${s}`),c.onload=()=>{if(200==c.status)try{var e=JSON.parse(c.response);r.request_id&&(e.request_id=r.request_id),e.hasOwnProperty("error")?o({reason:e.error}):n(e)}catch(e){o({code:1,reason:e.message})}else o({reason:c.statusText})},c.onerror=()=>{o({code:i.ERROR_CODES.UNKNOWN,error_type:i.ERROR_TYPES.CLIENT,reason:i.ERROR_REASONS.NETWORK_ERROR})},l?c.send(s):c.send()}else o({code:i.ERROR_CODES.MISSING_PARAM,reason:"Missing required param access_token"});else o({code:i.ERROR_CODES.MISSING_PARAM,reason:"Missing required param method"})}({appId:this.app.appId,apiHost:this.app.apiHost},e.method,t,this.successHandler,this.errorHandler)}resolveResponse(e){e&&(e.hasOwnProperty("error")?this.errorHandler(e.error):this.successHandler(e))}handler(e,t,r){this.callback=r,this.setData(e,t),e.params?e.params.v||e.params.version?isNaN(parseInt(e.params.v,10))&&isNaN(parseInt(e.params.version,10))?this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "v" should be a number'},r):(e.params.hasOwnProperty("v")?this.params.v=e.params.v:e.params.hasOwnProperty("version")&&(this.params.v=e.params.version),this.actionHandler(e)):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "v"'},r):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:"Missing required params"},r)}}function J(){return(J=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class Z extends E{constructor(e){super(e),this.callApi=!0,this.useUI=!0,this.allowUIAction=this.allowUIAction.bind(this)}takeAction(){var e,t,r;this.request.intents=[],null===(e=this.params)||void 0===e||null===(t=e.modal)||void 0===t||null===(r=t.checkbox)||void 0===r||r.map(e=>e.name&&this.request.intents.push(e.name)),ajax.post("apps.php",J({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},this.request),{onDone:e=>{e.hasOwnProperty("error")?this.errorHandler(e.error):parseInt(e,10)?this.successHandler({result:!0}):this.errorHandler()},onFail:e=>(this.errorHandler(e),!0)})}loadIntroData(e){this.request=J({},e),ajax.post("apps.php",J({act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},this.request),{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var r=JSON.parse(t),n=r.group.is_closed;this.checkIntroData(J({isGroupMember:r.is_group_member,canJoin:n!==i.GROUP_STATUS.PRIVATE,can_send_messages:r.can_send_messages},r.group),e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}allowUIAction(e){this.takeAction(e),o.pop(this.modal)}checkIntroData(e,t){this.params.modal.pic=e.photo_100,this.params.modal.app_name=e.name,this.params.modal.subscribers=e.members_count>1e3?Math.ceil(e.members_count/1e3):e.members_count,this.params.modal.title=e.name,this.createDenyUIAction(),this.createAllowUIAction(t),this._enhanceBtnsWithActions()}handler(e,t,r){this.setData(e,t),this.callback=r,e.group_id?"number"==typeof e.group_id?this.loadIntroData(e):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Param "group_id" should be a number'},this.callback):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Param "group_id" is missing'},this.callback)}actionHandler(e){this.loadIntroData(e)}}function Q(){return(Q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class ee extends Z{constructor(e){super(e),this.params.handlerName="VKWebAppJoinGroup",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_subscribe"),type:"success"}],text:getLang("apps_connect_modal_messages_join_group_text"),showCloseBtn:!0}}checkIntroData(e,t){super.checkIntroData(e,t),e.isGroupMember?this.successHandler({result:!0}):e.canJoin?(this.modal=new h(Q({},this.params.modal)),o.push(this.modal)):this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:i.ERROR_REASONS.INVALID_PARAMS})}}function te(){return(te=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class re extends Z{constructor(e){super(e),this.params.handlerName="VKWebAppLeaveGroup",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_leave"),type:"success"}],text:getLang("apps_connect_modal_messages_leave_group_text"),showCloseBtn:!0}}checkIntroData(e,t){super.checkIntroData(e,t),e.isGroupMember?(this.modal=new h(te({},this.params.modal)),o.push(this.modal)):this.successHandler({result:!0})}}r("T39b");function ne(){return(ne=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function oe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ie(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ie(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}class ae extends Z{constructor(e){super(e),this.params.handlerName="VKWebAppAllowMessagesFromGroup",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],text:getLang("apps_connect_modal_messages_allow_messages_text"),title:getLang("apps_connect_modal_messages_allow_messages_title")}}checkIntroData(e,t){super.checkIntroData(e,t);var r=this.params.modal;if(e.can_send_messages)this.successHandler({result:!0});else{if(r.text=r.text.replace("{group_name}",e.name),Object(Y.partConfigEnabled)("mini_apps_allow_messages_from_groups_intents")){if(!this.checkParams(t,[{param:"intents",type:"object"},{param:"subscribe_id",type:"array"}]))return;var n=Array.from(new Set(t.intents));if(n){var a={[i.PROMO_NEWSLETTER_INTENT]:{name:i.PROMO_NEWSLETTER_INTENT,title:getLang("apps_intents_promo_newsletter_title"),description:getLang("apps_intents_promo_newsletter_description")},[i.NON_PROMO_NEWSLETTER_INTENT]:{name:i.NON_PROMO_NEWSLETTER_INTENT,title:getLang("apps_intents_promo_non_newsletter_title"),description:getLang("apps_intents_promo_non_newsletter_description")},[i.CONFIRMED_NOTIFICATION_INTENT]:{name:i.CONFIRMED_NOTIFICATION_INTENT,title:getLang("apps_intents_confirmed_notification_title"),description:getLang("apps_intents_confirmed_notification_description")}},c=oe(r.buttons,2),l=c[0],p=c[1];Object(s.isMvk)()&&(r.buttons.reverse(),r.isGradientModal=!0,r.isNoWrapButtons=!0),l.title=getLang("apps_connect_modal_btn_undo"),p.title=getLang("apps_connect_modal_btn_allow_selected"),r.checkbox=r.checkbox||[],n.forEach(e=>{a[e]&&r.checkbox.push(a[e])}),n.length>0&&r.checkbox.unshift({title:getLang("apps_intents_developments_in_apps"),checked:!0,disabled:!0})}}this.modal=new h(ne({},r)),o.push(this.modal)}}}class se extends E{constructor(e){super(e),this.params.handlerName="VKWebAppDenyNotifications",this.callApi=!0,this.useUI=!1}}function ce(){return(ce=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class le extends E{constructor(e){super(e),this.params.handlerName="VKWebAppOpenPayForm",this.checkTransaction=this.checkTransaction.bind(this),this.destroyVkPayContainer=this.destroyVkPayContainer.bind(this)}actionHandler(e){this.app.isMiniAppWidget?this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:"You can not call VKWebAppOpenPayForm from widget"}):e.action?"string"==typeof e.action?e.params?e.hasOwnProperty("app_id")&&"number"!=typeof e.app_id?this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'"app_id" param should be an integer number'}):window.cur&&window.cur.app&&window.cur.app.isDirectGame?this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:"This event supported only for services"}):this.launchVkPayContainer(e):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "params"'}):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Param "action" should be a string'}):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "action"'})}openPayApp(e){var t=ce({},e.params);t.action=e.action,cur.app.funcs.openExternalApp("vkpay",t,this.errorHandler)}checkTransaction(e){var t=!Object(s.isMvk)()||e.origin===location.origin;e.data&&"vk-connect"===e.data.type?e.data.handler===i.VKPAY_TRANSACTION_EVENT&&t&&(e.data.params.status?this.successHandler(ce({},e.data.params),this.callback):this.errorHandler({code:i.ERROR_CODES.UNKNOWN,error_type:i.ERROR_TYPES.CLIENT,reason:ce({},e.data.params,{error_msg:"VK Pay payment failed"})}),Object(s.isMvk)()||this.destroyVkPayContainer()):e.data&&e.data.externalAppClosed&&this.errorHandler({code:i.ERROR_CODES.USER_DENIED,reason:"User denied"})}destroyVkPayContainer(){window.removeEventListener("message",this.checkTransaction)}launchVkPayContainer(e){this.openPayApp(e),window.addEventListener("message",this.checkTransaction)}}function pe(){return(pe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class _e extends E{constructor(e){super(e),this.params.handlerName="VKWebAppAllowNotifications",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_allow_notifications_title"),text:getLang("apps_connect_modal_messages_allow_notifications_text")},this.callApi=!0,this.useUI=!0}takeAction(){var e={group_id:this.request.group_id};this.request.hasOwnProperty("key")&&(e.key=this.request.key),ajax.post("apps.php",pe({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},e),{onDone:e=>{this.handleResponse(e,{},e=>this.successHandler(e))},onFail:e=>(this.errorHandler(e),!0)})}loadIntroData(e){this.request=pe({},e),ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var r=JSON.parse(t);this.checkIntroData(pe({can_send_messages:r.can_send_messages},r.group),e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}allowUIAction(e){this.takeAction(e),o.pop(this.modal)}checkIntroData(e,t){e.can_send_messages?this.successHandler({result:!0}):(this.params.modal.pic="/images/vk-app-notification.png",this.params.modal.picClass="MiniAppModalContainer__pic--small",this.params.modal.app_name=e.name,this.createDenyUIAction(),this.createAllowUIAction(t),this._enhanceBtnsWithActions(),this.modal=new h(pe({},this.params.modal)),o.push(this.modal))}handler(e,t,r){this.setData(e,t),this.callback=r,this.loadIntroData(e)}}function de(){return(de=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class ue extends E{constructor(e){super(e),this.params.handlerName="VKWebAppOpenApp"}actionHandler(e){if(this.app.appId!==e.app_id||Object(q.isVKPayApp)(parseInt(this.app.appId,10))){var t={open_app_id:e.app_id};this.openAppId=e.app_id,e.location&&(t.location=e.location),this.openApp=de({},t),ajax.post("apps.php",de({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},t),{onDone:t=>{try{var r=JSON.parse(t);r.hasOwnProperty("original_url")?(this.successHandler({result:!0}),Object(s.isMvk)()?cur.app.openAppInLayer(r.original_url,!0):(cur.app.openAppInLayer(r.original_url,()=>Object(q.destroyOpenedApp)(e.app_id)),cur.miniAppOpener||(cur.miniAppOpener=this.app))):r.hasOwnProperty("error")&&this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:"Invalid params"})}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}else this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:"Same app id as origin"})}handler(e,t,r){this.setData(e,t),this.callback=r,this.app.isMiniAppWidget?this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:"You can not call VKWebAppOpenApp from widget"},r):e.app_id?"number"==typeof e.app_id?e.hasOwnProperty("location")&&"string"!=typeof e.location?this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'"location" param should be a string'},r):this.actionHandler(e):this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "app_id" should be a number'},r):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "app_id"'},r)}createUrl(e){return`app${e.app_id}${e.hasOwnProperty("location")?"#"+e.location:""}`}}class he extends E{constructor(e){super(e),this.params.handlerName="VKWebAppShare",this.appId=cur.app.params.api_id,this.userId=cur.app.params.viewer_id}actionHandler(e){if(e.link&&"string"!=typeof e.link)this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "link" should be a string'},this.callback);else if(Object(s.isMvk)())this.handleMvk(e);else{var t=String(e.link);t&&t.startsWith("https://vk.com/textlive")?this.shareTextlive(t):t?cur.app.funcs.showWallPostBox({message:t,attachments:t},this.successHandler,this.errorHandler):(this.shareEmitters(),this.share(this.appId,this.userId))}}handleMvk(e){this.shareEmitters(),e.link?cur.app.funcs.shareBox(e.link,"","","",this.successHandler,this.errorHandler):cur.app.funcs.shareBox("https://vk.com/app"+cur.aid,cur.appShareParams.sharePhoto,cur.appShareParams.shareTitle,cur.appShareParams.shareDesc,this.successHandler,this.errorHandler)}share(e,t){showBox("like.php",{act:"publish_box",object:"app"+e+"_"+t},{onFail:()=>{this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:"Unknown error",error_type:"client_error"},this.callback)},params:{onHide:()=>{setTimeout(()=>{cur.app.vkMiniAppShareSuccess&&this.errorHandler({code:i.ERROR_CODES.USER_DENIED,reason:"User denied",error_type:"client_error"},this.callback)},1e3)}}})}shareTextlive(e){var t="";t=e.includes("post_id")?e.replace(/(.*)textlive(\d+)(.*)=(\d+)/i,"textpost$2_$4"):e.replace(/(.*)textlive(\d+)(.*)/i,"textlive$2_0"),showBox("like.php",{act:"publish_box",object:t},{onFail:()=>{this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:"Unknown error",error_type:"client_error"},this.callback)},params:{onHide:()=>{setTimeout(()=>{cur.app.vkMiniAppShareSuccess&&this.errorHandler({code:i.ERROR_CODES.USER_DENIED,reason:"User denied",error_type:"client_error"},this.callback)},1e3)}}})}cleanEmitters(){cur.app.vkMiniAppShareSuccess=null,cur.app.vkMiniAppShareFail=null}shareEmitters(){cur.app.vkMiniAppShareSuccess=e=>{e.post_id?this.successHandler({type:"post",post_id:`${e.owner_id}_${e.post_id}`}):"number"==typeof e&&this.successHandler({type:"message"}),this.cleanEmitters()},cur.app.vkMiniAppShareFail=e=>{e?this.errorHandler(e):this.errorHandler({error_type:"client_error",code:i.ERROR_CODES.USER_DENIED}),this.cleanEmitters()}}}class fe extends E{constructor(e){super(e),this.params.handlerName="VKWebAppShowNewPostBox",this.appId=cur.app.params.api_id,this.userId=cur.app.params.viewer_id}checkFields(e){return this.checkParams(e,[{param:"owner_id",type:"number"},{param:"author_id",type:"number"},{param:"textlive_id",type:"number",isRequired:!1,extraChecks:[{check:()=>i.TEXTLIVE_APPS.includes(cur.app.params.api_id),error:()=>i.ERROR_REASONS.UNKNOWN_ERROR}]},{params:"situational_suggest_id",type:"number"},{params:"post",type:"object"}])}actionHandler(e){Object(s.isMvk)()?this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM}):this.checkFields(e)&&this.open(e)}open(e){this.initEmitters(),cur.getWkviewOpts=()=>({textlive_id:e.textlive_id,author_id:e.author_id,owner_id:e.owner_id,textpost_id:e.post?e.post.id:0,situational_suggest_id:e.situational_suggest_id,post:JSON.stringify(e.post)}),showWiki({w:"postbox"},null,null,{queue:1})}cleanEmitters(){cur.app.vkMiniAppNewPostSuccess=null,cur.app.vkMiniAppNewPostFail=null}initEmitters(){window.cur.app.vkMiniAppNewPostSuccess=e=>{e.post_id?this.successHandler({type:"post",post_id:`${e.owner_id}_${e.post_id}`}):"number"==typeof e&&this.successHandler({type:"message"}),this.cleanEmitters()},window.cur.app.vkMiniAppNewPostFail=e=>{e?this.errorHandler(e):this.errorHandler({error_type:"client_error",code:i.ERROR_CODES.USER_DENIED}),this.cleanEmitters()}}}class me extends E{constructor(e){super(e),this.params.handlerName="VKWebAppShowWallPostBox",this.externalSuccessHandler=this.externalSuccessHandler.bind(this),this.externalErrorHandler=this.externalErrorHandler.bind(this),this.setExternalHandlers()}setExternalHandlers(){cur.VKWebAppShowWallPostBoxErrorHandler=this.externalErrorHandler,cur.VKWebAppShowWallPostBoxSuccessHandler=this.externalSuccessHandler}unsetCurHandlers(){cur.VKWebAppShowWallPostBoxErrorHandler=null,cur.VKWebAppShowWallPostBoxSuccessHandler=null,Object(s.isMvk)()&&VKApps.cancelSettings()}externalSuccessHandler(e){e&&e[1]?this.successHandler({post_id:e[1]}):this.errorHandler(),this.unsetCurHandlers()}externalErrorHandler(){this.errorHandler({code:i.ERROR_CODES.USER_DENIED,reason:"User denied"}),this.unsetCurHandlers()}actionHandler(e){e.hasOwnProperty("message")?e.message&&"string"!=typeof e.message?this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "message" should be a string'},this.callback):(e.message=e.message.replace(/(\r)/g,""),cur.app.funcs.showWallPostBox(e,this.successHandler.bind(this),this.errorHandler.bind(this))):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "message"'})}}class be extends E{constructor(e){super(e),this.params.handlerName="VKWebAppScroll",this.useUI=!1,this.DEFAULT_SPEED=100,this.onScrollEnd=this.onScrollEnd.bind(this)}onScrollEnd(){this.successHandler({result:{top:this.params.data.top,height:document.documentElement.offsetHeight}})}actionHandler(e){if(Object(s.isMvk)())this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback);else if(e.hasOwnProperty("top"))if("number"==typeof e.top)if(e.hasOwnProperty("speed")&&"number"!=typeof e.speed)this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'"speed" param should be a number'});else{var t=e.hasOwnProperty("speed")?e.speed:this.DEFAULT_SPEED;if(this.params.data={top:e.top},~this.app.containerId.indexOf("layer")){var r=ge("wk_layer_wrap");r?r.scrollTop=e.top:this.errorHandler({code:i.ERROR_CODES.UNKNOWN,error_type:i.ERROR_TYPES.CLIENT,reason:i.ERROR_REASONS.UNKNOWN_ERROR})}else this.scroll=new class{constructor(e,t,r){this.desiredOffset=e,this.speed=t,this.onComplete=r}go(){window.Apps.scrollToY(this.desiredOffset,this.speed,void 0,void 0,this.onComplete)}}(e.top,t,this.onScrollEnd.bind(this)),this.scroll.go()}else this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "top" should be a number'});else this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "top"'})}}function Ee(){return(Ee=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class ve extends E{constructor(e){super(e),this.params.handlerName="VKWebAppResizeWindow",this.useUI=!1}setWidth(e){var t=165;e&&this.app.vkApp&&(e=Math.min(Math.max(e,607),1e3),this.app.vkApp.options.layout_width&&(t=this.app.vkApp.options.layout_width-e),this.app.vkApp.options.layer?WkView.onResize():window.handlePageView&&handlePageView({noleftmenu:vk.noleftmenu,nobottommenu:vk.nobottommenu,notopmenu:vk.notopmenu,body_class:vk.body_class,staticheader:vk.staticheader,no_ads:vk.no_ads,ad_preview:vk.ad_preview,top_home_link_class:vk.top_home_link_class,width:Math.max(e,607)+t}),cur.app.frame.style.width=cur.app.cont.style.width=e+"px",this.result.width=e)}setHeight(e){var t=500;if(e){this.app.isTextliveApp&&(t=0),e=Math.min(Math.max(e,t),1e4),this.app.vkApp.inlineApp&&e>this.app.vkApp.options.heightMax&&!this.app.vkApp.params.is_vkpay_service&&(e=this.app.vkApp.options.heightMax);var r=e+"px";cur.app.frame.style.height=r,this.app.vkApp.options.boxed||(cur.app.cont.style.height=r),this.app.vkApp.options.layer&&WkView.onResize(),this.app.vkApp.options.onResize&&this.app.vkApp.options.onResize(),this.result.height=e}}actionHandler(e){Object(s.isMvk)()?this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback):e.hasOwnProperty("width")&&"number"!=typeof e.width?this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "width" should be a number'}):e.hasOwnProperty("height")&&"number"!=typeof e.height?this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "height" should be a number'}):e.hasOwnProperty("height")||e.hasOwnProperty("width")?(this.result={},e.hasOwnProperty("width")&&this.setWidth(e.width),e.hasOwnProperty("height")&&this.setHeight(e.height),this.successHandler({result:Ee({},this.result)})):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:"At least one parameter is required"})}}function Oe(){return(Oe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class we extends E{constructor(e){super(e),this.params.handlerName="VKWebAppSendPayload",this.callApi=!0,this.useUI=!1}handler(e,t,r){if(this.setData(e,t),this.callback=r,e.group_id)if("number"==typeof e.group_id)if(e.hasOwnProperty("payload")&&"object"!=typeof e.payload)this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'"payload" param should be an object'},r);else{try{e.payload=JSON.stringify(e.payload)}catch(e){this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "payload" is not valid JSON object'},r)}this.actionHandler(e)}else this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "group_id" should be a number'},r);else this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Missing required param "group_id"'},r)}actionHandler(e){return ajax.post("apps.php",Oe({act:"handle_vk_connect_event",hash:cur.app.options[i.VK_CONNECT_EVENTS[this.params.handlerName]+"_hash"],event:i.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId},e),{onDone:t=>{try{var r=JSON.parse(t);r.hasOwnProperty("error")?this.errorHandler(r.error,this.callback,i.ERROR_TYPES.API):r.status?this.successHandler(Oe({},r,{scope:e.scope})):this.errorHandler({reason:"Invalid params"})}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}}r("SRfc");var ye=/^https:\/\/(?:(?:.*)\.)*vk.com(\/@[a-z0-9_-]+)$/im;class Ae extends E{constructor(e){super(e),this.params.handlerName="VKWebAppOpenArticle",this.callApi=!1,this.useUI=!0}launchUI(e){var t=e.url,r=void 0===t?"":t,n=r.match(ye);if(n&&n[1]){var o=n[1];if(Object(s.isMvk)()){var a=window.location.pathname.substr(1);window.nav.go(`${o}?from=${a}`)}else window.show(boxLoader),window.show(boxLayerWrap),window.boxRefreshCoords(boxLoader),window.articlePrepare(o,{onEducationCloseBtnClick:e=>this.successReadHandler(e),onFailCallBack:()=>{window.hide(boxLoader),window.hide(boxLayerWrap),this.errorHandler({code:i.ERROR_CODES.UNKNOWN,error_type:i.ERROR_TYPES.CLIENT,reason:"ServerError: Can't open article."})}},()=>{window.hide(boxLoader),window.hide(boxLayerWrap),window.nav.go(o),this.successHandler({result:!0})})}else this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:"Error: incorrect url: "+r})}successReadHandler(e){this.callback({type:"VKWebAppArticleClosed",data:e},this.params.handlerName),Object(s.isMvk)()&&cur.app.frame.focus()}}function Se(){return(Se=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class Ce extends E{constructor(e){super(e),this.params.handlerName="VKWebAppUpdateConfig"}get successDescriptor(){return""+this.params.handlerName}get errorDescriptor(){return this.params.handlerName+"Failed"}actionHandler(e){var t,r={api_host:e.api_host,scheme:e.scheme||i.CLIENT_SCHEME.BRIGHT_LIGHT};if(e.viewport_width)if(e.viewport_height){var n=null===(t=cur.app)||void 0===t?void 0:t.options.layer;n&&(r.is_layer=n),Object(s.isMvk)()?this.successHandler(Se({},r),this.callback):this.successHandler(Se({},r,{viewport_width:e.viewport_width,viewport_height:e.viewport_height}),this.callback)}else this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Missing required param "viewport_height"'});else this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Missing required param "viewport_width"'})}}class Pe extends E{constructor(e){super(e),this.params.handlerName="VKWebAppTapticImpactOccurred"}actionHandler(e){this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}}class Re extends E{constructor(e){super(e),this.params.handlerName="VKWebAppTapticNotificationOccurred"}actionHandler(e){this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}}class Te extends E{constructor(e){super(e),this.params.handlerName="VKWebAppTapticSelectionChanged"}actionHandler(e){this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}}class De extends E{constructor(e){super(e),this.params.handlerName="VKWebAppShowImages"}checkUrlString(e){try{return!!new URL(e)}catch(e){return!1}}handler(e,t,r){if(this.setData(e,t),this.callback=r,Object(s.isMvk)()){var n=window.photoview,o=e.start_index,a=e.images;if(this.checkParams(e,[{param:"images",type:"object",isRequired:!0,extraChecks:[{check:e=>e.every(e=>this.checkUrlString(e)),error:e=>`Param "${e}" should be a valid link.`},{check:e=>e.every(e=>e.startsWith("https://")),error:e=>`Param "${e}" should be https link.`}]},{param:"start_index",type:"number",extraChecks:[{check:e=>e>=0,error:e=>`Param "${e}" should be non-negative number.`},{check:e=>void 0!==a[e],error:e=>`Param "${e}" should be a valid index in the pictures array.`}]}])){var c=o||0,l=a.map(e=>({src:e}));n.open(c,l,{showControls:!1}),this.successHandler({result:!0})}}else this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM},r)}}function ke(){return(ke=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var Ie={error_type:"client_error",code:i.ERROR_CODES.CONNECTION_LOST};class Me extends E{constructor(e){super(e),this.showConfirm=e=>{this.params.modal.pic=e.photo_url,this.params.modal.title=e.title,this.params.modal.text=e.message,this.modal=new h(ke({},this.params.modal)),o.push(this.modal);var t=document.querySelector(".vk_app_modal_container__pic");t&&(t.onload=()=>{t.classList.add("vk_app_modal_container__pic--loaded")})},this.loadItemData=()=>new Promise((e,t)=>{var r=0;this.interval=setInterval(()=>{ajax.post(this.controller,{act:"handle_vk_connect_event",event:this.getEventName(),hash:this.getEventHash(),item_id:this.itemId,order_id:this.orderId,app_id:this.app.appId},{onDone:n=>{switch((n=JSON.parse(n)).hasOwnProperty("error")&&t(n.error),n.status){case"waiting":this.orderId=n.order_id,r++>=30&&t({error_type:"client_error",code:i.ERROR_CODES.CUSTOM,reason:"Can't load product"});break;case"loaded":this.orderId=n.order_id,this.confirmHash=n.confirm_hash,this.orderHash=n.order_hash,e(n.item_data)}},onFail:()=>{t(Ie)}})},1e3)}),this.confirmOrder=()=>{this.hideLoader(),ajax.post(this.controller,{act:"handle_vk_connect_event",event:"confirm_order",item_id:this.itemId,order_id:this.orderId,app_id:this.app.appId,hash:this.confirmHash,order_hash:this.orderHash},{onDone:e=>{"charged"===(e=JSON.parse(e)).status?(this.successHandler({success:!0}),o.pop(this.modal)):(o.pop(this.modal),this.errorHandler(e.error))},onFail:()=>{this.onError(Ie)}})},this.params.handlerName="VKWebAppShowOrderBox",this.useUI=!1,this.callApi=!1,this.controller="/apps",this.itemId="",this.orderId=0,this.params.modal={buttons:[{title:getLang("vkapps_connect_modal_cancel"),type:"deny",action:this.cancel.bind(this)},{title:getLang("vkapps_connect_modal_buy"),type:"success",action:this.confirmOrder}],containerClass:"vk_app_modal_container--order",allowAction:this.confirmOrder,cancelAction:this.cancel.bind(this),picClass:"vk_app_modal_container__pic--buy",withoutAnimation:!0,onlyButtonHide:!0},this.rawData=null}setData(e,t){super.setData(e,t),this.itemId=this.itemId?this.itemId:e.item,this.rawData=e}showLoader(){var e={buttons:[{title:getLang("vkapps_connect_modal_cancel"),type:"deny",action:this.cancel.bind(this)},{title:getLang("vkapps_connect_modal_buy"),type:"success",action:this.cancel.bind(this),disabled:!0}],title:getLang("vkapps_connect_buy_waiting_item_title"),text:getLang("vkapps_connect_buy_waiting_item_desc"),cancelAction:this.cancel.bind(this),picClass:"vk_app_modal_container__pic--loader",pic:"/images/svg_icons/vk_apps/vk_app_spinner_100.svg",containerId:this.params.modal.containerId,onlyButtonHide:!0};this.loader=new h(ke({},e)),o.push(this.loader)}hideLoader(){this.loader&&(o.pop(this.loader),this.loader.destroy()),this.loader=null}handler(e,t,r){this.setData(e,t),this.callback=r,this.rawData.type&&this.rawData.item?Object(s.isMvk)()?(this.showLoader(),this.makeOrder()):(window.cur.app.registerVkBridgeCallback("onOrderCancel",()=>{this.errorHandler({reason:"User denied",code:i.ERROR_CODES.USER_DENIED})}),window.cur.app.registerVkBridgeCallback("onOrderSuccess",e=>{this.successHandler({success:!0,order_id:e})}),window.cur.app.registerVkBridgeCallback("onOrderFail",e=>{this.errorHandler({code:e})}),window.cur.app.funcs.showOrderBox(this.rawData)):this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS})}makeOrder(){this.loadItemData().then(e=>{clearInterval(this.interval),this.hideLoader(),this.showConfirm(e)}).catch(e=>{this.onError(e)})}cancel(){clearInterval(this.interval),this.denyUIAction(),this.hideLoader()}onError(e){clearInterval(this.interval),this.errorHandler(e),o.pop(this.modal),this.hideLoader()}}function Le(){return(Le=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class xe extends E{constructor(e){super(e),this.params.handlerName="VKWebAppShowLeaderBoardBox",this.callApi=!0}actionHandler(e){Object(s.isMvk)()?super.actionHandler(e):this.errorHandler({error_code:i.ERROR_CODES.INVALID_PARAMS,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM})}handleResponse(e,t){if((e=JSON.parse(e)).hasOwnProperty("error"))this.errorHandler({reason:i.ERROR_REASONS.UNKNOWN_ERROR,description:e.error});else{var r=Le({},t,{},e);window.DirectGames.showLeaderBoard({onClose:()=>{this.successHandler({result:!0})},board:r})}}}class Ne extends E{constructor(e){super(e),this.params.handlerName="VKWebAppShowInviteBox",this.callApi=!0}actionHandler(e){Object(s.isMvk)()?window.DirectGames.showInviteBox({onSuccess:super.actionHandler.bind(this),onFail:this.errorHandler}):cur.app.funcs.showInviteBox(this.successHandler.bind(this),this.errorHandler.bind(this))}}class Be extends E{constructor(e){super(e),this.params.handlerName="VKWebAppOpenArticleEditor",this.callApi=!1,this.useUI=!0,this.launchUI=this.launchUI.bind(this)}launchUI(e){if(cur.app.params.open_article_edit&&!window.isMvk){var t=e.owner_id,r=e.article_id,n=e.course_id,o="number"==typeof t,a="number"==typeof r,s="number"==typeof n;t&&o?r&&!a?this.errorHandler({code:a?i.ERROR_CODES.MISSING_PARAM:i.ERROR_CODES.INVALID_PARAMS,reason:`Param "article_id" is wrong. Expected integer greater than 0, got type ${typeof r} with value ${r}.`}):n&&(!s||n<=0)?this.errorHandler({code:s?i.ERROR_CODES.MISSING_PARAM:i.ERROR_CODES.INVALID_PARAMS,reason:`Param "course_id" is wrong. Expected integer greater than 0, got type ${typeof n} with value ${n}.`}):window.openArticleEditor&&window.openArticleEditor(t,r,null,{course_id:n,is_education:n>0?1:0,app_id:this.app.appId,app_hash:this.getEventHash()},{from:"app",eventHandler:this.successHandler.bind(this),errorHandler:this.errorWrapper.bind(this)}):this.errorHandler({code:o?i.ERROR_CODES.MISSING_PARAM:i.ERROR_CODES.INVALID_PARAMS,reason:`Param "owner_id" is missing or wrong. Expected integer, got type ${typeof t} with value ${t}.`})}else this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:window.isMvk?"ClientError: This handler is forbidden on this platform":"ClientError: This app isn't allowed to use this handler"})}errorWrapper(e){this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:e})}}function je(){return(je=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class Ue extends E{constructor(e){super(e),this.params.handlerName="VKWebAppShowRequestBox",this.callApi=!0}actionHandler(e){e.message&&e.message.trim()&&e.uid?Object(s.isMvk)()?ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId,friend_id:e.uid},{onDone:t=>{try{(t=JSON.parse(t)).hasOwnProperty("error")?this.errorHandler({code:t.error.code,reason:t.error.reason},null,i.ERROR_TYPES.API):(Object.assign(e,t),window.DirectGames.showRequestBox(je({},e,{onSuccess:super.actionHandler.bind(this),onFail:this.errorHandler})))}catch(e){this.errorHandler(e)}},onFail:()=>{this.errorHandler({code:i.ERROR_CODES.CONNECTION_LOST,reason:i.ERROR_REASONS.NETWORK_ERROR})}}):(cur.app.registerVkBridgeCallback("onRequestFail",e=>{Object(f.isObject)(e)?this.errorHandler({code:i.ERROR_CODES.CONNECTION_LOST,reason:i.ERROR_REASONS.NETWORK_ERROR}):this.errorHandler({code:i.ERROR_CODES.UNKNOWN,reason:e},null,i.ERROR_TYPES.API)}),cur.app.registerVkBridgeCallback("onRequestCancel",()=>{this.errorHandler({reason:i.ERROR_REASONS.USER_DENIED,code:i.ERROR_CODES.USER_DENIED})}),cur.app.registerVkBridgeCallback("onRequestSuccess",()=>{this.successHandler({request_key:e.requestKey,success:!0})}),cur.app.funcs.showRequestBox(e.uid,e.message,e.requestKey)):this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:i.ERROR_REASONS.INVALID_PARAMS})}}function We(){return(We=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class He extends E{constructor(e){super(e),this.params.handlerName="VKWebAppStorageGetKeys",this.callApi=!0,this.useUI=!1}handler(e,t,r){this.setData(e,t),this.callback=r,e.hasOwnProperty("count")&&"number"!=typeof e.count?this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "count" should be a number'},r):e.hasOwnProperty("offset")&&"number"!=typeof e.offset?this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "offset" should be a number'},r):e.hasOwnProperty("global")&&"boolean"!=typeof e.global?this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "global" should be a boolean'},r):(e.global=e.global?1:0,this.actionHandler(e))}actionHandler(e){return ajax.post("apps.php",We({act:"handle_vk_connect_event",hash:cur.app.options[i.VK_CONNECT_EVENTS[this.params.handlerName]+"_hash"],event:i.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId},e),{onDone:t=>{this.handleResponse(t,e,e=>this.successHandler(e))},onFail:e=>{this.errorHandler(e)}})}}function Ke(){return(Ke=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class Fe extends E{constructor(e){super(e),this.params.handlerName="VKWebAppStorageSet",this.callApi=!0,this.useUI=!1}handler(e,t,r){this.setData(e,t),this.callback=r,e.key?"string"==typeof e.key?e.hasOwnProperty("value")&&"string"!=typeof e.value?this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "value" should be a string'},r):e.hasOwnProperty("global")&&"boolean"!=typeof e.global?this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "global" should be a boolean'},r):(e.global=e.global?1:0,this.actionHandler(e)):this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "key" should be a string'},r):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "key"'},r)}actionHandler(e){return ajax.post("apps.php",Ke({act:"handle_vk_connect_event",hash:cur.app.options[i.VK_CONNECT_EVENTS[this.params.handlerName]+"_hash"],event:i.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId},e),{onDone:t=>{this.handleResponse(t,e,e=>this.successHandler(e))},onFail:e=>{this.errorHandler(e)}})}}function Ve(){return(Ve=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class Ge extends E{constructor(e){super(e),this.params.handlerName="VKWebAppStorageGet",this.callApi=!0,this.useUI=!1}handler(e,t,r){this.setData(e,t),this.callback=r,e.keys?"object"==typeof e.keys?e.hasOwnProperty("global")&&"boolean"!=typeof e.global?this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "global" should be a boolean'},r):(e.global=e.global?1:0,this.actionHandler(e)):this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "keys" should be a string'},r):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "keys"'},r)}actionHandler(e){return ajax.post("apps.php",Ve({act:"handle_vk_connect_event",hash:cur.app.options[i.VK_CONNECT_EVENTS[this.params.handlerName]+"_hash"],event:i.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId},e),{onDone:t=>{this.handleResponse(t,e,e=>this.successHandler(e))},onFail:e=>{this.errorHandler(e)}})}}function qe(){return(qe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class Ye extends E{constructor(e){super(e),this.params.handlerName="VKWebAppAddToFavorites",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_add"),type:"success"}],title:getLang("apps_connect_modal_messages_request_add_to_favorites"),text:getLang("apps_connect_modal_messages_request_add_to_favorites_text"),svgIcon:'<svg class="vk_app_modal_container__pic" width="56" height="56" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0H32V32H0z"/><path d="M15.487 22.565a.985.985 0 0 1 1.026 0l5.682 3.468c.004 0-.509-2.159-1.538-6.476a.983.983 0 0 1 .317-.975l5.056-4.328c.002-.004-2.211-.184-6.639-.54a.984.984 0 0 1-.83-.602L16.005 6.97c-.004-.003-.86 2.045-2.566 6.142a.984.984 0 0 1-.83.602l-6.637.532c-.003.002 1.681 1.448 5.054 4.336.28.24.402.616.317.975l-1.545 6.47c.001.005 1.898-1.15 5.69-3.462zm-4.656 5.146a1.974 1.974 0 0 1-2.947-2.14l1.405-5.886-4.6-3.937a1.97 1.97 0 0 1 1.126-3.462l6.038-.484 2.326-5.587a1.973 1.973 0 0 1 3.642 0l2.326 5.587 6.038.484a1.971 1.971 0 0 1 1.126 3.462l-4.6 3.937 1.405 5.886a1.97 1.97 0 0 1-2.947 2.14L16 24.556l-5.169 3.155z" fill="#528BCC" fill-rule="nonzero"/></g></svg>'},this.callApi=!0,this.useUI=!0}loadIntroData(e){this.request=qe({},e),ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[i.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"]+"_hash"],event:i.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"],app_id:this.app.appId},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var r=JSON.parse(t);this.checkIntroData(r,e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}checkIntroData(e,t){e.added_to_favorites?this.successHandler({result:!0}):this.launchUI(t)}checkResponse(e){Object(s.isMvk)()?this.checkResponseMvk(e):this.checkResponseWeb(e)}checkResponseMvk(e){!0===e.result&&window.cur&&window.cur.VKApp&&(window.cur.VKApp.isFavorite=!window.cur.VKApp.isFavorite,window.DirectGames&&window.DirectGames.initMenu()),super.checkResponse(e)}checkResponseWeb(e){e.result&&e.result.left_nav&&(window.Apps.updateLeftNav(e.result.left_nav),window.Apps.updateAddToMenuAction(),e={result:e.result.success}),super.checkResponse(e)}handler(e,t,r){(Object(Y.partConfigEnabled)("mini_apps_web_add_to_favorites")||cur.app.isDirectGame)&&(this.setData(e,t),this.callback=r,this.loadIntroData())}}r("ls82");function ze(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}class Xe extends E{constructor(e){super(e),this.params.handlerName="VKWebAppAddToMenu",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_add"),type:"success"}],title:getLang("apps_connect_modal_messages_request_add_to_menu"),text:getLang("apps_connect_modal_messages_request_add_to_menu_text"),svgIcon:'<svg class="vk_app_modal_container__pic" width="56" height="56" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0H32V32H0z"/><path d="M15.487 22.565a.985.985 0 0 1 1.026 0l5.682 3.468c.004 0-.509-2.159-1.538-6.476a.983.983 0 0 1 .317-.975l5.056-4.328c.002-.004-2.211-.184-6.639-.54a.984.984 0 0 1-.83-.602L16.005 6.97c-.004-.003-.86 2.045-2.566 6.142a.984.984 0 0 1-.83.602l-6.637.532c-.003.002 1.681 1.448 5.054 4.336.28.24.402.616.317.975l-1.545 6.47c.001.005 1.898-1.15 5.69-3.462zm-4.656 5.146a1.974 1.974 0 0 1-2.947-2.14l1.405-5.886-4.6-3.937a1.97 1.97 0 0 1 1.126-3.462l6.038-.484 2.326-5.587a1.973 1.973 0 0 1 3.642 0l2.326 5.587 6.038.484a1.971 1.971 0 0 1 1.126 3.462l-4.6 3.937 1.405 5.886a1.97 1.97 0 0 1-2.947 2.14L16 24.556l-5.169 3.155z" fill="#528BCC" fill-rule="nonzero"/></g></svg>'},this.callApi=!0,this.useUI=!0}actionHandler(e){var t,r=this;return(t=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((e,t)=>{ajax.post("apps.php",{act:"handle_vk_connect_event",hash:r.getEventHash(),event:r.getEventName(),app_id:r.app.appId,al:1,show:1},{onDone:t=>{e(t)},onFail:e=>{t(e)}})}).then(e=>{var t=window.Apps;t.updateLeftNav(e.left_nav),t.updateAddToMenuAction(!1),t.addToMenuErrorResolve(e),r.successHandler({result:Boolean(e&&e.left_nav)})}).catch(()=>{r.sendNetworkError()}));case 1:case"end":return e.stop()}}),e)})),function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(e){ze(i,n,o,a,s,"next",e)}function s(e){ze(i,n,o,a,s,"throw",e)}a(void 0)}))})()}isAppInLeftMenu(e,t){return new Promise((e,t)=>{ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},{onDone:t=>{e(t)},onFail:e=>{t(e)}})}).then(t=>{e&&e(t.result)}).catch(()=>{t()})}handler(e,t,r){if(Object(Y.partConfigEnabled)("mini_apps_web_add_to_menu")){if(this.setData(e,t),this.callback=r,Object(s.isMvk)())return void this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback);this.isAppInLeftMenu(t=>{t?this.successHandler({result:!0}):this.launchUI(e)})}}}r("Vd3H");function $e(){return($e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class Je extends E{constructor(e){super(e),this.onFlistHide=()=>{this.hasSuccess||this.errorHandler({code:i.ERROR_CODES.USER_DENIED,reason:"User denied"})},this.params.handlerName="VKWebAppGetFriends",this.callApi=!0}loadIntroData(e){var t=this;this.request=$e({},e),cur.onFlistSave=function(){return t.onFlistSave(...arguments)},cur.onFlistHide=this.onFlistHide,showTabbedBox("apps.php",$e({act:"handle_vk_connect_event",hash:cur.app.options[i.VK_CONNECT_EVENTS[""+this.params.handlerName]+"_hash"],event:i.VK_CONNECT_EVENTS[""+this.params.handlerName],app_id:this.app.appId},this.request),{stat:["ui_controls.js","ui_controls.css"]})}onFlistSave(e,t){this.hasSuccess=!0;var r={};r.users=t.friends.map(e=>{var t=e[1].split(" ");return{id:e[0],sex:parseInt(e[5],10),last_name:t[1]?t[1]:"",first_name:t[0],photo_200:e[2]}}),this.request.lists&&(r.lists=t.lists.map(e=>e[0]).sort()),this.successHandler(r)}handler(e,t,r){this.setData(e,t),this.callback=r,Object(s.isMvk)()?this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback):this.checkParams(e,[{param:"multi",type:"boolean"},{param:"lists",type:"boolean"}])&&(e.hasOwnProperty("lists")&&(e.lists=e.lists?1:0),e.hasOwnProperty("multi")&&(e.multi=e.multi?1:0),this.actionHandler(e))}actionHandler(e){this.loadIntroData(e)}}class Ze extends E{constructor(e){super(e),this.params.handlerName="VKWebAppShowCommunityWidgetPreviewBox"}resetBox(){delete cur.onAppWidgetPreviewFail,delete cur.onAppWidgetPreviewCancel,delete cur.onAppWidgetPreviewSuccess,setTimeout((function(){delete cur.appWidgetPreviewBox}),3e3)}actionHandler(e){if(Object(s.isMvk)())this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM});else{if(!this.checkParams(e,[{param:"group_id",type:"number",isRequired:!0},{param:"type",type:"string",isRequired:!0}]))return;this.showWidgetPreviewBox(e)}}showWidgetPreviewBox(e){if(!cur.appWidgetPreviewBox){cur.appWidgetPreviewBox=!0,cur.onAppWidgetPreviewFail=e=>{this.resetBox(),this.errorHandler(e)},cur.onAppWidgetPreviewCancel=()=>{this.resetBox(),this.errorHandler({code:i.ERROR_CODES.USER_DENIED,reason:"User denied"})},cur.onAppWidgetPreviewSuccess=()=>{this.resetBox(),this.successHandler({result:!0})};var t=showBox("apps",{act:"app_widget_preview_box",aid:this.app.appId,hash:cur.app.options.hash,gid:e.group_id,type:e.type,code:e.code},{params:{width:600,containerClass:"apps_app_widget_preview_box"},onDone:()=>{t.setOptions({onHide:()=>{Object(f.isFunction)(cur.onAppWidgetPreviewCancel)&&cur.onAppWidgetPreviewCancel()}})},onFail:e=>(~e.indexOf("413 Request Entity Too Large")&&(e="413 Request Entity Too Large"),Object(f.isFunction)(cur.onAppWidgetPreviewFail)&&cur.onAppWidgetPreviewFail(e),!0)})}}}class Qe extends E{constructor(e){super(e),this.params.handlerName="VKWebAppOpenInNativeApp",this.useUI=!1}actionHandler(e){var t=window.browser,r=t.ipad,n=t.iphone,o=t.android;if(Object(s.isMvk)()&&(r||n||o)){if(!this.checkParams(e,[{param:"link",type:"string",isRequired:!0}]))return;this.openInNativeApp(e.link)}else this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM})}openInNativeApp(e){if(this._openAppInProgress)return!1;var t="vk://vk.com/"+e,r=browser.mi?1500:300;browser.safari&&(r=browser.ios>=12?2800:300);var n=Date.now(),o=setTimeout(()=>{this._openAppInProgress=!1,Date.now()-n>r+200||!document.hasFocus()?this.successHandler({result:!0}):(nav.hard_go("https://vk.cc/dl"),this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.NATIVE_APP_IS_NOT_INSTALLED}))},r),a=()=>{clearTimeout(o),this._openAppInProgress=!1,window.removeEventListener("blur",a)};if(window.addEventListener("blur",a),browser.ios){var s=()=>{window.removeEventListener("focus",s)};window.addEventListener("focus",s)}return this._openAppInProgress=!0,nav.hard_go(t),!1}}class et extends E{constructor(e){super(e),this.params.handlerName="VKWebAppLocationChanged"}get successDescriptor(){return""+this.params.handlerName}actionHandler(e){this.successHandler({location:e.location})}}class tt extends E{constructor(e){super(e),this.params.handlerName="VKWebAppClose"}closeMiniAppPage(e){var t,r=-1,n=window.history.length;if(t=this.app.isTextliveApp&&e.back_url?e.back_url:Object(s.isMvk)()?"/services":"/feed",cur.VKApp){if(2===cur.VKApp.vkMiniAppsHistoryLength&&!document.referrer||1===cur.VKApp.vkMiniAppsHistoryLength)return void nav.go(t);cur.VKApp.vkMiniAppsHistoryLength!==n&&(r=cur.VKApp.vkMiniAppsHistoryLength-n-1)}r<=1?nav.go(t):window.history.go(r)}actionHandler(e){Object(s.isMvk)()?window.opener?(window.opener.postMessage({type:this.params.handlerName,name:this.successDescriptor,eventData:{status:e.status,payload:e.payload}},"*"),window.close()):this.closeMiniAppPage(e):cur.openerAppsQueue&&cur.openerAppsQueue.length>0&&Object.keys(cur.vkAppQueue).length>1?(cur.miniAppOpener&&cur.miniAppOpener.sendIframeMessage(this.successDescriptor,{status:e.status,payload:e.payload}),WkView.hide()):this.closeMiniAppPage(e)}handler(e,t,r){this.setData(e,t),this.callback=r;var n=[{param:"status",type:"string",extraChecks:[{check:e=>i.CLOSE_STATUS.includes(e),error:e=>`Param "${e}" should be "success" or "failed"`}]},{param:"payload",type:"object",isRequired:!1}];this.app.isTextliveApp&&n.push({param:"back_url",type:"string",isRequired:!1}),this.checkParams(e,n)&&this.actionHandler(e)}}var rt=r("bKAG");function nt(){return(nt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class ot extends E{constructor(){super(...arguments),this.params.handlerName="VKWebAppShowStoryBox",this.callApi=!1,this.useUI=!1}get loadFinishDescriptor(){return this.params.handlerName+"LoadFinish"}loadFinishHandler(e){this.callback({type:this.loadFinishDescriptor,data:e},this.params.handlerName)}static isValidUrl(e){try{return!!new URL(e)}catch(e){return!1}}initStoryPublisher(e){window.StoryPublisher&&window.StoryPublisher.init(e,()=>this.successHandler({result:!0}),(e,t)=>{if(!e){var r={code:i.ERROR_CODES.USER_DENIED};return t&&t.error&&t.error.message&&(r.reason=t.error.message),this.errorHandler(r)}if(t&&t.story){var n=t.story,o=n.owner_id,a=n.id;return this.loadFinishHandler({story_owner_id:o,story_id:a})}})}}class it extends ot{actionHandler(e){if(!Object(Y.partConfigEnabled)("web2_story_box_enabled"))return this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM});this.validateParams(e)&&window.stManager.add([window.jsc("web/story_publisher.js")]).then(()=>{this.initStoryPublisher(nt({entrypoint:rt.StoryEntryPoint.MINI_APP,miniAppId:Number(this.app.appId),photoUrl:e.url?e.url:e.blob,stickers:e.stickers,attachment:e.attachment,serviceInfo:e.service_info},e))}).catch(()=>this.errorHandler({code:i.ERROR_CODES.UNKNOWN}))}validateParams(e){return!!this.checkFields(e)&&(!(e.attachment&&!this.checkAttachment(e.attachment))&&(!(e.stickers&&!this.checkStickers(e.stickers))&&!(e.service_info&&!this.checkServiceInfo(e.service_info))))}checkFields(e){return this.checkParams(e,[{param:"background_type",type:"string",isRequired:!0,extraChecks:[{check:e=>"image"===e,error:e=>`Param "${e}" should be a image`}]},{param:"url",type:"string",isRequired:!e.blob,extraChecks:[{check:e=>ot.isValidUrl(e),error:e=>`Param "${e}" incorrect`}]},{param:"blob",type:"string",isRequired:!e.url},{param:"attachment",type:"object"},{param:"stickers",type:"object",extraChecks:[{check:e=>Array.isArray(e),error:e=>`Param "${e}" should be array`}]},{param:"service_info",type:"object"}])}checkAttachment(e){var t=["url","photo","video","audio"],r=["to_store","vote","more","book","order","enroll","fill","signup","buy","ticket","write","open","learn_more","view","go_to","contact","watch","play","install","read","to_memories_app"];return!!this.checkParams(e,[{param:"text",type:"string",isRequired:!0,extraChecks:[{check:e=>r.includes(e),error:e=>`Param "${e}" should be a ${r.join(", ")}`}]},{param:"type",type:"string",isRequired:!0,extraChecks:[{check:e=>t.includes(e),error:e=>`Param "${e}" should be a ${t.join(", ")}`}]}])&&("url"===e.type?this.checkParams(e,[{param:"url",type:"string",isRequired:!0,extraChecks:[{check:e=>ot.isValidUrl(e),error:e=>`Param "${e}" incorrect`}]}]):this.checkParams(e,[{param:"owner_id",type:"number",isRequired:!0},{param:"id",type:"number",isRequired:!0},{param:"access_key",type:"string"}]))}checkStickers(e){return!e.length||e.every(e=>!!this.checkStickerContainer(e)&&!!this.checkSticker(e.sticker_type,e.sticker))}checkServiceInfo(e){return this.checkParams(e,[{param:"open_text_editor",type:"boolean"}])}checkStickerContainer(e){return this.checkParams(e,[{param:"sticker_type",type:"string",isRequired:!0,extraChecks:[{check:e=>["native","renderable"].includes(e),error:e=>`Param "${e}" should be a native or renderable`}]},{param:"sticker",type:"object",isRequired:!0}])}checkSticker(e,t){return"renderable"===e?this.checkRenderableSticker(t):"native"===e?this.checkNativeSticker(t):(this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "sticker_type" should be a native or renderable'}),!1)}checkNativeSticker(e){return!!this.checkParams(e,[{param:"action_type",type:"string",isRequired:!0,extraChecks:[{check:e=>["text","sticker"].includes(e),error:e=>`Param "${e}" should be a text or sticker`}]},{param:"action",type:"object",isRequired:!0},{param:"transform",type:"object",isRequired:!1}])&&(!!this.checkAction(e.action_type,e.action)&&!(e.transform&&!this.checkTransform(e.transform)))}checkAction(e,t){return"text"===e?this.checkParams(t,[{param:"text",type:"string",isRequired:!0},{param:"style",type:"string"},{param:"background_style",type:"string"},{param:"alignment",type:"string"},{param:"selection_color",type:"string"}]):"sticker"===e?this.checkParams(t,[{param:"sticker_id",type:"number",isRequired:!0},{param:"pack_id",type:"number"}]):"link"===e?this.checkParams(t,[{param:"link",type:"string",isRequired:!0},{param:"tooltip_text_key",type:"string"}]):"app"===e?this.checkParams(t,[{param:"app_id",type:"number",isRequired:!0},{param:"app_context",type:"string"}]):"situational_theme"===e?0===Object.keys(t).length||(this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param situational_theme "action" should be empty'}),!1):(this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:'Param "action_type" should be a sticker or text'}),!1)}checkTransform(e){var t=["left_top","left_center","left_bottom","center_top","center","center_bottom","right_top","right_center","right_bottom"];return this.checkParams(e,[{param:"rotation",type:"number",isRequired:!1},{param:"relation_width",type:"number",isRequired:!1},{param:"translation_x",type:"number",isRequired:!1},{param:"translation_y",type:"number",isRequired:!1},{param:"gravity",type:"string",isRequired:!1,extraChecks:[{check:e=>t.includes(e),error:e=>`Param "${e}" should be ${t.join(", ")}`}]}])}checkRenderableSticker(e){return!!this.checkParams(e,[{param:"content_type",type:"string",isRequired:!0,extraChecks:[{check:e=>"image"===e,error:e=>`Param "${e}" should be a image`}]},{param:"url",type:"string",isRequired:!e.blob,extraChecks:[{check:e=>ot.isValidUrl(e),error:e=>`Param "${e}" incorrect`}]},{param:"blob",type:"string",isRequired:!e.url},{param:"transform",type:"object",isRequired:!1},{param:"clickable_zones",type:"object",isRequired:!1,extraChecks:[{check:e=>Array.isArray(e),error:e=>`Param "${e}" should be array`}]}])&&(!(e.transform&&!this.checkTransform(e.transform))&&!(e.clickable_zones&&!this.checkClickableZones(e.clickable_zones)))}checkClickableZones(e){return e.every(t=>!!this.checkClickableZone(t)&&(!!this.checkAction(t.action_type,t.action)&&(!e.clickable_area||(4!==e.clickable_area.length?(this.errorHandler({code:i.ERROR_CODES.UNKNOWN}),!1):e.clickable_area.every(e=>this.checkParams(e,[{param:"x",type:"number",isRequired:!0},{param:"y",type:"number",isRequired:!0}]))))))}checkClickableZone(e){return this.checkParams(e,[{param:"action_type",type:"string",isRequired:!0,extraChecks:[{check:e=>["link","app","situational_theme"].includes(e),error:e=>`Param "${e}" should be a link or app`}]},{param:"action",type:"object",isRequired:!0},{param:"clickable_area",type:"object",extraChecks:[{check:e=>Array.isArray(e),error:e=>`Param "${e}" should be array`}]}])}}class at extends ot{actionHandler(e){if(!Object(Y.partConfigEnabled)("bridge_mobile_story_box_enabled"))return this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM});var t=this.getEventHashes(),r=t.storyUploadUrlHash,n=t.storySaveHash;this.validateParams(e).then(()=>{this.initStoryPublisher(nt({entrypoint:rt.StoryEntryPoint.MINI_APP,miniAppId:Number(this.app.appId),miniAppName:this.app.vkApp.options.app_name,storyUploadUrlHash:r,storySaveHash:n,maxVideoDuration:rt.MAX_STORY_VIDEO_DURATION,closeAfterError:!0},e))}).catch(e=>{e&&this.errorHandler(e)})}validateParams(e){return this.checkFields(e)}checkFields(e){return new Promise((t,r)=>{var n={check:e=>ot.isValidUrl(e),error:e=>`Param "${e}" incorrect`};return this.checkParams(e,[{param:"background_type",type:"string",isRequired:!0,extraChecks:[{check:e=>"image"===e||"video"===e,error:e=>`Param "${e}" should be a image or video`}]},{param:"url",type:"string",isRequired:!e.blob,extraChecks:[n]},{param:"blob",type:"string",isRequired:!e.url,extraChecks:[{check:()=>"image"===e.background_type,error:e=>`Param "${e}" available only for image background_type`},n]}])?t():r()})}}class st{constructor(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Object(s.isMvk)()?new at(...t):new it(...t)}}class ct extends E{constructor(e){super(e),this.params.handlerName="VKWebAppSubscribeStoryApp",this.callApi=!1,this.useUI=!1}actionHandler(e){if(this.validateParams(e)){var t={act:"subscribe_user_to_app",story_owner_id:e.story_owner_id,story_id:e.story_id,access_key:e.access_key,sticker_id:e.sticker_id,hash:this.getEventHash(),app_id:this.app.appId},r=t=>{this.handleResponse(t,e,e=>this.successHandler(e))},n=e=>{this.errorHandler(e)};Object(s.isMvk)()?window.ajax.post("stories.php",t,{onDone:(e,t)=>t?n(t):r(e)}):window.ajax.post("al_stories.php",t,{onDone:r,onFail:n})}}validateParams(e){return this.checkParams(e,[{param:"story_owner_id",type:"number",isRequired:!0},{param:"story_id",type:"number",isRequired:!0},{param:"sticker_id",type:"number",isRequired:!0},{access_key:"string",type:"string",isRequired:!1}])}}class lt extends E{constructor(e){super(e),this.params.handlerName="VKWebAppGetPersonalCard"}actionHandler(){this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}}class pt extends E{constructor(e){super(e),this.params.handlerName="VKWebAppOpenContacts"}actionHandler(){this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}}class _t extends E{constructor(e){super(e),this.params.handlerName="VKWebAppOpenCodeReader"}actionHandler(){this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}}class dt extends E{constructor(){super(...arguments),this.params.handlerName="VKWebAppShowSubscriptionBox"}actionHandler(e){Object(s.isMvk)()?this.errorHandler({error_type:i.ERROR_TYPES.CLIENT,error_code:i.ERROR_CODES.INVALID_PARAMS,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM}):e.hasOwnProperty("action")?~["create","resume","cancel"].indexOf(e.action)?"create"!==e.action||e.hasOwnProperty("item")?"resume"!==e.action&&"cancel"!==e.action||e.hasOwnProperty("subscription_id")?(window.cur.app.registerVkBridgeCallback("onSubscriptionCancel",()=>{this.errorHandler({reason:i.ERROR_REASONS.USER_DENIED,code:i.ERROR_CODES.USER_DENIED})}),window.cur.app.registerVkBridgeCallback("onSubscriptionSuccess",e=>{this.successHandler({success:!0,subscriptionId:e})}),window.cur.app.registerVkBridgeCallback("onSubscriptionFail",e=>{this.errorHandler({reason:"Subscription error",code:e},null,i.ERROR_TYPES.API)}),window.cur.app.funcs.showSubscriptionBox(e.action,e,this.successHandler.bind(this),this.errorHandler.bind(this))):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:i.ERROR_REASONS.INVALID_PARAMS,description:'Missing required param "subscription_id"'}):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:i.ERROR_REASONS.INVALID_PARAMS,description:'Missing required param "item"'}):this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:i.ERROR_REASONS.INVALID_PARAMS,description:'Param "action" must be one of: create, resume or cancel'}):this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:i.ERROR_REASONS.INVALID_PARAMS,description:'Missing required param "action"'})}}class ut extends E{constructor(){super(...arguments),this.params.handlerName="VKWebAppShowInstallPushBox"}actionHandler(e){Object(s.isMvk)()?this.errorHandler({error_type:i.ERROR_TYPES.CLIENT,error_code:i.ERROR_CODES.INVALID_PARAMS,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM}):(window.cur.app.registerVkBridgeCallback("onInstallPushSuccess",()=>{this.successHandler({success:!0})}),window.cur.app.registerVkBridgeCallback("onInstallPushCancel",()=>{this.errorHandler({reason:"User denied",code:i.ERROR_CODES.USER_DENIED})}),window.cur.app.registerVkBridgeCallback("onInstallPushFail",e=>{this.errorHandler({reason:e})}),window.cur.app.funcs.showInstallPushBox(this.successHandler.bind(this),this.errorHandler.bind(this)))}}function ht(){return(ht=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class ft extends E{constructor(e){super(e),this.params.handlerName="VKWebAppGetGroupInfo",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_request_group_info"),text:getLang("apps_connect_modal_messages_request_group_info_text")},this.callApi=!0,this.useUI=!0}launchUI(e){var t=e.groupPhoto,r=e.groupName;t&&(this.params.modal.pic=t),r&&(this.params.modal.title=`${this.params.modal.title} ${r}`),this.createDenyUIAction(),this.createAllowUIAction(e),this.modal=new h(ht({},this.params.modal)),o.push(this.modal)}handler(e,t,r){this.setData(e,t),this.callback=r,this.validateParams(e)&&this.loadIntroData(e)}validateParams(e){return this.checkParams(e,[{param:"group_id",type:"number",isRequired:!0,extraChecks:[{check:e=>e>0,error:e=>`Param "${e}" should be a positive number`}]}])}loadIntroData(e){this.request=ht({},e);var t=e.group_id;ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[i.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"]+"_hash"],event:i.VK_CONNECT_EVENTS[this.params.handlerName+"Preload"],app_id:this.app.appId,group_id:t},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var r=JSON.parse(t);this.checkIntroData(r,e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}checkIntroData(e,t){if(e.hasOwnProperty("error"))this.errorHandler({code:i.ERROR_CODES.ACCESS_DENIED,reason:i.ERROR_REASONS.USER_NOT_A_PRIVATE_GROUP_MEMBER,error_type:i.ERROR_TYPES.CLIENT});else{if(!e.hasOwnProperty("result"))return this.successHandler(e);var r=e.photo_100,n=e.name;this.launchUI(ht({},t,{groupPhoto:r,groupName:n}))}}}class mt extends E{constructor(e){super(e),this.params.handlerName="VKWebAppFlashGetInfo"}actionHandler(e){this.successHandler({is_available:!1})}}var bt="owner_id",Et="post_id";class gt extends E{constructor(e){super(e),this.params.handlerName="VKWebAppOpenWallPost"}_validateParams(e){return this.checkParams(e,[{param:bt,type:"number",isRequired:!0},{param:Et,type:"number",isRequired:!0,extraChecks:[{check:e=>e>0,error:e=>`Param "${e}" should be a positive number`}]}])}actionHandler(e){Object(s.isMvk)()?this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM}):this._validateParams(e)&&this._openLayer(e)}_openLayer(e){var t=e[bt],r=e[Et];showWiki({w:`wall${t}_${r}`},null,null,{queue:1,onLoaded:()=>{this.successHandler({result:!0})},onFail:()=>(this.errorHandler({code:i.ERROR_CODES.UNKNOWN,reason:i.ERROR_REASONS.UNKNOWN_ERROR}),!0)})}}var vt=r("aJgW");class Ot extends E{constructor(e){super(e),this.params.handlerName="VKWebAppGetSilentToken",this.useUI=!0,this.vkConnectIframe=null,this.appIframeParent=null,this.prevAppContainerHeight=0,this.prevAppIframeParentPosition="",this.iframeHandler=this.iframeHandler.bind(this)}launchUI(e){var t=this.app.params;if(this.prevAppContainerHeight=cur.app.frame.offsetHeight,void 0===t.need_policy_confirmation)return this.errorHandler(i.ERROR_REASONS.UNSUPPORTED_ACTION);t.need_policy_confirmation?this.initIframe():this.getSilentTokenForce()}initIframe(){var e=this.getIframeUrl();this.vkConnectIframe=this.createIframe(e),Object(s.isMvk)()||this.resizeHeightContainer(528);var t=this.app.vkApp.frame;this.appIframeParent=t.parentNode,this.prevAppIframeParentPosition=this.appIframeParent.style.position,this.appIframeParent.style.position="relative",this.appIframeParent.appendChild(this.vkConnectIframe),window.addEventListener("message",this.iframeHandler)}createIframe(e){var t=document.createElement("iframe");return t.src=e,t.width="100%",t.height="100%",t.frameBorder="0",t.style.cssText="\n      position: absolute;\n      left: 0;\n      top: 0;\n      z-index: 101;\n      background: transparent;\n    ",t}destroyIframe(){this.vkConnectIframe.remove(),this.appIframeParent.style.position=this.prevAppIframeParentPosition,this.appIframeParent=null,this.vkConnectIframe=null,Object(s.isMvk)()||this.resizeHeightContainer(this.prevAppContainerHeight),window.removeEventListener("message",this.iframeHandler)}iframeHandler(e){var t=this.app.vkApp.options.vk_app_connect_host,r=Object(q.getHostName)(e.origin)===Object(q.getHostName)("https://"+t);e.data&&e.data.type===i.VK_CONNECT_SUPERAPPKIT_EVENT_TYPE&&r&&(e.data.params.error?this.errorHandler(i.ERROR_REASONS.UNKNOWN_ERROR):(this.app.params.need_policy_confirmation=!1,this.successHandler(e.data.params)),this.destroyIframe())}getIframeUrl(){return`https://${this.app.vkApp.options.vk_app_connect_host}/mini_app_confirm_policy${Object(q.objectToQuerystring)({app_id:this.app.appId,origin:location.origin,theme:vt.colorScheme.isDarkScheme()?"dark":"light"})}`}getSilentTokenForce(){return ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},{onDone:e=>{this.handleResponse(e,{},this.checkResponse)},onFail:e=>(this.errorHandler(e),!0)})}resizeHeightContainer(e){cur.app.frame.style.height=e+"px",this.app.vkApp.options.boxed||(cur.app.cont.style.height=e+"px")}}class wt extends E{constructor(e){super(e),this.params.handlerName="VKWebAppOpenReportForm"}checkFields(e){return this.checkParams(e,[{param:"type",type:"string",isRequired:!0,extraChecks:[{check:e=>"situational_post"===e,error:()=>i.ERROR_REASONS.UNKNOWN_ERROR}]},{param:"item_id",type:"number",isRequired:!0}])}actionHandler(e){Object(s.isMvk)()?this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM}):this.checkFields(e)&&this.openReportBox(e)}openReportBox(e){window.stManager.add([window.jsc("web/reports.js"),"reports.css"]).then(()=>{window.showReportBox(e.type,e.owner_id,e.item_id,e=>{e?this.successHandler({success:!0}):this.errorHandler({reason:i.ERROR_REASONS.USER_DENIED,code:i.ERROR_CODES.USER_DENIED})})}).catch(()=>this.errorHandler({code:i.ERROR_CODES.UNKNOWN}))}}function yt(){return(yt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var At=(e,t)=>{var r;if(e.frameId){var n=ge(e.frameId);n&&(r=n.querySelector("iframe"))}else t&&(r=t.querySelector("iframe"));r&&r.contentWindow.postMessage(yt({},e),"*")},St=(e,t)=>{if(n[e.handler]){var r=new n[e.handler]({request_id:e.params.request_id}),o=e=>{ge(t.containerId)&&e&&At(e,ge(t.containerId))};if(Object(Y.partConfigEnabled)("mini_apps_web_flood_control")){if(t.isRequestsLimitReached())return r.callback=o,void r.errorHandler({code:i.ERROR_CODES.REQUESTS_LIMIT_REACHED});t.eventQueue.push({eventData:e,timeInMs:Date.now()})}r.handler(yt({},e.params,{containerId:t.containerId,pic:e.pic}),t,o)}}},lyAj:function(e,t,r){"use strict";r.r(t);r("pIFo"),r("a1Th"),r("Btvt");var n=r("PU8N"),o=r("d4g6");!function(e){if(!e.fastXDM){var t={},r=[],i={};e.fastXDM={_id:0,helperUrl:"https://vk.com/js/api/xdmHelper.js",Server:function(r,n,o){this.methods=r||{},this.filter=n,this.options=o||{},this.id=e.fastXDM._id++,this.key=function(){for(var e="",t=0;t<5;t++)e+=Math.ceil(15*Math.random()).toString(16);return e}(),this.frameName="fXD"+this.key,this.frameId="fXD"+this.key,this.server=!0,this.methods["%init%"]=this.methods.__fxdm_i=function(){e.fastXDM.run(this.id),this.methods.onInit&&this.methods.onInit()},t[this.key]=[_,this]},Client:function(r,n){if(this.methods=r||{},this.options=n||{},this.id=e.fastXDM._id++,this.client=!0,e.fastXDM.run(this.id),0!==window.name.indexOf("fXD"))throw Error("Wrong window.name property.");this.key=window.name.substr(3),this.caller=window.parent,t[this.key]=[_,this],e.fastXDM.on("helper",(function(){e.fastXDM.onClientStart(this)}),this),l((function(e){e.send(this,e.json.stringify(["%init%"]));var t=this.methods;setTimeout((function(){t.onInit&&t.onInit()}),0)}),this)},onMessage:function(r){if(r.origin!==e.location.origin&&cur){var n=cur.app&&cur.app.options&&cur.app.options.src?cur.app.options.src:"";if(!n)return!1;r.origin===n||r.origin+"/"===n.substring(0,r.origin.length+1)||Object(o.isVKMiniAppsHostingStaticUrl)(Object(o.getHostName)(r.origin))||console.warn&&console.warn("Warning: message from "+r.origin+" will be disable in future")}var i=r.data;if(!i)return!1;if("string"!=typeof i&&!(i instanceof String))return!1;var a=i.substr(0,5);if(t[a]){var s=t[a][1];!s||s.filter&&!s.filter(r.origin)||t[a][0](i.substr(6),s)}},setJSON:function(e){i.json=e},getJSON:function(e){if(!e)return i.json;l((function(t){e(t.json)}))},setEnv:function(e){for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);p()},_q:{},on:function(e,t,r){this._q[e]||(this._q[e]=[]),-1==this._q[e]?t.apply(r):this._q[e].push([t,r])},run:function(e){for(var t=(this._q[e]||[]).length,r=0;r<t;r++)this._q[e][r][0].apply(this._q[e][r][1]);this._q[e]=-1},waitFor:a},e.fastXDM.Server.prototype.start=function(t,r){if(t.contentWindow)this.caller=t.contentWindow,this.frame=t,e.fastXDM.on("helper",(function(){e.fastXDM.onServerStart(this)}),this);else{var n=this;(r=r||0)<50&&setTimeout((function(){n.start.apply(n,[t,r+1])}),100)}},e.fastXDM.Server.prototype.destroy=function(){delete t[this.key]},e.fastXDM.Server.prototype.append=function(e,t,r){var o=document.createElement("DIV");o.innerHTML='<iframe name="'+this.frameName+'"  id="'+this.frameId+'" '+(r||"")+"></iframe>";var i=o.firstChild;!Object(n.isMvk)()&&t.vkApp&&window.cur&&window.cur.app&&i.addEventListener("load",(function(){var e=cur.app.cont,t={type:"VKWebAppSettings",frameId:e.id};e.firstElementChild.contentWindow.postMessage(t,"*")}));var a=this,s=function(){i.frameBorder="0",t&&function e(t,r){for(var n in r)t[n]&&"object"==typeof t[n]?e(t[n],r[n]):t[n]=r[n]}(i,t),e.insertBefore(i,e.firstChild),a.start(i)};return!Object(n.isMvk)()&&~e.className.indexOf("app_container--vk-app")&&delete t.scrolling,a.options.layer?s():setTimeout((function(){s()}),0),i},e.fastXDM.Client.prototype.callMethod=e.fastXDM.Server.prototype.callMethod=function(){for(var t=this,r=Array.prototype.slice.call(arguments),n=r.shift(),o=0,i=r.length;o<i;o++)"function"==typeof r[o]?function(){t.funcsCount=(t.funcsCount||0)+1;var e=r[o],n="_func"+t.funcsCount;t.methods[n]=function(){e.apply(this,arguments),delete this.methods[n]},r[o]={_func:t.funcsCount}}():this.options.safe&&(r[o]=c(r[o],!1));a(this,"caller",(function(){e.fastXDM.on(this.id,(function(){l((function(e){e.send(this,e.json.stringify([n,r]))}),this)}),this)}),this)},e.JSON&&"object"==typeof e.JSON&&e.JSON.parse&&e.JSON.stringify&&'{"a":[1,2,3]}'===e.JSON.stringify({a:[1,2,3]}).replace(/ /g,"")?i.json={parse:e.JSON.parse,stringify:e.JSON.stringify}:e.fastXDM._needJSON=!0,e.postMessage?(i.protocol="p",i.send=function(e,t){var r=e.frame?e.frame.contentWindow:e.caller;if(r)try{r.postMessage(e.key+":"+t,"*")}catch(n){window.postMessage.call(r,e.key+":"+t,"*")}},e.addEventListener?e.addEventListener("message",e.fastXDM.onMessage,!1):e.attachEvent("onmessage",e.fastXDM.onMessage),e.fastXDM._needJSON?(e.fastXDM._onlyJSON=!0,s()):p()):s()}function a(e,t,r,n,o){e[t]?r.apply(n):(o=o||0)<1e3&&setTimeout((function(){a(e,t,r,n,o+1)}),0)}function s(t){setTimeout((function(){var r=document.createElement("script");r.type="text/javascript",r.src=t||e.fastXDM.helperUrl,a(document,"body",(function(){document.getElementsByTagName("HEAD")[0].appendChild(r)}))}),0)}function c(e,t){var r;switch(typeof e){case"string":r=t?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):e.replace(/&#039;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&");break;case"object":if("[object Array]"===Object.prototype.toString.apply(e)){r=[];for(var n=0,o=e.length;n<o;n++)r[n]=c(e[n],t)}else for(var i in r={},e)Object.hasOwnProperty.call(e,i)&&(r[i]=c(e[i],t));break;default:r=e}return r}function l(e,t){i.loaded?e.apply(t,[i]):r.push([t,e])}function p(){i.loaded=!0;for(var e=0,t=r.length;e<t;e++)r[e][1].apply(r[e][0],[i])}function _(e,t){l((function(r){var n=r.json.parse(e);if(n[0]){n[1]||(n[1]=[]);for(var o=0,i=n[1].length;o<i;o++)n[1][o]&&n[1][o]._func?function(){var e=n[1][o]._func;n[1][o]=function(){var r=Array.prototype.slice.call(arguments);r.unshift("_func"+e),t.callMethod.apply(t,r)}}():t.options.safe&&(n[1][o]=c(n[1][o],!0));setTimeout((function(){t.methods[n[0]]?t.methods[n[0]].apply(t,n[1]):console.warn("fastXDM: Method "+n[0]+" is undefined")}),0)}}))}}(window)},n4MN:function(e,t,r){"use strict";function n(e,t){void 0===t&&(t=!0);var r=new URL(e),n=new URLSearchParams(r.search.slice(1));return t||n.delete("sign"),n.toString()}r.r(t),r.d(t,"extractVkAppQueryParams",(function(){return n}))},nB7T:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return i}));var n=r("FWc3"),o=r("zxIV");class i{static show(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(window.vk.id){var s=e.tt&&e.tt.container?e.tt.container:null;s&&!Object(o.isVisible)(s)&&(s.classList.remove("tt_left"),s.classList.remove("tt_right"),s.classList.remove("GamesCatalogGameInfoTooltipWrapper--up"));var c,l="left",p=-200,_="",d=document.documentElement.clientWidth,u=document.documentElement.clientHeight,h=e.getBoundingClientRect();return h.left>d-520?(l="right",c=365):c=-h.width-10,h.top>u-400&&(p=0,_="GamesCatalogGameInfoTooltipWrapper--up",s&&s.classList.add(_)),Object(n.showTooltip)(e,{url:"/apps",params:{act:"game_info_tooltip",game_id:t,ref:r,genre_id:i,collection_id:a},className:"GamesCatalogGameInfoTooltipWrapper "+_,dir:l,center:!1,shift:[c,p],hasover:!0,ajaxdt:200,showdt:300,hidedt:300})}}}},qJhe:function(e,t,r){"use strict";r.r(t),r.d(t,"StoryPublisher",(function(){return m}));var n,o=r("q1tI"),i=r("i8i4"),a=r("0fW4"),s=r("EasH"),c=r("6krn"),l=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),p=r("e87a").default,_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.errorHandler=function(e,t){var r=e||Object(c.getLang)("global_error");window.showFastBox({title:Object(c.getLang)("global_error")},r,Object(c.getLang)("global_close"),(function(){t(),window.curBox().hide()}))},t.save=function(e,r,n){var o;void 0===n&&(n={}),t.props.onClickSave(),window.StoryPublisher.saveStory(e,{attachment:JSON.stringify(t.props.attachment),clickable_stickers:n.clickableStickers,mini_app_id:t.props.miniAppId,situational_suggest_id:null===(o=t.props.serviceInfo)||void 0===o?void 0:o.situational_suggest_id,analytics:n.analytics,mediaEditorAnalytics:n.mediaEditorAnalytics,hash:n.storyUploadUrlHash,entry_point:t.props.entrypoint,ref:window.cur.module},n.storySaveHash).then((function(e){t.onClose(!0,!1,e),r()})).catch((function(e){return t.errorHandler(e,r),!0}))},t.onClose=function(e,r,n){var o,i;if(r)t.props.onClose(!1);else if(e)window.Stories&&window.Stories.updateFeedStories&&window.Stories.updateFeedStories(),t.props.onClose(!0,n);else{(null===(i=null===(o=window.cur.photoEditorStore)||void 0===o?void 0:o.getState())||void 0===i?void 0:i.past.length)>1?Object(s.showFastBox)({title:Object(c.getLang)("photos_pe_story_editor_close_title"),bodyStyle:"padding: 20px; line-height: 160%;",dark:1,forceNoBtn:1,onShow:function(){window.cur._noEscHide=!0},onClean:function(){window.cur._noEscHide=!1}},Object(c.getLang)("photos_pe_story_editor_close_text"),Object(c.getLang)("box_yes"),(function(){t.props.onClose(!1),window.curBox().hide()}),Object(c.getLang)("box_no"),(function(){window.curBox().hide()})):t.props.onClose(!1)}},t}return l(t,e),t.prototype.render=function(){var e=this,t=Math.min(900,window.innerHeight-100),r=t/1.78;return o.createElement(p,{disableBodyScroll:!0,onClose:function(){return e.onClose()}},o.createElement(a.default,{context:"story",photoUrl:this.props.photoUrl,artboardWidth:r,artboardHeight:t,save:this.save,close:function(){return e.onClose()},attachment:this.props.attachment,stickers:this.props.stickers,serviceInfo:this.props.serviceInfo}))},t}(o.Component),d=r("ufMw"),u=r("kcIO"),h=r("4+be"),f=r("bKAG"),m={init:function(e,t,r){var n=this;this.onClickSave=t||function(){},this.cb=r,this.loadStatic().then((function(){n.render(e)})).catch((function(e){console.error(e)}))},loadStatic:function(){return window.stManager.add([window.jsc("web/story_publisher.js"),"photo_editor.css"])},render:function(e){var t=(null==e?void 0:e.entrypoint)||"",r=(null==e?void 0:e.miniAppId)||0;window.cur.storyPublishContext=!0,"story_repost"===t?Object(d.sendStat)(d.EVENTS.ADD_STORY_FROM_SHARING):Object(d.sendStat)(d.EVENTS.ADD_STORY);var n=document.querySelector(".StoryPublisher");n||((n=document.createElement("div")).classList.add("StoryPublisher"),document.body.append(n)),i.render(o.createElement(_,{entrypoint:t,miniAppId:r,onClose:this.destroy.bind(this),onClickSave:this.onClickSave.bind(this),photoUrl:null==e?void 0:e.photoUrl,attachment:null==e?void 0:e.attachment,stickers:null==e?void 0:e.stickers,serviceInfo:null==e?void 0:e.serviceInfo}),n)},destroy:function(e,t){var r=document.querySelector(".StoryPublisher");r&&i.unmountComponentAtNode(r),this.cb&&this.cb(e,t),delete window.cur.photoEditorStore,e&&Object(u.showDoneBox)(Object(h.getLang)("photos_pe_story_published"))},saveStory:function(e,t,r){return Object(f.getStoryUploadUrl)(t).then((function(t){return Object(f.uploadStoryBlobToServer)(e,t)})).then((function(e){var t=e.response;return Object(f.saveStoryOnServer)(t&&t.upload_result,r)}))}}},qT12:function(e,t,r){"use strict";var n="function"==typeof Symbol&&Symbol.for,o=n?Symbol.for("react.element"):60103,i=n?Symbol.for("react.portal"):60106,a=n?Symbol.for("react.fragment"):60107,s=n?Symbol.for("react.strict_mode"):60108,c=n?Symbol.for("react.profiler"):60114,l=n?Symbol.for("react.provider"):60109,p=n?Symbol.for("react.context"):60110,_=n?Symbol.for("react.async_mode"):60111,d=n?Symbol.for("react.concurrent_mode"):60111,u=n?Symbol.for("react.forward_ref"):60112,h=n?Symbol.for("react.suspense"):60113,f=n?Symbol.for("react.suspense_list"):60120,m=n?Symbol.for("react.memo"):60115,b=n?Symbol.for("react.lazy"):60116,E=n?Symbol.for("react.block"):60121,g=n?Symbol.for("react.fundamental"):60117,v=n?Symbol.for("react.responder"):60118,O=n?Symbol.for("react.scope"):60119;function w(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case o:switch(e=e.type){case _:case d:case a:case c:case s:case h:return e;default:switch(e=e&&e.$$typeof){case p:case u:case b:case m:case l:return e;default:return t}}case i:return t}}}function y(e){return w(e)===d}t.AsyncMode=_,t.ConcurrentMode=d,t.ContextConsumer=p,t.ContextProvider=l,t.Element=o,t.ForwardRef=u,t.Fragment=a,t.Lazy=b,t.Memo=m,t.Portal=i,t.Profiler=c,t.StrictMode=s,t.Suspense=h,t.isAsyncMode=function(e){return y(e)||w(e)===_},t.isConcurrentMode=y,t.isContextConsumer=function(e){return w(e)===p},t.isContextProvider=function(e){return w(e)===l},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===o},t.isForwardRef=function(e){return w(e)===u},t.isFragment=function(e){return w(e)===a},t.isLazy=function(e){return w(e)===b},t.isMemo=function(e){return w(e)===m},t.isPortal=function(e){return w(e)===i},t.isProfiler=function(e){return w(e)===c},t.isStrictMode=function(e){return w(e)===s},t.isSuspense=function(e){return w(e)===h},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===a||e===d||e===c||e===s||e===h||e===f||"object"==typeof e&&null!==e&&(e.$$typeof===b||e.$$typeof===m||e.$$typeof===l||e.$$typeof===p||e.$$typeof===u||e.$$typeof===g||e.$$typeof===v||e.$$typeof===O||e.$$typeof===E)},t.typeOf=w},sINF:function(e,t,r){"use strict";function n(e){return function(t){var r=t.dispatch,n=t.getState;return function(t){return function(o){return"function"==typeof o?o(r,n,e):t(o)}}}}r.r(t);var o=n();o.withExtraArgument=n,t.default=o},ufMw:function(e,t,r){"use strict";r.r(t),r.d(t,"EVENTS",(function(){return s})),r.d(t,"sendStat",(function(){return l})),r.d(t,"prepareStat",(function(){return p})),r.d(t,"prepareMediaEditorStat",(function(){return _}));var n=r("1y80"),o=r("98sY"),i=r("xYVc"),a=r("W9Tc"),s={FLIP_X:"flipX",FLIP_Y:"flipY",ADD_FILTER:"add_filter",REMOVE_FILTER:"remove_filter",UNDO:"undo",REDO:"redo",ENABLE_AUTOCORRECTION:"enable_autocorrection",DISABLE_AUTOCORRECTION:"disable_autocorrection",ENABLE_BLUR:"enable_blur",DISABLE_BLUR:"disable_blur",ZOOM:"zoom",UNZOOM:"unzoom",TURN_LEFT:"turn_left",TURN_RIGHT:"turn_right",ADD_STORY:"add_story",ADD_STORY_FROM_SHARING:"add_story_from_sharing",CLICK_TO_CAMERA_ICON:"click_to_camera_icon",CLICK_TO_GRADIENT_ICON:"click_to_gradient_icon",ADD_TEXT:"add_text",EDIT_TEXT:"edit_text",DELETE_TEXT:"delete_text",ADD_STICKER:"add_sticker",DELETE_STICKER:"delete_sticker",ADD_GRAFFITI:"add_graffiti",SELECT_BACKGROUND:"select_background"},c=[s.ADD_STORY,s.ADD_STORY_FROM_SHARING,s.CLICK_TO_CAMERA_ICON,s.CLICK_TO_GRADIENT_ICON,s.ADD_TEXT,s.EDIT_TEXT,s.DELETE_TEXT,s.ADD_STICKER,s.DELETE_STICKER,s.ADD_GRAFFITI,s.SELECT_BACKGROUND];function l(e){var t=0,r=0;if(window.cur.pvCurPhoto){var i=window.cur.pvCurPhoto.id.split("_"),s=i[0],l=i[1];t=parseInt(s),r=parseInt(l)}var p={event_type:e,media_type:window.cur.storyPublishContext?"story":"photo",media_owner_id:t,media_id:r};Object(a.partConfigEnabled)("story_publish_analytics_log")&&Object(o.debugLog)(p),Object(n.statlogsValueEvent)("media_editor_product_analytics",p),c.includes(e)&&Object(n.statlogsValueEvent)("story_create_product_analytics",{event_type:e,story_type:"photo"})}function p(e,t,r,n){var o=0,a="photo";r===i.default.BACKGROUND_MODES.BACKGROUND&&(a=(o=n)>100?"emojies":"gradients");var s={has_text:0,has_sticker:0,has_graffiti:0,background_type:a,background_id:o},c=[],l=[],p=[];return e.forEach((function(e){if(e.type===i.default.LAYER_TYPES.STICKER){var t=(a=e).id.split("_"),r=t[0],n=t[1],o=parseInt(r);c.push({id:parseInt(n),pack_id:o||0,type:o?"from_pack":"individual"})}else if(e.type===i.default.LAYER_TYPES.TEXT){var a=e;l.push({text:a.text,font:a.fontStyle,size:Math.round(a.fontSize*i.default.FONT_SIZE_COEFFICIENT),color:a.color.slice(1),background:"none",align:"center"})}})),l.length&&(s.has_text=1,s.texts=l),c.length&&(s.has_sticker=1,s.stickers=c),t.forEach((function(e){p.push({brush:e.opacity,size:e.width,color:e.color.slice(1)})})),p.length&&(s.has_graffiti=1,s.graffities=p),s}function _(e,t){var r=0,n=0;if(window.cur.pvCurPhoto){var o=window.cur.pvCurPhoto.id.split("_"),a=o[0],s=o[1];r=parseInt(a),n=parseInt(s)}var c={media_type:window.cur.storyPublishContext?"story":"photo",media_owner_id:r,media_id:n,is_cropped:t.isCropped,is_autocorrected:t.isAutoCorrection,rotation:t.rotation,filter:t.filter.name,filter_value:100*t.filter.value,ratio:t.cropAspect,photo_correction:[{type:"exposure",value:100*t.colorCorrection.exposure},{type:"contrast",value:100*t.colorCorrection.contrast},{type:"saturation",value:100*t.colorCorrection.saturation},{type:"warmth",value:100*t.colorCorrection.warmth},{type:"vignette",value:100*t.colorCorrection.vignette},{type:"sharpness",value:100*t.colorCorrection.sharpness},{type:"grain",value:100*t.colorCorrection.grain}]};t.blur.isEnabled&&(c.blur_type=t.blur.form,c.blur_value=t.blur.size);var l=[];return e.forEach((function(e){if(e.type===i.default.LAYER_TYPES.TEXT){var t=e;l.push({text:t.text,font:t.fontStyle,size:Math.round(t.fontSize*i.default.FONT_SIZE_COEFFICIENT),color:t.color.slice(1),background:"none",align:"center"})}})),l.length&&(c.has_text=1,c.texts=l),c}},wx14:function(e,t,r){"use strict";function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}r.r(t),r.d(t,"default",(function(){return n}))},xYVc:function(e,t,r){"use strict";r.r(t);var n=r("t7n3"),o=[{title:"photos_pe_crop_aspect_free",value:0},{title:"photos_pe_crop_aspect_original",value:-1},{title:"photos_pe_crop_aspect_16_9",value:16/9},{title:"photos_pe_crop_aspect_4_3",value:4/3},{title:"photos_pe_crop_aspect_1_1",value:1},{title:"photos_pe_crop_aspect_3_4",value:3/4},{title:"photos_pe_crop_aspect_9_16",value:9/16}];t.default={TABS:{STICKERS:"stickers",TEXT:"text",PAINT:"paint",CROP:"crop",FILTERS:"filters",COLOR:"color"},BACKGROUND_MODES:{PHOTO:"photo",BACKGROUND:"background"},STORY_BASE_WIDTH:1080,STORY_BASE_HEIGHT:1920,BOTTOM_PANEL_HEIGHT:50,CANVAS_SCALE:Object(n.isRetina)()?2:1,STICKER_THUMB:"thumb",STICKER_SMALL:64,STICKER_MEDIUM:Object(n.isRetina)()?256:128,STICKER_LARGE:512,COLORS:["#FFFFFF","#000000","#FF3301","#FF8C49","#F9D827","#2EBA48","#4189E8","#9F4BED","#69E4B3","#FF84A0","#F7A978","#F8786C","#8B3232","#93B658","#556E35","#5B4490","#1B1B1B","#333333","#4D4D4D","#666666","#808080","#999999","#B3B3B3","#CCCCCC"],FONTS:["classic","cursive","marker","italics","typewriter","poster","retro","impact","lobster"],BRUSH_WIDTH_COEFFICIENT:40,FONT_SIZE_COEFFICIENT:100,PHOTO_FILTERS:["regular","nox","vesper","latona","liber","luna","minerva","mitra","pro","terra","veles","vesta","zaria","sepia","genius","horus","fortuna"],COLOR_CORRECTION:["exposure","contrast","saturation","warmth","vignette","sharpness","grain"],BLUR_TYPES:{ROUND:"round",RECTANGULAR:"rectangular"},AVERAGE_COLORS_MAP:[{s:12,v:-40},{s:9,v:-30},{s:6,v:-20},{s:3,v:-10},{s:0,v:0},{s:-3,v:10},{s:-6,v:20},{s:-9,v:30},{s:-12,v:40}],LAYER_TYPES:{STICKER:"sticker",TEXT:"text",IMAGE:"image",BACKGROUND:"background"},LAYER_MIN_SIZE:30,LAYER_DEFAULT_SIZE:128,CONTEXT_TYPES:{PHOTO:"photo",STORY:"story"},FILTER_PREVIEW_WIDTH:127,FILTER_PREVIEW_HEIGHT:95,DRAWING_PREVIEW_WIDTH:270,DRAWING_PREVIEW_HEIGHT:110,CROP_MIN_SIZE:100,CROP_SIDES:{CENTER:"center",NW:"nw",NE:"ne",SW:"sw",SE:"se",N:"n",S:"s",W:"w",E:"e"},CROP_ASPECTS:o,CROP_ASPECT_FREE:0,CROP_ASPECT_ORIGINAL:-1}},xo6n:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return p}));r("KKXr"),r("Vd3H"),r("rGqo"),r("Btvt"),r("91GP");var n=r("UlUB"),o=r("gF8j"),i={id:"active_time",triggerEvents:"mouseover mousedown keypress",timeout:15e3,maxChainInterval:0,doesScrollTriggerIdle:!1,callback:()=>{}};var a=class{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._timeChainStart=void 0,this._timeStart=0,this._timeActivityStart=0,this._sumActiveTime=0,this.opts=Object.assign({},i,e),this._idle=new o.default({id:this.opts.id,element:document,focusElement:window,triggerEvents:this.opts.triggerEvents,idleTimeout:this.opts.timeout}),window.addEventListener("beforeunload",this._onTabClose.bind(this)),this.opts.doesScrollTriggerIdle&&window.addEventListener("scroll",Object(n.throttle)(this._onScroll.bind(this),this.opts.timeout)),this._idle.on("idle",this._onTabInactive.bind(this)),this._idle.on("unidle",this._onTabActive.bind(this)),this._idle.start(),this._timeChainStart=Date.now(),document.activeElement===document.body&&this.start()}_checkTimeLimit(){this._timeStart&&this.opts.maxChainInterval&&(Date.now()-this._timeStart>this.opts.maxChainInterval&&this.endInterval())}_sessionEnd(){this.opts.callback(this.getData())}getData(){var e=Date.now(),t=this._sumActiveTime;return this._timeActivityStart&&(t+=e-this._timeActivityStart),{timeChainStart:this._timeChainStart,timeStart:this._timeStart,timeEnd:e,activeTime:t}}_onTabActive(){this.start()}_onTabInactive(){this.stop()}_onTabClose(){this.endInterval()}_onScroll(){this._idle.unidle(),clearTimeout(this._idleTimeoutHandler),this._idleTimeoutHandler=setTimeout(()=>this._idle.idle(),2*this.opts.timeout)}stop(){this._timeActivityStart&&(this._sumActiveTime+=Date.now()-this._timeActivityStart,this._checkTimeLimit(),this._timeActivityStart=0)}start(){if(this._checkTimeLimit(),!this._timeActivityStart){var e=Date.now();this._timeStart||(this._timeStart=e),this._timeActivityStart=e}}resetToNewTimer(){this._timeStart=0,this._sumActiveTime=0,this._timeActivityStart=0}endInterval(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._timeActivityStart?(e&&this._sessionEnd(),this._idle.stop(),this.resetToNewTimer(),this):this}startInterval(){return this._idle.start(),this.start(),this}},s=r("J8bf"),c=r("W0P9"),l={triggerEvents:"mousemove keydown keypress",timeout:18e4};class p{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.opts=Object.assign({},l,t),this.activeTime=null,this.sessionId=null,this.sessions={},this.appId=e,this.lastIdleTs=0}start(){this._loadSessions(),this.sessionId=this._getSessionId(),Object(c.log)("[AppSessionTimeLogger] started with session id",this.sessionId),this.activeTime=new a({id:"app_"+this.appId,triggerEvents:this.opts.triggerEvents,timeout:this.opts.timeout,doesScrollTriggerIdle:!0,callback:this._saveSession.bind(this)}),this.activeTime._idle.on("idle",this._onIdle.bind(this)),this.activeTime._idle.on("unidle",this._onUnIdle.bind(this)),this.activeTime.start()}stop(){Object(c.log)("[AppSessionTimeLogger] stopped."),this.activeTime&&(this.activeTime.endInterval(),this.activeTime.stop(),this.sessions={},this.activeTime=null)}idle(){this.activeTime&&this.activeTime._idle.cbInactive()}unIdle(){this.activeTime&&this.activeTime._idle.cbActive()}_clearOldSessions(){var e=Object.keys(this.sessions);e.length>10&&(e.sort((e,t)=>{var r=+e.split("_")[1];return+t.split("_")[1]-r}),e.slice(10).forEach(e=>{delete this.sessions[e],Object(c.log)("[AppSessionTimeLogger] deleted old session",e)}))}_saveSession(){this._logSession(),Object(s.setCookie)("remixapp_session",JSON.stringify(this.sessions),.01)}_logSession(){if(this.sessionId&&this.activeTime){this._clearOldSessions();var e=this.activeTime.getData().activeTime;(e=Math.round(e/1e3))>0&&(this.sessions[this.sessionId]=e),Object(c.log)("[AppSessionTimeLogger] Log sessions:",this.sessions)}}_onIdle(){this.lastIdleTs=Date.now()}_onUnIdle(){this.activeTime&&(this.lastIdleTs&&Date.now()-this.lastIdleTs>this.opts.timeout&&(this.activeTime.endInterval(),this.activeTime.startInterval(),this.sessionId=this._getSessionId(),Object(c.log)("[AppSessionTimeLogger] last session is ended after timeout",this.opts.timeout),Object(c.log)("[AppSessionTimeLogger] start new session with id",this.sessionId)),this.lastIdleTs=0)}_getSessionId(){return`${this.appId}_${Date.now()}`}_loadSessions(){var e=Object(s.getCookie)("remixapp_session");if(e)try{this.sessions=JSON.parse(e)}catch(e){this.sessions={}}Object(c.log)("[AppSessionTimeLogger] Load old sessions from cookie",this.sessions)}}},yLpj:function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},z9Td:function(e,t,r){"use strict";r.r(t),r.d(t,"PLATFORM_MVK",(function(){return n}));var n="mvk"},zLVn:function(e,t,r){"use strict";function n(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}r.r(t),r.d(t,"default",(function(){return n}))}});